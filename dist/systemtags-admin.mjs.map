{"version":3,"file":"systemtags-admin.mjs","sources":["../apps/systemtags/src/components/SystemTagForm.vue","../apps/systemtags/src/views/SystemTagsSection.vue","../apps/systemtags/src/admin.ts"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<form class=\"system-tag-form\"\n\t\t:disabled=\"loading\"\n\t\taria-labelledby=\"system-tag-form-heading\"\n\t\t@submit.prevent=\"handleSubmit\"\n\t\t@reset=\"reset\">\n\t\t<h3 id=\"system-tag-form-heading\">\n\t\t\t{{ t('systemtags', 'Create or edit tags') }}\n\t\t</h3>\n\n\t\t<div class=\"system-tag-form__group\">\n\t\t\t<label for=\"system-tags-input\">{{ t('systemtags', 'Search for a tag to edit') }}</label>\n\t\t\t<NcSelectTags v-model=\"selectedTag\"\n\t\t\t\tinput-id=\"system-tags-input\"\n\t\t\t\t:placeholder=\"t('systemtags', 'Collaborative tags …')\"\n\t\t\t\t:fetch-tags=\"false\"\n\t\t\t\t:options=\"tags\"\n\t\t\t\t:multiple=\"false\"\n\t\t\t\tpassthru>\n\t\t\t\t<template #no-options>\n\t\t\t\t\t{{ t('systemtags', 'No tags to select') }}\n\t\t\t\t</template>\n\t\t\t</NcSelectTags>\n\t\t</div>\n\n\t\t<div class=\"system-tag-form__group\">\n\t\t\t<label for=\"system-tag-name\">{{ t('systemtags', 'Tag name') }}</label>\n\t\t\t<NcTextField id=\"system-tag-name\"\n\t\t\t\tref=\"tagNameInput\"\n\t\t\t\t:value.sync=\"tagName\"\n\t\t\t\t:error=\"Boolean(errorMessage)\"\n\t\t\t\t:helper-text=\"errorMessage\"\n\t\t\t\tlabel-outside />\n\t\t</div>\n\n\t\t<div class=\"system-tag-form__group\">\n\t\t\t<label for=\"system-tag-level\">{{ t('systemtags', 'Tag level') }}</label>\n\t\t\t<NcSelect v-model=\"tagLevel\"\n\t\t\t\tinput-id=\"system-tag-level\"\n\t\t\t\t:options=\"tagLevelOptions\"\n\t\t\t\t:reduce=\"level => level.id\"\n\t\t\t\t:clearable=\"false\"\n\t\t\t\t:disabled=\"loading\" />\n\t\t</div>\n\n\t\t<div class=\"system-tag-form__row\">\n\t\t\t<NcButton v-if=\"isCreating\"\n\t\t\t\tnative-type=\"submit\"\n\t\t\t\t:disabled=\"isCreateDisabled || loading\">\n\t\t\t\t{{ t('systemtags', 'Create') }}\n\t\t\t</NcButton>\n\t\t\t<template v-else>\n\t\t\t\t<NcButton native-type=\"submit\"\n\t\t\t\t\t:disabled=\"isUpdateDisabled || loading\">\n\t\t\t\t\t{{ t('systemtags', 'Update') }}\n\t\t\t\t</NcButton>\n\t\t\t\t<NcButton :disabled=\"loading\"\n\t\t\t\t\t@click=\"handleDelete\">\n\t\t\t\t\t{{ t('systemtags', 'Delete') }}\n\t\t\t\t</NcButton>\n\t\t\t</template>\n\t\t\t<NcButton native-type=\"reset\"\n\t\t\t\t:disabled=\"isResetDisabled || loading\">\n\t\t\t\t{{ t('systemtags', 'Reset') }}\n\t\t\t</NcButton>\n\t\t\t<NcLoadingIcon v-if=\"loading\"\n\t\t\t\t:name=\"t('systemtags', 'Loading …')\"\n\t\t\t\t:size=\"32\" />\n\t\t</div>\n\t</form>\n</template>\n\n<script lang=\"ts\">\n/* eslint-disable */\nimport Vue, { type PropType } from 'vue'\n\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcLoadingIcon from '@nextcloud/vue/dist/Components/NcLoadingIcon.js'\nimport NcSelect from '@nextcloud/vue/dist/Components/NcSelect.js'\nimport NcSelectTags from '@nextcloud/vue/dist/Components/NcSelectTags.js'\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\n\nimport { translate as t } from '@nextcloud/l10n'\nimport { showSuccess } from '@nextcloud/dialogs'\n\nimport { defaultBaseTag } from '../utils.js'\nimport { createTag, deleteTag, updateTag } from '../services/api.js'\n\nimport type { Tag, TagWithId } from '../types.js'\n\nenum TagLevel {\n\tPublic = 'Public',\n\tRestricted = 'Restricted',\n\tInvisible = 'Invisible',\n}\n\ninterface TagLevelOption {\n\tid: TagLevel\n\tlabel: string\n}\n\nconst tagLevelOptions: TagLevelOption[] = [\n\t{\n\t\tid: TagLevel.Public,\n\t\tlabel: t('systemtags', 'Public'),\n\t},\n\t{\n\t\tid: TagLevel.Restricted,\n\t\tlabel: t('systemtags', 'Restricted'),\n\t},\n\t{\n\t\tid: TagLevel.Invisible,\n\t\tlabel: t('systemtags', 'Invisible'),\n\t},\n]\n\nconst getTagLevel = (userVisible: boolean, userAssignable: boolean): TagLevel => {\n\tconst matchLevel: Record<string, TagLevel> = {\n\t\t[[true, true].join(',')]: TagLevel.Public,\n\t\t[[true, false].join(',')]: TagLevel.Restricted,\n\t\t[[false, false].join(',')]: TagLevel.Invisible,\n\t}\n\treturn matchLevel[[userVisible, userAssignable].join(',')]\n}\n\nexport default Vue.extend({\n\tname: 'SystemTagForm',\n\n\tcomponents: {\n\t\tNcButton,\n\t\tNcLoadingIcon,\n\t\tNcSelect,\n\t\tNcSelectTags,\n\t\tNcTextField,\n\t},\n\n\tprops: {\n\t\ttags: {\n\t\t\ttype: Array as PropType<TagWithId[]>,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tloading: false,\n\t\t\ttagLevelOptions,\n\t\t\tselectedTag: null as null | TagWithId,\n\t\t\terrorMessage: '',\n\t\t\ttagName: '',\n\t\t\ttagLevel: TagLevel.Public,\n\t\t}\n\t},\n\n\twatch: {\n\t\tselectedTag(tag: null | TagWithId) {\n\t\t\tthis.tagName = tag ? tag.displayName : ''\n\t\t\tthis.tagLevel = tag ? getTagLevel(tag.userVisible, tag.userAssignable) : TagLevel.Public\n\t\t},\n\t},\n\n\tcomputed: {\n\t\tisCreating(): boolean {\n\t\t\treturn this.selectedTag === null\n\t\t},\n\n\t\tisCreateDisabled(): boolean {\n\t\t\treturn this.tagName === ''\n\t\t},\n\n\t\tisUpdateDisabled(): boolean {\n\t\t\treturn (\n\t\t\t\tthis.tagName === ''\n\t\t\t\t|| (\n\t\t\t\t\tthis.selectedTag?.displayName === this.tagName\n\t\t\t\t\t&& getTagLevel(this.selectedTag?.userVisible, this.selectedTag?.userAssignable) === this.tagLevel\n\t\t\t\t)\n\t\t\t)\n\t\t},\n\n\t\tisResetDisabled(): boolean {\n\t\t\tif (this.isCreating) {\n\t\t\t\treturn this.tagName === '' && this.tagLevel === TagLevel.Public\n\t\t\t}\n\t\t\treturn this.selectedTag === null\n\t\t},\n\n\t\tuserVisible(): boolean {\n\t\t\tconst matchLevel: Record<TagLevel, boolean> = {\n\t\t\t\t[TagLevel.Public]: true,\n\t\t\t\t[TagLevel.Restricted]: true,\n\t\t\t\t[TagLevel.Invisible]: false,\n\t\t\t}\n\t\t\treturn matchLevel[this.tagLevel]\n\t\t},\n\n\t\tuserAssignable(): boolean {\n\t\t\tconst matchLevel: Record<TagLevel, boolean> = {\n\t\t\t\t[TagLevel.Public]: true,\n\t\t\t\t[TagLevel.Restricted]: false,\n\t\t\t\t[TagLevel.Invisible]: false,\n\t\t\t}\n\t\t\treturn matchLevel[this.tagLevel]\n\t\t},\n\n\t\ttagProperties(): Omit<Tag, 'id' | 'canAssign'> {\n\t\t\treturn {\n\t\t\t\tdisplayName: this.tagName,\n\t\t\t\tuserVisible: this.userVisible,\n\t\t\t\tuserAssignable: this.userAssignable,\n\t\t\t}\n\t\t},\n\t},\n\n\tmethods: {\n\t\tt,\n\n\t\tasync handleSubmit() {\n\t\t\tif (this.isCreating) {\n\t\t\t\tawait this.create()\n\t\t\t\treturn\n\t\t\t}\n\t\t\tawait this.update()\n\t\t},\n\n\t\tasync create() {\n\t\t\tconst tag: Tag = { ...defaultBaseTag, ...this.tagProperties }\n\t\t\tthis.loading = true\n\t\t\ttry {\n\t\t\t\tconst id = await createTag(tag)\n\t\t\t\tconst createdTag: TagWithId = { ...tag, id }\n\t\t\t\tthis.$emit('tag:created', createdTag)\n\t\t\t\tshowSuccess(t('systemtags', 'Created tag'))\n\t\t\t\tthis.reset()\n\t\t\t} catch (error) {\n\t\t\t\tthis.errorMessage = t('systemtags', 'Failed to create tag')\n\t\t\t}\n\t\t\tthis.loading = false\n\t\t},\n\n\t\tasync update() {\n\t\t\tif (this.selectedTag === null) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst tag: TagWithId = { ...this.selectedTag, ...this.tagProperties }\n\t\t\tthis.loading = true\n\t\t\ttry {\n\t\t\t\tawait updateTag(tag)\n\t\t\t\tthis.selectedTag = tag\n\t\t\t\tthis.$emit('tag:updated', tag)\n\t\t\t\tshowSuccess(t('systemtags', 'Updated tag'))\n\t\t\t\tthis.$refs.tagNameInput?.focus()\n\t\t\t} catch (error) {\n\t\t\t\tthis.errorMessage = t('systemtags', 'Failed to update tag')\n\t\t\t}\n\t\t\tthis.loading = false\n\t\t},\n\n\t\tasync handleDelete() {\n\t\t\tif (this.selectedTag === null) {\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.loading = true\n\t\t\ttry {\n\t\t\t\tawait deleteTag(this.selectedTag)\n\t\t\t\tthis.$emit('tag:deleted', this.selectedTag)\n\t\t\t\tshowSuccess(t('systemtags', 'Deleted tag'))\n\t\t\t\tthis.reset()\n\t\t\t} catch (error) {\n\t\t\t\tthis.errorMessage = t('systemtags', 'Failed to delete tag')\n\t\t\t}\n\t\t\tthis.loading = false\n\t\t},\n\n\t\treset() {\n\t\t\tthis.selectedTag = null\n\t\t\tthis.errorMessage = ''\n\t\t\tthis.tagName = ''\n\t\t\tthis.tagLevel = TagLevel.Public\n\t\t\tthis.$refs.tagNameInput?.focus()\n\t\t},\n\t},\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.system-tag-form {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmax-width: 400px;\n\tgap: 8px 0;\n\n\t&__group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t&__row {\n\t\tmargin-top: 8px;\n\t\tdisplay: flex;\n\t\tgap: 0 4px;\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcSettingsSection :name=\"t('systemtags', 'Collaborative tags')\"\n\t\t:description=\"t('systemtags', 'Collaborative tags are available for all users. Restricted tags are visible to users but cannot be assigned by them. Invisible tags are for internal use, since users cannot see or assign them.')\">\n\t\t<NcLoadingIcon v-if=\"loadingTags\"\n\t\t\t:name=\"t('systemtags', 'Loading collaborative tags …')\"\n\t\t\t:size=\"32\" />\n\n\t\t<SystemTagForm v-else\n\t\t\t:tags=\"tags\"\n\t\t\t@tag:created=\"handleCreate\"\n\t\t\t@tag:updated=\"handleUpdate\"\n\t\t\t@tag:deleted=\"handleDelete\" />\n\t</NcSettingsSection>\n</template>\n\n<script lang=\"ts\">\n/* eslint-disable */\nimport Vue from 'vue'\n\nimport NcLoadingIcon from '@nextcloud/vue/dist/Components/NcLoadingIcon.js'\nimport NcSettingsSection from '@nextcloud/vue/dist/Components/NcSettingsSection.js'\n\nimport { translate as t } from '@nextcloud/l10n'\nimport { showError } from '@nextcloud/dialogs'\n\nimport SystemTagForm from '../components/SystemTagForm.vue'\n\nimport { fetchTags } from '../services/api.js'\n\nimport type { TagWithId } from '../types.js'\n\nexport default Vue.extend({\n\tname: 'SystemTagsSection',\n\n\tcomponents: {\n\t\tNcLoadingIcon,\n\t\tNcSettingsSection,\n\t\tSystemTagForm,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tloadingTags: false,\n\t\t\ttags: [] as TagWithId[],\n\t\t}\n\t},\n\n\tasync created() {\n\t\tthis.loadingTags = true\n\t\ttry {\n\t\t\tthis.tags = await fetchTags()\n\t\t} catch (error) {\n\t\t\tshowError(t('systemtags', 'Failed to load tags'))\n\t\t}\n\t\tthis.loadingTags = false\n\t},\n\n\tmethods: {\n\t\tt,\n\n\t\thandleCreate(tag: TagWithId) {\n\t\t\tthis.tags.unshift(tag)\n\t\t},\n\n\t\thandleUpdate(tag: TagWithId) {\n\t\t\tconst tagIndex = this.tags.findIndex(currTag => currTag.id === tag.id)\n\t\t\tthis.tags.splice(tagIndex, 1)\n\t\t\tthis.tags.unshift(tag)\n\t\t},\n\n\t\thandleDelete(tag: TagWithId) {\n\t\t\tconst tagIndex = this.tags.findIndex(currTag => currTag.id === tag.id)\n\t\t\tthis.tags.splice(tagIndex, 1)\n\t\t},\n\t},\n})\n</script>\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport Vue from 'vue'\n\nimport SystemTagsSection from './views/SystemTagsSection.vue'\n\nconst SystemTagsSectionView = Vue.extend(SystemTagsSection)\nnew SystemTagsSectionView().$mount('#vue-admin-systemtags')\n"],"names":["tagLevelOptions","t","getTagLevel","userVisible","userAssignable","_sfc_main$1","Vue","NcButton","NcLoadingIcon","NcSelect","NcSelectTags","NcTextField","tag","_a","_b","_c","defaultBaseTag","id","createTag","createdTag","showSuccess","updateTag","deleteTag","_sfc_main","NcSettingsSection","SystemTagForm","fetchTags","showError","tagIndex","currTag","SystemTagsSectionView","SystemTagsSection"],"mappings":"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"}