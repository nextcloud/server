import{m as E,n as f,M as ne,p as m,o as r,t as _,u as d,_ as x,i as C,q as b,V as q,k as H,l as ve,f as u,X as T,a9 as ae,c as V,w as h,d as M,b as S,a2 as de,K as ie,a8 as me,a3 as pe,aa as re,T as B,W as le,$ as ce,ab as fe,ac as he,e as ge,j as te,a7 as be,ad as we,ae as ye,af as _e,s as Ce,F as ke,v as Se,a0 as Y,h as He}from"./check-Ci-sicaQ.chunk.mjs";import{v as Ve,w as Le,x as N,y as Ae,e as Ie,l as xe,_ as ze,g as $e,z as Me,j as G,s as J}from"./Plus-BGKC2YZR.chunk.mjs";import{k as Te,l as se,P as Q,e as Ee,p as De}from"./index-Dr9RAte9.chunk.mjs";import{m as oe,N as Oe}from"./index-DNpw_vcD.chunk.mjs";import{I as Be,a as Ne}from"./TrashCanOutline-DwKWr4VT.chunk.mjs";const Re=["data-timestamp","title","textContent"],qe=E({__name:"NcDateTime",props:{timestamp:{},format:{default:()=>({timeStyle:"medium",dateStyle:"short"})},relativeTime:{type:[Boolean,String],default:"long"},ignoreSeconds:{type:Boolean}},setup(e){const t=e,i=f(()=>({format:t.format})),o=f(()=>({ignoreSeconds:t.ignoreSeconds,relativeTime:t.relativeTime||"long",update:t.relativeTime!==!1})),c=Ve(ne(()=>t.timestamp),i),n=Le(ne(()=>t.timestamp),o),l=f(()=>t.relativeTime?n.value:c.value);return(w,p)=>(r(),m("span",{class:"nc-datetime",dir:"auto","data-timestamp":w.timestamp,title:d(c),textContent:_(l.value)},null,8,Re))}}),Fe='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-backup-restore" viewBox="0 0 24 24"><path d="M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z" /></svg>',Pe={name:"BackupRestoreIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Ue=["aria-hidden","aria-label"],We=["fill","width","height"],Ke={d:"M12,3A9,9 0 0,0 3,12H0L4,16L8,12H5A7,7 0 0,1 12,5A7,7 0 0,1 19,12A7,7 0 0,1 12,19C10.5,19 9.09,18.5 7.94,17.7L6.5,19.14C8.04,20.3 9.94,21 12,21A9,9 0 0,0 21,12A9,9 0 0,0 12,3M14,12A2,2 0 0,0 12,10A2,2 0 0,0 10,12A2,2 0 0,0 12,14A2,2 0 0,0 14,12Z"},je={key:0};function Ze(e,t,i,o,c,n){return r(),m("span",q(e.$attrs,{"aria-hidden":i.title?null:"true","aria-label":i.title,class:"material-design-icon backup-restore-icon",role:"img",onClick:t[0]||(t[0]=l=>e.$emit("click",l))}),[(r(),m("svg",{fill:i.fillColor,class:"material-design-icon__svg",width:i.size,height:i.size,viewBox:"0 0 24 24"},[C("path",Ke,[i.title?(r(),m("title",je,_(i.title),1)):b("",!0)])],8,We))],16,Ue)}const Xe=x(Pe,[["render",Ze]]),Ye={name:"FileCompareIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Ge=["aria-hidden","aria-label"],Je=["fill","width","height"],Qe={d:"M10,18H6V16H10V18M10,14H6V12H10V14M10,1V2H6C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H10V23H12V1H10M20,8V20C20,21.11 19.11,22 18,22H14V20H18V11H14V9H18.5L14,4.5V2L20,8M16,14H14V12H16V14M16,18H14V16H16V18Z"},ei={key:0};function ii(e,t,i,o,c,n){return r(),m("span",q(e.$attrs,{"aria-hidden":i.title?null:"true","aria-label":i.title,class:"material-design-icon file-compare-icon",role:"img",onClick:t[0]||(t[0]=l=>e.$emit("click",l))}),[(r(),m("svg",{fill:i.fillColor,class:"material-design-icon__svg",width:i.size,height:i.size,viewBox:"0 0 24 24"},[C("path",Qe,[i.title?(r(),m("title",ei,_(i.title),1)):b("",!0)])],8,Je))],16,Ge)}const ti=x(Ye,[["render",ii]]),si={name:"ImageOffOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},oi=["aria-hidden","aria-label"],ni=["fill","width","height"],ai={d:"M22 20.7L3.3 2L2 3.3L3 4.3V19C3 20.1 3.9 21 5 21H19.7L20.7 22L22 20.7M5 19V6.3L12.6 13.9L11.1 15.8L9 13.1L6 17H15.7L17.7 19H5M8.8 5L6.8 3H19C20.1 3 21 3.9 21 5V17.2L19 15.2V5H8.8"},ri={key:0};function li(e,t,i,o,c,n){return r(),m("span",q(e.$attrs,{"aria-hidden":i.title?null:"true","aria-label":i.title,class:"material-design-icon image-off-outline-icon",role:"img",onClick:t[0]||(t[0]=l=>e.$emit("click",l))}),[(r(),m("svg",{fill:i.fillColor,class:"material-design-icon__svg",width:i.size,height:i.size,viewBox:"0 0 24 24"},[C("path",ai,[i.title?(r(),m("title",ri,_(i.title),1)):b("",!0)])],8,ni))],16,oi)}const ui=x(si,[["render",li]]),ci={name:"PencilOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},vi=["aria-hidden","aria-label"],di=["fill","width","height"],mi={d:"M14.06,9L15,9.94L5.92,19H5V18.08L14.06,9M17.66,3C17.41,3 17.15,3.1 16.96,3.29L15.13,5.12L18.88,8.87L20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18.17,3.09 17.92,3 17.66,3M14.06,6.19L3,17.25V21H6.75L17.81,9.94L14.06,6.19Z"},pi={key:0};function fi(e,t,i,o,c,n){return r(),m("span",q(e.$attrs,{"aria-hidden":i.title?null:"true","aria-label":i.title,class:"material-design-icon pencil-outline-icon",role:"img",onClick:t[0]||(t[0]=l=>e.$emit("click",l))}),[(r(),m("svg",{fill:i.fillColor,class:"material-design-icon__svg",width:i.size,height:i.size,viewBox:"0 0 24 24"},[C("path",mi,[i.title?(r(),m("title",pi,_(i.title),1)):b("",!0)])],8,di))],16,vi)}const hi=x(ci,[["render",fi]]),gi={key:0,class:"version__image"},bi=["src"],wi={key:2,class:"version__image"},yi={class:"version__info"},_i=["title"],Ci={key:1,class:"version__info","data-cy-files-version-author-name":""},ki={key:0},Si=["title"],Hi={class:"version__info version__info__subline"},Vi=E({__name:"VersionEntry",props:{version:{type:Object,required:!0},fileInfo:{type:Object,required:!0},isCurrent:{type:Boolean,default:!1},isFirstVersion:{type:Boolean,default:!1},loadPreview:{type:Boolean,default:!1},canView:{type:Boolean,default:!1},canCompare:{type:Boolean,default:!1}},emits:["click","compare","restore","delete","label-update-request"],setup(e,{emit:t}){const i=e,o=t,c=(s,v)=>(s&v)!==0,n=H(!1),l=H(!1),w=H(ve("core","capabilities",{files:{version_labeling:!1,version_deletion:!1}})),p=f(()=>Te(i.version.size)),g=f(()=>{const s=i.version.label??"";return i.isCurrent?s===""?u("files_versions","Current version"):`${s} (${u("files_versions","Current version")})`:i.isFirstVersion&&s===""?u("files_versions","Initial version"):s}),a=f(()=>!i.version.author||!i.version.authorName?"":i.version.author===T()?.uid?u("files_versions","You"):i.version.authorName??i.version.author),L=f(()=>oe(i.version.mtime).format("LLLL")),k=f(()=>i.isCurrent?ae()+se("/remote.php/webdav",i.fileInfo.path,i.fileInfo.name):ae()+i.version.url),A=f(()=>w.value.files.version_labeling===!0),F=f(()=>w.value.files.version_deletion===!0),P=f(()=>c(i.fileInfo.permissions,Q.DELETE)),O=f(()=>c(i.fileInfo.permissions,Q.UPDATE)),U=f(()=>!((i.fileInfo.permissions&Q.READ)===0||i.fileInfo.mountType==="shared"&&(i.fileInfo.shareAttributes.find(s=>s.scope==="permissions"&&s.key==="download")||{})?.value===!1));function W(){o("label-update-request")}function K(){o("restore",i.version)}async function j(){await ie(),await ie(),o("delete",i.version)}function Z(){if(!i.canView){window.location.href=k.value;return}o("click",{version:i.version})}function X(){if(!i.canView)throw new Error("Cannot compare version of this file");o("compare",{version:i.version})}return(s,v)=>(r(),V(d(Oe),{class:"version","force-display-actions":!0,"actions-aria-label":d(u)("files_versions","Actions for version from {versionHumanExplicitDate}",{versionHumanExplicitDate:L.value}),"data-files-versions-version":e.version.fileVersion,onClick:Z},{icon:h(()=>[e.loadPreview||n.value?e.version.previewUrl&&!l.value?(r(),m("img",{key:1,src:e.version.previewUrl,alt:"",decoding:"async",fetchpriority:"low",loading:"lazy",class:"version__image",onLoad:v[0]||(v[0]=y=>n.value=!0),onError:v[1]||(v[1]=y=>l.value=!0)},null,40,bi)):(r(),m("div",wi,[S(ui,{size:20})])):(r(),m("div",gi))]),name:h(()=>[C("div",yi,[g.value?(r(),m("div",{key:0,class:"version__info__label","data-cy-files-version-label":"",title:g.value},_(g.value),9,_i)):b("",!0),a.value?(r(),m("div",Ci,[g.value?(r(),m("span",ki,"•")):b("",!0),S(d(Ie),{class:"avatar",user:e.version.author??void 0,size:20,"disable-menu":"","disable-tooltip":"","hide-status":""},null,8,["user"]),C("div",{class:"version__info__author_name",title:a.value},_(a.value),9,Si)])):b("",!0)])]),subname:h(()=>[C("div",Hi,[S(d(qe),{class:"version__info__date","relative-time":"short",timestamp:e.version.mtime},null,8,["timestamp"]),v[2]||(v[2]=C("span",null,"•",-1)),C("span",null,_(p.value),1)])]),actions:h(()=>[A.value&&O.value?(r(),V(d(N),{key:0,"data-cy-files-versions-version-action":"label","close-after-click":!0,onClick:W},{icon:h(()=>[S(hi,{size:22})]),default:h(()=>[M(" "+_(e.version.label===""?d(u)("files_versions","Name this version"):d(u)("files_versions","Edit version name")),1)]),_:1})):b("",!0),!e.isCurrent&&e.canView&&e.canCompare?(r(),V(d(N),{key:1,"data-cy-files-versions-version-action":"compare","close-after-click":!0,onClick:X},{icon:h(()=>[S(ti,{size:22})]),default:h(()=>[M(" "+_(d(u)("files_versions","Compare to current version")),1)]),_:1})):b("",!0),!e.isCurrent&&O.value?(r(),V(d(N),{key:2,"data-cy-files-versions-version-action":"restore","close-after-click":!0,onClick:K},{icon:h(()=>[S(Xe,{size:22})]),default:h(()=>[M(" "+_(d(u)("files_versions","Restore version")),1)]),_:1})):b("",!0),U.value?(r(),V(d(Ae),{key:3,"data-cy-files-versions-version-action":"download",href:k.value,"close-after-click":!0,download:k.value},{icon:h(()=>[S(de,{size:22})]),default:h(()=>[M(" "+_(d(u)("files_versions","Download version")),1)]),_:1},8,["href","download"])):b("",!0),!e.isCurrent&&F.value&&P.value?(r(),V(d(N),{key:4,"data-cy-files-versions-version-action":"delete","close-after-click":!0,onClick:j},{icon:h(()=>[S(Be,{size:22})]),default:h(()=>[M(" "+_(d(u)("files_versions","Delete version")),1)]),_:1})):b("",!0)]),_:1},8,["actions-aria-label","data-files-versions-version"]))}}),Li=x(Vi,[["__scopeId","data-v-e3870fc8"]]),Ai={class:"version-label-modal__info"},Ii=E({__name:"VersionLabelDialog",props:{open:{type:Boolean,default:!1},label:{type:String,default:""}},emits:["update:open","update:label"],setup(e,{emit:t}){const i=e,o=t,c=me("labelInput"),n=H(""),l=f(()=>{const p=[];return i.label.trim()===""?p.push({label:u("files_versions","Cancel")}):p.push({label:u("files_versions","Remove version name"),type:"reset",variant:"error",callback:()=>{w("")}}),[...p,{label:u("files_versions","Save version name"),icon:pe,type:"submit",variant:"primary"}]});re(()=>{n.value=i.label??""}),re(()=>{i.open&&ie(()=>c.value?.focus()),n.value=i.label});function w(p){o("update:label",p)}return(p,g)=>(r(),V(d(xe),{buttons:l.value,"content-classes":"version-label-modal","is-form":"",open:e.open,size:"normal",name:d(u)("files_versions","Name this version"),"onUpdate:open":g[1]||(g[1]=a=>p.$emit("update:open",a)),onSubmit:g[2]||(g[2]=a=>w(n.value))},{default:h(()=>[S(d(ze),{ref_key:"labelInput",ref:c,modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=a=>n.value=a),class:"version-label-modal__input",label:d(u)("files_versions","Version name"),placeholder:d(u)("files_versions","Version name")},null,8,["modelValue","label","placeholder"]),C("p",Ai,_(d(u)("files_versions","Named versions are persisted, and excluded from automatic cleanups when your storage quota is full.")),1)]),_:1},8,["buttons","open","name"]))}}),xi=x(Ii,[["__scopeId","data-v-6a69577b"]]),I=$e().setApp("files_version").detectUser().build(),zi=E({name:"VirtualScrolling",props:{sections:{type:Array,required:!0},containerElement:{type:HTMLElement,default:null},useWindow:{type:Boolean,default:!1},headerHeight:{type:Number,default:75},renderDistance:{type:Number,default:.5},bottomBufferRatio:{type:Number,default:2},scrollToKey:{type:String,default:""}},emits:["need-content"],data(){return{scrollPosition:0,containerHeight:0,rowsContainerHeight:0,resizeObserver:null}},computed:{visibleSections(){I.debug("[VirtualScrolling] Computing visible section",{sections:this.sections});const e=this.containerHeight,t=this.scrollPosition,i=t+e;let o=0,c=0;const n=this.sections.map(a=>(c+=this.headerHeight,{...a,rows:a.rows.reduce((L,k)=>{o=c,c+=k.height;let A=0;return c<t?A=(t-c)/e:o>i&&(A=(o-i)/e),A>this.renderDistance?L:[...L,{...k,distance:A}]},[])})).filter(a=>a.rows.length>0),l=n.flatMap(({rows:a})=>a).flatMap(({items:a})=>a),w=this._rowIdToKeyMap;l.forEach(a=>a.key=w[a.id]);const p=l.map(({key:a})=>a).filter(a=>a!==void 0),g=Object.values(w).filter(a=>!p.includes(a));return l.filter(({key:a})=>a===void 0).forEach(a=>a.key=g.pop()??Math.random().toString(36).substr(2)),this._rowIdToKeyMap=l.reduce((a,{id:L,key:k})=>({...a,[`${L}`]:k}),{}),n},totalHeight(){return this.sections.map(e=>this.headerHeight+e.height).reduce((e,t)=>e+t,0)+0},paddingTop(){if(this.visibleSections.length===0)return 0;let e=0;for(const t of this.sections){if(t.key!==this.visibleSections[0].rows[0].sectionKey){e+=this.headerHeight+t.height;continue}for(const i of t.rows){if(i.key===this.visibleSections[0].rows[0].key)return e;e+=i.height}e+=this.headerHeight}return e},rowsContainerStyle(){return{height:`${this.totalHeight}px`,paddingTop:`${this.paddingTop}px`}},isNearBottom(){const e=this.containerHeight*this.bottomBufferRatio;return this.scrollPosition+this.containerHeight>=this.totalHeight-e},container(){return I.debug("[VirtualScrolling] Computing container"),this.containerElement!==null?this.containerElement:this.useWindow?window:this.$refs.container}},watch:{isNearBottom(e){I.debug("[VirtualScrolling] isNearBottom changed",{value:e}),e&&this.$emit("need-content")},visibleSections(){this.isNearBottom&&this.$emit("need-content")},scrollToKey(e){let t=0;for(const i of this.sections){if(i.key!==e){t+=this.headerHeight+i.height;continue}break}I.debug("[VirtualScrolling] Scrolling to",{currentRowTopDistanceFromTop:t}),this.container.scrollTo({top:t,behavior:"smooth"})}},beforeCreate(){this._rowIdToKeyMap={}},mounted(){this.resizeObserver=new ResizeObserver(e=>{for(const t of e){const i=t.contentRect;t.target===this.container&&(this.containerHeight=i.height),t.target.classList.contains("vs-rows-container")&&(this.rowsContainerHeight=i.height)}}),this.useWindow?(window.addEventListener("resize",this.updateContainerSize,{passive:!0}),this.containerHeight=window.innerHeight):this.resizeObserver.observe(this.container),this.resizeObserver.observe(this.$refs.rowsContainer),this.container.addEventListener("scroll",this.updateScrollPosition,{passive:!0})},beforeUnmount(){this.useWindow&&window.removeEventListener("resize",this.updateContainerSize),this.resizeObserver?.disconnect(),this.container.removeEventListener("scroll",this.updateScrollPosition)},methods:{updateScrollPosition(){this._onScrollHandle??=requestAnimationFrame(()=>{this._onScrollHandle=null,this.useWindow?this.scrollPosition=this.container.scrollY:this.scrollPosition=this.container.scrollTop})},updateContainerSize(){this.containerHeight=window.innerHeight}}}),$i={key:0,ref:"container",class:"vs-container"};function Mi(e,t,i,o,c,n){return!e.useWindow&&e.containerElement===null?(r(),m("div",$i,[C("div",{ref:"rowsContainer",class:"vs-rows-container",style:le(e.rowsContainerStyle)},[B(e.$slots,"default",{visibleSections:e.visibleSections},void 0,!0),B(e.$slots,"loader",{},void 0,!0)],4)],512)):(r(),m("div",{key:1,ref:"rowsContainer",class:"vs-rows-container",style:le(e.rowsContainerStyle)},[B(e.$slots,"default",{visibleSections:e.visibleSections},void 0,!0),B(e.$slots,"loader",{},void 0,!0)],4))}const Ti=x(zi,[["render",Mi],["__scopeId","data-v-b0f92288"]]),Ei="dav",Di=ce(Ei),D=Ne(Di);function ue(e){D.setHeaders({"X-Requested-With":"XMLHttpRequest",requesttoken:e??""})}he(ue),ue(fe());const Oi=`<?xml version="1.0"?>
<d:propfind xmlns:d="DAV:"
	xmlns:oc="http://owncloud.org/ns"
	xmlns:nc="http://nextcloud.org/ns"
	xmlns:ocs="http://open-collaboration-services.org/ns">
	<d:prop>
		<d:getcontentlength />
		<d:getcontenttype />
		<d:getlastmodified />
		<d:getetag />
		<nc:version-label />
		<nc:version-author />
		<nc:has-preview />
	</d:prop>
</d:propfind>`;async function ee(e){const t=`/versions/${T()?.uid}/versions/${e.id}`;try{const i=(await D.getDirectoryContents(t,{data:Oi,details:!0})).data.filter(({mime:n})=>n!=="").map(n=>Ni(n,e)),o=new Set(i.map(n=>String(n.author))),c=await ge.post(te("/displaynames"),{users:[...o]});for(const n of i){const l=c.data.users[n.author??""];l&&(n.authorName=l)}return i}catch(i){throw I.error("Could not fetch version",{exception:i}),i}}async function Bi(e){try{I.debug("Restoring version",{url:e.url}),await D.moveFile(`/versions/${T()?.uid}/versions/${e.fileId}/${e.fileVersion}`,`/versions/${T()?.uid}/restore/target`)}catch(t){throw I.error("Could not restore version",{exception:t}),t}}function Ni(e,t){const i=oe(e.lastmod).unix()*1e3;let o="";return i===t.mtime?o=te("/core/preview?fileId={fileId}&c={fileEtag}&x=250&y=250&forceIcon=0&a=0&forceIcon=1&mimeFallback=1",{fileId:t.id,fileEtag:t.etag}):o=te("/apps/files_versions/preview?file={file}&version={fileVersion}&mimeFallback=1",{file:se(t.path,t.name),fileVersion:e.basename}),{fileId:t.id,label:e.props["version-label"]?String(e.props["version-label"]):"",author:e.props["version-author"]?String(e.props["version-author"]):null,authorName:null,filename:e.filename,basename:oe(i).format("LLL"),mime:e.mime,etag:`${e.props.getetag}`,size:e.size,type:e.type,mtime:i,permissions:"R",previewUrl:o,url:se("/remote.php/dav",e.filename),source:ce("dav")+Ee(e.filename),fileVersion:e.basename}}async function Ri(e,t){return await D.customRequest(e.filename,{method:"PROPPATCH",data:`<?xml version="1.0"?>
					<d:propertyupdate xmlns:d="DAV:"
						xmlns:oc="http://owncloud.org/ns"
						xmlns:nc="http://nextcloud.org/ns"
						xmlns:ocs="http://open-collaboration-services.org/ns">
					<d:set>
						<d:prop>
							<nc:version-label>${t}</nc:version-label>
						</d:prop>
					</d:set>
					</d:propertyupdate>`})}async function qi(e){await D.deleteFile(e.filename)}const Fi={key:0,class:"versions-tab__container"},Pi=["aria-label"],Ui=E({__name:"FilesVersionsSidebarTab",setup(e,{expose:t}){const i=Me(),o=H(null),c=H(!1),n=H([]),l=H(!1),w=H(!1),p=H(null),g=f(()=>[...n.value].sort((s,v)=>o.value===null?0:s.mtime===o.value.mtime?-1:v.mtime===o.value.mtime?1:v.mtime-s.mtime)),a=f(()=>[{key:"versions",rows:g.value.map(s=>({key:s.mtime.toString(),height:68,sectionKey:"versions",items:[{id:s.mtime.toString(),version:s}]})),height:68*g.value.length}]),L=f(()=>n.value.map(s=>s.mtime).reduce((s,v)=>Math.min(s,v))),k=f(()=>{if(o.value===null)return null;let s="";return o.value.permissions&1&&(s+="R"),o.value.permissions&2&&(s+="W"),o.value.permissions&8&&(s+="D"),{...o.value,mime:o.value.mimetype,basename:o.value.name,filename:o.value.path+"/"+o.value.name,permissions:s,fileid:o.value.id}}),A=f(()=>o.value===null?!1:window.OCA.Viewer?.mimetypesCompare?.includes(o.value.mimetype)),F=f(()=>!i.value);be(()=>{we("files_versions:restore:restored",ee)}),ye(()=>{_e("files_versions:restore:restored",ee)}),t({async update(s){o.value=s,j(),P()},async setIsActive(s){c.value=s}});async function P(){try{l.value=!0,n.value=await ee(o.value)}finally{l.value=!1}}async function O(s){const v=o.value;o.value={...o.value,size:s.size,mtime:s.mtime};const y={preventDefault:!1,fileInfo:o.value,version:s};if(Y("files_versions:restore:requested",y),!y.preventDefault)try{await Bi(s),s.label?G(u("files_versions",`${s.label} restored`)):s.mtime===L.value?G(u("files_versions","Initial version restored")):G(u("files_versions","Version restored")),Y("files_versions:restore:restored",s)}catch{o.value=v,J(u("files_versions","Could not restore version")),Y("files_versions:restore:failed",s)}}function U(s){w.value=!0,p.value=s}async function W(s){if(p.value===null)throw new Error("editedVersion should be set at that point");const v=p.value.label;p.value.label=s,w.value=!1;try{await Ri(p.value,s),p.value=null}catch(y){p.value.label=v,J(u("files_versions","Could not set version label")),I.error("Could not set version label",{exception:y})}}async function K(s){const v=n.value.indexOf(s);n.value.splice(v,1);try{await qi(s)}catch{n.value.push(s),J(u("files_versions","Could not delete version"))}}function j(){n.value=[]}function Z({version:s}){if(o.value!==null){if(s.mtime===o.value.mtime){window.OCA.Viewer.open({fileInfo:k.value});return}window.OCA.Viewer.open({fileInfo:{...s,filename:s.mtime===o.value.mtime?De.join("files",T()?.uid??"",o.value.path,o.value.name):s.filename,previewUrl:void 0},enableSidebar:!1})}}function X({version:s}){const v=n.value.map(y=>({...y,previewUrl:void 0}));window.OCA.Viewer.compare(k.value,v.find(y=>y.source===s.source))}return(s,v)=>o.value!==null?(r(),m("div",Fi,[S(Ti,{sections:a.value,"header-height":0},{default:h(({visibleSections:y})=>[C("ul",{"aria-label":d(u)("files_versions","File versions"),"data-files-versions-versions-list":""},[y.length===1?(r(!0),m(ke,{key:0},Se(y[0].rows,$=>(r(),V(Li,{key:$.items[0].version.mtime,"can-view":A.value,"can-compare":F.value,"load-preview":c.value,version:$.items[0].version,"file-info":o.value,"is-current":$.items[0].version.mtime===o.value.mtime,"is-first-version":$.items[0].version.mtime===L.value,onClick:Z,onCompare:X,onRestore:O,onLabelUpdateRequest:Wi=>U($.items[0].version),onDelete:K},null,8,["can-view","can-compare","load-preview","version","file-info","is-current","is-first-version","onLabelUpdateRequest"]))),128)):b("",!0)],8,Pi)]),loader:h(()=>[l.value?(r(),V(d(Ce),{key:0,class:"files-list-viewer__loader"})):b("",!0)]),_:1},8,["sections"]),p.value?(r(),V(xi,{key:0,open:w.value,"onUpdate:open":v[0]||(v[0]=y=>w.value=y),label:p.value.label,"onUpdate:label":W},null,8,["open","label"])):b("",!0)])):b("",!0)}});let z=null,R=null;window.addEventListener("DOMContentLoaded",function(){window.OCA.Files?.Sidebar!==void 0&&window.OCA.Files.Sidebar.registerTab(new window.OCA.Files.Sidebar.Tab({id:"files_versions",name:u("files_versions","Versions"),iconSvg:Fe,async mount(e,t){z&&z.unmount(),z=He(Ui),R=z.mount(e),R.update(t)},update(e){R.update(e)},setIsActive(e){R?.setIsActive(e)},destroy(){z?.unmount(),z=null},enabled(e){return!(e?.isDirectory()??!0)}}))});
//# sourceMappingURL=files_versions-sidebar-tab.mjs.map
