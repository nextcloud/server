/*! third party licenses: dist/vendor.LICENSE.txt */
import{bS as a,aV as l,F as o,a4 as n,af as d,ag as c,al as u,ai as m}from"./core-common.mjs";import"./chunks/index-PaKKd09k.mjs";import{B as i,z as h}from"./chunks/_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import{d as p,c as y,u as b,a as v,f}from"./chunks/api-Bu5d7DE4.mjs";import{n as g}from"./chunks/icons-TElqpmA8.mjs";import"./chunks/index-tn-fAC9x.mjs";import"./chunks/index-CiG5J8j_.mjs";const _=[{id:"Public",label:a("systemtags","Public")},{id:"Restricted",label:a("systemtags","Restricted")},{id:"Invisible",label:a("systemtags","Invisible")}],r=(t,e)=>({[[!0,!0].join(",")]:"Public",[[!0,!1].join(",")]:"Restricted",[[!1,!1].join(",")]:"Invisible"})[[t,e].join(",")],N=l.extend({name:"SystemTagForm",components:{NcButton:o,NcLoadingIcon:n,NcSelect:d,NcSelectTags:c,NcTextField:u},props:{tags:{type:Array,required:!0}},data(){return{loading:!1,tagLevelOptions:_,selectedTag:null,errorMessage:"",tagName:"",tagLevel:"Public"}},watch:{selectedTag(t){this.tagName=t?t.displayName:"",this.tagLevel=t?r(t.userVisible,t.userAssignable):"Public"}},computed:{isCreating(){return this.selectedTag===null},isCreateDisabled(){return this.tagName===""},isUpdateDisabled(){var t,e,s;return this.tagName===""||((t=this.selectedTag)==null?void 0:t.displayName)===this.tagName&&r((e=this.selectedTag)==null?void 0:e.userVisible,(s=this.selectedTag)==null?void 0:s.userAssignable)===this.tagLevel},isResetDisabled(){return this.isCreating?this.tagName===""&&this.tagLevel==="Public":this.selectedTag===null},userVisible(){return{Public:!0,Restricted:!0,Invisible:!1}[this.tagLevel]},userAssignable(){return{Public:!0,Restricted:!1,Invisible:!1}[this.tagLevel]},tagProperties(){return{displayName:this.tagName,userVisible:this.userVisible,userAssignable:this.userAssignable}}},methods:{t:a,async handleSubmit(){if(this.isCreating){await this.create();return}await this.update()},async create(){const t={...p,...this.tagProperties};this.loading=!0;try{const e=await y(t),s={...t,id:e};this.$emit("tag:created",s),i(a("systemtags","Created tag")),this.reset()}catch{this.errorMessage=a("systemtags","Failed to create tag")}this.loading=!1},async update(){var t;if(this.selectedTag===null)return;const e={...this.selectedTag,...this.tagProperties};this.loading=!0;try{await b(e),this.selectedTag=e,this.$emit("tag:updated",e),i(a("systemtags","Updated tag")),(t=this.$refs.tagNameInput)==null||t.focus()}catch{this.errorMessage=a("systemtags","Failed to update tag")}this.loading=!1},async handleDelete(){if(this.selectedTag!==null){this.loading=!0;try{await v(this.selectedTag),this.$emit("tag:deleted",this.selectedTag),i(a("systemtags","Deleted tag")),this.reset()}catch{this.errorMessage=a("systemtags","Failed to delete tag")}this.loading=!1}},reset(){var t;this.selectedTag=null,this.errorMessage="",this.tagName="",this.tagLevel="Public",(t=this.$refs.tagNameInput)==null||t.focus()}}});var T=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("form",{staticClass:"system-tag-form",attrs:{disabled:t.loading,"aria-labelledby":"system-tag-form-heading"},on:{submit:function(s){return s.preventDefault(),t.handleSubmit.apply(null,arguments)},reset:t.reset}},[e("h3",{attrs:{id:"system-tag-form-heading"}},[t._v(" "+t._s(t.t("systemtags","Create or edit tags"))+" ")]),e("div",{staticClass:"system-tag-form__group"},[e("label",{attrs:{for:"system-tags-input"}},[t._v(t._s(t.t("systemtags","Search for a tag to edit")))]),e("NcSelectTags",{attrs:{"input-id":"system-tags-input",placeholder:t.t("systemtags","Collaborative tags …"),"fetch-tags":!1,options:t.tags,multiple:!1,passthru:""},scopedSlots:t._u([{key:"no-options",fn:function(){return[t._v(" "+t._s(t.t("systemtags","No tags to select"))+" ")]},proxy:!0}]),model:{value:t.selectedTag,callback:function(s){t.selectedTag=s},expression:"selectedTag"}})],1),e("div",{staticClass:"system-tag-form__group"},[e("label",{attrs:{for:"system-tag-name"}},[t._v(t._s(t.t("systemtags","Tag name")))]),e("NcTextField",{ref:"tagNameInput",attrs:{id:"system-tag-name",value:t.tagName,error:!!t.errorMessage,"helper-text":t.errorMessage,"label-outside":""},on:{"update:value":function(s){t.tagName=s}}})],1),e("div",{staticClass:"system-tag-form__group"},[e("label",{attrs:{for:"system-tag-level"}},[t._v(t._s(t.t("systemtags","Tag level")))]),e("NcSelect",{attrs:{"input-id":"system-tag-level",options:t.tagLevelOptions,reduce:s=>s.id,clearable:!1,disabled:t.loading},model:{value:t.tagLevel,callback:function(s){t.tagLevel=s},expression:"tagLevel"}})],1),e("div",{staticClass:"system-tag-form__row"},[t.isCreating?e("NcButton",{attrs:{"native-type":"submit",disabled:t.isCreateDisabled||t.loading}},[t._v(" "+t._s(t.t("systemtags","Create"))+" ")]):[e("NcButton",{attrs:{"native-type":"submit",disabled:t.isUpdateDisabled||t.loading}},[t._v(" "+t._s(t.t("systemtags","Update"))+" ")]),e("NcButton",{attrs:{disabled:t.loading},on:{click:t.handleDelete}},[t._v(" "+t._s(t.t("systemtags","Delete"))+" ")])],e("NcButton",{attrs:{"native-type":"reset",disabled:t.isResetDisabled||t.loading}},[t._v(" "+t._s(t.t("systemtags","Reset"))+" ")]),t.loading?e("NcLoadingIcon",{attrs:{name:t.t("systemtags","Loading …"),size:32}}):t._e()],2)])},C=[],L=g(N,T,C,!1,null,"3426a620");const S=L.exports,x=l.extend({name:"SystemTagsSection",components:{NcLoadingIcon:n,NcSettingsSection:m,SystemTagForm:S},data(){return{loadingTags:!1,tags:[]}},async created(){this.loadingTags=!0;try{this.tags=await f()}catch{h(a("systemtags","Failed to load tags"))}this.loadingTags=!1},methods:{t:a,handleCreate(t){this.tags.unshift(t)},handleUpdate(t){const e=this.tags.findIndex(s=>s.id===t.id);this.tags.splice(e,1),this.tags.unshift(t)},handleDelete(t){const e=this.tags.findIndex(s=>s.id===t.id);this.tags.splice(e,1)}}});var I=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("NcSettingsSection",{attrs:{name:t.t("systemtags","Collaborative tags"),description:t.t("systemtags","Collaborative tags are available for all users. Restricted tags are visible to users but cannot be assigned by them. Invisible tags are for internal use, since users cannot see or assign them.")}},[t.loadingTags?e("NcLoadingIcon",{attrs:{name:t.t("systemtags","Loading collaborative tags …"),size:32}}):e("SystemTagForm",{attrs:{tags:t.tags},on:{"tag:created":t.handleCreate,"tag:updated":t.handleUpdate,"tag:deleted":t.handleDelete}})],1)},P=[],D=g(x,I,P,!1,null,null);const F=D.exports,w=l.extend(F);new w().$mount("#vue-admin-systemtags");
