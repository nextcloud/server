import{A as w,B as h,C as g,D as y}from"./_plugin-vue_export-helper-sUpjG1-Y.chunk.mjs";import{i as m,c as D}from"./string_decoder-CKkZVVJW.chunk.mjs";import{a as E,u as N}from"./index-D8QEQJpI.chunk.mjs";import{l as u,N as $,F as b,a as A,P as i}from"./index-BA-QMfCr.chunk.mjs";const T=function(e=""){let t=i.NONE;return e&&((e.includes("C")||e.includes("K"))&&(t|=i.CREATE),e.includes("G")&&(t|=i.READ),(e.includes("W")||e.includes("N")||e.includes("V"))&&(t|=i.UPDATE),e.includes("D")&&(t|=i.DELETE),e.includes("R")&&(t|=i.SHARE)),t},_=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],f={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},P=function(e,t={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[..._],window._nc_dav_namespaces={...f});const o={...window._nc_dav_namespaces,...t};if(window._nc_dav_properties.find(n=>n===e))return u.warn(`${e} already registered`,{prop:e}),!1;if(e.startsWith("<")||e.split(":").length!==2)return u.error(`${e} is not valid. See example: 'oc:fileid'`,{prop:e}),!1;const s=e.split(":")[0];return o[s]?(window._nc_dav_properties.push(e),window._nc_dav_namespaces=o,!0):(u.error(`${e} namespace unknown`,{prop:e,namespaces:o}),!1)},S=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[..._]),window._nc_dav_properties.map(e=>`<${e} />`).join(" ")},j=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...f}),Object.keys(window._nc_dav_namespaces).map(e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`).join(" ")};function x(){return m()?`/files/${D()}`:`/files/${w()?.uid}`}const R=x();function q(){const e=h("dav");return m()?e.replace("remote.php","public.php"):e}const v=q(),z=function(e=v,t={}){const o=E(e,{headers:t});function s(n){o.setHeaders({...t,"X-Requested-With":"XMLHttpRequest",requesttoken:n??""})}return y(s),s(g()),N().patch("fetch",(n,a)=>{const r=a.headers;return r?.method&&(a.method=r.method,delete r.method),fetch(n,a)}),o},F=function(e,t=R,o=v){let s=w()?.uid;if(m())s=s??"anonymous";else if(!s)throw new Error("No user id found");const n=e.props,a=T(n?.permissions),r=String(n?.["owner-id"]||s),l=n.fileid||0,d=new Date(Date.parse(e.lastmod)),c=new Date(Date.parse(n.creationdate)),p={id:l,source:`${o}${e.filename}`,mtime:!isNaN(d.getTime())&&d.getTime()!==0?d:void 0,crtime:!isNaN(c.getTime())&&c.getTime()!==0?c:void 0,mime:e.mime||"application/octet-stream",displayname:n.displayname!==void 0?String(n.displayname):void 0,size:n?.size||Number.parseInt(n.getcontentlength||"0"),status:l<0?$.FAILED:void 0,permissions:a,owner:r,root:t,attributes:{...e,...n,hasPreview:n?.["has-preview"]}};return delete p.attributes?.props,e.type==="file"?new b(p):new A(p)};export{j as a,S as b,F as c,v as d,z as g,P as r};
//# sourceMappingURL=dav-Cbt6Q9c0.chunk.mjs.map
