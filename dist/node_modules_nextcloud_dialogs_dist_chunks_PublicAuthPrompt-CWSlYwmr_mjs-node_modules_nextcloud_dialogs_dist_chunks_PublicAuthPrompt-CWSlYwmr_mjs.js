"use strict";
(globalThis["webpackChunknextcloud_ui_legacy"] = globalThis["webpackChunknextcloud_ui_legacy"] || []).push([["node_modules_nextcloud_dialogs_dist_chunks_PublicAuthPrompt-CWSlYwmr_mjs"],{

/***/ "./node_modules/@nextcloud/dialogs/dist/chunks/PublicAuthPrompt-CWSlYwmr.mjs":
/*!***********************************************************************************!*\
  !*** ./node_modules/@nextcloud/dialogs/dist/chunks/PublicAuthPrompt-CWSlYwmr.mjs ***!
  \***********************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ PublicAuthPrompt)
/* harmony export */ });
/* harmony import */ var vue__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! vue */ "./node_modules/@nextcloud/dialogs/node_modules/vue/dist/vue.runtime.esm-bundler.js");
/* harmony import */ var _nextcloud_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @nextcloud/auth */ "./node_modules/@nextcloud/auth/dist/index.mjs");
/* harmony import */ var _nextcloud_browser_storage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @nextcloud/browser-storage */ "./node_modules/@nextcloud/browser-storage/dist/index.js");
/* harmony import */ var _nextcloud_vue_components_NcDialog__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @nextcloud/vue/components/NcDialog */ "./node_modules/@nextcloud/dialogs/node_modules/@nextcloud/vue/dist/components/NcDialog/index.mjs");
/* harmony import */ var _nextcloud_vue_components_NcNoteCard__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @nextcloud/vue/components/NcNoteCard */ "./node_modules/@nextcloud/dialogs/node_modules/@nextcloud/vue/dist/components/NcNoteCard/index.mjs");
/* harmony import */ var _nextcloud_vue_components_NcTextField__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @nextcloud/vue/components/NcTextField */ "./node_modules/@nextcloud/dialogs/node_modules/@nextcloud/vue/dist/components/NcTextField/index.mjs");
/* harmony import */ var _index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./index-hZPKu-D6.mjs */ "./node_modules/@nextcloud/dialogs/dist/chunks/index-hZPKu-D6.mjs");
/* harmony import */ var _nextcloud_files__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @nextcloud/files */ "./node_modules/@nextcloud/dialogs/node_modules/@nextcloud/files/dist/index.mjs");
/* harmony import */ var _plugin_vue_export_helper_1tPrXgE0_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./_plugin-vue_export-helper-1tPrXgE0.mjs */ "./node_modules/@nextcloud/dialogs/dist/chunks/_plugin-vue_export-helper-1tPrXgE0.mjs");









/*!
 * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors
 * SPDX-License-Identifier: AGPL-3.0-or-later
 */
function getGuestNameValidity(name) {
  if (name.trim() === "") {
    return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Names must not be empty.");
  }
  if (name.startsWith(".")) {
    return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Names must not start with a dot.");
  }
  if (name.length > 64) {
    return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Names may be at most 64 characters long.");
  }
  try {
    (0,_nextcloud_files__WEBPACK_IMPORTED_MODULE_7__.validateFilename)(name);
    return "";
  } catch (error) {
    if (!(error instanceof _nextcloud_files__WEBPACK_IMPORTED_MODULE_7__.InvalidFilenameError)) {
      throw error;
    }
    switch (error.reason) {
      case _nextcloud_files__WEBPACK_IMPORTED_MODULE_7__.InvalidFilenameErrorReason.Character:
        return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)('"{char}" is not allowed inside a name.', { char: error.segment });
      case _nextcloud_files__WEBPACK_IMPORTED_MODULE_7__.InvalidFilenameErrorReason.ReservedName:
        return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)('"{segment}" is a reserved name and not allowed.', { segment: error.segment });
      case _nextcloud_files__WEBPACK_IMPORTED_MODULE_7__.InvalidFilenameErrorReason.Extension:
        if (error.segment.match(/\.[a-z]/i)) {
          return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)('"{extension}" is not an allowed name.', { extension: error.segment });
        }
        return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)('Names must not end with "{extension}".', { extension: error.segment });
      default:
        return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Invalid name.");
    }
  }
}
const _hoisted_1 = {
  key: 0,
  class: "public-auth-prompt__text"
};
const _sfc_main = /* @__PURE__ */ (0,vue__WEBPACK_IMPORTED_MODULE_0__.defineComponent)({
  __name: "PublicAuthPrompt",
  props: {
    nickname: { default: "" },
    title: { default: (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Guest identification") },
    text: { default: "" },
    notice: { default: "" },
    submitLabel: { default: (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Submit name") },
    cancellable: { type: Boolean }
  },
  emits: ["close"],
  setup(__props, { emit: __emit }) {
    const props = __props;
    const emit = __emit;
    const inputElement = (0,vue__WEBPACK_IMPORTED_MODULE_0__.useTemplateRef)("input");
    const storage = (0,_nextcloud_browser_storage__WEBPACK_IMPORTED_MODULE_2__.getBuilder)("public").build();
    const name = (0,vue__WEBPACK_IMPORTED_MODULE_0__.ref)(props.nickname);
    (0,vue__WEBPACK_IMPORTED_MODULE_0__.watch)(() => props.nickname, () => {
      name.value = props.nickname;
    });
    (0,vue__WEBPACK_IMPORTED_MODULE_0__.watch)(name, (newName) => {
      const validity = getGuestNameValidity(newName);
      if (!validity) {
        inputElement.value.setCustomValidity(validity);
        inputElement.value.reportValidity();
        inputElement.value.focus();
        return;
      }
    });
    const buttons = (0,vue__WEBPACK_IMPORTED_MODULE_0__.computed)(() => {
      const cancelButton = {
        label: (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Cancel"),
        variant: "tertiary",
        callback: () => emit("close")
      };
      const submitButton = {
        label: props.submitLabel,
        type: "submit",
        variant: "primary"
      };
      if (props.cancellable) {
        return [cancelButton, submitButton];
      }
      return [submitButton];
    });
    const defaultNotice = (0,vue__WEBPACK_IMPORTED_MODULE_0__.computed)(() => {
      if (props.notice) {
        return props.notice;
      }
      if (name.value) {
        return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("You are currently identified as {nickname}.", { nickname: name.value });
      }
      return (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("You are currently not identified.");
    });
    function onSubmit() {
      const nickname = name.value.trim();
      const validity = getGuestNameValidity(nickname);
      if (validity) {
        inputElement.value.setCustomValidity(validity);
        inputElement.value.reportValidity();
        inputElement.value.focus();
        return;
      }
      if (nickname === "") {
        inputElement.value.setCustomValidity((0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("You cannot leave the name empty."));
        inputElement.value.reportValidity();
        inputElement.value.focus();
        return;
      }
      if (nickname.length < 2) {
        inputElement.value.setCustomValidity((0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Please enter a name with at least 2 characters."));
        inputElement.value.reportValidity();
        inputElement.value.focus();
        return;
      }
      try {
        (0,_nextcloud_auth__WEBPACK_IMPORTED_MODULE_1__.setGuestNickname)(nickname);
      } catch (error) {
        _index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.l.error("Failed to set nickname", { error });
        (0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.s)((0,_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Failed to set nickname."));
        inputElement.value.focus();
        return;
      }
      storage.setItem("public-auth-prompt-shown", "true");
      emit("close", name.value);
    }
    return (_ctx, _cache) => {
      return (0,vue__WEBPACK_IMPORTED_MODULE_0__.openBlock)(), (0,vue__WEBPACK_IMPORTED_MODULE_0__.createBlock)((0,vue__WEBPACK_IMPORTED_MODULE_0__.unref)(_nextcloud_vue_components_NcDialog__WEBPACK_IMPORTED_MODULE_3__["default"]), {
        buttons: buttons.value,
        class: "public-auth-prompt",
        "data-cy-public-auth-prompt-dialog": "",
        "is-form": "",
        "no-close": "",
        name: __props.title,
        onSubmit
      }, {
        default: (0,vue__WEBPACK_IMPORTED_MODULE_0__.withCtx)(() => [
          __props.text ? ((0,vue__WEBPACK_IMPORTED_MODULE_0__.openBlock)(), (0,vue__WEBPACK_IMPORTED_MODULE_0__.createElementBlock)("p", _hoisted_1, (0,vue__WEBPACK_IMPORTED_MODULE_0__.toDisplayString)(__props.text), 1)) : (0,vue__WEBPACK_IMPORTED_MODULE_0__.createCommentVNode)("", true),
          (0,vue__WEBPACK_IMPORTED_MODULE_0__.createVNode)((0,vue__WEBPACK_IMPORTED_MODULE_0__.unref)(_nextcloud_vue_components_NcNoteCard__WEBPACK_IMPORTED_MODULE_4__["default"]), {
            class: "public-auth-prompt__header",
            text: defaultNotice.value,
            type: "info"
          }, null, 8, ["text"]),
          (0,vue__WEBPACK_IMPORTED_MODULE_0__.createVNode)((0,vue__WEBPACK_IMPORTED_MODULE_0__.unref)(_nextcloud_vue_components_NcTextField__WEBPACK_IMPORTED_MODULE_5__["default"]), {
            ref: "input",
            modelValue: name.value,
            "onUpdate:modelValue": _cache[0] || (_cache[0] = ($event) => name.value = $event),
            class: "public-auth-prompt__input",
            "data-cy-public-auth-prompt-dialog-name": "",
            label: (0,vue__WEBPACK_IMPORTED_MODULE_0__.unref)(_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Name"),
            placeholder: (0,vue__WEBPACK_IMPORTED_MODULE_0__.unref)(_index_hZPKu_D6_mjs__WEBPACK_IMPORTED_MODULE_6__.t)("Enter your name"),
            required: !__props.cancellable,
            minlength: "2",
            maxlength: "64",
            name: "name"
          }, null, 8, ["modelValue", "label", "placeholder", "required"])
        ]),
        _: 1
      }, 8, ["buttons", "name"]);
    };
  }
});
const PublicAuthPrompt = /* @__PURE__ */ (0,_plugin_vue_export_helper_1tPrXgE0_mjs__WEBPACK_IMPORTED_MODULE_8__._)(_sfc_main, [["__scopeId", "data-v-b33d88e5"]]);

//# sourceMappingURL=PublicAuthPrompt-CWSlYwmr.mjs.map


/***/ }),

/***/ "./node_modules/@nextcloud/dialogs/node_modules/@nextcloud/vue/dist/components/NcTextField/index.mjs":
/*!***********************************************************************************************************!*\
  !*** ./node_modules/@nextcloud/dialogs/node_modules/@nextcloud/vue/dist/components/NcTextField/index.mjs ***!
  \***********************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* reexport safe */ _chunks_NcTextField_vue_vue_type_script_setup_true_lang_Dl9AQfwW_mjs__WEBPACK_IMPORTED_MODULE_0__._)
/* harmony export */ });
/* harmony import */ var _chunks_NcTextField_vue_vue_type_script_setup_true_lang_Dl9AQfwW_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../chunks/NcTextField.vue_vue_type_script_setup_true_lang-Dl9AQfwW.mjs */ "./node_modules/@nextcloud/dialogs/node_modules/@nextcloud/vue/dist/chunks/NcTextField.vue_vue_type_script_setup_true_lang-Dl9AQfwW.mjs");


//# sourceMappingURL=index.mjs.map


/***/ })

}]);
//# sourceMappingURL=node_modules_nextcloud_dialogs_dist_chunks_PublicAuthPrompt-CWSlYwmr_mjs-node_modules_nextcloud_dialogs_dist_chunks_PublicAuthPrompt-CWSlYwmr_mjs.js.map?v=7b8a3b54a8923240ede4