import{a as h,b as N,o as y}from"./index-6_gsQFyp.chunk.mjs";import{d as E}from"./createElementId-DhjFt1I9-Bjk2333q.chunk.mjs";import{i as l,b}from"./index-xFugdZPW.chunk.mjs";import{l as D,_ as $}from"./index-Dpy2yt9b.chunk.mjs";import{s as n,l as u,N as P,a as T,b as R,P as i}from"./folder-D9CBQngR-Cw5TS1GK.chunk.mjs";function x(e=""){let s=i.NONE;return e&&(e.includes("G")&&(s|=i.READ),e.includes("W")&&(s|=i.WRITE),e.includes("CK")&&(s|=i.CREATE),e.includes("NV")&&(s|=i.UPDATE),e.includes("D")&&(s|=i.DELETE),e.includes("R")&&(s|=i.SHARE)),s}const v=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],g={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"};function S(e,s={nc:"http://nextcloud.org/ns"}){n.davNamespaces??={...g},n.davProperties??=[...v];const a={...n.davNamespaces,...s};if(n.davProperties.find(t=>t===e))return u.warn(`${e} already registered`,{prop:e}),!1;if(e.startsWith("<")||e.split(":").length!==2)return u.error(`${e} is not valid. See example: 'oc:fileid'`,{prop:e}),!1;const o=e.split(":")[0];return a[o]?(n.davProperties.push(e),n.davNamespaces=a,!0):(u.error(`${e} namespace unknown`,{prop:e,namespaces:a}),!1)}function z(){return n.davProperties??=[...v],n.davProperties.map(e=>`<${e} />`).join(" ")}function C(){return n.davNamespaces??={...g},Object.keys(n.davNamespaces).map(e=>`xmlns:${e}="${n.davNamespaces?.[e]}"`).join(" ")}function A(){return l()?`/files/${b()}`:`/files/${h()?.uid}`}const q=A();function W(){const e=E("dav");return l()?e.replace("remote.php","public.php"):e}const w=W();function O(e=w,s={}){const a=D(e,{headers:s});function o(t){a.setHeaders({...s,"X-Requested-With":"XMLHttpRequest",requesttoken:t??""})}return y(o),o(N()),$().patch("fetch",(t,r)=>{const c=r.headers;return c?.method&&(r.method=c.method,delete c.method),fetch(t,r)}),a}function U(e,s=q,a=w){let o=h()?.uid;if(l())o=o??"anonymous";else if(!o)throw new Error("No user id found");const t=e.props,r=x(t?.permissions),c=String(t?.["owner-id"]||o),f=t.fileid||0,d=new Date(Date.parse(e.lastmod)),p=new Date(Date.parse(t.creationdate)),m={id:f,source:`${a}${e.filename}`,mtime:!isNaN(d.getTime())&&d.getTime()!==0?d:void 0,crtime:!isNaN(p.getTime())&&p.getTime()!==0?p:void 0,mime:e.mime||"application/octet-stream",displayname:t.displayname!==void 0?String(t.displayname):void 0,size:t?.size||Number.parseInt(t.getcontentlength||"0"),status:f<0?P.FAILED:void 0,permissions:r,owner:c,root:s,attributes:{...e,...t,hasPreview:t?.["has-preview"]}};return delete m.attributes?.props,e.type==="file"?new T(m):new R(m)}export{C as a,z as b,S as c,w as d,W as e,A as f,O as g,U as r};
//# sourceMappingURL=dav-BYbKV7ND.chunk.mjs.map
