import{j as Y,F as m,o as c,I as D,x as Z,G as L,U as O,H as T,t as A,X as it,s as tt,ah as rt,q as ot,n as j,ag as ut,ao as ct,ap as q,aq as lt,K as et,f as ht,ar as dt,as as ft,A as G,g as pt,i as z,r as U,at as mt,M as gt,c as k,w as N,v as V,a as J,P as vt,Q as yt,ac as bt,z as St,b as _t,au as E,J as P}from"./_plugin-vue_export-helper-sUpjG1-Y.chunk.mjs";import{c as st}from"./index-Cvjfo1ma.chunk.mjs";import{l as xt,m as At,n as W,u as Ut,o as kt,p as Q,q as Lt,r as wt,I as It}from"./index-JpgrUA2Z-hoZOv0I-.chunk.mjs";import{a as Mt,l as H,N as Nt,e as Ct}from"./string_decoder-CKkZVVJW.chunk.mjs";import{g as Dt}from"./colors-Go3zmZRD-B3dC1KT2.chunk.mjs";import{N as Ot,g as $t}from"./NcUserStatusIcon-CGEf7fej-CSAsMs-R.chunk.mjs";import{A as zt,N as Et,a as Pt,b as Bt}from"./NcDateTime.vue_vue_type_script_setup_true_lang-BhB8yA4U-Cq-oANUr.chunk.mjs";import{N as Tt}from"./mdi-BrEv6Slh.chunk.mjs";const jt={name:"NcActionText",mixins:[zt],inject:{isInSemanticMenu:{from:xt,default:!1}}},Gt=["role"],Wt={key:0,class:"action-text__longtext-wrapper"},Ht={class:"action-text__name"},Ft=["textContent"],qt=["textContent"],Vt={key:2,class:"action-text__text"};function Jt(r,i,n,s,t,e){return c(),m("li",{class:"action",role:e.isInSemanticMenu&&"presentation"},[D("span",{class:"action-text",onClick:i[0]||(i[0]=(...a)=>r.onClick&&r.onClick(...a))},[Z(r.$slots,"icon",{},()=>[r.icon!==""?(c(),m("span",{key:0,"aria-hidden":"true",class:T(["action-text__icon",[r.isIconUrl?"action-text__icon--url":r.icon]]),style:O({backgroundImage:r.isIconUrl?`url(${r.icon})`:null})},null,6)):L("",!0)],!0),r.name?(c(),m("span",Wt,[D("strong",Ht,A(r.name),1),D("span",{class:"action-text__longtext",textContent:A(r.text)},null,8,Ft)])):r.isLongText?(c(),m("span",{key:1,class:"action-text__longtext",textContent:A(r.text)},null,8,qt)):(c(),m("span",Vt,A(r.text),1)),L("",!0)])],8,Gt)}const Qt=Y(jt,[["render",Jt],["__scopeId","data-v-fa684b48"]]),Rt=Symbol.for("nc:theme:enforced");function Xt(r){const i=tt(()=>rt(r)??document.body),n=ot(W(i.value)),s=kt();function t(){n.value=W(i.value)}return Ut(i,t,{attributes:!0}),j(i,t),j(s,t,{immediate:!0}),ut(n)}const Kt=At(()=>Xt());function Yt(){const r=Kt(),i=it(Rt,void 0);return tt(()=>i?.value?i.value==="dark":r.value)}const B=new WeakMap,Zt={mounted(r,i){const n=!i.modifiers.bubble;let s;if(typeof i.value=="function")s=Q(r,i.value,{capture:n});else{const[t,e]=i.value;s=Q(r,t,Object.assign({capture:n},e))}B.set(r,s)},unmounted(r){const i=B.get(r);i&&typeof i=="function"?i():i?.stop(),B.delete(r)}};function te(){let r=!1;const i=ct(!1);return(n,s)=>{if(i.value=s.value,r)return;r=!0;const t=Lt(n,s.value);j(i,e=>t.value=e)}}te();function ee(r,i){const n=(g,b)=>g.startsWith(b)?g.slice(b.length):g,s=(g,...b)=>b.reduce((w,p)=>n(w,p),g);if(!r)return null;const t=/^https?:\/\//.test(i),e=/^[a-z][a-z0-9+.-]*:.+/.test(i);if(!t&&e||t&&!i.startsWith(q())||!t&&!i.startsWith("/"))return null;const a=t?s(i,q(),"/index.php"):i,h=s(r.options.history.base,lt(),"/index.php"),y=s(a,h)||"/",_=r.resolve(y);return _.matched.length?_.fullPath:null}function se(r){return window._nc_contacts_menu_hooks?Object.values(window._nc_contacts_menu_hooks).filter(i=>i.enabled(r)):[]}const ae=new Int32Array(4);class d{static hashStr(i,n=!1){return this.onePassHasher.start().appendStr(i).end(n)}static hashAsciiStr(i,n=!1){return this.onePassHasher.start().appendAsciiStr(i).end(n)}static stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);static buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);static hexChars="0123456789abcdef";static hexOut=[];static onePassHasher=new d;static _hex(i){const n=d.hexChars,s=d.hexOut;let t,e,a,h;for(h=0;h<4;h+=1)for(e=h*8,t=i[h],a=0;a<8;a+=2)s[e+1+a]=n.charAt(t&15),t>>>=4,s[e+0+a]=n.charAt(t&15),t>>>=4;return s.join("")}static _md5cycle(i,n){let s=i[0],t=i[1],e=i[2],a=i[3];s+=(t&e|~t&a)+n[0]-680876936|0,s=(s<<7|s>>>25)+t|0,a+=(s&t|~s&e)+n[1]-389564586|0,a=(a<<12|a>>>20)+s|0,e+=(a&s|~a&t)+n[2]+606105819|0,e=(e<<17|e>>>15)+a|0,t+=(e&a|~e&s)+n[3]-1044525330|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&a)+n[4]-176418897|0,s=(s<<7|s>>>25)+t|0,a+=(s&t|~s&e)+n[5]+1200080426|0,a=(a<<12|a>>>20)+s|0,e+=(a&s|~a&t)+n[6]-1473231341|0,e=(e<<17|e>>>15)+a|0,t+=(e&a|~e&s)+n[7]-45705983|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&a)+n[8]+1770035416|0,s=(s<<7|s>>>25)+t|0,a+=(s&t|~s&e)+n[9]-1958414417|0,a=(a<<12|a>>>20)+s|0,e+=(a&s|~a&t)+n[10]-42063|0,e=(e<<17|e>>>15)+a|0,t+=(e&a|~e&s)+n[11]-1990404162|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&a)+n[12]+1804603682|0,s=(s<<7|s>>>25)+t|0,a+=(s&t|~s&e)+n[13]-40341101|0,a=(a<<12|a>>>20)+s|0,e+=(a&s|~a&t)+n[14]-1502002290|0,e=(e<<17|e>>>15)+a|0,t+=(e&a|~e&s)+n[15]+1236535329|0,t=(t<<22|t>>>10)+e|0,s+=(t&a|e&~a)+n[1]-165796510|0,s=(s<<5|s>>>27)+t|0,a+=(s&e|t&~e)+n[6]-1069501632|0,a=(a<<9|a>>>23)+s|0,e+=(a&t|s&~t)+n[11]+643717713|0,e=(e<<14|e>>>18)+a|0,t+=(e&s|a&~s)+n[0]-373897302|0,t=(t<<20|t>>>12)+e|0,s+=(t&a|e&~a)+n[5]-701558691|0,s=(s<<5|s>>>27)+t|0,a+=(s&e|t&~e)+n[10]+38016083|0,a=(a<<9|a>>>23)+s|0,e+=(a&t|s&~t)+n[15]-660478335|0,e=(e<<14|e>>>18)+a|0,t+=(e&s|a&~s)+n[4]-405537848|0,t=(t<<20|t>>>12)+e|0,s+=(t&a|e&~a)+n[9]+568446438|0,s=(s<<5|s>>>27)+t|0,a+=(s&e|t&~e)+n[14]-1019803690|0,a=(a<<9|a>>>23)+s|0,e+=(a&t|s&~t)+n[3]-187363961|0,e=(e<<14|e>>>18)+a|0,t+=(e&s|a&~s)+n[8]+1163531501|0,t=(t<<20|t>>>12)+e|0,s+=(t&a|e&~a)+n[13]-1444681467|0,s=(s<<5|s>>>27)+t|0,a+=(s&e|t&~e)+n[2]-51403784|0,a=(a<<9|a>>>23)+s|0,e+=(a&t|s&~t)+n[7]+1735328473|0,e=(e<<14|e>>>18)+a|0,t+=(e&s|a&~s)+n[12]-1926607734|0,t=(t<<20|t>>>12)+e|0,s+=(t^e^a)+n[5]-378558|0,s=(s<<4|s>>>28)+t|0,a+=(s^t^e)+n[8]-2022574463|0,a=(a<<11|a>>>21)+s|0,e+=(a^s^t)+n[11]+1839030562|0,e=(e<<16|e>>>16)+a|0,t+=(e^a^s)+n[14]-35309556|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^a)+n[1]-1530992060|0,s=(s<<4|s>>>28)+t|0,a+=(s^t^e)+n[4]+1272893353|0,a=(a<<11|a>>>21)+s|0,e+=(a^s^t)+n[7]-155497632|0,e=(e<<16|e>>>16)+a|0,t+=(e^a^s)+n[10]-1094730640|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^a)+n[13]+681279174|0,s=(s<<4|s>>>28)+t|0,a+=(s^t^e)+n[0]-358537222|0,a=(a<<11|a>>>21)+s|0,e+=(a^s^t)+n[3]-722521979|0,e=(e<<16|e>>>16)+a|0,t+=(e^a^s)+n[6]+76029189|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^a)+n[9]-640364487|0,s=(s<<4|s>>>28)+t|0,a+=(s^t^e)+n[12]-421815835|0,a=(a<<11|a>>>21)+s|0,e+=(a^s^t)+n[15]+530742520|0,e=(e<<16|e>>>16)+a|0,t+=(e^a^s)+n[2]-995338651|0,t=(t<<23|t>>>9)+e|0,s+=(e^(t|~a))+n[0]-198630844|0,s=(s<<6|s>>>26)+t|0,a+=(t^(s|~e))+n[7]+1126891415|0,a=(a<<10|a>>>22)+s|0,e+=(s^(a|~t))+n[14]-1416354905|0,e=(e<<15|e>>>17)+a|0,t+=(a^(e|~s))+n[5]-57434055|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~a))+n[12]+1700485571|0,s=(s<<6|s>>>26)+t|0,a+=(t^(s|~e))+n[3]-1894986606|0,a=(a<<10|a>>>22)+s|0,e+=(s^(a|~t))+n[10]-1051523|0,e=(e<<15|e>>>17)+a|0,t+=(a^(e|~s))+n[1]-2054922799|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~a))+n[8]+1873313359|0,s=(s<<6|s>>>26)+t|0,a+=(t^(s|~e))+n[15]-30611744|0,a=(a<<10|a>>>22)+s|0,e+=(s^(a|~t))+n[6]-1560198380|0,e=(e<<15|e>>>17)+a|0,t+=(a^(e|~s))+n[13]+1309151649|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~a))+n[4]-145523070|0,s=(s<<6|s>>>26)+t|0,a+=(t^(s|~e))+n[11]-1120210379|0,a=(a<<10|a>>>22)+s|0,e+=(s^(a|~t))+n[2]+718787259|0,e=(e<<15|e>>>17)+a|0,t+=(a^(e|~s))+n[9]-343485551|0,t=(t<<21|t>>>11)+e|0,i[0]=s+i[0]|0,i[1]=t+i[1]|0,i[2]=e+i[2]|0,i[3]=a+i[3]|0}_dataLength=0;_bufferLength=0;_state=new Int32Array(4);_buffer=new ArrayBuffer(68);_buffer8;_buffer32;constructor(){this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(d.stateIdentity),this}appendStr(i){const n=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,a;for(a=0;a<i.length;a+=1){if(e=i.charCodeAt(a),e<128)n[t++]=e;else if(e<2048)n[t++]=(e>>>6)+192,n[t++]=e&63|128;else if(e<55296||e>56319)n[t++]=(e>>>12)+224,n[t++]=e>>>6&63|128,n[t++]=e&63|128;else{if(e=(e-55296)*1024+(i.charCodeAt(++a)-56320)+65536,e>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");n[t++]=(e>>>18)+240,n[t++]=e>>>12&63|128,n[t++]=e>>>6&63|128,n[t++]=e&63|128}t>=64&&(this._dataLength+=64,d._md5cycle(this._state,s),t-=64,s[0]=s[16])}return this._bufferLength=t,this}appendAsciiStr(i){const n=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,a=0;for(;;){for(e=Math.min(i.length-a,64-t);e--;)n[t++]=i.charCodeAt(a++);if(t<64)break;this._dataLength+=64,d._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}appendByteArray(i){const n=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,a=0;for(;;){for(e=Math.min(i.length-a,64-t);e--;)n[t++]=i[a++];if(t<64)break;this._dataLength+=64,d._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}getState(){const i=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[i[0],i[1],i[2],i[3]]}}setState(i){const n=i.buffer,s=i.state,t=this._state;let e;for(this._dataLength=i.length,this._bufferLength=i.buflen,t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],e=0;e<n.length;e+=1)this._buffer8[e]=n.charCodeAt(e)}end(i=!1){const n=this._bufferLength,s=this._buffer8,t=this._buffer32,e=(n>>2)+1;this._dataLength+=n;const a=this._dataLength*8;if(s[n]=128,s[n+1]=s[n+2]=s[n+3]=0,t.set(d.buffer32Identity.subarray(e),e),n>55&&(d._md5cycle(this._state,t),t.set(d.buffer32Identity)),a<=4294967295)t[14]=a;else{const h=a.toString(16).match(/(.*?)(.{0,8})$/);if(h===null)return i?ae:"";const y=parseInt(h[2],16),_=parseInt(h[1],16)||0;t[14]=y,t[15]=_}return d._md5cycle(this._state,t),i?this._state:d._hex(this._state)}}if(d.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");function ne(r){let i=r;r.match(/^([0-9a-f]{4}-?){8}$/)===null&&(i=d.hashStr(r)),i=i.replace(/[^0-9a-f]/g,"");let n=0;for(let s=0;s<i.length;s++)n+=parseInt(i.charAt(s),16);return n}function R(r){const i=Dt(6),n=ne(r.toLocaleLowerCase());return i[n%i.length]}var F={exports:{}},ie=F.exports,X;function re(){return X||(X=1,(function(r){(function(i){if(typeof n!="function"){var n=function(u){return u};n.nonNative=!0}const s=n("plaintext"),t=n("html"),e=n("comment"),a=/<(\w*)>/g,h=/<\/?([^\s\/>]+)/;function y(u,o,v){u=u||"",o=o||[],v=v||"";let I=g(o,v);return b(u,I)}function _(u,o){u=u||[],o=o||"";let v=g(u,o);return function(I){return b(I||"",v)}}y.init_streaming_mode=_;function g(u,o){return u=w(u),{allowable_tags:u,tag_replacement:o,state:s,tag_buffer:"",depth:0,in_quote_char:""}}function b(u,o){if(typeof u!="string")throw new TypeError("'html' parameter must be a string");let v=o.allowable_tags,I=o.tag_replacement,S=o.state,l=o.tag_buffer,C=o.depth,x=o.in_quote_char,M="";for(let $=0,nt=u.length;$<nt;$++){let f=u[$];if(S===s)f==="<"?(S=t,l+=f):M+=f;else if(S===t)switch(f){case"<":if(x)break;C++;break;case">":if(x)break;if(C){C--;break}x="",S=s,l+=">",v.has(p(l))?M+=l:M+=I,l="";break;case'"':case"'":f===x?x="":x=x||f,l+=f;break;case"-":l==="<!-"&&(S=e),l+=f;break;case" ":case`
`:if(l==="<"){S=s,M+="< ",l="";break}l+=f;break;default:l+=f;break}else S===e&&(f===">"?(l.slice(-2)=="--"&&(S=s),l=""):l+=f)}return o.state=S,o.tag_buffer=l,o.depth=C,o.in_quote_char=x,M}function w(u){let o=new Set;if(typeof u=="string"){let v;for(;v=a.exec(u);)o.add(v[1])}else!n.nonNative&&typeof u[n.iterator]=="function"?o=new Set(u):typeof u.forEach=="function"&&u.forEach(o.add,o);return o}function p(u){let o=h.exec(u);return o?o[1].toLowerCase():null}r.exports?r.exports=y:i.striptags=y})(ie)})(F)),F.exports}re();function oe(r,i){const n=(i?.size||64)<=64?64:512,s=i?.isGuest?"/guest":"",t=i?.isDarkTheme??W(document.body)?"/dark":"";return et(`/avatar${s}/{user}/{size}${t}`,{user:r,size:n})}ht(dt);const ue={data(){return{hasStatus:!1,userStatus:{status:null,message:null,icon:null}}},methods:{async fetchUserStatus(r){if(!r)return;const i=Mt();if(!(!Object.hasOwn(i,"user_status")||!i.user_status.enabled)&&G())try{const{data:n}=await st.get(pt("apps/user_status/api/v1/statuses/{userId}",{userId:r}));this.setUserStatus(n.ocs.data)}catch(n){if(n.response.status===404&&n.response.data.ocs?.data?.length===0)return;H.error("Failed to fetch user status",{error:n})}},setUserStatus({status:r,message:i,icon:n}){this.userStatus.status=r||"",this.userStatus.message=i||"",this.userStatus.icon=n||"",this.hasStatus=!!r}}},at=ft("nextcloud").persist().build();function ce(r){const i=at.getItem("user-has-avatar."+r);return typeof i=="string"?!!i:null}function K(r,i){r&&at.setItem("user-has-avatar."+r,i)}const le={name:"NcAvatar",directives:{ClickOutside:Zt},components:{IconDotsHorizontal:It,NcActions:wt,NcButton:Ct,NcIconSvgWrapper:Nt,NcLoadingIcon:Tt,NcUserStatusIcon:Ot},mixins:[ue],props:{url:{type:String,default:void 0},iconClass:{type:String,default:void 0},user:{type:String,default:void 0},hideStatus:{type:Boolean,default:!1},verboseStatus:{type:Boolean,default:!1},preloadedUserStatus:{type:Object,default:void 0},isGuest:{type:Boolean,default:!1},displayName:{type:String,default:void 0},size:{type:Number,default:32},noPlaceholder:{type:Boolean,default:!1},disableTooltip:{type:Boolean,default:!1},disableMenu:{type:Boolean,default:!1},tooltipMessage:{type:String,default:null},isNoUser:{type:Boolean,default:!1},menuContainer:{type:[Boolean,String,Object,Element],default:"body"}},setup(){return{isDarkTheme:Yt()}},data(){return{avatarUrlLoaded:null,avatarSrcSetLoaded:null,userDoesNotExist:!1,isAvatarLoaded:!1,isMenuLoaded:!1,contactsMenuLoading:!1,contactsMenuData:{},contactsMenuActions:[],contactsMenuOpenState:!1}},computed:{avatarAriaLabel(){if(this.hasMenu)return this.canDisplayUserStatus||this.showUserStatusIconOnAvatar?z("Avatar of {displayName}, {status}",{displayName:this.displayName??this.user,status:$t(this.userStatus.status)}):z("Avatar of {displayName}",{displayName:this.displayName??this.user})},canDisplayUserStatus(){return!this.hideStatus&&this.hasStatus&&["online","away","busy","dnd"].includes(this.userStatus.status)},showUserStatusIconOnAvatar(){return!this.hideStatus&&!this.verboseStatus&&this.hasStatus&&this.userStatus.status!=="dnd"&&this.userStatus.icon},userIdentifier(){return this.isDisplayNameDefined?this.displayName:this.isUserDefined?this.user:""},isUserDefined(){return typeof this.user<"u"},isDisplayNameDefined(){return typeof this.displayName<"u"},isUrlDefined(){return typeof this.url<"u"},hasMenu(){return this.disableMenu?!1:this.isMenuLoaded?this.menu.length>0:!(this.user===G()?.uid||this.userDoesNotExist||this.url)},showInitials(){return!this.noPlaceholder&&this.userDoesNotExist&&!(this.iconClass||this.$slots.icon)},avatarStyle(){return{"--avatar-size":this.size+"px",lineHeight:this.showInitials?this.size+"px":0,fontSize:Math.round(this.size*.45)+"px"}},initialsWrapperStyle(){const{r,g:i,b:n}=R(this.userIdentifier);return{backgroundColor:`rgba(${r}, ${i}, ${n}, 0.1)`}},initialsStyle(){const{r,g:i,b:n}=R(this.userIdentifier);return{color:`rgb(${r}, ${i}, ${n})`}},tooltip(){return this.disableTooltip?null:this.tooltipMessage?this.tooltipMessage:this.displayName},initials(){let r="?";if(this.showInitials){const i=this.userIdentifier.trim();if(i==="")return r;const n=i.match(/[\p{L}\p{N}\s]/gu);if(!n)return r;const s=n.join(""),t=s.lastIndexOf(" ");r=String.fromCodePoint(s.codePointAt(0)),t!==-1&&(r=r.concat(String.fromCodePoint(s.codePointAt(t+1))))}return r.toLocaleUpperCase()},menu(){const r=this.contactsMenuActions.map(n=>{const s=ee(this.$router,n.hyperlink);return{ncActionComponent:s?Et:Pt,ncActionComponentProps:s?{to:s,icon:n.icon}:{href:n.hyperlink,icon:n.icon},text:n.title}});for(const n of se(this.contactsMenuData))try{r.push({ncActionComponent:Bt,ncActionComponentProps:{onClick:()=>n.callback(this.contactsMenuData)},text:n.displayName(this.contactsMenuData),iconSvg:n.iconSvg(this.contactsMenuData)})}catch(s){H.error(`Failed to render ContactsMenu action ${n.id}`,{error:s,action:n})}function i(n){const s=document.createTextNode(n),t=document.createElement("p");return t.appendChild(s),t.innerHTML}if(!this.hideStatus&&(this.userStatus.icon||this.userStatus.message)){const n=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
					<text x="50%" y="50%" text-anchor="middle" style="dominant-baseline: central; font-size: 85%">${i(this.userStatus.icon)}</text>
				</svg>`;return[{ncActionComponent:Qt,ncActionComponentProps:{},iconSvg:this.userStatus.icon?n:void 0,text:`${this.userStatus.message}`}].concat(r)}return r}},watch:{url(){this.userDoesNotExist=!1,this.loadAvatarUrl()},user(){this.userDoesNotExist=!1,this.isMenuLoaded=!1,this.loadAvatarUrl()}},mounted(){this.loadAvatarUrl(),P("settings:avatar:updated",this.loadAvatarUrl),P("settings:display-name:updated",this.loadAvatarUrl),!this.hideStatus&&this.user&&!this.isNoUser?(this.preloadedUserStatus?this.setUserStatus(this.preloadedUserStatus):this.fetchUserStatus(this.user),P("user_status:status.updated",this.handleUserStatusUpdated)):!this.hideStatus&&this.preloadedUserStatus&&this.setUserStatus(this.preloadedUserStatus)},beforeUnmount(){E("settings:avatar:updated",this.loadAvatarUrl),E("settings:display-name:updated",this.loadAvatarUrl),E("user_status:status.updated",this.handleUserStatusUpdated)},methods:{t:z,handleUserStatusUpdated(r){this.user===r.userId&&(this.userStatus={status:r.status,icon:r.icon,message:r.message},this.hasStatus=r.status!==null)},async toggleMenu(r){r.type==="keydown"&&r.key!=="Enter"||(this.contactsMenuOpenState||await this.fetchContactsMenu(),this.contactsMenuOpenState=!this.contactsMenuOpenState)},closeMenu(){this.contactsMenuOpenState=!1},async fetchContactsMenu(){this.contactsMenuLoading=!0;try{const r=encodeURIComponent(this.user),{data:i}=await st.post(et("contactsmenu/findOne"),`shareType=0&shareWith=${r}`);this.contactsMenuData=i,this.contactsMenuActions=i.topAction?[i.topAction].concat(i.actions):i.actions}catch{this.contactsMenuOpenState=!1}this.contactsMenuLoading=!1,this.isMenuLoaded=!0},loadAvatarUrl(){if(this.isAvatarLoaded=!1,!this.isUrlDefined&&(!this.isUserDefined||this.isNoUser||this.iconClass||this.$slots.icon)){this.isAvatarLoaded=!0,this.userDoesNotExist=!0;return}if(this.isUrlDefined){this.updateImageIfValid(this.url);return}if(this.size<=64){const r=this.avatarUrlGenerator(this.user,64),i=[r+" 1x",this.avatarUrlGenerator(this.user,512)+" 8x"].join(", ");this.updateImageIfValid(r,i)}else{const r=this.avatarUrlGenerator(this.user,512);this.updateImageIfValid(r)}},avatarUrlGenerator(r,i){let n=oe(r,{size:i,isDarkTheme:this.isDarkTheme,isGuest:this.isGuest});return r===G()?.uid&&typeof oc_userconfig<"u"&&(n+="?v="+window.oc_userconfig.avatar.version),n},updateImageIfValid(r,i=null){const n=ce(this.user);if(this.isUserDefined&&typeof n=="boolean"){this.isAvatarLoaded=!0,this.avatarUrlLoaded=r,i&&(this.avatarSrcSetLoaded=i),n===!1&&(this.userDoesNotExist=!0);return}const s=new Image;s.onload=()=>{this.avatarUrlLoaded=r,i&&(this.avatarSrcSetLoaded=i),this.isAvatarLoaded=!0,K(this.user,!0)},s.onerror=t=>{H.debug("[NcAvatar] Invalid avatar url",{error:t,url:r}),this.avatarUrlLoaded=null,this.avatarSrcSetLoaded=null,this.userDoesNotExist=!0,this.isAvatarLoaded=!1,K(this.user,!1)},i&&(s.srcset=i),s.src=r}}},he=["title"],de=["src","srcset"],fe={key:2,class:"avatardiv__user-status avatardiv__user-status--icon"};function pe(r,i,n,s,t,e){const a=U("NcLoadingIcon"),h=U("IconDotsHorizontal"),y=U("NcButton"),_=U("NcIconSvgWrapper"),g=U("NcActions"),b=U("NcUserStatusIcon"),w=mt("click-outside");return gt((c(),m("span",{class:T(["avatardiv popovermenu-wrapper",{"avatardiv--unknown":t.userDoesNotExist,"avatardiv--with-menu":e.hasMenu,"avatardiv--with-menu-loading":t.contactsMenuLoading}]),style:O(e.avatarStyle),title:e.tooltip},[Z(r.$slots,"icon",{},()=>[n.iconClass?(c(),m("span",{key:0,class:T([n.iconClass,"avatar-class-icon"])},null,2)):t.isAvatarLoaded&&!t.userDoesNotExist?(c(),m("img",{key:1,src:t.avatarUrlLoaded,srcset:t.avatarSrcSetLoaded,alt:""},null,8,de)):L("",!0)],!0),e.hasMenu&&e.menu.length===0?(c(),k(y,{key:0,"aria-label":e.avatarAriaLabel,class:"action-item action-item__menutoggle",variant:"tertiary-no-background",onClick:e.toggleMenu},{icon:N(()=>[t.contactsMenuLoading?(c(),k(a,{key:0})):(c(),k(h,{key:1,size:20}))]),_:1},8,["aria-label","onClick"])):e.hasMenu?(c(),k(g,{key:1,open:t.contactsMenuOpenState,"onUpdate:open":i[0]||(i[0]=p=>t.contactsMenuOpenState=p),"aria-label":e.avatarAriaLabel,container:n.menuContainer,"force-menu":"","manual-open":"",variant:"tertiary-no-background",onClick:e.toggleMenu},V({default:N(()=>[(c(!0),m(vt,null,yt(e.menu,(p,u)=>(c(),k(bt(p.ncActionComponent),St({key:u},{ref_for:!0},p.ncActionComponentProps),V({default:N(()=>[_t(" "+A(p.text),1)]),_:2},[p.iconSvg?{name:"icon",fn:N(()=>[J(_,{svg:p.iconSvg},null,8,["svg"])]),key:"0"}:void 0]),1040))),128))]),_:2},[t.contactsMenuLoading?{name:"icon",fn:N(()=>[J(a)]),key:"0"}:void 0]),1032,["open","aria-label","container","onClick"])):L("",!0),e.showUserStatusIconOnAvatar?(c(),m("span",fe,A(r.userStatus.icon),1)):e.canDisplayUserStatus?(c(),k(b,{key:3,class:"avatardiv__user-status",status:r.userStatus.status,"aria-hidden":String(e.hasMenu)},null,8,["status","aria-hidden"])):L("",!0),e.showInitials?(c(),m("span",{key:4,style:O(e.initialsWrapperStyle),class:"avatardiv__initials-wrapper"},[D("span",{style:O(e.initialsStyle),class:"avatardiv__initials"},A(e.initials),5)],4)):L("",!0)],14,he)),[[w,e.closeMenu]])}const Ae=Y(le,[["render",pe],["__scopeId","data-v-d7dc2a1f"]]);export{Ae as N,ue as u};
//# sourceMappingURL=NcAvatar-DmUGApWA-HHJYMSvr.chunk.mjs.map
