import{c as g}from"./index-C-LJcJnH.chunk.mjs";import{g as y,b}from"./createElementId-DhjFt1I9-BQ18DTJF.chunk.mjs";import{d as I}from"./index-Bndk0DrU.chunk.mjs";import{A as U,N as R}from"./AccountOutline-DmK_gbmB.chunk.mjs";import{N as $}from"./NcEmptyContent-B8-90BSI-DoWQxWGL.chunk.mjs";import{N as A}from"./NcSelect-DLheQ2yp-BSVZMNN4.chunk.mjs";import{a as _}from"./index-Ma7sfat2.chunk.mjs";import{j as d,o as c,k as a,l as P,t as h,y as L,f as n,e as u,w as p,g as k,c as x}from"./runtime-dom.esm-bundler-BprhcrOE.chunk.mjs";import{l as w}from"./logger-_TauvWEC.chunk.mjs";import"./index-sH3U_332.chunk.mjs";import"./translation-DoG5ZELJ-Bni_xMHF.chunk.mjs";import"./NcModal-DHryP_87-06sOiSPg.chunk.mjs";import"./Web-sfKoe9bN.chunk.mjs";const O={name:"ArrowRightIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},B=["aria-hidden","aria-label"],T=["fill","width","height"],E={d:"M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"},Q={key:0};function z(e,i,r,l,s,o){return c(),d("span",L(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon arrow-right-icon",role:"img",onClick:i[0]||(i[0]=f=>e.$emit("click",f))}),[(c(),d("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[a("path",E,[r.title?(c(),d("title",Q,h(r.title),1)):P("",!0)])],8,T))],16,B)}const F=_(O,[["render",z]]),V={name:"ProfilesCustomPicker",components:{NcSelect:A,NcButton:R,NcEmptyContent:$,AccountOutline:U,ArrowRightIcon:F},props:{providerId:{type:String,required:!0},accessible:{type:Boolean,default:!1}},emits:["submit"],data(){return{searchQuery:"",loading:!1,resultUrl:null,reference:null,profiles:[],selectedProfile:null,abortController:null}},computed:{options(){return this.searchQuery!==""?this.profiles:[]},noResultText(){return this.loading?t("user_picker","Searching …"):t("user_picker","Not found")}},mounted(){this.focusOnInput()},methods:{focusOnInput(){this.$nextTick(()=>{this.$refs["profiles-search-input"].$el.getElementsByTagName("input")[0]?.focus()})},async searchForProfile(e){e.trim()===""||e.trim().length<3||(this.searchQuery=e.trim(),this.loading=!0,await this.debounceFindProfiles(e))},debounceFindProfiles:I(function(...e){this.findProfiles(...e)},300),async findProfiles(e){const i=b("core/autocomplete/get?search={searchQuery}&itemType=%20&itemId=%20&shareTypes[]=0&limit=20",{searchQuery:e});try{const r=await g.get(i);this.profiles=r.data.ocs.data.map(l=>({user:l.id,displayName:l.label,icon:l.icon,subtitle:l.subline,isNoUser:l.source.startsWith("users")}))}catch(r){w.error("user_picker: error while searching for users",{error:r})}finally{this.loading=!1}},submit(){this.resultUrl=window.location.origin+y(`/u/${this.selectedProfile.user.trim().toLowerCase()}`,null,{noRewrite:!0}),this.$emit("submit",this.resultUrl),this.$el.dispatchEvent(new CustomEvent("submit",{detail:this.resultUrl,bubbles:!0}))},async resolveResult(e){this.loading=!0,this.abortController=new AbortController,this.selectedProfile=e,this.resultUrl=window.location.origin+y(`/u/${this.selectedProfile.user.trim().toLowerCase()}`,null,{noRewrite:!0});try{const i=await g.get(b("references/resolve",2)+"?reference="+encodeURIComponent(this.resultUrl),{signal:this.abortController.signal});this.reference=i.data.ocs.data.references[this.resultUrl]}catch(i){w.error("user_picker: error resolving the user profile link",{error:i})}finally{this.loading=!1}},clearSelection(){this.selectedProfile=null,this.resultUrl=null,this.reference=null}}},H={class:"profile-picker"},j={class:"profile-picker__heading"},M={class:"input-wrapper"},W={class:"profile-picker__footer"};function Z(e,i,r,l,s,o){const f=n("NcSelect"),C=n("AccountOutline"),v=n("NcEmptyContent"),N=n("ArrowRightIcon"),S=n("NcButton");return c(),d("div",H,[a("div",j,[a("h2",null,h(e.t("user_picker","Profile picker")),1),a("div",M,[u(f,{ref:"profiles-search-input",modelValue:s.selectedProfile,"onUpdate:modelValue":i[0]||(i[0]=m=>s.selectedProfile=m),inputId:"profiles-search",loading:s.loading,filterable:!1,placeholder:e.t("user_picker","Search for a user profile"),clearSearchOnBlur:()=>!1,multiple:!1,options:o.options,label:"displayName",onSearch:o.searchForProfile,"onOption:selecting":o.resolveResult},{"no-options":p(({search:m})=>[k(h(m?o.noResultText:e.t("user_picker","Search for a user profile. Start typing")),1)]),_:1},8,["modelValue","loading","placeholder","options","onSearch","onOption:selecting"])]),u(v,{class:"empty-content"},{icon:p(()=>[u(C,{size:20})]),_:1})]),a("div",W,[s.selectedProfile!==null?(c(),x(S,{key:0,variant:"primary","aria-label":e.t("user_picker","Insert selected user profile link"),disabled:s.loading||s.selectedProfile===null,onClick:o.submit},{icon:p(()=>[u(N)]),default:p(()=>[k(h(e.t("user_picker","Insert"))+" ",1)]),_:1},8,["aria-label","disabled","onClick"])):P("",!0)])])}const oe=_(V,[["render",Z],["__scopeId","data-v-5d5cee2f"]]);export{oe as default};
//# sourceMappingURL=ProfilesCustomPicker-dSChOfDg.chunk.mjs.map
