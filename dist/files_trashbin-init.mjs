import{C as k,V as W,c as Y,P as Z,e as G,g as J,f as Q,d as X}from"./index-Cp1VzrI8.chunk.mjs";import{j as U,P as ee,V as A,s as o,aa as te,y,m as H,u as ae,ab as se,k as re,c as N,o as h,w,x as C,W as S,z as ne,b as ie,H as le,E as D,F as oe,R as ue,f as de,B as b,t as n,ac as z,a6 as I,h as ce,ad as me,g as fe,ae as pe,a7 as M,l as he}from"./string_decoder-BY7m9-pN.chunk.mjs";import{c as R,i as be}from"./index-CYNbcBtJ.chunk.mjs";import{g as ve,h as ge,s as F,d as ye,i as we}from"./index-JpgrUA2Z-Bcb7_yWp.chunk.mjs";import{b as O,e as _e,c as xe}from"./_plugin-vue_export-helper-CXvX4IZ0.chunk.mjs";import{g as Ae,a as Ce,b as Ve,c as ke,d as Ie}from"./dav-DeUNzbml.chunk.mjs";/* empty css                                     */import{r as P,g as $e,h as E,j as He,k as Ne,n as Se}from"./NcNoteCard-CVhtNL04-B9GbPOf_.chunk.mjs";import{N as Ee}from"./NcAvatar-DmUGApWA-DtpLphsv.chunk.mjs";import"./index-DpibbgL8.chunk.mjs";import"./mdi-BK4BBTPr.chunk.mjs";import"./index-HgP8VlAw.chunk.mjs";import"./colors-Go3zmZRD-S7FgV1KG.chunk.mjs";import"./NcUserStatusIcon-CGEf7fej-liZS007Z.chunk.mjs";import"./NcActionRouter-oT-YU_jf-Bo7WEQMz.chunk.mjs";function T(e){const t=A(P),a=A($e),s=o(()=>{const u=y(e.to);return t.resolve(u)}),r=o(()=>{const{matched:u}=s.value,{length:d}=u,p=u[d-1],c=a.matched;if(!p||!c.length)return-1;const i=c.findIndex(E.bind(null,p));if(i>-1)return i;const m=B(u[d-2]);return d>1&&B(p)===m&&c[c.length-1].path!==m?c.findIndex(E.bind(null,u[d-2])):i}),l=o(()=>r.value>-1&&De(a.params,s.value.params)),f=o(()=>r.value>-1&&r.value===a.matched.length-1&&He(a.params,s.value.params));function v(u={}){if(Ue(u)){const d=t[y(e.replace)?"replace":"push"](y(e.to)).catch(Se);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>d),d}return Promise.resolve()}return{route:s,href:o(()=>s.value.href),isActive:l,isExactActive:f,navigate:v}}function Te(e){return e.length===1?e[0]:e}const Be=U({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:T,setup(e,{slots:t}){const a=ee(T(e)),{options:s}=A(P),r=o(()=>({[L(e.activeClass,s.linkActiveClass,"router-link-active")]:a.isActive,[L(e.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:a.isExactActive}));return()=>{const l=t.default&&Te(t.default(a));return e.custom?l:te("a",{"aria-current":a.isExactActive?e.ariaCurrentValue:null,href:a.href,onClick:a.navigate,class:r.value},l)}}}),Le=Be;function Ue(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function De(e,t){for(const a in t){const s=t[a],r=e[a];if(typeof s=="string"){if(s!==r)return!1}else if(!Ne(r)||r.length!==s.length||s.some((l,f)=>l!==r[f]))return!1}return!0}function B(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const L=(e,t,a)=>e??t??a,ze={};function Me(e,t){return h(),D("div",null,[C(e.$slots,"trigger")])}const Re=O(ze,[["render",Me]]),Fe={class:"user-bubble__name"},Oe={key:0,class:"user-bubble__secondary"},Pe=U({__name:"NcUserBubble",props:H({avatarImage:{default:void 0},user:{default:void 0},displayName:{default:void 0},showUserStatus:{type:Boolean},url:{default:void 0},to:{default:void 0},primary:{type:Boolean},size:{default:20},margin:{default:2}},{open:{type:Boolean},openModifiers:{}}),emits:H(["click"],["update:open"]),setup(e,{emit:t}){const a=ae(e,"open"),s=e,r=t,l=o(()=>{if(!s.avatarImage)return!1;try{return!!new URL(s.avatarImage)}catch{return!1}}),f=o(()=>!!s.avatarImage),v=o(()=>({marginInlineStart:`${s.margin}px`})),u=o(()=>{if(!s.url||s.url.trim()==="")return!1;try{return!!new URL(s.url,s.url?.startsWith?.("/")?window.location.href:void 0)}catch{return se("[NcUserBubble] Invalid URL passed",{url:s.url}),!1}}),d=o(()=>u.value?s.url:void 0),p=o(()=>u.value?"a":s.to?Le:"div"),c=o(()=>({height:`${s.size}px`,lineHeight:`${s.size}px`,borderRadius:`${s.size/2}px`}));return re([()=>s.displayName,()=>s.user],()=>{!s.displayName&&s.user}),(i,m)=>(h(),N(S(i.$slots.default?ve:Re),{shown:a.value,"onUpdate:shown":m[1]||(m[1]=g=>a.value=g),class:"user-bubble__wrapper",trigger:"hover focus"},{trigger:w(({attrs:g})=>[(h(),N(S(p.value),ne({class:["user-bubble__content",{"user-bubble__content--primary":i.primary}],style:c.value,to:i.to,href:d.value},g,{onClick:m[0]||(m[0]=q=>r("click",q))}),{default:w(()=>[ie(Ee,{url:f.value&&l.value?i.avatarImage:void 0,"icon-class":f.value&&!l.value?i.avatarImage:void 0,user:i.user,"display-name":i.displayName,size:i.size-i.margin*2,style:ue(v.value),"disable-tooltip":!0,"disable-menu":!0,"hide-status":!i.showUserStatus,class:"user-bubble__avatar"},null,8,["url","icon-class","user","display-name","size","style","hide-status"]),le("span",Fe,de(i.displayName||i.user),1),i.$slots.name?(h(),D("span",Oe,[C(i.$slots,"name",{},void 0,!0)])):oe("",!0)]),_:2},1040,["class","style","to","href"]))]),default:w(()=>[C(i.$slots,"default",{},void 0,!0)]),_:3},40,["shown"]))}}),Ke=O(Pe,[["__scopeId","data-v-ad356e41"]]),je='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-history" viewBox="0 0 24 24"><path d="M13.5,8H12V13L16.28,15.54L17,14.33L13.5,12.25V8M13,3A9,9 0 0,0 4,12H1L4.96,16.03L9,12H6A7,7 0 0,1 13,5A7,7 0 0,1 20,12A7,7 0 0,1 13,19C11.07,19 9.32,18.21 8.06,16.94L6.64,18.36C8.27,20 10.5,21 13,21A9,9 0 0,0 22,12A9,9 0 0,0 13,3" /></svg>',qe='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-trash-can-outline" viewBox="0 0 24 24"><path d="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" /></svg>',K=`/trashbin/${b()?.uid}/trash`,We=Ae(),Ye=`<?xml version="1.0"?>
<d:propfind ${Ce()}>
	<d:prop>
		<nc:trashbin-deletion-time />
		<nc:trashbin-original-location />
		<nc:trashbin-title />
		<nc:trashbin-deleted-by-id />
		<nc:trashbin-deleted-by-display-name />
		${Ve()}
	</d:prop>
</d:propfind>`;function Ze(e){const t=ke(e,K);return t.attributes.previewUrl=_e("/apps/files_trashbin/preview?fileId={fileid}&x=32&y=32",{fileid:t.fileid}),t}async function Ge(e="/"){const t=(await We.getDirectoryContents(`${K}${e}`,{details:!0,data:Ye,includeSelf:!0})).data.map(Ze),[a]=t.splice(t.findIndex(s=>s.path===e),1);return{folder:a,contents:t}}const Je=new k({id:"files_trashbin--original-location",title:n("files_trashbin","Original location"),render(e){const t=_(e),a=document.createElement("span");return a.title=t,a.textContent=t,a},sort(e,t){const a=_(e),s=_(t);return a.localeCompare(s,[z(),I()],{numeric:!0,usage:"sort"})}}),Qe=new k({id:"files_trashbin--deleted-by",title:n("files_trashbin","Deleted by"),render(e){const{userId:t,displayName:a,label:s}=x(e);if(s){const l=document.createElement("span");return l.textContent=s,l}const r=document.createElement("div");return ce(Ke,{size:32,user:t??void 0,displayName:a??t}).mount(r),r},sort(e,t){const a=x(e),s=a.label??a.displayName??a.userId,r=x(t),l=r.label??r.displayName??r.userId;return s.localeCompare(l,[z(),I()],{numeric:!0,usage:"sort"})}}),Xe=new k({id:"files_trashbin--deleted",title:n("files_trashbin","Deleted"),render(e){const t=e.attributes?.["trashbin-deletion-time"]||(e?.mtime?.getTime()??0)/1e3,a=document.createElement("span");if(t){const s=Intl.DateTimeFormat([I()],{dateStyle:"long",timeStyle:"short"}),r=new Date(t*1e3);return a.title=s.format(r),a.textContent=ge(r,{ignoreSeconds:n("files","few seconds ago")}),a}return a.textContent=n("files_trashbin","A long time ago"),a},sort(e,t){const a=e.attributes?.["trashbin-deletion-time"]||(e?.mtime?.getTime()??0)/1e3;return(t.attributes?.["trashbin-deletion-time"]||(t?.mtime?.getTime()??0)/1e3)-a}});function _(e){const t=V(e.attributes?.["trashbin-original-location"]);if(!t)return n("files_trashbin","Unknown");const a=me(t);return a==="/"||a==="."?n("files_trashbin","All files"):a.replace(/^\//,"")}function x(e){const t=V(e.attributes?.["trashbin-deleted-by-id"]),a=V(e.attributes?.["trashbin-deleted-by-display-name"]);let s;const r=b()?.uid;return t===r&&(s=n("files_trashbin","You")),!t&&!a&&(s=n("files_trashbin","Unknown")),{userId:t,displayName:a,label:s}}function V(e){return e?String(e):null}const $="trashbin",et=new W({id:$,name:n("files_trashbin","Deleted files"),caption:n("files_trashbin","List of files that have been deleted."),emptyTitle:n("files_trashbin","No deleted files"),emptyCaption:n("files_trashbin","Files and folders you have deleted will show up here"),icon:qe,order:50,sticky:!0,defaultSortKey:"deleted",columns:[Je,Qe,Xe],getContents:Ge}),j=fe().setApp("files_trashbin").detectUser().build(),tt=new Y({id:"restore",displayName(){return n("files_trashbin","Restore")},iconSvgInline:()=>je,enabled({nodes:e,view:t}){return t.id!==$?!1:e.length>0&&e.map(a=>a.permissions).every(a=>!!(a&Z.READ))},async exec({nodes:e}){const t=e[0];try{const a=xe(pe(`dav/trashbin/${b().uid}/restore/${t.basename}`));return await R.request({method:"MOVE",url:t.encodedSource,headers:{destination:a}}),M("files:node:deleted",t),!0}catch(a){return be(a)&&a.response?.status===507&&F(n("files_trashbin","Not enough free space to restore the file/folder")),j.error("Failed to restore node",{error:a,node:t}),!1}},async execBatch({nodes:e,view:t,folder:a,contents:s}){return Promise.all(e.map(r=>this.exec({nodes:[r],view:t,folder:a,contents:s})))},order:1,inline:()=>!0});async function at(){try{return await R.delete(`${Ie}/trashbin/${b().uid}/trash`),ye(n("files_trashbin","All files have been permanently deleted")),!0}catch(e){return F(n("files_trashbin","Failed to empty deleted files")),j.error("Failed to empty deleted files",{error:e}),!1}}const st=new G({id:"empty-trash",displayName:()=>n("files_trashbin","Empty deleted files"),order:0,enabled({view:e,folder:t,contents:a}){return e.id!==$||!he("files_trashbin","config").allow_delete?!1:a.length>0&&t.path==="/"},async exec({contents:e}){return await new Promise(t=>{we(n("files_trashbin","Confirm permanent deletion")).setSeverity("warning").setText(n("files_trashbin","Are you sure you want to permanently delete all files and folders in the trash? This cannot be undone.")).setButtons([{label:n("files_trashbin","Cancel"),variant:"secondary",callback:()=>t(!1)},{label:n("files_trashbin","Empty deleted files"),variant:"error",callback:()=>t(!0)}]).build().show().then(()=>{t(!1)})})===!0&&await at()&&e.forEach(t=>M("files:node:deleted",t)),null}}),rt=J();rt.register(et),Q(st),X(tt);
//# sourceMappingURL=files_trashbin-init.mjs.map
