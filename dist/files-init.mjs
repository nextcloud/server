const __vite__fileDeps=["./chunks/TemplatePicker-B3vtJD_R.mjs","./core-common.mjs","./chunks/index-PaKKd09k.mjs","./chunks/_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs","./chunks/index-DG15V7L3.mjs","./chunks/index-CiG5J8j_.mjs","./chunks/index-CPb3EwrS.mjs","./chunks/index-tn-fAC9x.mjs","./chunks/icons-TElqpmA8.mjs","./chunks/logger-R_K4lHwR.mjs"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
/*! third party licenses: dist/vendor.LICENSE.txt */
import{F as h,P as c,e as f,D as V,k as T,t as te,u as E,C as z,g as ne,a as G,d as C,n as D,V as g,h as ie,r as p,j as W}from"./chunks/index-DG15V7L3.mjs";import{bR as b,bQ as y,bS as i,bZ as I,b$ as H,bW as w,aV as J,a_ as oe,F as re,T as ae,al as se,b_ as P,aZ as le,c0 as U,cj as de}from"./core-common.mjs";import{p as k}from"./chunks/index-PaKKd09k.mjs";import{j as ce,z as K,B as ue}from"./chunks/_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import{aw as fe,b3 as pe,b4 as me,b5 as he,b6 as we,b7 as ye,b8 as Y,b9 as _,ba as ve,bb as ge,n as be,bc as Ne,bd as Ce,aa as De,ar as Fe}from"./chunks/icons-TElqpmA8.mjs";import{l as d}from"./chunks/logger-R_K4lHwR.mjs";import{P as Se}from"./chunks/index-C20CehWT.mjs";import{e as Z}from"./chunks/index-CPb3EwrS.mjs";import{a as Ee,b as O,c as Q,h as xe,d as Re,p as Te,r as Ie,i as Pe,e as ke}from"./chunks/LivePhotos-CMdH4wdf.mjs";import{a as _e}from"./chunks/sidebarAction-DYCQBJiz.mjs";import{u as Oe}from"./chunks/index-D0hy_tCT.mjs";import{_ as Ae}from"./chunks/preload-helper-BG02UnR2.mjs";import"./chunks/index-CiG5J8j_.mjs";import"./chunks/index-tn-fAC9x.mjs";import"./chunks/pinia-CcZmjq9w.mjs";const v=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="shared"),x=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="external"),Le=e=>{if(e.length===1)return!1;const t=e.some(o=>v([o])),n=e.some(o=>!v([o]));return t&&n},We=e=>!e.some(t=>t.type!==f.File),Ue=e=>!e.some(t=>t.type!==f.Folder),B=(e,t)=>t.id==="trashbin"?i("files","Delete permanently"):Le(e)?i("files","Delete and unshare"):v(e)?e.length===1?i("files","Leave this share"):i("files","Leave these shares"):x(e)?e.length===1?i("files","Disconnect storage"):i("files","Disconnect storages"):We(e)?e.length===1?i("files","Delete file"):i("files","Delete files"):Ue(e)?e.length===1?i("files","Delete folder"):i("files","Delete folders"):i("files","Delete"),Be=new Se({concurrency:5}),$e=new h({id:"delete",displayName:B,iconSvgInline:e=>v(e)?fe:x(e)?pe:me,enabled(e){return e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.DELETE)!==0)},async exec(e,t,n){try{return await b.delete(e.encodedSource),y("files:node:deleted",e),!0}catch(o){return d.error("Error while deleting a file",{error:o,source:e.source,node:e}),!1}},async execBatch(e,t,n){if(await new Promise(a=>{if(e.length>=5&&!v(e)&&!x(e)){window.OC.dialogs.confirmDestructive(i("files","You are about to delete {count} items.",{count:e.length}),i("files","Confirm deletion"),{type:window.OC.dialogs.YES_NO_BUTTONS,confirm:B(e,t),confirmClasses:"error",cancel:i("files","Cancel")},s=>{a(s)});return}a(!0)})===!1)return ce(i("files","Deletion cancelled")),Promise.all(e.map(()=>!1));const o=e.map(a=>new Promise(s=>{Be.add(async()=>{const r=await this.exec(a,t,n);s(r!==null?r:!1)})}));return Promise.all(o)},order:100}),X=function(e){const t=document.createElement("a");t.download="",t.href=e,t.click()},$=function(e,t){const n=Math.random().toString(36).substring(2),o=I("/apps/files/ajax/download.php?dir={dir}&files={files}&downloadStartSecret={secret}",{dir:e,secret:n,files:JSON.stringify(t.map(a=>a.basename))});X(o)},je=function(e){var t,n;if(!(e.permissions&c.READ))return!1;if(e.attributes["mount-type"]==="shared"){const o=JSON.parse((t=e.attributes["share-attributes"])!=null?t:"null"),a=(n=o==null?void 0:o.find)==null?void 0:n.call(o,s=>s.scope==="permissions"&&s.key==="download");if(a!==void 0&&a.enabled===!1)return!1}return!0},qe=new h({id:"download",displayName:()=>i("files","Download"),iconSvgInline:()=>he,enabled(e){return e.length===0||e.some(t=>t.type===f.Folder)&&e.some(t=>{var n;return!((n=t.root)!=null&&n.startsWith("/files"))})?!1:e.every(je)},async exec(e,t,n){return e.type===f.Folder?($(n,[e]),null):(X(e.encodedSource),null)},async execBatch(e,t,n){return e.length===1?(this.exec(e[0],t,n),[null]):($(n,e),new Array(e.length).fill(null))},order:30}),Me=async function(e){var t;const n=H("apps/files/api/v1")+"/openlocaleditor?format=json";try{const o=await b.post(n,{path:e}),a=(t=w())==null?void 0:t.uid;let s="nc://open/".concat(a,"@")+window.location.host+Z(e);s+="?token="+o.data.ocs.data.token,window.location.href=s}catch{K(i("files","Failed to redirect to client"))}},Ve=new h({id:"edit-locally",displayName:()=>i("files","Edit locally"),iconSvgInline:()=>we,enabled(e){return e.length!==1?!1:(e[0].permissions&c.UPDATE)!==0},async exec(e){return Me(e.path),null},order:25}),N=e=>e.some(t=>t.attributes.favorite!==1),j=async(e,t,n)=>{try{const o=I("/apps/files/api/v1/files")+Z(e.path);return await b.post(o,{tags:n?[window.OC.TAG_FAVORITE]:[]}),t.id==="favorites"&&!n&&e.dirname==="/"&&y("files:node:deleted",e),J.set(e.attributes,"favorite",n?1:0),n?y("files:favorites:added",e):y("files:favorites:removed",e),!0}catch(o){const a=n?"adding a file to favourites":"removing a file from favourites";return d.error("Error while "+a,{error:o,source:e.source,node:e}),!1}},ze=new h({id:"favorite",displayName(e){return N(e)?i("files","Add to favorites"):i("files","Remove from favorites")},iconSvgInline:e=>N(e)?ye:Y,enabled(e){return!e.some(t=>{var n,o;return!((o=(n=t.root)==null?void 0:n.startsWith)!=null&&o.call(n,"/files"))})&&e.every(t=>t.permissions!==c.NONE)},async exec(e,t){const n=N([e]);return await j(e,t,n)},async execBatch(e,t){const n=N(e);return Promise.all(e.map(async o=>await j(o,t,n)))},order:-50}),Ge=new h({id:"open-folder",displayName(e){const t=e[0].attributes.displayName||e[0].basename;return i("files","Open folder {displayName}",{displayName:t})},iconSvgInline:()=>_,enabled(e){if(e.length!==1)return!1;const t=e[0];return t.isDavRessource?t.type===f.Folder&&(t.permissions&c.READ)!==0:!1},async exec(e,t){return!e||e.type!==f.Folder?!1:(window.OCP.Files.Router.goToRoute(null,{view:t.id,fileid:e.fileid},{dir:e.path}),null)},default:V.HIDDEN,order:-100}),He=new h({id:"open-in-files-recent",displayName:()=>i("files","Open in Files"),iconSvgInline:()=>"",enabled:(e,t)=>t.id==="recent",async exec(e){let t=e.dirname;return e.type===f.Folder&&(t=t+"/"+e.basename),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:t,openfile:"true"}),null},order:-1e3,default:V.HIDDEN}),Je=new h({id:"rename",displayName:()=>i("files","Rename"),iconSvgInline:()=>ve,enabled:e=>e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.UPDATE)!==0),async exec(e){return y("files:node:rename",e),null},order:10}),Ke=new h({id:"view-in-folder",displayName(){return i("files","View in folder")},iconSvgInline:()=>ge,enabled(e,t){if(t.id==="files"||e.length!==1)return!1;const n=e[0];return!n.isDavRessource||n.permissions===c.NONE?!1:n.type===f.File},async exec(e){return!e||e.type!==f.File?!1:(window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:e.dirname}),null)},order:80}),Ye=oe({name:"NewNodeDialog",components:{NcButton:re,NcDialog:ae,NcTextField:se},props:{defaultName:{type:String,default:i("files","New folder")},otherNames:{type:Array,default:()=>[]},open:{type:Boolean,default:!0},name:{type:String,default:i("files","Create new folder")},label:{type:String,default:i("files","Folder name")}},emits:{close:e=>e===null||e},data(){return{localDefaultName:this.defaultName||i("files","New folder")}},computed:{errorMessage(){return this.isUniqueName?"":i("files","A file or folder with that name already exists.")},uniqueName(){return Ee(this.localDefaultName,this.otherNames)},isUniqueName(){return this.localDefaultName===this.uniqueName}},watch:{defaultName(){this.localDefaultName=this.defaultName||i("files","New folder")},open(){this.$nextTick(()=>this.focusInput())}},mounted(){this.localDefaultName=this.uniqueName,this.$nextTick(()=>this.focusInput())},methods:{t:i,focusInput(){this.open&&this.$nextTick(()=>{var e,t;return(t=(e=this.$refs.input)==null?void 0:e.focus)==null?void 0:t.call(e)})},onCreate(){this.$emit("close",this.localDefaultName)},onClose(e){e||this.$emit("close",null)}}});var Ze=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("NcDialog",{attrs:{name:e.name,open:e.open,"close-on-click-outside":"","out-transition":""},on:{"update:open":e.onClose},scopedSlots:e._u([{key:"actions",fn:function(){return[t("NcButton",{attrs:{type:"primary",disabled:!e.isUniqueName},on:{click:e.onCreate}},[e._v(" "+e._s(e.t("files","Create"))+" ")])]},proxy:!0}])},[t("form",{on:{submit:function(n){return n.preventDefault(),e.onCreate.apply(null,arguments)}}},[t("NcTextField",{ref:"input",attrs:{error:!e.isUniqueName,"helper-text":e.errorMessage,label:e.label,value:e.localDefaultName},on:{"update:value":function(n){e.localDefaultName=n}}})],1)])},Qe=[],Xe=be(Ye,Ze,Qe,!1,null,null);const et=Xe.exports;function A(e,t,n={}){const o=t.map(a=>a.basename);return new Promise(a=>{Oe(et,{...n,defaultName:e,otherNames:o},s=>{a(s)})})}const tt=async(e,t)=>{const n=e.source+"/"+t,o=e.encodedSource+"/"+encodeURIComponent(t),a=await b({method:"MKCOL",url:o,headers:{Overwrite:"F"}});return{fileid:parseInt(a.headers["oc-fileid"]),source:n}},nt={id:"newFolder",displayName:i("files","New folder"),enabled:e=>(e.permissions&c.CREATE)!==0,iconSvgInline:Ne,order:0,async handler(e,t){var n,o,a,s,r;const l=await A(i("files","New folder"),t);if(l!==null){const{fileid:u,source:m}=await tt(e,l),F=new T({source:m,id:u,mtime:new Date,owner:((n=w())==null?void 0:n.uid)||null,permissions:c.ALL,root:(e==null?void 0:e.root)||"/files/"+((o=w())==null?void 0:o.uid),attributes:{"mount-type":(a=e.attributes)==null?void 0:a["mount-type"],"owner-id":(s=e.attributes)==null?void 0:s["owner-id"],"owner-display-name":(r=e.attributes)==null?void 0:r["owner-display-name"]}});ue(i("files",'Created new folder "{name}"',{name:k.basename(m)})),d.debug("Created new folder",{folder:F,source:m}),y("files:node:created",F),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:F.fileid},{dir:e.path})}}};let L=P("files","templates_path",!1);d.debug("Initial templates folder",{templatesPath:L});const it=async function(e,t){const n=k.join(e.path,t);try{d.debug("Initializing the templates directory",{templatePath:n});const{data:o}=await b.post(H("apps/files/api/v1/templates/path"),{templatePath:n,copySystemTemplates:!0});window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:void 0},{dir:n}),d.info("Created new templates folder",{...o.ocs.data}),L=o.ocs.data.templates_path}catch{d.error("Unable to initialize the templates directory"),K(i("files","Unable to initialize the templates directory"))}},ot={id:"template-picker",displayName:i("files","Create new templates folder"),iconSvgInline:Ce,order:10,enabled(e){var t;return L||e.owner!==((t=w())==null?void 0:t.uid)?!1:(e.permissions&c.CREATE)!==0},async handler(e,t){const n=await A(i("files","Templates"),t,{name:i("files","New template folder")});n!==null&&(it(e,n),te("template-picker"))}},rt=le(()=>Ae(()=>import("./chunks/TemplatePicker-B3vtJD_R.mjs"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url));let S=null;const at=async e=>{if(S===null){const t=document.createElement("div");t.id="template-picker",document.body.appendChild(t),S=new J({render:n=>n(rt,{ref:"picker",props:{parent:e}}),methods:{open(...n){this.$refs.picker.open(...n)}},el:t})}return S};function st(){P("files","templates",[]).forEach((e,t)=>{E({id:"template-new-".concat(e.app,"-").concat(t),displayName:e.label,iconClass:e.iconClass||"icon-file",iconSvgInline:e.iconSvgInline,enabled(n){return(n.permissions&c.CREATE)!==0},order:11,async handler(n,o){const a=at(n),s=await A("".concat(e.label).concat(e.extension),o,{label:i("files","Filename"),name:e.label});s!==null&&(await a).open(s,e)}})})}const ee=(e="/")=>e!=="/"?O(e):new z((t,n,o)=>{const a=ne(Q).catch(n).then(s=>{var r;if(!s){n();return}t({contents:s,folder:new T({id:0,source:"".concat(G).concat(C),root:C,owner:((r=w())==null?void 0:r.uid)||null,permissions:c.READ})})});o(()=>a.cancel())}),q=function(e,t=0){return new g({id:R(e.path),name:k.basename(e.path),icon:_,order:t,params:{dir:e.path,fileid:e.fileid.toString(),view:"favorites"},parent:"favorites",columns:[],getContents:ee})},R=function(e){return"favorite-".concat(xe(e))},lt=()=>{const e=P("files","favoriteFolders",[]),t=e.map((r,l)=>q(r,l));d.debug("Generating favorites view",{favoriteFolders:e});const n=D();n.register(new g({id:"favorites",name:i("files","Favorites"),caption:i("files","List of favorites files and folders."),emptyTitle:i("files","No favorites yet"),emptyCaption:i("files","Files and folders you mark as favorite will show up here"),icon:Y,order:15,columns:[],getContents:ee})),t.forEach(r=>n.register(r)),U("files:favorites:added",r=>{var l;if(r.type===f.Folder){if(r.path===null||!((l=r.root)!=null&&l.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:r});return}a(r)}}),U("files:favorites:removed",r=>{var l;if(r.type===f.Folder){if(r.path===null||!((l=r.root)!=null&&l.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:r});return}s(r.path)}});const o=function(){e.sort((r,l)=>r.path.localeCompare(l.path,de(),{ignorePunctuation:!0})),e.forEach((r,l)=>{const u=t.find(m=>m.id===R(r.path));u&&(u.order=l)})},a=function(r){const l={path:r.path,fileid:r.fileid},u=q(l);e.find(m=>m.path===r.path)||(e.push(l),t.push(u),o(),n.register(u))},s=function(r){const l=R(r),u=e.findIndex(m=>m.path===r);u!==-1&&(e.splice(u,1),t.splice(u,1),n.remove(l),o())}},dt=Math.round(Date.now()/1e3-60*60*24*14),ct=(e="/")=>{const t=Re(Te),n=s=>e!=="/"||t.userConfig.show_hidden||!s.dirname.split("/").some(r=>r.startsWith(".")),o=new AbortController,a=async()=>{var s;const r=(await Q.search("/",{signal:o.signal,details:!0,data:ie(dt)})).data.results.map(Ie).filter(n);return{folder:new T({id:0,source:"".concat(G).concat(C),root:C,owner:((s=w())==null?void 0:s.uid)||null,permissions:c.READ}),contents:r}};return new z(async(s,r,l)=>{l(()=>o.abort()),s(a())})},ut=()=>{D().register(new g({id:"recent",name:i("files","Recent"),caption:i("files","List of recently modified files and folders."),emptyTitle:i("files","No recently modified files"),emptyCaption:i("files","Files and folders you recently modified will show up here."),icon:De,order:10,defaultSortKey:"mtime",getContents:ct}))};var M;const ft=(M=w())==null?void 0:M.uid,pt=function(e){const t=["group","shared"],n=e.attributes["mount-type"];return ft===e.owner&&!t.includes(n)},mt=(e="/")=>O(e).then(t=>(t.contents=t.contents.filter(pt),t)),ht=()=>{D().register(new g({id:"personal",name:i("files","Personal Files"),caption:i("files","List of your files and folders that are not shared."),emptyTitle:i("files","No personal files found"),emptyCaption:i("files","Files that are not shared will show up here."),icon:Fe,order:5,getContents:mt}))},wt=()=>{D().register(new g({id:"files",name:i("files","All files"),caption:i("files","List of your files and folders."),icon:_,order:0,getContents:O}))},yt=()=>{"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{const e=I("/apps/files/preview-service-worker.js",{},{noRewrite:!0}),t=await navigator.serviceWorker.register(e,{scope:"/"});d.debug("SW registered: ",{registration:t})}catch(e){d.error("SW registration failed: ",{error:e})}}):d.debug("Service Worker is not enabled on this browser.")};p($e),p(qe),p(Ve),p(ze),p(ke),p(Ge),p(He),p(Je),p(_e),p(Ke),E(nt),E(ot),st(),lt(),wt(),ut(),ht(),yt(),W("nc:hidden",{nc:"http://nextcloud.org/ns"}),W("nc:is-mount-root",{nc:"http://nextcloud.org/ns"}),Pe();
