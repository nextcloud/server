(()=>{"use strict";var e,t,i,n={1032(e,t,i){var n=i(53334),r=i(85471),a=(i(83219),i(29069),i(52781)),l=i(85168),o=i(87485),s=i(63814);function c(e){const t=(0,s.$_)(),{globalscale:i}=(0,o.F)();return i?.token?(0,s.Jv)("/gf/{token}/{fileid}",{token:i.token,fileid:e},{baseURL:t}):(0,s.Jv)("/f/{fileid}",{fileid:e},{baseURL:t})}const d=(0,i(35947).YK)().setApp("files").detectUser().build(),A=(0,r.pM)({__name:"FileReferencePickerElement",props:{providerId:null,accessible:{type:Boolean}},emits:["submit","cancel"],setup(e,{emit:t}){const i=`filepicker-${Math.random().toString(36).slice(7)}`,a=new l.CO((0,n.t)("files","Select file or folder to link to")).allowDirectories(!0).setButtonFactory(o).setContainer(`#${i}`).setMultiSelect(!1).build();function o(e){const t=[],i=e[0];return void 0===i||"/"===i.path?[]:(t.push({label:(0,n.t)("files","Choose {file}",{file:i.displayname}),variant:"primary",callback:()=>{}}),t)}function s(e){t("submit",c(e.fileid))}return(0,r.sV)(async()=>{try{const[e]=await a.pickNodes();s(e)}catch(e){d.debug("Aborted picking nodes:",{error:e}),t("cancel")}}),{__sfc:!0,emit:t,containerId:i,filePicker:a,buttonFactory:o,onSubmit:s}}});var p=i(14486);const f=(0,p.A)(A,function(){return(0,this._self._c)("div",{attrs:{id:this._self._setupProxy.containerId}})},[],!1,null,null,null).exports;var u=i(21777),v=i(43627),h=i.n(v),b=i(60557),m=i(25866);const w=(0,r.pM)({name:"ReferenceFileWidget",components:{FolderIcon:m.A,FileIcon:b.A},props:{richObject:{type:Object,required:!0},accessible:{type:Boolean,default:!0},interactive:{type:Boolean,default:!0}},data:()=>({previewUrl:null,failedViewer:!1}),computed:{availableViewerHandlers:()=>window?.OCA?.Viewer?.availableHandlers||[],viewerHandler(){return this.availableViewerHandlers.find(e=>e.mimes.includes(this.richObject.mimetype))},viewerFile(){const e=(0,s.dC)(`dav/files/${(0,u.HW)()?.uid}/${this.richObject.path}`).replace(/\/\/$/,"/");return{filename:this.richObject.path,basename:this.richObject.name,lastmod:new Date(1e3*this.richObject.mtime),size:this.richObject.size,type:"file",mime:this.richObject.mimetype,fileid:this.richObject.id,failed:!1,loaded:!0,davPath:e,source:e}},fileSize(){return window.OC.Util.humanFileSize(this.richObject.size)},fileMtime(){return window.OC.Util.relativeModifiedDate(1e3*this.richObject.mtime)},filePath(){return h().dirname(this.richObject.path)},filePreviewStyle(){return this.previewUrl?{backgroundImage:"url("+this.previewUrl+")"}:{}},filePreviewClass(){return this.previewUrl?"widget-file__image--preview":"widget-file__image--icon"},isFolder(){return"httpd/unix-directory"===this.richObject.mimetype}},mounted(){if(this.richObject["preview-available"]){const e=(0,s.Jv)("/core/preview?fileId={fileId}&x=250&y=250",{fileId:this.richObject.id}),t=new Image;t.onload=()=>{this.previewUrl=e},t.onerror=e=>{d.error("could not load recommendation preview",{error:e})},t.src=e}},methods:{navigate(e){this.isFolder?(e.stopPropagation(),e.preventDefault(),this.openFilePicker()):-1===window?.OCA?.Viewer?.mimetypes.indexOf(this.richObject.mimetype)||window?.OCA?.Viewer?.file||(e.stopPropagation(),e.preventDefault(),window?.OCA?.Viewer?.open({path:this.richObject.path}))},openFilePicker(){(0,l.a1)((0,n.t)("settings","Your files")).allowDirectories(!0).setMultiSelect(!1).addButton({id:"open",label:this.t("settings","Open in files"),callback([e]){e&&window.open(c(e.fileid))},variant:"primary"}).disableNavigation().startAt(this.richObject.path).build().pick()}}});var C=i(85072),g=i.n(C),_=i(97825),y=i.n(_),x=i(77659),k=i.n(x),O=i(55056),j=i.n(O),B=i(10540),F=i.n(B),P=i(41113),I=i.n(P),S=i(63063),T={};T.styleTagTransform=I(),T.setAttributes=j(),T.insert=k().bind(null,"head"),T.domAPI=y(),T.insertStyleElement=F(),g()(S.A,T),S.A&&S.A.locals&&S.A.locals;const z=(0,p.A)(w,function(){var e=this,t=e._self._c;return e._self._setupProxy,e.accessible?e.interactive&&e.viewerHandler&&!e.failedViewer?t(e.viewerHandler.component,e._b({tag:"component",staticClass:"widget-file widget-file--interactive",attrs:{active:!1,"can-swipe":!1,"can-zoom":!1,"is-embedded":!0,"file-list":[e.viewerFile],"is-full-screen":!1,"is-sidebar-shown":!1},on:{error:function(t){e.failedViewer=!0}}},"component",e.viewerFile,!1)):t("a",{staticClass:"widget-file widget-file--link",attrs:{href:e.richObject.link,target:"_blank"},on:{click:e.navigate}},[t("span",{staticClass:"widget-file__image",class:e.filePreviewClass,style:e.filePreviewStyle},[e.previewUrl?e._e():[e.isFolder?t("FolderIcon",{attrs:{size:88,"fill-color":"var(--color-primary-element)"}}):t("FileIcon",{attrs:{size:88}})]],2),e._v(" "),t("span",{staticClass:"widget-file__details"},[t("p",{staticClass:"widget-file__title"},[e._v(e._s(e.richObject.name))]),e._v(" "),t("p",{staticClass:"widget-file__description"},[e._v(e._s(e.fileSize)),t("br"),e._v(e._s(e.fileMtime))]),e._v(" "),t("p",{staticClass:"widget-file__link"},[e._v(e._s(e.filePath))])])]):t("div",{staticClass:"widget-file widget-file--no-access"},[t("span",{staticClass:"widget-file__image widget-file__image--icon"},[e.isFolder?t("FolderIcon",{attrs:{size:88}}):t("FileIcon",{attrs:{size:88}})],1),e._v(" "),t("span",{staticClass:"widget-file__details"},[t("p",{staticClass:"widget-file__title"},[e._v("\n\t\t\t"+e._s(e.t("files","File cannot be accessed"))+"\n\t\t")]),e._v(" "),t("p",{staticClass:"widget-file__description"},[e._v("\n\t\t\t"+e._s(e.t("files","The file could not be found or you do not have permissions to view it. Ask the sender to share it."))+"\n\t\t")])])])},[],!1,null,"613fea0c",null).exports;r.Ay.mixin({methods:{t:n.t}}),(0,a.r)("file",(e,{richObjectType:t,richObject:i,accessible:n,interactive:a})=>{new(r.Ay.extend(z))({propsData:{richObjectType:t,richObject:i,accessible:n,interactive:a}}).$mount(e)},()=>{},{hasInteractiveView:!0}),(0,a.e)("files",(e,{providerId:t,accessible:i})=>{const n=new(r.Ay.extend(f))({propsData:{providerId:t,accessible:i}}).$mount(e);return new a.N(n.$el,n)},(e,t)=>{t.object.$destroy()})},63063(e,t,i){i.d(t,{A:()=>o});var n=i(71354),r=i.n(n),a=i(76314),l=i.n(a)()(r());l.push([e.id,".widget-file[data-v-613fea0c]{display:flex;flex-grow:1;color:var(--color-main-text) !important;text-decoration:none !important;padding:0 !important}.widget-file__image[data-v-613fea0c]{width:30%;min-width:160px;max-width:320px;background-position:center;background-size:cover;background-repeat:no-repeat}.widget-file__image--icon[data-v-613fea0c]{min-width:88px;max-width:88px;padding:12px;padding-inline-end:0;display:flex;align-items:center;justify-content:center}.widget-file__title[data-v-613fea0c]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:bold}.widget-file__details[data-v-613fea0c]{padding:12px;flex-grow:1;display:flex;flex-direction:column}.widget-file__details p[data-v-613fea0c]{margin:0;padding:0}.widget-file__description[data-v-613fea0c]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical}.widget-file--link[data-v-613fea0c]{color:var(--color-text-maxcontrast)}.widget-file--interactive[data-v-613fea0c]{position:relative;height:400px;max-height:50vh;margin:0}","",{version:3,sources:["webpack://./apps/files/src/views/ReferenceFileWidget.vue"],names:[],mappings:"AACA,8BACC,YAAA,CACA,WAAA,CACA,uCAAA,CACA,+BAAA,CACA,oBAAA,CAEA,qCACC,SAAA,CACA,eAAA,CACA,eAAA,CACA,0BAAA,CACA,qBAAA,CACA,2BAAA,CAEA,2CACC,cAAA,CACA,cAAA,CACA,YAAA,CACA,oBAAA,CACA,YAAA,CACA,kBAAA,CACA,sBAAA,CAIF,qCACC,eAAA,CACA,sBAAA,CACA,kBAAA,CACA,gBAAA,CAGD,uCACC,YAAA,CACA,WAAA,CACA,YAAA,CACA,qBAAA,CAEA,yCACC,QAAA,CACA,SAAA,CAIF,2CACC,eAAA,CACA,sBAAA,CACA,mBAAA,CACA,oBAAA,CACA,YAAA,CACA,2BAAA,CAID,oCACC,mCAAA,CAGD,2CACC,iBAAA,CACA,YAAA,CACA,eAAA,CACA,QAAA",sourcesContent:["\n.widget-file {\n\tdisplay: flex;\n\tflex-grow: 1;\n\tcolor: var(--color-main-text) !important;\n\ttext-decoration: none !important;\n\tpadding: 0 !important;\n\n\t&__image {\n\t\twidth: 30%;\n\t\tmin-width: 160px;\n\t\tmax-width: 320px;\n\t\tbackground-position: center;\n\t\tbackground-size: cover;\n\t\tbackground-repeat: no-repeat;\n\n\t\t&--icon {\n\t\t\tmin-width: 88px;\n\t\t\tmax-width: 88px;\n\t\t\tpadding: 12px;\n\t\t\tpadding-inline-end: 0;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t}\n\t}\n\n\t&__title {\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t\tfont-weight: bold;\n\t}\n\n\t&__details {\n\t\tpadding: 12px;\n\t\tflex-grow: 1;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\n\t\tp {\n\t\t\tmargin: 0;\n\t\t\tpadding: 0;\n\t\t}\n\t}\n\n\t&__description {\n\t\toverflow: hidden;\n\t\ttext-overflow: ellipsis;\n\t\tdisplay: -webkit-box;\n\t\t-webkit-line-clamp: 3;\n\t\tline-clamp: 3;\n\t\t-webkit-box-orient: vertical;\n\t}\n\n\t// No preview, standard link to ressource\n\t&--link {\n\t\tcolor: var(--color-text-maxcontrast);\n\t}\n\n\t&--interactive {\n\t\tposition: relative;\n\t\theight: 400px;\n\t\tmax-height: 50vh;\n\t\tmargin: 0;\n\t}\n}\n"],sourceRoot:""}]);const o=l}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}a.m=n,e=[],a.O=(t,i,n,r)=>{if(!i){var l=1/0;for(d=0;d<e.length;d++){for(var[i,n,r]=e[d],o=!0,s=0;s<i.length;s++)(!1&r||l>=r)&&Object.keys(a.O).every(e=>a.O[e](i[s]))?i.splice(s--,1):(o=!1,r<l&&(l=r));if(o){e.splice(d--,1);var c=n();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[i,n,r]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,i)=>(a.f[i](e,t),t),[])),a.u=e=>e+"-"+e+".js?v="+{2710:"0c2e26891ac1c05900e0",4471:"9b3c8620f038b7593241",5862:"580b9c2e231a9169a12f",7004:"da5a822695a273d4d2eb",7394:"5b773f16893ed80e0246",7859:"cd6f48c919ca307639eb",8127:"b62d5791b2d7256af4a8",8453:"0ad2c9a35eee895d5980"}[e],a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},i="nextcloud-ui-legacy:",a.l=(e,n,r,l)=>{if(t[e])t[e].push(n);else{var o,s;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var A=c[d];if(A.getAttribute("src")==e||A.getAttribute("data-webpack")==i+r){o=A;break}}o||(s=!0,(o=document.createElement("script")).charset="utf-8",a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",i+r),o.src=e),t[e]=[n];var p=(i,n)=>{o.onerror=o.onload=null,clearTimeout(f);var r=t[e];if(delete t[e],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach(e=>e(n)),i)return i(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=p.bind(null,o.onerror),o.onload=p.bind(null,o.onload),s&&document.head.appendChild(o)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),a.j=54,(()=>{var e;globalThis.importScripts&&(e=globalThis.location+"");var t=globalThis.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=i[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{a.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={54:0};a.f.j=(t,i)=>{var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var r=new Promise((i,r)=>n=e[t]=[i,r]);i.push(n[2]=r);var l=a.p+a.u(t),o=new Error;a.l(l,i=>{if(a.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var r=i&&("load"===i.type?"missing":i.type),l=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+l+")",o.name="ChunkLoadError",o.type=r,o.request=l,n[1](o)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,i)=>{var n,r,[l,o,s]=i,c=0;if(l.some(t=>0!==e[t])){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);if(s)var d=s(a)}for(t&&t(i);c<l.length;c++)r=l[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},i=globalThis.webpackChunknextcloud_ui_legacy=globalThis.webpackChunknextcloud_ui_legacy||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),a.nc=void 0;var l=a.O(void 0,[4208],()=>a(1032));l=a.O(l)})();
//# sourceMappingURL=files-reference-files.js.map?v=bc3c5ba0c19195a45921