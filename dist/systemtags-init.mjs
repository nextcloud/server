/*! third party licenses: dist/vendor.LICENSE.txt */
import{F as y,j as h,r as v,b,k as d,P as m,f as w,l as T,m as E,n as _,V as x}from"./chunks/index-DG15V7L3.mjs";import{bS as n,c1 as g,bW as f}from"./core-common.mjs";import{K as A}from"./chunks/icons-TElqpmA8.mjs";import{f as C}from"./chunks/api-Bu5d7DE4.mjs";import"./chunks/index-CiG5J8j_.mjs";import"./chunks/index-PaKKd09k.mjs";import"./chunks/index-CPb3EwrS.mjs";import"./chunks/index-tn-fAC9x.mjs";const r=function(s){var t,e;const a=(e=(t=s.attributes)==null?void 0:t["system-tags"])==null?void 0:e["system-tag"];return a===void 0?[]:[a].flat()},l=function(s,t=!1){const e=document.createElement("li");return e.classList.add("files-list__system-tag"),e.textContent=s,t&&e.classList.add("files-list__system-tag--more"),e},L=new y({id:"system-tags",displayName:()=>"",iconSvgInline:()=>"",enabled(s){if(s.length!==1)return!1;const t=s[0];return r(t).length!==0},exec:async()=>null,async renderInline(s){const t=r(s);if(t.length===0)return null;const e=document.createElement("ul");if(e.classList.add("files-list__system-tags"),t.length===1)e.setAttribute("aria-label",n("files","This file has the tag {tag}",{tag:t[0]}));else{const a=t.slice(0,-1).join(", "),i=t[t.length-1];e.setAttribute("aria-label",n("files","This file has the tags {firstTags} and {lastTag}",{firstTags:a,lastTag:i}))}if(e.append(l(t[0])),t.length>1){const a=l("+"+(t.length-1),!0);a.setAttribute("title",t.slice(1).join(", ")),e.append(a)}return e},order:0});h("nc:system-tags"),v(L);const N=b(),I=s=>w(s),R=s=>'<?xml version="1.0"?>\n<oc:filter-files '.concat(T(),">\n	<d:prop>\n		").concat(E(),"\n	</d:prop>\n    <oc:filter-rules>\n        <oc:systemtag>").concat(s,"</oc:systemtag>\n    </oc:filter-rules>\n</oc:filter-files>"),c=function(s){var t;return new d({id:s.id,source:g("dav/systemtags/"+s.id),owner:(t=f())==null?void 0:t.uid,root:"/systemtags",permissions:m.READ,attributes:{...s,"is-tag":!0}})},j=async(s="/")=>{var t;const e=(await C()).filter(o=>o.userVisible);if(s==="/")return{folder:new d({id:0,source:g("dav/systemtags"),owner:(t=f())==null?void 0:t.uid,root:"/systemtags",permissions:m.NONE}),contents:e.map(c)};const a=parseInt(s.replace("/",""),10),i=e.find(o=>o.id===a);if(!i)throw new Error("Tag not found");const u=c(i),p=await N.getDirectoryContents("/",{details:!0,data:R(a),headers:{method:"REPORT"}});return{folder:u,contents:p.data.map(I)}},D=_();D.register(new x({id:"tags",name:n("systemtags","Tags"),caption:n("systemtags","List of tags and their associated files and folders."),emptyTitle:n("systemtags","No tags found"),emptyCaption:n("systemtags","Tags you have created will show up here."),icon:A,order:25,getContents:j}));
