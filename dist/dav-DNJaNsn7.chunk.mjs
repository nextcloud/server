import{a as w,b as h,o as g}from"./index-6_gsQFyp.chunk.mjs";import{i as m,b as y}from"./index-xFugdZPW.chunk.mjs";import{b}from"./createElementId-DhjFt1I9-CmaX6aVQ.chunk.mjs";import{a as E,u as D}from"./index-DY1sONrk.chunk.mjs";import{l as u,N,a as $,b as T,P as i}from"./index-UotFO_A_.chunk.mjs";const x=function(e=""){let t=i.NONE;return e&&((e.includes("C")||e.includes("K"))&&(t|=i.CREATE),e.includes("G")&&(t|=i.READ),(e.includes("W")||e.includes("N")||e.includes("V"))&&(t|=i.UPDATE),e.includes("D")&&(t|=i.DELETE),e.includes("R")&&(t|=i.SHARE)),t},_=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],f={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},S=function(e,t={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[..._],window._nc_dav_namespaces={...f});const s={...window._nc_dav_namespaces,...t};if(window._nc_dav_properties.find(n=>n===e))return u.warn(`${e} already registered`,{prop:e}),!1;if(e.startsWith("<")||e.split(":").length!==2)return u.error(`${e} is not valid. See example: 'oc:fileid'`,{prop:e}),!1;const o=e.split(":")[0];return s[o]?(window._nc_dav_properties.push(e),window._nc_dav_namespaces=s,!0):(u.error(`${e} namespace unknown`,{prop:e,namespaces:s}),!1)},z=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[..._]),window._nc_dav_properties.map(e=>`<${e} />`).join(" ")},C=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...f}),Object.keys(window._nc_dav_namespaces).map(e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`).join(" ")};function A(){return m()?`/files/${y()}`:`/files/${w()?.uid}`}const R=A();function q(){const e=b("dav");return m()?e.replace("remote.php","public.php"):e}const v=q(),W=function(e=v,t={}){const s=E(e,{headers:t});function o(n){s.setHeaders({...t,"X-Requested-With":"XMLHttpRequest",requesttoken:n??""})}return g(o),o(h()),D().patch("fetch",(n,a)=>{const r=a.headers;return r?.method&&(a.method=r.method,delete r.method),fetch(n,a)}),s},I=function(e,t=R,s=v){let o=w()?.uid;if(m())o=o??"anonymous";else if(!o)throw new Error("No user id found");const n=e.props,a=x(n?.permissions),r=String(n?.["owner-id"]||o),l=n.fileid||0,d=new Date(Date.parse(e.lastmod)),c=new Date(Date.parse(n.creationdate)),p={id:l,source:`${s}${e.filename}`,mtime:!isNaN(d.getTime())&&d.getTime()!==0?d:void 0,crtime:!isNaN(c.getTime())&&c.getTime()!==0?c:void 0,mime:e.mime||"application/octet-stream",displayname:n.displayname!==void 0?String(n.displayname):void 0,size:n?.size||Number.parseInt(n.getcontentlength||"0"),status:l<0?N.FAILED:void 0,permissions:a,owner:r,root:t,attributes:{...e,...n,hasPreview:n?.["has-preview"]}};return delete p.attributes?.props,e.type==="file"?new $(p):new T(p)};export{C as a,z as b,S as c,v as d,W as g,I as r};
//# sourceMappingURL=dav-DNJaNsn7.chunk.mjs.map
