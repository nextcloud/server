import{F as g,r as X,a as o}from"./index-DC-Z9B7X.chunk.mjs";import{g as Y,e as $,O as R,f as a,P as _,m as J,k as m,Q as ee,R as te,c as b,q as N,o as p,w as d,j as re,S as ae,b as D,u as n,d as u,t as c,_ as ie}from"./TrashCanOutline-Das_T9Qh.chunk.mjs";import{g as ne,b as se,c as I,N as T,d as de,s as f,e as x,f as le}from"./Plus-BBJJAKrt.chunk.mjs";import{_ as oe}from"./index-Cjutx76A.chunk.mjs";const me='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-alarm-off" viewBox="0 0 24 24"><path d="M8,3.28L6.6,1.86L5.74,2.57L7.16,4M16.47,18.39C15.26,19.39 13.7,20 12,20A7,7 0 0,1 5,13C5,11.3 5.61,9.74 6.61,8.53M2.92,2.29L1.65,3.57L3,4.9L1.87,5.83L3.29,7.25L4.4,6.31L5.2,7.11C3.83,8.69 3,10.75 3,13A9,9 0 0,0 12,22C14.25,22 16.31,21.17 17.89,19.8L20.09,22L21.36,20.73L3.89,3.27L2.92,2.29M22,5.72L17.4,1.86L16.11,3.39L20.71,7.25L22,5.72M12,6A7,7 0 0,1 19,13C19,13.84 18.84,14.65 18.57,15.4L20.09,16.92C20.67,15.73 21,14.41 21,13A9,9 0 0,0 12,4C10.59,4 9.27,4.33 8.08,4.91L9.6,6.43C10.35,6.16 11.16,6 12,6Z" /></svg>';async function B(e,t){const r=Y("/apps/files_reminders/api/v1/{fileId}",{fileId:e});return(await $.put(r,{dueDate:t.toISOString()})).data.ocs.data}async function W(e){const t=Y("/apps/files_reminders/api/v1/{fileId}",{fileId:e});return(await $.delete(t)).data.ocs.data}var w=(e=>(e.LaterToday="later-today",e.Tomorrow="tomorrow",e.ThisWeekend="this-weekend",e.NextWeek="next-week",e))(w||{});function M(){const e=new Date;return e.setHours(0,0,0,0),e.setDate(e.getDate()-e.getDay()+1),new Date(e)}function V(e){new Date(e).setHours(0,0,0,0);const t=new Date(e.getFullYear(),0,1,0,0,0,0),r=(e.getTime()-t.getTime())/864e5;return Math.ceil((r+t.getDay()+1)/7)}function ue(e,t){return V(e)===V(t)&&e.getFullYear()===t.getFullYear()}function ce(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function L(e){return{"later-today":()=>{const t=new Date,r=new Date;r.setHours(18,0,0,0);const l=new Date;return l.setHours(17,0,0,0),t>=l?null:r},tomorrow:()=>{const t=new Date,r=new Date;return r.setDate(t.getDate()+1),r.setHours(8,0,0,0),r},"this-weekend":()=>{const t=new Date;if([5,6,0].includes(t.getDay()))return null;const r=new Date,l=M();return r.setDate(l.getDate()+5),r.setHours(8,0,0,0),r},"next-week":()=>{if(new Date().getDay()===0)return null;const t=new Date,r=M();return t.setDate(r.getDate()+7),t.setHours(8,0,0,0),t}}[e]()}function fe(){const e=new Date,t=new Date;return t.setHours(e.getHours()+2,0,0,0),t}function P(e){let t={hour:"numeric",minute:"2-digit"};const r=new Date;return ce(e,r)||(t={...t,weekday:"short"}),ue(e,r)||(t={...t,month:"short",day:"numeric"}),e.getFullYear()!==r.getFullYear()&&(t={...t,year:"numeric"}),e.toLocaleString(R(),t)}function h(e){let t={month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"2-digit"};const r=new Date;return e.getFullYear()!==r.getFullYear()&&(t={...t,year:"numeric"}),e.toLocaleString(R(),t)}const ge=new g({id:"clear-reminder",displayName:()=>a("files_reminders","Clear reminder"),title:e=>{const t=e.at(0),r=new Date(t.attributes["reminder-due-date"]);return`${a("files_reminders","Clear reminder")} – ${h(r)}`},iconSvgInline:()=>me,enabled:e=>e.length!==1?!1:!!e.at(0).attributes["reminder-due-date"],async exec(e){if(e.fileid)try{return await W(e.fileid),e.attributes["reminder-due-date"]="",_("files:node:updated",e),!0}catch{return!1}return null},order:19}),E='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-alarm" viewBox="0 0 24 24"><path d="M12,20A7,7 0 0,1 5,13A7,7 0 0,1 12,6A7,7 0 0,1 19,13A7,7 0 0,1 12,20M12,4A9,9 0 0,0 3,13A9,9 0 0,0 12,22A9,9 0 0,0 21,13A9,9 0 0,0 12,4M12.5,8H11V14L15.75,16.85L16.5,15.62L12.5,13.25V8M7.88,3.39L6.6,1.86L2,5.71L3.29,7.24L7.88,3.39M22,5.72L17.4,1.86L16.11,3.39L20.71,7.25L22,5.72Z" /></svg>',S=ne().setApp("files_reminders").detectUser().build(),we=J({__name:"SetCustomReminderModal",props:{node:{}},emits:["close"],setup(e,{emit:t}){const r=e,l=t,k=m(!1),C=m(!1),v=m(!0),s=m(),A=m(new Date);ee(()=>{const i=r.node.attributes["reminder-due-date"]?new Date(r.node.attributes["reminder-due-date"]):void 0;k.value=!!i,v.value=!0,C.value=!0,s.value=i??fe(),A.value=new Date}),te(()=>{const i=document.getElementById("set-custom-reminder");i.focus(),k.value||i.showPicker()});async function z(){if(!(s.value instanceof Date)||isNaN(s.value.getTime())){f(a("files_reminders","Please choose a valid date & time"));return}try{await B(r.node.fileid,s.value);const i=r.node.clone();i.attributes["reminder-due-date"]=s.value.toISOString(),_("files:node:updated",i),x(a("files_reminders",'Reminder set for "{fileName}"',{fileName:r.node.displayname})),y()}catch(i){S.error("Failed to set reminder",{error:i}),f(a("files_reminders","Failed to set reminder"))}}async function Q(){try{await W(r.node.fileid);const i=r.node.clone();i.attributes["reminder-due-date"]="",_("files:node:updated",i),x(a("files_reminders",'Reminder cleared for "{fileName}"',{fileName:r.node.displayname})),y()}catch(i){S.error("Failed to clear reminder",{error:i}),f(a("files_reminders","Failed to clear reminder"))}}function y(){C.value=!1,l("close")}function G(){const i=document.getElementById("set-custom-reminder");v.value=i.checkValidity()}return(i,F)=>C.value?(p(),b(n(de),{key:0,name:n(a)("files_reminders","Set reminder for '{fileName}'",{fileName:e.node.displayname}),"out-transition":"",size:"small","close-on-click-outside":"",onClosing:y},{actions:d(()=>[D(n(T),{variant:"tertiary",onClick:y},{default:d(()=>[u(c(n(a)("files_reminders","Cancel")),1)]),_:1}),k.value?(p(),b(n(T),{key:0,onClick:Q},{default:d(()=>[u(c(n(a)("files_reminders","Clear reminder")),1)]),_:1})):N("",!0),D(n(T),{disabled:!v.value,variant:"primary",form:"set-custom-reminder-form",type:"submit"},{default:d(()=>[u(c(n(a)("files_reminders","Set reminder")),1)]),_:1},8,["disabled"])]),default:d(()=>[re("form",{id:"set-custom-reminder-form",class:"custom-reminder-modal",onSubmit:ae(z,["prevent"])},[D(n(se),{id:"set-custom-reminder",modelValue:s.value,"onUpdate:modelValue":F[0]||(F[0]=K=>s.value=K),label:n(a)("files_reminders","Reminder at custom date & time"),min:A.value,required:!0,type:"datetime-local",onInput:G},null,8,["modelValue","label","min"]),v.value&&s.value?(p(),b(n(I),{key:0,type:"info"},{default:d(()=>[u(c(n(a)("files_reminders","We will remind you of this file"))+" ",1),D(n(oe),{timestamp:s.value},null,8,["timestamp"])]),_:1})):(p(),b(n(I),{key:1,type:"error"},{default:d(()=>[u(c(n(a)("files_reminders","Please choose a valid date & time")),1)]),_:1}))],32)]),_:1},8,["name"])):N("",!0)}}),ve=ie(we,[["__scopeId","data-v-a860b574"]]);async function O(e){await le(ve,{node:e})}const ye=new g({id:"reminder-status",inline:()=>!0,displayName:()=>"",title:e=>{const t=e.at(0),r=new Date(t.attributes["reminder-due-date"]);return`${a("files_reminders","Reminder set")} – ${h(r)}`},iconSvgInline:()=>E,enabled:e=>e.length!==1?!1:!!e.at(0).attributes["reminder-due-date"],async exec(e){return await O(e),null},order:-15}),be='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-calendar-clock" viewBox="0 0 24 24"><path d="M15,13H16.5V15.82L18.94,17.23L18.19,18.53L15,16.69V13M19,8H5V19H9.67C9.24,18.09 9,17.07 9,16A7,7 0 0,1 16,9C17.07,9 18.09,9.24 19,9.67V8M5,21C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3H6V1H8V3H16V1H18V3H19A2,2 0 0,1 21,5V11.1C22.24,12.36 23,14.09 23,16A7,7 0 0,1 16,23C14.09,23 12.36,22.24 11.1,21H5M16,11.15A4.85,4.85 0 0,0 11.15,16C11.15,18.68 13.32,20.85 16,20.85A4.85,4.85 0 0,0 20.85,16C20.85,13.32 18.68,11.15 16,11.15Z" /></svg>',H="set-reminder-menu",pe=new g({id:H,displayName:()=>a("files_reminders","Set reminder"),iconSvgInline:()=>E,enabled:(e,t)=>t.id==="trashbin"||e.length!==1?!1:e.at(0).attributes["reminder-due-date"]!==void 0,async exec(){return null},order:20}),De=new g({id:"set-reminder-custom",displayName:()=>a("files_reminders","Custom reminder"),title:()=>a("files_reminders","Reminder at custom date & time"),iconSvgInline:()=>be,enabled:(e,t)=>t.id==="trashbin"||e.length!==1?!1:e.at(0).attributes["reminder-due-date"]!==void 0,parent:H,async exec(e){return O(e),null},order:22}),Z={dateTimePreset:w.LaterToday,label:a("files_reminders","Later today"),ariaLabel:a("files_reminders","Set reminder for later today"),dateString:"",verboseDateString:""},q={dateTimePreset:w.Tomorrow,label:a("files_reminders","Tomorrow"),ariaLabel:a("files_reminders","Set reminder for tomorrow"),dateString:"",verboseDateString:""},U={dateTimePreset:w.ThisWeekend,label:a("files_reminders","This weekend"),ariaLabel:a("files_reminders","Set reminder for this weekend"),dateString:"",verboseDateString:""},j={dateTimePreset:w.NextWeek,label:a("files_reminders","Next week"),ariaLabel:a("files_reminders","Set reminder for next week"),dateString:"",verboseDateString:""};function _e(e){return new g({id:`set-reminder-${e.dateTimePreset}`,displayName:()=>`${e.label} – ${e.dateString}`,title:()=>`${e.ariaLabel} – ${e.verboseDateString}`,iconSvgInline:()=>"<svg></svg>",enabled:(t,r)=>r.id==="trashbin"||t.length!==1?!1:t.at(0).attributes["reminder-due-date"]!==void 0&&!!L(e.dateTimePreset),parent:H,async exec(t){if(!t.fileid)return S.error("Failed to set reminder, missing file id"),f(a("files_reminders","Failed to set reminder")),null;try{const r=L(e.dateTimePreset);await B(t.fileid,r),t.attributes["reminder-due-date"]=r.toISOString(),_("files:node:updated",t),x(a("files_reminders",'Reminder set for "{fileName}"',{fileName:t.basename}))}catch(r){S.error("Failed to set reminder",{error:r}),f(a("files_reminders","Failed to set reminder"))}return null},order:21})}[Z,q,U,j].forEach(e=>{const t=L(e.dateTimePreset);t&&(e.dateString=P(t),e.verboseDateString=h(t),setInterval(()=>{const r=L(e.dateTimePreset);r&&(e.dateString=P(r),e.verboseDateString=h(r))},1e3*30*60))});const Le=[Z,q,U,j].map(_e);X("nc:reminder-due-date",{nc:"http://nextcloud.org/ns"}),o(ye),o(ge),o(pe),o(De),Le.forEach(e=>o(e));
//# sourceMappingURL=files_reminders-init.mjs.map
