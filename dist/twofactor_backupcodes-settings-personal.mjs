import{d as U,c as A}from"./pinia-6GixkV57.chunk.mjs";import{r as _,f as I,c as l,o as n,g as x,u as a,w as k,j as p,t as d,e as E,F as m,b as f,z as N,C as M,p as w,h as y,k as R}from"./runtime-dom.esm-bundler-w0tDt7Gi.chunk.mjs";import{g as $,l as j,a as z}from"./index-Ma7sfat2.chunk.mjs";import{a as P}from"./index-C1xmmKTZ-zpf0CQaW.chunk.mjs";import{t as o}from"./translation-DoG5ZELJ-Bni_xMHF.chunk.mjs";import{c as B}from"./index-Ds96fp_Y.chunk.mjs";import{N as g}from"./autolink-U5pBzLgI-2h5mm9kB.chunk.mjs";import{N as F}from"./Web-DzGiDslj.chunk.mjs";import{g as G}from"./index-Bndk0DrU.chunk.mjs";import{c as H}from"./index-2HC-5o-4.chunk.mjs";import{g as q}from"./createElementId-DhjFt1I9-B1fq6aa1.chunk.mjs";import"./index-1X7ElQaR.chunk.mjs";import"./NcModal-DHryP_87-BkYzWFXJ.chunk.mjs";import"./mdi-YPhQfxXZ.chunk.mjs";import"./NcPasswordField-uaMO2pdt-PEl2ADM3.chunk.mjs";import"./NcInputField-o5OFv3z6-BKcArNCr.chunk.mjs";import"./index-sH3U_332.chunk.mjs";const D=G().detectLogLevel().setApp("twofactor_backupcodes").build();function J(r){const c=$().theming.name||"Nextcloud",e=window.open("",o("twofactor_backupcodes","{name} backup codes",{name:c}));if(!e)throw P(o("twofactor_backupcodes","Unable to open a new tab for printing")),new Error("Unable to open a new tab for printing");const t=e.document.createElement("h1");t.textContent=o("twofactor_backupcodes","{name} backup codes",{name:c});const s=e.document.createElement("pre");for(const b of r){const u=e.document.createTextNode(b);s.appendChild(u),s.appendChild(e.document.createElement("br"))}e.document.body.innerHTML="",e.document.body.appendChild(t),e.document.body.appendChild(s),e.print(),e.close()}async function K(){const r=q("/apps/twofactor_backupcodes/settings/create"),{data:c}=await H.post(r);return c}const v=j("twofactor_backupcodes","state"),O=U("twofactor_backupcodes",()=>{const r=_(v.enabled),c=_(v.total),e=_(v.used),t=_([]);async function s(){r.value=!1;const{codes:b,state:u}=await K();r.value=u.enabled,c.value=u.total,e.value=u.used,t.value=b}return{enabled:r,total:c,used:e,codes:t,generate:s}}),Q=["aria-label"],V=I({__name:"PersonalSettings",setup(r){const c=$().theming.name??"Nextcloud",e=O(),t=_(!1),s=N(()=>e.codes&&e.codes.length>0),b=c+"-backup-codes.txt",u=N(()=>s.value?"data:text/plain,"+encodeURIComponent(e.codes.reduce((i,C)=>i+C+`
`,"")):"");async function h(){await B(),t.value=!0;try{await e.generate()}catch(i){D.error("Error generating backup codes",{error:i}),P(o("twofactor_backupcodes","An error occurred while generating your backup codes"))}finally{t.value=!1}}function T(){J(!e.codes||e.codes.length===0?[]:e.codes)}return(i,C)=>(n(),l("div",{class:w(i.$style.backupcodesSettings)},[a(e).enabled?(n(),l(m,{key:1},[f("p",null,[s.value?(n(),l(m,{key:1},[p(d(a(o)("twofactor_backupcodes","These are your backup codes. Please save and/or print them as you will not be able to read the codes again later."))+" ",1),f("ul",{"aria-label":a(o)("twofactor_backupcodes","List of backup codes")},[(n(!0),l(m,null,M(a(e).codes,S=>(n(),l("li",{key:S,class:w(i.$style.backupcodesSettings__code)},d(S),3))),128))],8,Q)],64)):(n(),l(m,{key:0},[p(d(a(o)("twofactor_backupcodes","Backup codes have been generated. {used} of {total} codes have been used.",{used:a(e).used,total:a(e).total})),1)],64))]),f("p",{class:w(i.$style.backupcodesSettings__actions)},[y(a(g),{id:"generate-backup-codes",variant:"error",onClick:h},{default:k(()=>[p(d(a(o)("twofactor_backupcodes","Regenerate backup codes")),1)]),_:1}),s.value?(n(),l(m,{key:0},[y(a(g),{onClick:T},{default:k(()=>[p(d(a(o)("twofactor_backupcodes","Print backup codes")),1)]),_:1}),y(a(g),{href:u.value,download:b,variant:"primary"},{default:k(()=>[p(d(a(o)("twofactor_backupcodes","Save backup codes")),1)]),_:1},8,["href"])],64)):E("",!0)],2),f("p",null,[f("em",null,d(a(o)("twofactor_backupcodes","If you regenerate backup codes, you automatically invalidate old codes.")),1)])],64)):(n(),x(a(g),{key:0,disabled:t.value,variant:"primary",onClick:h},{icon:k(()=>[t.value?(n(),x(a(F),{key:0})):E("",!0)]),default:k(()=>[p(" "+d(a(o)("twofactor_backupcodes","Generate backup codes")),1)]),_:1},8,["disabled"]))],2))}}),W="_backupcodesSettings_bnkw8_2",X="_backupcodesSettings__code_bnkw8_7",Y="_backupcodesSettings__actions_bnkw8_13",Z={backupcodesSettings:W,backupcodesSettings__code:X,backupcodesSettings__actions:Y},ee={$style:Z},ae=z(V,[["__cssModules",ee]]),oe=A(),L=R(ae);L.use(oe),L.mount("#twofactor-backupcodes-settings");
//# sourceMappingURL=twofactor_backupcodes-settings-personal.mjs.map
