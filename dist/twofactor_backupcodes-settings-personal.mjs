import{d as U,c as A}from"./pinia-D0ZVBiNx.chunk.mjs";import{f as t,q as I,e as M,l as R,j as m,i as j,k as x,x as i,o as n,c as E,u as a,w as k,d as p,t as u,n as L,y as q,F as _,m as f,z as B,p as g,b as y,_ as F,h as G}from"./TrashCanOutline-DKvv_nn_.chunk.mjs";import{g as H,d as N,s as P,e as w}from"./ContentCopy-DXaCAmGe.chunk.mjs";import{c as z}from"./index-CNT1cdzC.chunk.mjs";const D=H().detectLogLevel().setApp("twofactor_backupcodes").build();function J(d){const c=N().theming.name||"Nextcloud",e=window.open("",t("twofactor_backupcodes","{name} backup codes",{name:c}));if(!e)throw P(t("twofactor_backupcodes","Unable to open a new tab for printing")),new Error("Unable to open a new tab for printing");const o=e.document.createElement("h1");o.textContent=t("twofactor_backupcodes","{name} backup codes",{name:c});const s=e.document.createElement("pre");for(const b of d){const r=e.document.createTextNode(b);s.appendChild(r),s.appendChild(e.document.createElement("br"))}e.document.body.innerHTML="",e.document.body.appendChild(o),e.document.body.appendChild(s),e.print(),e.close()}async function K(){const d=I("/apps/twofactor_backupcodes/settings/create"),{data:c}=await M.post(d);return c}const v=R("twofactor_backupcodes","state"),O=U("twofactor_backupcodes",()=>{const d=m(v.enabled),c=m(v.total),e=m(v.used),o=m([]);async function s(){d.value=!1;const{codes:b,state:r}=await K();d.value=r.enabled,c.value=r.total,e.value=r.used,o.value=b}return{enabled:d,total:c,used:e,codes:o,generate:s}}),Q=["aria-label"],V=j({__name:"PersonalSettings",setup(d){const c=N().theming.name??"Nextcloud",e=O(),o=m(!1),s=x(()=>e.codes&&e.codes.length>0),b=c+"-backup-codes.txt",r=x(()=>s.value?"data:text/plain,"+encodeURIComponent(e.codes.reduce((l,C)=>l+C+`
`,"")):"");async function h(){await z(),o.value=!0;try{await e.generate()}catch(l){D.error("Error generating backup codes",{error:l}),P(t("twofactor_backupcodes","An error occurred while generating your backup codes"))}finally{o.value=!1}}function T(){J(!e.codes||e.codes.length===0?[]:e.codes)}return(l,C)=>(n(),i("div",{class:g(l.$style.backupcodesSettings)},[a(e).enabled?(n(),i(_,{key:1},[f("p",null,[s.value?(n(),i(_,{key:1},[p(u(a(t)("twofactor_backupcodes","These are your backup codes. Please save and/or print them as you will not be able to read the codes again later."))+" ",1),f("ul",{"aria-label":a(t)("twofactor_backupcodes","List of backup codes")},[(n(!0),i(_,null,B(a(e).codes,S=>(n(),i("li",{key:S,class:g(l.$style.backupcodesSettings__code)},u(S),3))),128))],8,Q)],64)):(n(),i(_,{key:0},[p(u(a(t)("twofactor_backupcodes","Backup codes have been generated. {used} of {total} codes have been used.",{used:a(e).used,total:a(e).total})),1)],64))]),f("p",{class:g(l.$style.backupcodesSettings__actions)},[y(a(w),{id:"generate-backup-codes",variant:"error",onClick:h},{default:k(()=>[p(u(a(t)("twofactor_backupcodes","Regenerate backup codes")),1)]),_:1}),s.value?(n(),i(_,{key:0},[y(a(w),{onClick:T},{default:k(()=>[p(u(a(t)("twofactor_backupcodes","Print backup codes")),1)]),_:1}),y(a(w),{href:r.value,download:b,variant:"primary"},{default:k(()=>[p(u(a(t)("twofactor_backupcodes","Save backup codes")),1)]),_:1},8,["href"])],64)):L("",!0)],2),f("p",null,[f("em",null,u(a(t)("twofactor_backupcodes","If you regenerate backup codes, you automatically invalidate old codes.")),1)])],64)):(n(),E(a(w),{key:0,disabled:o.value,variant:"primary",onClick:h},{icon:k(()=>[o.value?(n(),E(a(q),{key:0})):L("",!0)]),default:k(()=>[p(" "+u(a(t)("twofactor_backupcodes","Generate backup codes")),1)]),_:1},8,["disabled"]))],2))}}),W="_backupcodesSettings_bnkw8_2",X="_backupcodesSettings__code_bnkw8_7",Y="_backupcodesSettings__actions_bnkw8_13",Z={backupcodesSettings:W,backupcodesSettings__code:X,backupcodesSettings__actions:Y},ee={$style:Z},ae=F(V,[["__cssModules",ee]]),te=A(),$=G(ae);$.use(te),$.mount("#twofactor-backupcodes-settings");
//# sourceMappingURL=twofactor_backupcodes-settings-personal.mjs.map
