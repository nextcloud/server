/*! third party licenses: dist/vendor.LICENSE.txt */
import"./chunks/modulepreload-polyfill-DGCCkazm.mjs";import{F as f,bS as i,a8 as L,al as p,a7 as m,b_ as o,bT as P,bZ as d,bR as c,aV as w}from"./core-common.mjs";import{q as C}from"./chunks/base-DGiCN8Wo.mjs";import{a as k}from"./chunks/index-DCgLaXhm.mjs";import{aj as N,n,aI as x,aJ as T}from"./chunks/icons-TElqpmA8.mjs";import{s as F,b as A}from"./chunks/index-CPIrzAK_.mjs";import{l as v}from"./chunks/logger-7CwbMBAx.mjs";import{N as I}from"./chunks/Nextcloud-Cf6G-Flm.mjs";import"./chunks/index-CiG5J8j_.mjs";import"./chunks/handlebars-CXvOxsjd.mjs";import"./chunks/jquery-BdeSydBb.mjs";import"./chunks/index-PaKKd09k.mjs";import"./chunks/_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import"./chunks/index-CPb3EwrS.mjs";import"./chunks/preload-helper-BG02UnR2.mjs";import"./chunks/index-D0hy_tCT.mjs";import"./chunks/requesttoken-a6i8BQgd.mjs";import"./chunks/index-CDMqmWCu.mjs";/* empty css                      */import"./chunks/moment-Cr1O5WQr.mjs";import"./chunks/index-DG15V7L3.mjs";import"./chunks/index-tn-fAC9x.mjs";const y={computed:{userNameInputLengthIs255(){return this.user.length>=255},userInputHelperText(){if(this.userNameInputLengthIs255)return t("core","Email length is at max (255)")}}},B={name:"LoginButton",components:{ArrowRight:N,NcButton:f},props:{value:{type:String,default:i("core","Log in")},valueLoading:{type:String,default:i("core","Logging in â€¦")},loading:{type:Boolean,required:!0},invertedColors:{type:Boolean,default:!1}}};var U=function(){var e=this,s=e._self._c;return s("NcButton",{attrs:{type:"primary","native-type":"submit",wide:!0,disabled:e.loading},on:{click:function(r){return e.$emit("click")}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loading?s("div",{staticClass:"submit-wrapper__icon icon-loading-small-dark"}):s("ArrowRight",{staticClass:"submit-wrapper__icon"})]},proxy:!0}])},[e._v(" "+e._s(e.loading?e.valueLoading:e.value)+" ")])},R=[],S=n(B,U,R,!1,null,"6e705e45");const u=S.exports,D={name:"LoginForm",components:{LoginButton:u,NcPasswordField:L,NcTextField:p,NcNoteCard:m},mixins:[y],props:{username:{type:String,default:""},redirectUrl:{type:[String,Boolean],default:!1},errors:{type:Array,default:()=>[]},messages:{type:Array,default:()=>[]},throttleDelay:{type:Number,default:0},autoCompleteAllowed:{type:Boolean,default:!0},directLogin:{type:Boolean,default:!1},emailStates:{type:Array,default(){return[]}}},setup(){var e,s;return{t:i,headlineText:i("core","Log in to {productName}",{productName:OC.theme.name},void 0,{sanitize:!1,escape:!1}),loginTimeout:o("core","loginTimeout",300),requestToken:window.OC.requestToken,timezone:(s=(e=new Intl.DateTimeFormat)==null?void 0:e.resolvedOptions())==null?void 0:s.timeZone,timezoneOffset:-new Date().getTimezoneOffset()/60}},data(){return{loading:!1,user:"",password:""}},computed:{resetFormTimeout(){return this.loginTimeout<=0?()=>{}:k.debounce(this.handleResetForm,this.loginTimeout*1e3)},isError(){return this.invalidPassword||this.userDisabled||this.throttleDelay>5e3},errorLabel(){if(this.invalidPassword)return i("core","Wrong login or password.");if(this.userDisabled)return i("core","This account is disabled");if(this.throttleDelay>5e3)return i("core","We have detected multiple invalid login attempts from your IP. Therefore your next login is throttled up to 30 seconds.")},apacheAuthFailed(){return this.errors.indexOf("apacheAuthFailed")!==-1},csrfCheckFailed(){return this.errors.indexOf("csrfCheckFailed")!==-1},internalException(){return this.errors.indexOf("internalexception")!==-1},invalidPassword(){return this.errors.indexOf("invalidpassword")!==-1},userDisabled(){return this.errors.indexOf("userdisabled")!==-1},loadingIcon(){return P("core","loading-dark.gif")},loginActionUrl(){return d("login")},emailEnabled(){return this.emailStates?this.emailStates.every(e=>e==="1"):1},loginText(){return this.emailEnabled?i("core","Account name or email"):i("core","Account name")}},watch:{password(){this.resetFormTimeout()}},mounted(){this.username===""?this.$refs.user.$refs.inputField.$refs.input.focus():(this.user=this.username,this.$refs.password.$refs.inputField.$refs.input.focus())},methods:{handleResetForm(){this.password=""},updateUsername(){this.$emit("update:username",this.user)},submit(e){if(this.loading){e.preventDefault();return}this.loading=!0,this.$emit("submit")}}};var $=function(){var e=this,s=e._self._c;return s("form",{ref:"loginForm",staticClass:"login-form",attrs:{method:"post",name:"login",action:e.loginActionUrl},on:{submit:e.submit}},[s("fieldset",{staticClass:"login-form__fieldset",attrs:{"data-login-form":""}},[e.apacheAuthFailed?s("NcNoteCard",{attrs:{title:e.t("core","Server side authentication failed!"),type:"warning"}},[e._v(" "+e._s(e.t("core","Please contact your administrator."))+" ")]):e._e(),e.csrfCheckFailed?s("NcNoteCard",{attrs:{heading:e.t("core","Temporary error"),type:"error"}},[e._v(" "+e._s(e.t("core","Please try again."))+" ")]):e._e(),e.messages.length>0?s("NcNoteCard",e._l(e.messages,function(r,a){return s("div",{key:a},[e._v(" "+e._s(r)),s("br")])}),0):e._e(),e.internalException?s("NcNoteCard",{class:e.t("core","An internal error occurred."),attrs:{type:"warning"}},[e._v(" "+e._s(e.t("core","Please try again or contact your administrator."))+" ")]):e._e(),s("div",{staticClass:"hidden",attrs:{id:"message"}},[s("img",{staticClass:"float-spinner",attrs:{alt:"",src:e.loadingIcon}}),s("span",{attrs:{id:"messageText"}}),s("div",{staticStyle:{clear:"both"}})]),s("h2",{staticClass:"login-form__headline",attrs:{"data-login-form-headline":""}},[e._v(" "+e._s(e.headlineText)+" ")]),s("NcTextField",{ref:"user",class:{shake:e.invalidPassword},attrs:{id:"user",label:e.loginText,name:"user",maxlength:255,value:e.user,autocapitalize:"none",spellchecking:!1,autocomplete:e.autoCompleteAllowed?"username":"off",required:"",error:e.userNameInputLengthIs255,"helper-text":e.userInputHelperText,"data-login-form-input-user":""},on:{"update:value":function(r){e.user=r},change:e.updateUsername}}),s("NcPasswordField",{ref:"password",class:{shake:e.invalidPassword},attrs:{id:"password",name:"password",value:e.password,spellchecking:!1,autocapitalize:"none",autocomplete:e.autoCompleteAllowed?"current-password":"off",label:e.t("core","Password"),"helper-text":e.errorLabel,error:e.isError,"data-login-form-input-password":"",required:""},on:{"update:value":function(r){e.password=r}}}),s("LoginButton",{attrs:{"data-login-form-submit":"",loading:e.loading}}),e.redirectUrl?s("input",{attrs:{type:"hidden",name:"redirect_url"},domProps:{value:e.redirectUrl}}):e._e(),s("input",{attrs:{type:"hidden",name:"timezone"},domProps:{value:e.timezone}}),s("input",{attrs:{type:"hidden",name:"timezone_offset"},domProps:{value:e.timezoneOffset}}),s("input",{attrs:{type:"hidden",name:"requesttoken"},domProps:{value:e.requestToken}}),e.directLogin?s("input",{attrs:{type:"hidden",name:"direct",value:"1"}}):e._e()],1)])},q=[],E=n(D,$,q,!1,null,"d8ca3f95");const O=E.exports;let z=class extends Error{};async function H(e){const s=d("/login/webauthn/start"),{data:r}=await c.post(s,{loginName:e});if(!r.allowCredentials||r.allowCredentials.length===0)throw v.error("No valid credentials returned for webauthn"),new z;return await F(r)}async function W(e){const s=d("/login/webauthn/finish"),{data:r}=await c.post(s,{data:JSON.stringify(e)});return r}const G={name:"PasswordLessLoginForm",components:{LoginButton:u,InformationIcon:x,LockOpenIcon:T,NcTextField:p},props:{username:{type:String,default:""},redirectUrl:{type:[String,Boolean],default:!1},autoCompleteAllowed:{type:Boolean,default:!0},isHttps:{type:Boolean,default:!1},isLocalhost:{type:Boolean,default:!1}},setup(){return{supportsWebauthn:A()}},data(){return{user:this.username,loading:!1,validCredentials:!0}},methods:{async authenticate(){if(this.$refs.loginForm.checkValidity()){console.debug("passwordless login initiated");try{const e=await H(this.user);await this.completeAuthentication(e)}catch(e){if(e instanceof NoValidCredentials){this.validCredentials=!1;return}v.debug(e)}}},changeUsername(e){this.user=e,this.$emit("update:username",this.user)},completeAuthentication(e){const s=this.redirectUrl;return W(e).then(({defaultRedirectUrl:r})=>{console.debug("Logged in redirecting"),window.location.href=s||r}).catch(r=>{console.debug("GOT AN ERROR WHILE SUBMITTING CHALLENGE!"),console.debug(r)})},submit(){}}};var V=function(){var e=this,s=e._self._c;return(e.isHttps||e.isLocalhost)&&e.supportsWebauthn?s("form",{ref:"loginForm",attrs:{method:"post",name:"login"},on:{submit:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[s("h2",[e._v(e._s(e.t("core","Log in with a device")))]),s("fieldset",[s("NcTextField",{attrs:{required:"",value:e.user,autocomplete:e.autoCompleteAllowed?"on":"off",error:!e.validCredentials,label:e.t("core","Login or email"),placeholder:e.t("core","Login or email"),"helper-text":e.validCredentials?"":e.t("core","Your account is not setup for passwordless login.")},on:{"update:value":e.changeUsername}}),e.validCredentials?s("LoginButton",{attrs:{loading:e.loading},on:{click:e.authenticate}}):e._e()],1)]):e.supportsWebauthn?!e.isHttps&&!e.isLocalhost?s("div",{staticClass:"update"},[s("LockOpenIcon",{attrs:{size:"70"}}),s("h2",[e._v(e._s(e.t("core","Your connection is not secure")))]),s("p",{staticClass:"infogroup"},[e._v(" "+e._s(e.t("core","Passwordless authentication is only available over a secure connection."))+" ")])],1):e._e():s("div",{staticClass:"update"},[s("InformationIcon",{attrs:{size:"70"}}),s("h2",[e._v(e._s(e.t("core","Browser not supported")))]),s("p",{staticClass:"infogroup"},[e._v(" "+e._s(e.t("core","Passwordless authentication is not supported in your browser."))+" ")])],1)},Y=[],j=n(G,V,Y,!1,null,"eb9d4f70");const J=j.exports,M={name:"ResetPassword",components:{LoginButton:u,NcNoteCard:m,NcTextField:p},mixins:[y],props:{username:{type:String,required:!0},resetPasswordLink:{type:String,required:!0}},data(){return{error:!1,loading:!1,message:void 0,user:this.username}},watch:{username(e){this.user=e}},methods:{updateUsername(){this.$emit("update:username",this.user)},submit(){this.loading=!0,this.error=!1,this.message="";const e=d("/lostpassword/email"),s={user:this.user};return c.post(e,s).then(r=>r.data).then(r=>{if(r.status!=="success")throw new Error("got status ".concat(r.status));this.message="send-success"}).catch(r=>{console.error("could not send reset email request",r),this.error=!0,this.message="send-error"}).then(()=>{this.loading=!1})}}};var Z=function(){var e=this,s=e._self._c;return s("form",{staticClass:"login-form",on:{submit:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[s("fieldset",{staticClass:"login-form__fieldset"},[s("NcTextField",{attrs:{id:"user",value:e.user,name:"user",maxlength:255,autocapitalize:"off",label:e.t("core","Login or email"),error:e.userNameInputLengthIs255,"helper-text":e.userInputHelperText,required:""},on:{"update:value":function(r){e.user=r},change:e.updateUsername}}),s("LoginButton",{attrs:{value:e.t("core","Reset password")}}),e.message==="send-success"?s("NcNoteCard",{attrs:{type:"success"}},[e._v(" "+e._s(e.t("core","If this account exists, a password reset message has been sent to its email address. If you do not receive it, verify your email address and/or Login, check your spam/junk folders or ask your local administration for help."))+" ")]):e.message==="send-error"?s("NcNoteCard",{attrs:{type:"error"}},[e._v(" "+e._s(e.t("core","Couldn't send reset email. Please contact your administrator."))+" ")]):e.message==="reset-error"?s("NcNoteCard",{attrs:{type:"error"}},[e._v(" "+e._s(e.t("core","Password cannot be changed. Please contact your administrator."))+" ")]):e._e(),s("a",{staticClass:"login-form__link",attrs:{href:"#"},on:{click:function(r){return r.preventDefault(),e.$emit("abort")}}},[e._v(" "+e._s(e.t("core","Back to login"))+" ")])],1)])},K=[],Q=n(M,Z,K,!1,null,"beeb435b");const X=Q.exports,ee={name:"UpdatePassword",components:{LoginButton:u},props:{username:{type:String,required:!0},resetPasswordTarget:{type:String,required:!0}},data(){return{error:!1,loading:!1,message:void 0,user:this.username,password:"",encrypted:!1,proceed:!1}},watch:{username(e){this.user=e}},methods:{async submit(){this.loading=!0,this.error=!1,this.message="";try{const{data:e}=await c.post(this.resetPasswordTarget,{password:this.password,proceed:this.proceed});if(e&&e.status==="success")this.message="send-success",this.$emit("update:username",this.user),this.$emit("done");else if(e&&e.encryption)this.encrypted=!0;else throw e&&e.msg?new Error(e.msg):new Error}catch(e){this.error=!0,this.message=e.message?e.message:t("core","Password cannot be changed. Please contact your administrator.")}finally{this.loading=!1}}}};var te=function(){var e=this,s=e._self._c;return s("form",{on:{submit:function(r){return r.preventDefault(),e.submit.apply(null,arguments)}}},[s("fieldset",[s("p",[s("label",{staticClass:"infield",attrs:{for:"password"}},[e._v(e._s(e.t("core","New password")))]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],attrs:{id:"password",type:"password",name:"password",autocomplete:"new-password",autocapitalize:"none",spellcheck:"false",required:"",placeholder:e.t("core","New password")},domProps:{value:e.password},on:{input:function(r){r.target.composing||(e.password=r.target.value)}}})]),e.encrypted?s("div",{staticClass:"update"},[s("p",[e._v(" "+e._s(e.t("core","Your files are encrypted. There will be no way to get your data back after your password is reset. If you are not sure what to do, please contact your administrator before you continue. Do you really want to continue?"))+" ")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.proceed,expression:"proceed"}],staticClass:"checkbox",attrs:{id:"encrypted-continue",type:"checkbox"},domProps:{checked:Array.isArray(e.proceed)?e._i(e.proceed,null)>-1:e.proceed},on:{change:function(r){var a=e.proceed,g=r.target,b=!!g.checked;if(Array.isArray(a)){var h=null,l=e._i(a,h);g.checked?l<0&&(e.proceed=a.concat([h])):l>-1&&(e.proceed=a.slice(0,l).concat(a.slice(l+1)))}else e.proceed=b}}}),s("label",{attrs:{for:"encrypted-continue"}},[e._v(" "+e._s(e.t("core","I know what I'm doing"))+" ")])]):e._e(),s("LoginButton",{attrs:{loading:e.loading,value:e.t("core","Reset password"),"value-loading":e.t("core","Resetting password")}}),e.error&&e.message?s("p",{class:{warning:e.error}},[e._v(" "+e._s(e.message)+" ")]):e._e()],1)])},se=[],re=n(ee,te,se,!1,null,"38cd6d96");const oe=re.exports,_=C.parse(location.search);if(_.clear==="1")try{window.localStorage.clear(),window.sessionStorage.clear(),console.debug("Browser storage cleared")}catch(e){console.error("Could not clear browser storage",e)}const ae={name:"Login",components:{LoginForm:O,PasswordLessLoginForm:J,ResetPassword:X,UpdatePassword:oe,NcButton:f,NcNoteCard:m},data(){return{loading:!1,user:o("core","loginUsername",""),passwordlessLogin:!1,resetPassword:!1,errors:o("core","loginErrors",[]),messages:o("core","loginMessages",[]),redirectUrl:o("core","loginRedirectUrl",!1),throttleDelay:o("core","loginThrottleDelay",0),canResetPassword:o("core","loginCanResetPassword",!1),resetPasswordLink:o("core","loginResetPasswordLink",""),autoCompleteAllowed:o("core","loginAutocomplete",!0),resetPasswordTarget:o("core","resetPasswordTarget",""),resetPasswordUser:o("core","resetPasswordUser",""),directLogin:_.direct==="1",hasPasswordless:o("core","webauthn-available",!1),countAlternativeLogins:o("core","countAlternativeLogins",!1),alternativeLogins:o("core","alternativeLogins",[]),isHttps:window.location.protocol==="https:",isLocalhost:window.location.hostname==="localhost",hideLoginForm:o("core","hideLoginForm",!1),emailStates:o("core","emailStates",[])}},methods:{passwordResetFinished(){this.resetPasswordTarget="",this.directLogin=!0}}};var ie=function(){var e=this,s=e._self._c;return s("div",{staticClass:"guest-box login-box"},[!e.hideLoginForm||e.directLogin?[s("transition",{attrs:{name:"fade",mode:"out-in"}},[!e.passwordlessLogin&&!e.resetPassword&&e.resetPasswordTarget===""?s("div",[s("LoginForm",{attrs:{username:e.user,"redirect-url":e.redirectUrl,"direct-login":e.directLogin,messages:e.messages,errors:e.errors,"throttle-delay":e.throttleDelay,"auto-complete-allowed":e.autoCompleteAllowed,"email-states":e.emailStates},on:{"update:username":function(r){e.user=r},submit:function(r){e.loading=!0}}}),e.canResetPassword&&e.resetPasswordLink!==""?s("a",{staticClass:"login-box__link",attrs:{id:"lost-password",href:e.resetPasswordLink}},[e._v(" "+e._s(e.t("core","Forgot password?"))+" ")]):e.canResetPassword&&!e.resetPassword?s("a",{staticClass:"login-box__link",attrs:{id:"lost-password",href:e.resetPasswordLink},on:{click:function(r){r.preventDefault(),e.resetPassword=!0}}},[e._v(" "+e._s(e.t("core","Forgot password?"))+" ")]):e._e(),e.hasPasswordless?[e.countAlternativeLogins?s("div",{staticClass:"alternative-logins"},[e.hasPasswordless?s("a",{staticClass:"button",class:{"single-alt-login-option":e.countAlternativeLogins},attrs:{href:"#"},on:{click:function(r){r.preventDefault(),e.passwordlessLogin=!0}}},[e._v(" "+e._s(e.t("core","Log in with a device"))+" ")]):e._e()]):s("a",{attrs:{href:"#"},on:{click:function(r){r.preventDefault(),e.passwordlessLogin=!0}}},[e._v(" "+e._s(e.t("core","Log in with a device"))+" ")])]:e._e()],2):!e.loading&&e.passwordlessLogin?s("div",{key:"reset-pw-less",staticClass:"login-additional login-passwordless"},[s("PasswordLessLoginForm",{attrs:{username:e.user,"redirect-url":e.redirectUrl,"auto-complete-allowed":e.autoCompleteAllowed,"is-https":e.isHttps,"is-localhost":e.isLocalhost},on:{"update:username":function(r){e.user=r},submit:function(r){e.loading=!0}}}),s("NcButton",{attrs:{type:"tertiary","aria-label":e.t("core","Back to login form"),wide:!0},on:{click:function(r){e.passwordlessLogin=!1}}},[e._v(" "+e._s(e.t("core","Back"))+" ")])],1):!e.loading&&e.canResetPassword?s("div",{key:"reset-can-reset",staticClass:"login-additional"},[s("div",{staticClass:"lost-password-container"},[e.resetPassword?s("ResetPassword",{attrs:{username:e.user,"reset-password-link":e.resetPasswordLink},on:{"update:username":function(r){e.user=r},abort:function(r){e.resetPassword=!1}}}):e._e()],1)]):e.resetPasswordTarget!==""?s("div",[s("UpdatePassword",{attrs:{username:e.user,"reset-password-target":e.resetPasswordTarget},on:{"update:username":function(r){e.user=r},done:e.passwordResetFinished}})],1):e._e()])]:[s("transition",{attrs:{name:"fade",mode:"out-in"}},[s("NcNoteCard",{attrs:{type:"info",title:e.t("core","Login form is disabled.")}},[e._v(" "+e._s(e.t("core","The Nextcloud login form is disabled. Use another login option if available or contact your administration."))+" ")])],1)],s("div",{staticClass:"alternative-logins",attrs:{id:"alternative-logins"}},e._l(e.alternativeLogins,function(r,a){return s("NcButton",{key:a,class:[r.class],attrs:{type:"secondary",wide:!0,role:"link",href:r.href}},[e._v(" "+e._s(r.name)+" ")])}),1)],2)},ne=[],le=n(ae,ie,ne,!1,null,null);const de=le.exports;w.mixin(I);const ce=w.extend(de);new ce().$mount("#login");
