/*! third party licenses: dist/vendor.LICENSE.txt */
import{c2 as R,b as O,w,g as G,F as _,K as b,a6 as Q,a7 as k,O as P,A as $,G as E,af as q,bR as W,bZ as F,aX as i,a_ as T,bu as u,bS as N,x as z,S as j,e as K,j as V,o as X,a1 as Y,a4 as Z}from"../core-common.mjs";import{n as f,al as H,a3 as J,S as tt,d as et,am as ot,k as nt,an as st,ao as at}from"./icons-TElqpmA8.mjs";import"./index-PaKKd09k.mjs";import{z as A}from"./_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import{s as S,i as it}from"./index-DG15V7L3.mjs";import{G as m,u as rt}from"../settings-vue-settings-apps-users-management.mjs";import{u as c}from"./userUtils-Di345_lx.mjs";import{u as ut,a as ct}from"./composables-CBXUeqOy.mjs";import"./index-CiG5J8j_.mjs";import"./index-CPb3EwrS.mjs";import"./index-tn-fAC9x.mjs";import"./v-tooltip.esm-DFdYkWpQ.mjs";import"./_overRest-DjFtaWRq.mjs";import"./_setToArray-V03nfpyh.mjs";import"./_isIterateeCall-CX-rKv74.mjs";import"./isPlainObject-CnMaw-ru.mjs";import"./vue-router.esm-CkRP8kF4.mjs";import"./preload-helper-BG02UnR2.mjs";import"./vuex.esm-pSkZdmXO.mjs";import"./index-CDMqmWCu.mjs";/* empty css               */import"./logger-C7fGMvfA.mjs";import"./pinia-CcZmjq9w.mjs";const pt={name:"GroupListItem",components:{AccountGroup:H,Delete:J,Fragment:R,NcActionButton:O,NcActionInput:w,NcAppNavigationItem:G,NcButton:_,NcCounterBubble:b,NcModal:Q,NcNoteCard:k,Pencil:tt},props:{active:{type:Boolean,required:!0},count:{type:Number,default:null},id:{type:String,required:!0},name:{type:String,required:!0}},data(){return{loadingRenameGroup:!1,openGroupMenu:!1,showRemoveGroupModal:!1}},computed:{settings(){return this.$store.getters.getServerData}},methods:{handleGroupMenuOpen(){this.openGroupMenu=!0},async renameGroup(e){if(e.trim()==="")return;const n=this.$refs.displayNameInput.$el.querySelector('input[type="text"]').value;if(n.trim()!=="")try{this.openGroupMenu=!1,this.loadingRenameGroup=!0,await this.$store.dispatch("renameGroup",{groupid:e.trim(),displayName:n.trim()}),this.loadingRenameGroup=!1}catch{this.openGroupMenu=!0,this.loadingRenameGroup=!1}},async removeGroup(){try{await this.$store.dispatch("removeGroup",this.id),this.showRemoveGroupModal=!1}catch{A(t("settings",'Failed to remove group "{group}"',{group:this.name}))}}}};var dt=function(){var e=this,n=e._self._c;return n("Fragment",[e.showRemoveGroupModal?n("NcModal",{on:{close:function(o){e.showRemoveGroupModal=!1}}},[n("div",{staticClass:"modal__content"},[n("h2",{staticClass:"modal__header"},[e._v(" "+e._s(e.t("settings","Please confirm the group removal"))+" ")]),n("NcNoteCard",{attrs:{type:"warning","show-alert":""}},[e._v(" "+e._s(e.t("settings",'You are about to remove the group "{group}". The accounts will NOT be deleted.',{group:e.name}))+" ")]),n("div",{staticClass:"modal__button-row"},[n("NcButton",{attrs:{type:"secondary"},on:{click:function(o){e.showRemoveGroupModal=!1}}},[e._v(" "+e._s(e.t("settings","Cancel"))+" ")]),n("NcButton",{attrs:{type:"primary"},on:{click:e.removeGroup}},[e._v(" "+e._s(e.t("settings","Confirm"))+" ")])],1)],1)]):e._e(),n("NcAppNavigationItem",{key:e.id,attrs:{exact:!0,name:e.name,to:{name:"group",params:{selectedGroup:encodeURIComponent(e.id)}},loading:e.loadingRenameGroup,"menu-open":e.openGroupMenu},on:{"update:menuOpen":e.handleGroupMenuOpen},scopedSlots:e._u([{key:"icon",fn:function(){return[n("AccountGroup",{attrs:{size:20}})]},proxy:!0},{key:"counter",fn:function(){return[e.count?n("NcCounterBubble",{attrs:{type:e.active?"highlighted":void 0}},[e._v(" "+e._s(e.count)+" ")]):e._e()]},proxy:!0},{key:"actions",fn:function(){return[e.id!=="admin"&&e.id!=="disabled"&&e.settings.isAdmin?n("NcActionInput",{ref:"displayNameInput",attrs:{"trailing-button-label":e.t("settings","Submit"),type:"text",value:e.name,label:e.t("settings","Rename group")},on:{submit:function(o){return e.renameGroup(e.id)}},scopedSlots:e._u([{key:"icon",fn:function(){return[n("Pencil",{attrs:{size:20}})]},proxy:!0}],null,!1,580569589)}):e._e(),e.id!=="admin"&&e.id!=="disabled"&&e.settings.isAdmin?n("NcActionButton",{on:{click:function(o){e.showRemoveGroupModal=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[n("Delete",{attrs:{size:20}})]},proxy:!0}],null,!1,2705356561)},[e._v(" "+e._s(e.t("settings","Remove group"))+" ")]):e._e()]},proxy:!0}])})],1)},lt=[],gt=f(pt,dt,lt,!1,null,"6d011a02");const mt=gt.exports,ht={name:"UserSettingsDialog",components:{NcAppSettingsDialog:P,NcAppSettingsSection:$,NcCheckboxRadioSwitch:E,NcNoteCard:k,NcSelect:q},props:{open:{type:Boolean,required:!0}},data(){return{selectedQuota:!1,loadingSendMail:!1}},computed:{groupSorting:{get(){return this.$store.getters.getGroupSorting===m.GroupName?"name":"member-count"},set(e){this.$store.commit("setGroupSorting",e==="name"?m.GroupName:m.UserCount)}},isGroupSortingEnforced(){return this.$store.getters.getServerData.forceSortGroupByName},isModalOpen:{get(){return this.open},set(e){this.$emit("update:open",e)}},showConfig(){return this.$store.getters.getShowConfig},settings(){return this.$store.getters.getServerData},showLanguages:{get(){return this.showConfig.showLanguages},set(e){this.setShowConfig("showLanguages",e)}},showLastLogin:{get(){return this.showConfig.showLastLogin},set(e){this.setShowConfig("showLastLogin",e)}},showUserBackend:{get(){return this.showConfig.showUserBackend},set(e){this.setShowConfig("showUserBackend",e)}},showStoragePath:{get(){return this.showConfig.showStoragePath},set(e){this.setShowConfig("showStoragePath",e)}},quotaOptions(){const e=this.settings.quotaPreset.reduce((n,o)=>n.concat({id:o,label:o}),[]);return this.settings.allowUnlimitedQuota&&e.unshift(c),e},defaultQuota:{get(){return this.selectedQuota!==!1?this.selectedQuota:this.settings.defaultQuota!==c.id&&OC.Util.computerFileSize(this.settings.defaultQuota)>=0?{id:this.settings.defaultQuota,label:this.settings.defaultQuota}:c},set(e){this.selectedQuota=e}},sendWelcomeMail:{get(){return this.settings.newUserSendEmail},async set(e){try{this.loadingSendMail=!0,this.$store.commit("setServerData",{...this.settings,newUserSendEmail:e}),await W.post(F("/settings/users/preferences/newUser.sendEmail"),{value:e?"yes":"no"})}catch(n){console.error("could not update newUser.sendEmail preference: "+n.message,n)}finally{this.loadingSendMail=!1}}}},methods:{setShowConfig(e,n){this.$store.commit("setShowConfig",{key:e,value:n})},validateQuota(e){return typeof e=="object"&&(e=(e==null?void 0:e.id)||e.label),S(e)===null?c:(e=it(S(e)),{id:e,label:e})},setDefaultQuota(e="none"){e==="none"&&(e=c),this.$store.dispatch("setAppConfig",{app:"files",key:"default_quota",value:e.id?e.id:e}).then(()=>{typeof e!="object"&&(e={id:e,label:e}),this.defaultQuota=e})}}};var ft=function(){var e=this,n=e._self._c;return n("NcAppSettingsDialog",{attrs:{open:e.isModalOpen,"show-navigation":!0,name:e.t("settings","Account management settings")},on:{"update:open":function(o){e.isModalOpen=o}}},[n("NcAppSettingsSection",{attrs:{id:"visibility-settings",name:e.t("settings","Visibility")}},[n("NcCheckboxRadioSwitch",{attrs:{type:"switch","data-test":"showLanguages",checked:e.showLanguages},on:{"update:checked":function(o){e.showLanguages=o}}},[e._v(" "+e._s(e.t("settings","Show language"))+" ")]),n("NcCheckboxRadioSwitch",{attrs:{type:"switch","data-test":"showUserBackend",checked:e.showUserBackend},on:{"update:checked":function(o){e.showUserBackend=o}}},[e._v(" "+e._s(e.t("settings","Show account backend"))+" ")]),n("NcCheckboxRadioSwitch",{attrs:{type:"switch","data-test":"showStoragePath",checked:e.showStoragePath},on:{"update:checked":function(o){e.showStoragePath=o}}},[e._v(" "+e._s(e.t("settings","Show storage path"))+" ")]),n("NcCheckboxRadioSwitch",{attrs:{type:"switch","data-test":"showLastLogin",checked:e.showLastLogin},on:{"update:checked":function(o){e.showLastLogin=o}}},[e._v(" "+e._s(e.t("settings","Show last login"))+" ")])],1),n("NcAppSettingsSection",{attrs:{id:"groups-sorting",name:e.t("settings","Sorting")}},[e.isGroupSortingEnforced?n("NcNoteCard",{attrs:{type:"warning"}},[e._v(" "+e._s(e.t("settings","The system config enforces sorting the groups by name. This also disables showing the member count."))+" ")]):e._e(),n("fieldset",[n("legend",[e._v(e._s(e.t("settings","Group list sorting")))]),n("NcCheckboxRadioSwitch",{attrs:{type:"radio",checked:e.groupSorting,"data-test":"sortGroupsByMemberCount",disabled:e.isGroupSortingEnforced,name:"group-sorting-mode",value:"member-count"},on:{"update:checked":function(o){e.groupSorting=o}}},[e._v(" "+e._s(e.t("settings","By member count"))+" ")]),n("NcCheckboxRadioSwitch",{attrs:{type:"radio",checked:e.groupSorting,"data-test":"sortGroupsByName",disabled:e.isGroupSortingEnforced,name:"group-sorting-mode",value:"name"},on:{"update:checked":function(o){e.groupSorting=o}}},[e._v(" "+e._s(e.t("settings","By name"))+" ")])],1)],1),n("NcAppSettingsSection",{attrs:{id:"email-settings",name:e.t("settings","Send email")}},[n("NcCheckboxRadioSwitch",{attrs:{type:"switch","data-test":"sendWelcomeMail",checked:e.sendWelcomeMail,disabled:e.loadingSendMail},on:{"update:checked":function(o){e.sendWelcomeMail=o}}},[e._v(" "+e._s(e.t("settings","Send welcome email to new accounts"))+" ")])],1),n("NcAppSettingsSection",{attrs:{id:"default-settings",name:e.t("settings","Defaults")}},[n("NcSelect",{attrs:{"input-label":e.t("settings","Default quota"),placement:"top",taggable:!0,options:e.quotaOptions,"create-option":e.validateQuota,placeholder:e.t("settings","Select default quota"),clearable:!1},on:{"option:selected":e.setDefaultQuota},model:{value:e.defaultQuota,callback:function(o){e.defaultQuota=o},expression:"defaultQuota"}})],1)],1)},vt=[],yt=f(ht,ft,vt,!1,null,"48b86bef");const Nt=yt.exports;function h(e){return typeof e>"u"?null:{id:e.id,title:e.name,usercount:e.usercount,count:Math.max(0,e.usercount-e.disabled)}}const St=e=>{const n=i(()=>e.value.filter(a=>a.id!=="disabled"&&a.id!=="admin").map(a=>h(a)).filter(a=>a!==null)),o=i(()=>h(e.value.find(a=>a.id==="admin"))),s=i(()=>h(e.value.find(a=>a.id==="disabled")));return{adminGroup:o,disabledGroup:s,userGroups:n}},wt=T({__name:"UserManagementNavigation",setup(e){const n=ut(),o=ct(),s=rt(),a=u(!1),p=i(()=>{var r;return(r=n.params)==null?void 0:r.selectedGroup}),C=i(()=>p.value?decodeURIComponent(p.value):null),x=i(()=>s.getters.getUserCount),v=i(()=>s.getters.getSortedGroups),{adminGroup:M,disabledGroup:I,userGroups:B}=St(v),D=i(()=>s.getters.getServerData.isAdmin),y=u(!1),d=u(!1),l=u(!1),g=u("");async function L(){l.value=!1;const r=g.value.trim();if(r===""){l.value=!0;return}y.value=!1,d.value=!0;try{await s.dispatch("addGroup",r),await o.push({name:"group",params:{selectedGroup:encodeURIComponent(r)}}),g.value=""}catch{A(N("settings","Failed to create group"))}d.value=!1}function U(){s.commit("setShowConfig",{key:"showNewUserForm",value:!0})}return{__sfc:!0,route:n,router:o,store:s,isDialogOpen:a,selectedGroup:p,selectedGroupDecoded:C,userCount:x,groups:v,adminGroup:M,disabledGroup:I,userGroups:B,isAdmin:D,isAddGroupOpen:y,loadingAddGroup:d,hasAddGroupError:l,newGroupName:g,createGroup:L,showNewUserMenu:U,mdiAccount:et,mdiAccountOff:ot,mdiCog:nt,mdiPlus:st,mdiShieldAccount:at,t:N,NcActionInput:w,NcActionText:z,NcAppNavigation:j,NcAppNavigationCaption:K,NcAppNavigationItem:G,NcAppNavigationList:V,NcAppNavigationNew:X,NcButton:_,NcCounterBubble:b,NcIconSvgWrapper:Y,NcLoadingIcon:Z,GroupListItem:mt,UserSettingsDialog:Nt}}});var Gt=function(){var e=this,n=e._self._c,o=e._self._setupProxy;return n(o.NcAppNavigation,{attrs:{"aria-label":o.t("settings","Account management")},scopedSlots:e._u([{key:"footer",fn:function(){return[n(o.NcButton,{staticClass:"account-management__settings-toggle",attrs:{type:"tertiary"},on:{click:function(s){o.isDialogOpen=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[n(o.NcIconSvgWrapper,{attrs:{path:o.mdiCog}})]},proxy:!0}])},[e._v(" "+e._s(o.t("settings","Account management settings"))+" ")]),n(o.UserSettingsDialog,{attrs:{open:o.isDialogOpen},on:{"update:open":function(s){o.isDialogOpen=s}}})]},proxy:!0}])},[n(o.NcAppNavigationNew,{attrs:{"button-id":"new-user-button",text:o.t("settings","New account")},on:{click:o.showNewUserMenu,keyup:[function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:o.showNewUserMenu.apply(null,arguments)},function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"space",32,s.key,[" ","Spacebar"])?null:o.showNewUserMenu.apply(null,arguments)}]},scopedSlots:e._u([{key:"icon",fn:function(){return[n(o.NcIconSvgWrapper,{attrs:{path:o.mdiPlus}})]},proxy:!0}])}),n(o.NcAppNavigationList,{staticClass:"account-management__system-list",attrs:{"data-cy-users-settings-navigation-groups":"system"}},[n(o.NcAppNavigationItem,{attrs:{id:"everyone",exact:!0,name:o.t("settings","Active accounts"),to:{name:"users"}},scopedSlots:e._u([{key:"icon",fn:function(){return[n(o.NcIconSvgWrapper,{attrs:{path:o.mdiAccount}})]},proxy:!0},{key:"counter",fn:function(){return[o.userCount?n(o.NcCounterBubble,{attrs:{type:o.selectedGroupDecoded?void 0:"highlighted"}},[e._v(" "+e._s(o.userCount)+" ")]):e._e()]},proxy:!0}])}),o.isAdmin?n(o.NcAppNavigationItem,{attrs:{id:"admin",exact:!0,name:o.t("settings","Admins"),to:{name:"group",params:{selectedGroup:"admin"}}},scopedSlots:e._u([{key:"icon",fn:function(){return[n(o.NcIconSvgWrapper,{attrs:{path:o.mdiShieldAccount}})]},proxy:!0},{key:"counter",fn:function(){return[o.adminGroup&&o.adminGroup.count>0?n(o.NcCounterBubble,{attrs:{type:o.selectedGroupDecoded==="admin"?"highlighted":void 0}},[e._v(" "+e._s(o.adminGroup.count)+" ")]):e._e()]},proxy:!0}],null,!1,3105706657)}):e._e(),o.disabledGroup&&(o.disabledGroup.usercount>0||o.disabledGroup.usercount===-1)?n(o.NcAppNavigationItem,{attrs:{id:"disabled",exact:!0,name:o.t("settings","Disabled accounts"),to:{name:"group",params:{selectedGroup:"disabled"}}},scopedSlots:e._u([{key:"icon",fn:function(){return[n(o.NcIconSvgWrapper,{attrs:{path:o.mdiAccountOff}})]},proxy:!0},o.disabledGroup.usercount>0?{key:"counter",fn:function(){return[n(o.NcCounterBubble,{attrs:{type:o.selectedGroupDecoded==="disabled"?"highlighted":void 0}},[e._v(" "+e._s(o.disabledGroup.usercount)+" ")])]},proxy:!0}:null],null,!0)}):e._e()],1),n(o.NcAppNavigationCaption,{attrs:{name:o.t("settings","Groups"),disabled:o.loadingAddGroup,"aria-label":o.loadingAddGroup?o.t("settings","Creating groupâ€¦"):o.t("settings","Create group"),"force-menu":"","is-heading":"",open:o.isAddGroupOpen},on:{"update:open":function(s){o.isAddGroupOpen=s}},scopedSlots:e._u([{key:"actionsTriggerIcon",fn:function(){return[o.loadingAddGroup?n(o.NcLoadingIcon):n(o.NcIconSvgWrapper,{attrs:{path:o.mdiPlus}})]},proxy:!0},{key:"actions",fn:function(){return[n(o.NcActionText,{scopedSlots:e._u([{key:"icon",fn:function(){return[n("AccountGroup",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(o.t("settings","Create group"))+" ")]),n(o.NcActionInput,{attrs:{label:o.t("settings","Group name"),"data-cy-users-settings-new-group-name":"","label-outside":!1,disabled:o.loadingAddGroup,value:o.newGroupName,error:o.hasAddGroupError,"helper-text":o.hasAddGroupError?o.t("settings","Please enter a valid group name"):""},on:{"update:value":function(s){o.newGroupName=s},submit:o.createGroup}})]},proxy:!0}])}),n(o.NcAppNavigationList,{staticClass:"account-management__group-list",attrs:{"data-cy-users-settings-navigation-groups":"custom"}},e._l(o.userGroups,function(s){return n(o.GroupListItem,{key:s.id,attrs:{id:s.id,active:o.selectedGroupDecoded===s.id,name:s.title,count:s.count}})}),1)],1)},_t=[],bt=f(wt,Gt,_t,!1,null,"d977d99d");const Vt=bt.exports;export{Vt as default};
