/*! third party licenses: dist/vendor.LICENSE.txt */
import{a_ as D,bu as g,aX as m,bA as oe,bj as $,bQ as ce,T as ue,X as de,be as pe,b_ as Y,bR as ee,bZ as M,c1 as fe,bK as te,bo as me,F as ie,G as ae,v as ve,w as ge,J as _e,E as he,bW as ye,a1 as we,af as be,al as Ce,c2 as ke,c3 as X,c4 as Fe,bc as Se,P as xe}from"../core-common.mjs";import{R as B,C as k,z as A}from"./_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import{d as Ne,a as Pe,b as G,c as J,g as Be,e as H,f as ze,C as Q,h as Ie,i as Le}from"./index-DG15V7L3.mjs";import{m as Ve,a as De,b as He}from"./icons-TElqpmA8.mjs";import{p as q}from"./index-PaKKd09k.mjs";import"./index-CiG5J8j_.mjs";import"./index-CPb3EwrS.mjs";import"./index-tn-fAC9x.mjs";const $e={name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Me=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon file-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Ae=[],Re=B($e,Me,Ae,!1,null,null);const le=Re.exports,R=()=>{const e=()=>{var t;return((t=document.getElementById("isPublic"))==null?void 0:t.value)==="1"},i=g(!0);return pe(()=>{i.value=e()}),{isPublic:i}},ne=()=>{var l,o,F;const e=Y("files","config",null),i=g((l=e==null?void 0:e.show_hidden)!=null?l:!0),t=g((o=e==null?void 0:e.sort_favorites_first)!=null?o:!0),a=g((F=e==null?void 0:e.crop_image_previews)!=null?F:!0),{isPublic:n}=R();return $(async()=>{var w,d,c,p,x,b;if(n.value)console.debug("Skip loading files settings - currently on public share");else try{const{data:f}=await ee.get(M("/apps/files/api/v1/configs"));i.value=(d=(w=f==null?void 0:f.data)==null?void 0:w.show_hidden)!=null?d:!1,t.value=(p=(c=f==null?void 0:f.data)==null?void 0:c.sort_favorites_first)!=null?p:!0,a.value=(b=(x=f==null?void 0:f.data)==null?void 0:x.crop_image_previews)!=null?b:!0}catch(f){console.error("Could not load files settings",f),A(k("Could not load files settings"))}}),{showHiddenFiles:i,sortFavoritesFirst:t,cropImagePreviews:a}},Ee=e=>{var c,p,x,b,f,_,h,N,z,S,r,P;const i=v=>v==="asc"?"ascending":v==="desc"?"descending":"none",t=Y("files","viewConfigs",null),a=g({sortBy:(p=(c=t==null?void 0:t.files)==null?void 0:c.sorting_mode)!=null?p:"basename",order:i((b=(x=t==null?void 0:t.files)==null?void 0:x.sorting_direction)!=null?b:"asc")}),n=g({sortBy:(_=(f=t==null?void 0:t.recent)==null?void 0:f.sorting_mode)!=null?_:"basename",order:i((N=(h=t==null?void 0:t.recent)==null?void 0:h.sorting_direction)!=null?N:"asc")}),l=g({sortBy:(S=(z=t==null?void 0:t.favorites)==null?void 0:z.sorting_mode)!=null?S:"basename",order:i((P=(r=t==null?void 0:t.favorites)==null?void 0:r.sorting_direction)!=null?P:"asc")}),{isPublic:o}=R();$(async()=>{var v,y,s,u,I,L,V,E,T,O,Z,U,j,W,K;if(o.value)console.debug("Skip loading files views - currently on public share");else try{const{data:C}=await ee.get(M("/apps/files/api/v1/views"));a.value={sortBy:(s=(y=(v=C==null?void 0:C.data)==null?void 0:v.files)==null?void 0:y.sorting_mode)!=null?s:"basename",order:i((I=(u=C==null?void 0:C.data)==null?void 0:u.files)==null?void 0:I.sorting_direction)},l.value={sortBy:(E=(V=(L=C==null?void 0:C.data)==null?void 0:L.favorites)==null?void 0:V.sorting_mode)!=null?E:"basename",order:i((O=(T=C==null?void 0:C.data)==null?void 0:T.favorites)==null?void 0:O.sorting_direction)},n.value={sortBy:(j=(U=(Z=C==null?void 0:C.data)==null?void 0:Z.recent)==null?void 0:U.sorting_mode)!=null?j:"basename",order:i((K=(W=C==null?void 0:C.data)==null?void 0:W.recent)==null?void 0:K.sorting_direction)}}catch(C){console.error("Could not load files views",C),A(k("Could not load files views"))}});const F=m(()=>X(e||"files")==="files"?a.value:X(e)==="recent"?n.value:l.value),w=m(()=>F.value.sortBy),d=m(()=>F.value.order);return{filesViewConfig:a,favoritesViewConfig:l,recentViewConfig:n,currentConfig:F,sortBy:w,order:d}},Te={name:"MenuUpIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Oe=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon menu-up-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M7,15L12,10L17,15H7Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Ze=[],Ue=B(Te,Oe,Ze,!1,null,null);const je=Ue.exports,We={name:"MenuDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ke=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon menu-down-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M7,10L12,15L17,10H7Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Xe=[],Ge=B(We,Ke,Xe,!1,null,null);const Je=Ge.exports,se={"file-picker__file-icon":"_file-picker__file-icon_1vgv4_5"},Qe=D({__name:"LoadingTableRow",props:{showCheckbox:{type:Boolean}},setup(e){return{__sfc:!0,fileListIconStyles:se}}});var qe=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("tr",{staticClass:"file-picker__row loading-row",attrs:{"aria-hidden":"true"}},[e.showCheckbox?i("td",{staticClass:"row-checkbox"},[i("span")]):e._e(),i("td",{staticClass:"row-name"},[i("div",{staticClass:"row-wrapper"},[i("span",{class:t.fileListIconStyles["file-picker__file-icon"]}),i("span")])]),e._m(0),e._m(1)])},Ye=[function(){var e=this,i=e._self._c;return e._self._setupProxy,i("td",{staticClass:"row-size"},[i("span")])},function(){var e=this,i=e._self._c;return e._self._setupProxy,i("td",{staticClass:"row-modified"},[i("span")])}],et=B(Qe,qe,Ye,!1,null,"6aded0d9");const tt=et.exports;function it(e,i={}){var t;i={size:32,cropPreview:!1,mimeFallback:!0,...i};try{const a=((t=e.attributes)==null?void 0:t.previewUrl)||M("/core/preview?fileId={fileid}",{fileid:e.fileid});let n;try{n=new URL(a)}catch{n=new URL(a,window.location.origin)}return n.searchParams.set("x","".concat(i.size)),n.searchParams.set("y","".concat(i.size)),n.searchParams.set("mimeFallback","".concat(i.mimeFallback)),n.searchParams.set("a",i.cropPreview===!0?"0":"1"),n.searchParams.set("c","".concat(e.attributes.etag)),n}catch{return null}}const at={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var lt=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon folder-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},nt=[],st=B(at,lt,nt,!1,null,null);const re=st.exports,rt={name:"FilePreview"},ot=D({...rt,props:{node:null,cropImagePreviews:{type:Boolean}},setup(e){const i=e,t=g(se),a=m(()=>it(i.node,{cropPreview:i.cropImagePreviews})),n=m(()=>i.node.type===H.File),l=g(!1);return te(a,()=>{if(l.value=!1,a.value){const o=document.createElement("img");o.src=a.value.href,o.onerror=()=>o.remove(),o.onload=()=>{l.value=!0,o.remove()},document.body.appendChild(o)}},{immediate:!0}),{__sfc:!0,fileListIconStyles:t,props:i,previewURL:a,isFile:n,canLoadPreview:l,IconFile:le,IconFolder:re}}});var ct=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("div",{class:t.fileListIconStyles["file-picker__file-icon"],style:t.canLoadPreview?{backgroundImage:"url(".concat(t.previewURL,")")}:void 0},[t.canLoadPreview?e._e():[t.isFile?i(t.IconFile,{attrs:{size:20}}):i(t.IconFolder,{attrs:{size:20}})]],2)},ut=[],dt=B(ot,ct,ut,!1,null,null);const pt=dt.exports,ft=D({__name:"FileListRow",props:{allowPickDirectory:{type:Boolean},selected:{type:Boolean},showCheckbox:{type:Boolean},canPick:{type:Boolean},node:null,cropImagePreviews:{type:Boolean}},emits:["update:selected","enter-directory"],setup(e,{emit:i}){const t=e,a=m(()=>{var c;return((c=t.node.attributes)==null?void 0:c.displayName)||t.node.basename.slice(0,t.node.extension?-t.node.extension.length:void 0)}),n=m(()=>t.node.extension),l=m(()=>t.node.type===H.Folder),o=m(()=>t.canPick&&(t.allowPickDirectory||!l.value));function F(){i("update:selected",!t.selected)}function w(){l.value?i("enter-directory",t.node):F()}function d(c){c.key==="Enter"&&w()}return{__sfc:!0,props:t,emit:i,displayName:a,fileExtension:n,isDirectory:l,isPickable:o,toggleSelected:F,handleClick:w,handleKeyDown:d,formatFileSize:Le,NcCheckboxRadioSwitch:ae,NcDateTime:xe,t:k,FilePreview:pt}}});var mt=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("tr",e._g({class:["file-picker__row",{"file-picker__row--selected":e.selected&&!e.showCheckbox}],attrs:{tabindex:e.showCheckbox&&!t.isDirectory?void 0:0,"aria-selected":t.isPickable?e.selected:void 0,"data-filename":e.node.basename,"data-testid":"file-list-row"}},{click:t.handleClick,...!e.showCheckbox||t.isDirectory?{keydown:t.handleKeyDown}:{}}),[e.showCheckbox?i("td",{staticClass:"row-checkbox",on:{click:function(a){return a.stopPropagation(),(()=>{}).apply(null,arguments)}}},[i(t.NcCheckboxRadioSwitch,{attrs:{"aria-label":t.t("Select the row for {nodename}",{nodename:t.displayName}),checked:e.selected,disabled:!t.isPickable,"data-testid":"row-checkbox"},on:{"update:checked":t.toggleSelected}})],1):e._e(),i("td",{staticClass:"row-name"},[i("div",{staticClass:"file-picker__name-container",attrs:{"data-testid":"row-name"}},[i(t.FilePreview,{attrs:{node:e.node,"crop-image-previews":e.cropImagePreviews}}),i("div",{staticClass:"file-picker__file-name",attrs:{title:t.displayName},domProps:{textContent:e._s(t.displayName)}}),i("div",{staticClass:"file-picker__file-extension",domProps:{textContent:e._s(t.fileExtension)}})],1)]),i("td",{staticClass:"row-size"},[e._v(" "+e._s(t.formatFileSize(e.node.size||0))+" ")]),i("td",{staticClass:"row-modified"},[i(t.NcDateTime,{attrs:{timestamp:e.node.mtime,"ignore-seconds":!0}})],1)])},vt=[],gt=B(ft,mt,vt,!1,null,"48df4f27");const _t=gt.exports,ht=D({__name:"FileList",props:{currentView:null,multiselect:{type:Boolean},allowPickDirectory:{type:Boolean},loading:{type:Boolean},files:null,selectedFiles:null,path:null},emits:["update:path","update:selectedFiles"],setup(e,{emit:i}){const t=e,a=g(),{currentConfig:n}=Ee(t.currentView),l=m(()=>{var r;return(r=a.value)!=null?r:n.value}),o=m(()=>l.value.sortBy==="basename"?l.value.order==="none"?void 0:l.value.order:void 0),F=m(()=>l.value.sortBy==="size"?l.value.order==="none"?void 0:l.value.order:void 0),w=m(()=>l.value.sortBy==="mtime"?l.value.order==="none"?void 0:l.value.order:void 0),d=r=>{l.value.sortBy===r?l.value.order==="ascending"?a.value={sortBy:l.value.sortBy,order:"descending"}:a.value={sortBy:l.value.sortBy,order:"ascending"}:a.value={sortBy:r,order:"ascending"}},{sortFavoritesFirst:c,cropImagePreviews:p}=ne(),x=m(()=>{const r={ascending:(v,y,s)=>s(v,y),descending:(v,y,s)=>s(y,v),none:(v,y,s)=>0},P={basename:(v,y)=>{var s,u;return(((s=v.attributes)==null?void 0:s.displayName)||v.basename).localeCompare(((u=y.attributes)==null?void 0:u.displayName)||y.basename,Fe())},size:(v,y)=>(v.size||0)-(y.size||0),mtime:(v,y)=>{var s,u,I,L;return(((u=(s=y.mtime)==null?void 0:s.getTime)==null?void 0:u.call(s))||0)-(((L=(I=v.mtime)==null?void 0:I.getTime)==null?void 0:L.call(I))||0)}};return[...t.files].sort((v,y)=>(y.type===H.Folder?1:0)-(v.type===H.Folder?1:0)||(c?(y.attributes.favorite?1:0)-(v.attributes.favorite?1:0):0)||r[l.value.order](v,y,P[l.value.sortBy]))}),b=m(()=>t.files.filter(r=>t.allowPickDirectory||r.type!==H.Folder)),f=m(()=>!t.loading&&t.selectedFiles.length>0&&t.selectedFiles.length>=b.value.length);function _(){t.selectedFiles.length<b.value.length?i("update:selectedFiles",b.value):i("update:selectedFiles",[])}function h(r){t.selectedFiles.includes(r)?i("update:selectedFiles",t.selectedFiles.filter(P=>P.path!==r.path)):t.multiselect?i("update:selectedFiles",[...t.selectedFiles,r]):i("update:selectedFiles",[r])}function N(r){i("update:path",r.path)}const z=g(4),S=g();{const r=()=>Se(()=>{var y,s,u,I,L;const P=((s=(y=S.value)==null?void 0:y.parentElement)==null?void 0:s.children)||[];let v=((I=(u=S.value)==null?void 0:u.parentElement)==null?void 0:I.clientHeight)||450;for(let V=0;V<P.length;V++)(L=S.value)!=null&&L.isSameNode(P[V])||(v-=P[V].clientHeight);z.value=Math.floor((v-50)/50)});$(()=>{window.addEventListener("resize",r),r()}),me(()=>{window.removeEventListener("resize",r)})}return{__sfc:!0,props:t,emit:i,customSortingConfig:a,filesAppSorting:n,sortingConfig:l,sortByName:o,sortBySize:F,sortByModified:w,toggleSorting:d,sortFavoritesFirst:c,cropImagePreviews:p,sortedFiles:x,selectableFiles:b,allSelected:f,onSelectAll:_,onNodeSelected:h,onChangeDirectory:N,skeletonNumber:z,fileContainer:S,NcButton:ie,NcCheckboxRadioSwitch:ae,t:k,IconSortAscending:je,IconSortDescending:Je,LoadingTableRow:tt,FileListRow:_t}}});var yt=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i("div",{ref:"fileContainer",staticClass:"file-picker__files"},[i("table",[i("thead",[i("tr",[e.multiselect?i("th",{staticClass:"row-checkbox"},[i("span",{staticClass:"hidden-visually"},[e._v(" "+e._s(t.t("Select entry"))+" ")]),e.multiselect?i(t.NcCheckboxRadioSwitch,{attrs:{"aria-label":t.t("Select all entries"),checked:t.allSelected,"data-testid":"select-all-checkbox"},on:{"update:checked":t.onSelectAll}}):e._e()],1):e._e(),i("th",{staticClass:"row-name",attrs:{"aria-sort":t.sortByName}},[i("div",{staticClass:"header-wrapper"},[i("span",{staticClass:"file-picker__header-preview"}),i(t.NcButton,{attrs:{wide:!0,type:"tertiary","data-test":"file-picker_sort-name"},on:{click:function(a){return t.toggleSorting("basename")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t.sortByName==="ascending"?i(t.IconSortAscending,{attrs:{size:20}}):t.sortByName==="descending"?i(t.IconSortDescending,{attrs:{size:20}}):i("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(t.t("Name"))+" ")])],1)]),i("th",{staticClass:"row-size",attrs:{"aria-sort":t.sortBySize}},[i(t.NcButton,{attrs:{wide:!0,type:"tertiary"},on:{click:function(a){return t.toggleSorting("size")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t.sortBySize==="ascending"?i(t.IconSortAscending,{attrs:{size:20}}):t.sortBySize==="descending"?i(t.IconSortDescending,{attrs:{size:20}}):i("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(t.t("Size"))+" ")])],1),i("th",{staticClass:"row-modified",attrs:{"aria-sort":t.sortByModified}},[i(t.NcButton,{attrs:{wide:!0,type:"tertiary"},on:{click:function(a){return t.toggleSorting("mtime")}},scopedSlots:e._u([{key:"icon",fn:function(){return[t.sortByModified==="ascending"?i(t.IconSortAscending,{attrs:{size:20}}):t.sortByModified==="descending"?i(t.IconSortDescending,{attrs:{size:20}}):i("span",{staticStyle:{width:"44px"}})]},proxy:!0}])},[e._v(" "+e._s(t.t("Modified"))+" ")])],1)])]),i("tbody",[e.loading?e._l(t.skeletonNumber,function(a){return i(t.LoadingTableRow,{key:a,attrs:{"show-checkbox":e.multiselect}})}):e._l(t.sortedFiles,function(a){return i(t.FileListRow,{key:a.fileid||a.path,attrs:{"allow-pick-directory":e.allowPickDirectory,"show-checkbox":e.multiselect,"can-pick":e.multiselect||e.selectedFiles.length===0||e.selectedFiles.includes(a),selected:e.selectedFiles.includes(a),node:a,"crop-image-previews":t.cropImagePreviews},on:{"update:selected":function(n){return t.onNodeSelected(a)},"enter-directory":t.onChangeDirectory}})})],2)])])},wt=[],bt=B(ht,yt,wt,!1,null,"d3c94818");const Ct=bt.exports,kt={name:"HomeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ft=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon home-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},St=[],xt=B(kt,Ft,St,!1,null,null);const Nt=xt.exports,Pt={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Bt=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon plus-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},zt=[],It=B(Pt,Bt,zt,!1,null,null);const Lt=It.exports,Vt=D({__name:"FilePickerBreadcrumbs",props:{path:null,showMenu:{type:Boolean}},emits:["update:path","create-node"],setup(e,{emit:i}){const t=e,a=g(!1),n=g(""),l=g();function o(){var x,b,f,_;const d=n.value.trim(),c=(b=(x=l.value)==null?void 0:x.$el)==null?void 0:b.querySelector("input");let p="";return d.length===0?p=k("Folder name cannot be empty."):d.includes("/")?p=k('"/" is not allowed inside a folder name.'):["..","."].includes(d)?p=k('"{name}" is an invalid folder name.',{name:d}):(f=window.OC.config)!=null&&f.blacklist_files_regex&&d.match((_=window.OC.config)==null?void 0:_.blacklist_files_regex)&&(p=k('"{name}" is not an allowed folder name',{name:d})),c&&c.setCustomValidity(p),p===""}const F=function(){const d=n.value.trim();o()&&(a.value=!1,i("create-node",d),n.value="")},w=m(()=>t.path.split("/").filter(d=>d!=="").map((d,c,p)=>({name:d,path:"/"+p.slice(0,c+1).join("/")})));return{__sfc:!0,props:t,emit:i,actionsOpen:a,newNodeName:n,nameInput:l,validateInput:o,onSubmit:F,pathElements:w,IconFolder:re,IconHome:Nt,IconPlus:Lt,NcActions:ve,NcActionInput:ge,NcBreadcrumbs:_e,NcBreadcrumb:he,t:k}}});var Dt=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i(t.NcBreadcrumbs,{staticClass:"file-picker__breadcrumbs",scopedSlots:e._u([{key:"default",fn:function(){return[i(t.NcBreadcrumb,{attrs:{name:t.t("All files"),title:t.t("Home")},on:{click:function(a){return t.emit("update:path","/")}},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconHome,{attrs:{size:20}})]},proxy:!0}])}),e._l(t.pathElements,function(a){return i(t.NcBreadcrumb,{key:a.path,attrs:{name:a.name,title:a.path},on:{click:function(n){return t.emit("update:path",a.path)}}})})]},proxy:!0},e.showMenu?{key:"actions",fn:function(){return[i(t.NcActions,{attrs:{"aria-label":t.t("Create directory"),"force-menu":!0,"force-name":!0,"menu-name":t.t("New"),open:t.actionsOpen,type:"secondary"},on:{"update:open":function(a){t.actionsOpen=a},close:function(a){t.newNodeName=""}},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconPlus,{attrs:{size:20}})]},proxy:!0}],null,!1,2971667417)},[i(t.NcActionInput,{ref:"nameInput",attrs:{value:t.newNodeName,label:t.t("New folder"),placeholder:t.t("New folder name")},on:{"update:value":function(a){t.newNodeName=a},submit:t.onSubmit,input:t.validateInput},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconFolder,{attrs:{size:20}})]},proxy:!0}],null,!1,1614167509)})],1)]},proxy:!0}:null],null,!0)})},Ht=[],$t=B(Vt,Dt,Ht,!1,null,"22cbb5df");const Mt=$t.exports,At={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Rt=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},Et=[],Tt=B(At,Rt,Et,!1,null,null);const Ot=Tt.exports,Zt={name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var Ut=function(){var e=this,i=e._self._c;return i("span",e._b({staticClass:"material-design-icon magnify-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(t){return e.$emit("click",t)}}},"span",e.$attrs,!1),[i("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[i("path",{attrs:{d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"}},[e.title?i("title",[e._v(e._s(e.title))]):e._e()])])])},jt=[],Wt=B(Zt,Ut,jt,!1,null,null);const Kt=Wt.exports,Xt=e=>{const i=[{id:"files",label:k("All files"),icon:Ve},{id:"recent",label:k("Recent"),icon:De},{id:"favorites",label:k("Favorites"),icon:He}],t=e.value?i.filter(({id:a})=>a==="files"):i;return{allViews:i,availableViews:t}},Gt=D({__name:"FilePickerNavigation",props:{currentView:null,filterString:null,isCollapsed:{type:Boolean},disabledNavigation:{type:Boolean}},emits:["update:currentView","update:filterString"],setup(e,{emit:i}){const t=e,{availableViews:a}=Xt(g(ye()===null)),n=m(()=>{var l;return(l=a.filter(o=>o.id===t.currentView)[0])!=null?l:a[0]});return{__sfc:!0,props:t,emit:i,availableViews:a,currentViewObject:n,updateFilterValue:l=>i("update:filterString",l),IconClose:Ot,IconMagnify:Kt,NcButton:ie,NcIconSvgWrapper:we,NcSelect:be,NcTextField:Ce,Fragment:ke,t:k}}});var Jt=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i(t.Fragment,[i(t.NcTextField,{staticClass:"file-picker__filter-input",attrs:{value:e.filterString,label:t.t("Filter file list"),"show-trailing-button":!!e.filterString},on:{"update:value":t.updateFilterValue,"trailing-button-click":function(a){return t.updateFilterValue("")}},scopedSlots:e._u([{key:"trailing-button-icon",fn:function(){return[i(t.IconClose,{attrs:{size:16}})]},proxy:!0}])},[i(t.IconMagnify,{attrs:{size:16}})],1),t.availableViews.length>1&&!e.disabledNavigation?[e.isCollapsed?i(t.NcSelect,{attrs:{"aria-label":t.t("Current view selector"),clearable:!1,searchable:!1,options:t.availableViews,value:t.currentViewObject},on:{input:a=>t.emit("update:currentView",a.id)}}):i("ul",{staticClass:"file-picker__side"},e._l(t.availableViews,function(a){return i("li",{key:a.id},[i(t.NcButton,{attrs:{type:e.currentView===a.id?"primary":"tertiary",wide:!0},on:{click:function(n){return e.$emit("update:currentView",a.id)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.NcIconSvgWrapper,{attrs:{path:a.icon,size:20}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(a.label)+" ")])],1)}),0)]:e._e()],2)},Qt=[],qt=B(Gt,Jt,Qt,!1,null,"a06474d4");const Yt=qt.exports,ei=function(e,i,t){const a=m(()=>t.value?"/":Ne),n=m(()=>t.value?fe("webdav").replace("/remote.php","/public.php"):Pe),l=m(()=>{if(t.value){const _=document.getElementById("sharingToken").value,h=btoa("".concat(_,":null"));return G(n.value,{Authorization:"Basic ".concat(h)})}return G()}),o=_=>ze(_,a.value,n.value),F=()=>{const _=new AbortController,h=Math.round(Date.now()/1e3)-60*60*24*14;return new Q(async(N,z,S)=>{S(()=>_.abort());try{const{data:r}=await l.value.search("/",{signal:_.signal,details:!0,data:Ie(h)}),P=r.results.map(o);N(P)}catch(r){z(r)}})},w=()=>{const _=new AbortController;return new Q(async(h,N,z)=>{z(()=>_.abort());try{let S=(await l.value.getDirectoryContents("".concat(a.value).concat(i.value),{signal:_.signal,details:!0,data:J()})).data.map(o);t.value&&(S=S.filter(r=>r.path!==i.value)),h(S)}catch(S){N(S)}})},d=g([]),c=g(!0),p=g(null);async function x(_){const h=q.join(i.value,_);await l.value.createDirectory(q.join(a.value,h));const N=await b(h);return d.value.push(N),N}async function b(_,h=void 0){h=h!=null?h:a.value;const{data:N}=await l.value.stat("".concat(h).concat(_),{details:!0,data:J()});return o(N)}async function f(){p.value&&p.value.cancel(),c.value=!0,e.value==="favorites"?p.value=Be(l.value,i.value,a.value):e.value==="recent"?p.value=F():p.value=w(),d.value=await p.value,p.value=null,c.value=!1}return te([e,i],()=>f()),$(()=>f()),{isLoading:c,files:d,loadFiles:f,getFile:b,createDirectory:x}},ti=function(e){const i=m(()=>e.value.map(t=>t.split("/")));return{isSupportedMimeType:t=>{const a=t.split("/");return i.value.some(([n,l])=>(a[0]===n||n==="*")&&(a[1]===l||l==="*"))}}},ii={name:"FilePicker"},ai=D({...ii,props:{buttons:null,name:null,allowPickDirectory:{type:Boolean,default:!1},disabledNavigation:{type:Boolean,default:!1},container:{default:"body"},filterFn:{default:void 0},mimetypeFilter:{default:()=>[]},multiselect:{type:Boolean,default:!0},path:{default:void 0}},emits:["close"],setup(e,{emit:i}){const t=e,{isPublic:a}=R(),n=g(!0),l=m(()=>(typeof t.buttons=="function"?t.buttons(c.value,b.value,w.value):t.buttons).map(s=>({...s,callback:()=>{o=!0,F(s.callback)}})));let o=!1;const F=async s=>{const u=c.value.length===0&&t.allowPickDirectory?[await S(b.value)]:c.value;s(u),i("close",u),o=!1},w=g("files"),d=m(()=>w.value==="favorites"?k("Favorites"):w.value==="recent"?k("Recent"):""),c=g([]),p=g((window==null?void 0:window.sessionStorage.getItem("NC.FilePicker.LastPath"))||"/"),x=g(),b=m({get:()=>w.value==="files"?x.value||t.path||p.value:"/",set:s=>{t.path===void 0&&window.sessionStorage.setItem("NC.FilePicker.LastPath",s),x.value=s,c.value=[]}}),f=g(""),{isSupportedMimeType:_}=ti(oe(t,"mimetypeFilter")),{files:h,isLoading:N,loadFiles:z,getFile:S,createDirectory:r}=ei(w,b,a);$(()=>z());const{showHiddenFiles:P}=ne(),v=m(()=>{let s=h.value;return P.value||(s=s.filter(u=>!u.basename.startsWith("."))),t.mimetypeFilter.length>0&&(s=s.filter(u=>u.type==="folder"||u.mime&&_(u.mime))),f.value&&(s=s.filter(u=>u.basename.toLowerCase().includes(f.value.toLowerCase()))),t.filterFn&&(s=s.filter(u=>t.filterFn(u))),s}),y=m(()=>w.value==="files"?k("Upload some content or sync with your devices!"):w.value==="recent"?k("Files and folders you recently modified will show up here."):k("Files and folders you mark as favorite will show up here."));return{__sfc:!0,props:t,emit:i,isPublic:a,isOpen:n,dialogButtons:l,isHandlingCallback:o,handleButtonClick:F,currentView:w,viewHeadline:d,selectedFiles:c,savedPath:p,navigatedPath:x,currentPath:b,filterString:f,isSupportedMimeType:_,files:h,isLoading:N,loadFiles:z,getFile:S,createDirectory:r,showHiddenFiles:P,filteredFiles:v,noFilesDescription:y,onCreateFolder:async s=>{try{const u=await r(s);b.value=u.path,ce("files:node:created",h.value.filter(I=>I.basename===s)[0])}catch(u){console.warn("Could not create new folder",{name:s,error:u}),A(k("Could not create the new folder"))}},handleClose:s=>{!s&&!o&&i("close")},IconFile:le,FileList:Ct,FilePickerBreadcrumbs:Mt,FilePickerNavigation:Yt,NcDialog:ue,NcEmptyContent:de,t:k}}});var li=function(){var e=this,i=e._self._c,t=e._self._setupProxy;return i(t.NcDialog,{attrs:{container:e.container,buttons:t.dialogButtons,name:e.name,size:"large","content-classes":"file-picker__content","dialog-classes":"file-picker","navigation-classes":"file-picker__navigation",open:t.isOpen},on:{"update:open":[function(a){t.isOpen=a},t.handleClose]},scopedSlots:e._u([{key:"navigation",fn:function({isCollapsed:a}){return[i(t.FilePickerNavigation,{attrs:{"is-collapsed":a,"current-view":t.currentView,"filter-string":t.filterString,"disabled-navigation":e.disabledNavigation},on:{"update:currentView":function(n){t.currentView=n},"update:current-view":function(n){t.currentView=n},"update:filterString":function(n){t.filterString=n},"update:filter-string":function(n){t.filterString=n}}})]}}])},[i("div",{staticClass:"file-picker__main"},[t.currentView==="files"?i(t.FilePickerBreadcrumbs,{attrs:{path:t.currentPath,"show-menu":e.allowPickDirectory},on:{"update:path":function(a){t.currentPath=a},"create-node":t.onCreateFolder}}):i("div",{staticClass:"file-picker__view"},[i("h3",[e._v(e._s(t.viewHeadline))])]),t.isLoading||t.filteredFiles.length>0?i(t.FileList,{attrs:{"allow-pick-directory":e.allowPickDirectory,"current-view":t.currentView,files:t.filteredFiles,multiselect:e.multiselect,loading:t.isLoading,path:t.currentPath,"selected-files":t.selectedFiles,name:t.viewHeadline},on:{"update:path":[function(a){t.currentPath=a},function(a){t.currentView="files"}],"update:selectedFiles":function(a){t.selectedFiles=a},"update:selected-files":function(a){t.selectedFiles=a}}}):t.filterString?i(t.NcEmptyContent,{attrs:{name:t.t("No matching files"),description:t.t("No files matching your filter were found.")},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconFile)]},proxy:!0}])}):i(t.NcEmptyContent,{attrs:{name:t.t("No files in here"),description:t.noFilesDescription},scopedSlots:e._u([{key:"icon",fn:function(){return[i(t.IconFile)]},proxy:!0}])})],1)])},ni=[],si=B(ai,li,ni,!1,null,"6ff1b36b");const vi=si.exports;export{vi as default};
