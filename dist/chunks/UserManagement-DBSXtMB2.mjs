/*! third party licenses: dist/vendor.LICENSE.txt */
import{aV as x,ch as H,F as V,T as R,a8 as W,af as T,al as P,a4 as q,bS as h,c5 as X,a_ as M,b as Y,v as K,a1 as k,D as Z,aa as J,bW as ee,c2 as te,X as se,c0 as E,cg as G,H as ae}from"../core-common.mjs";import{n as p,av as ie,ba as re,D as ne}from"./icons-TElqpmA8.mjs";import"./index-PaKKd09k.mjs";import{B as b,z as U}from"./_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import{a as oe}from"./index-DCgLaXhm.mjs";import{l as C}from"./logger-C7fGMvfA.mjs";import{i as w,s as _}from"./index-DG15V7L3.mjs";import{u as F,s as le,O as de,n as ue,v as z,j as ce}from"./json2xml-BD0x8Z3S.mjs";import{i as Q,u as v,d as B}from"./userUtils-Di345_lx.mjs";import"./index-CiG5J8j_.mjs";import"./index-CPb3EwrS.mjs";import"./index-tn-fAC9x.mjs";class ge{constructor(s){this.tagname=s,this.child=[],this[":@"]={}}add(s,a){s==="__proto__"&&(s="#__proto__"),this.child.push({[s]:a})}addChild(s){s.tagname==="__proto__"&&(s.tagname="#__proto__"),s[":@"]&&Object.keys(s[":@"]).length>0?this.child.push({[s.tagname]:s.child,":@":s[":@"]}):this.child.push({[s.tagname]:s.child})}}var he=ge;const pe=F;function me(e,s){const a={};if(e[s+3]==="O"&&e[s+4]==="C"&&e[s+5]==="T"&&e[s+6]==="Y"&&e[s+7]==="P"&&e[s+8]==="E"){s=s+9;let r=1,i=!1,n=!1,o="";for(;s<e.length;s++)if(e[s]==="<"&&!n){if(i&&we(e,s))s+=7,[entityName,val,s]=fe(e,s+1),val.indexOf("&")===-1&&(a[xe(entityName)]={regx:RegExp("&".concat(entityName,";"),"g"),val});else if(i&&_e(e,s))s+=8;else if(i&&ye(e,s))s+=8;else if(i&&ve(e,s))s+=9;else if(be)n=!0;else throw new Error("Invalid DOCTYPE");r++,o=""}else if(e[s]===">"){if(n?e[s-1]==="-"&&e[s-2]==="-"&&(n=!1,r--):r--,r===0)break}else e[s]==="["?i=!0:o+=e[s];if(r!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:a,i:s}}function fe(e,s){let a="";for(;s<e.length&&e[s]!=="'"&&e[s]!=='"';s++)a+=e[s];if(a=a.trim(),a.indexOf(" ")!==-1)throw new Error("External entites are not supported");const r=e[s++];let i="";for(;s<e.length&&e[s]!==r;s++)i+=e[s];return[a,i,s]}function be(e,s){return e[s+1]==="!"&&e[s+2]==="-"&&e[s+3]==="-"}function we(e,s){return e[s+1]==="!"&&e[s+2]==="E"&&e[s+3]==="N"&&e[s+4]==="T"&&e[s+5]==="I"&&e[s+6]==="T"&&e[s+7]==="Y"}function _e(e,s){return e[s+1]==="!"&&e[s+2]==="E"&&e[s+3]==="L"&&e[s+4]==="E"&&e[s+5]==="M"&&e[s+6]==="E"&&e[s+7]==="N"&&e[s+8]==="T"}function ye(e,s){return e[s+1]==="!"&&e[s+2]==="A"&&e[s+3]==="T"&&e[s+4]==="T"&&e[s+5]==="L"&&e[s+6]==="I"&&e[s+7]==="S"&&e[s+8]==="T"}function ve(e,s){return e[s+1]==="!"&&e[s+2]==="N"&&e[s+3]==="O"&&e[s+4]==="T"&&e[s+5]==="A"&&e[s+6]==="T"&&e[s+7]==="I"&&e[s+8]==="O"&&e[s+9]==="N"}function xe(e){if(pe.isName(e))return e;throw new Error("Invalid entity name ".concat(e))}var Ue=me;const j=F,y=he,Ce=Ue,Ne=le;let Ae=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=Se,this.parseXml=Ee,this.parseTextData=Le,this.resolveNameSpace=Oe,this.buildAttributesMap=$e,this.isItStopNode=Te,this.replaceEntitiesValue=Ie,this.readStopNodeData=Me,this.saveTextToParentTag=De,this.addChild=Ge}};function Se(e){const s=Object.keys(e);for(let a=0;a<s.length;a++){const r=s[a];this.lastEntities[r]={regex:new RegExp("&"+r+";","g"),val:e[r]}}}function Le(e,s,a,r,i,n,o){if(e!==void 0&&(this.options.trimValues&&!r&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const l=this.options.tagValueProcessor(s,e,a,i,n);return l==null?e:typeof l!=typeof e||l!==e?l:this.options.trimValues?O(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?O(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Oe(e){if(this.options.removeNSPrefix){const s=e.split(":"),a=e.charAt(0)==="/"?"/":"";if(s[0]==="xmlns")return"";s.length===2&&(e=a+s[1])}return e}const qe=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function $e(e,s,a){if(!this.options.ignoreAttributes&&typeof e=="string"){const r=j.getAllMatches(e,qe),i=r.length,n={};for(let o=0;o<i;o++){const l=this.resolveNameSpace(r[o][1]);let u=r[o][4],d=this.options.attributeNamePrefix+l;if(l.length)if(this.options.transformAttributeName&&(d=this.options.transformAttributeName(d)),d==="__proto__"&&(d="#__proto__"),u!==void 0){this.options.trimValues&&(u=u.trim()),u=this.replaceEntitiesValue(u);const c=this.options.attributeValueProcessor(l,u,s);c==null?n[d]=u:typeof c!=typeof u||c!==u?n[d]=c:n[d]=O(u,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(n[d]=!0)}if(!Object.keys(n).length)return;if(this.options.attributesGroupName){const o={};return o[this.options.attributesGroupName]=n,o}return n}}const Ee=function(e){e=e.replace(/\r\n?/g,"\n");const s=new y("!xml");let a=s,r="",i="";for(let n=0;n<e.length;n++)if(e[n]==="<")if(e[n+1]==="/"){const o=m(e,">",n,"Closing Tag is not closed.");let l=e.substring(n+2,o).trim();if(this.options.removeNSPrefix){const c=l.indexOf(":");c!==-1&&(l=l.substr(c+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),a&&(r=this.saveTextToParentTag(r,a,i));const u=i.substring(i.lastIndexOf(".")+1);if(l&&this.options.unpairedTags.indexOf(l)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(l,">"));let d=0;u&&this.options.unpairedTags.indexOf(u)!==-1?(d=i.lastIndexOf(".",i.lastIndexOf(".")-1),this.tagsNodeStack.pop()):d=i.lastIndexOf("."),i=i.substring(0,d),a=this.tagsNodeStack.pop(),r="",n=o}else if(e[n+1]==="?"){let o=L(e,n,!1,"?>");if(!o)throw new Error("Pi Tag is not closed.");if(r=this.saveTextToParentTag(r,a,i),!(this.options.ignoreDeclaration&&o.tagName==="?xml"||this.options.ignorePiTags)){const l=new y(o.tagName);l.add(this.options.textNodeName,""),o.tagName!==o.tagExp&&o.attrExpPresent&&(l[":@"]=this.buildAttributesMap(o.tagExp,i,o.tagName)),this.addChild(a,l,i)}n=o.closeIndex+1}else if(e.substr(n+1,3)==="!--"){const o=m(e,"-->",n+4,"Comment is not closed.");if(this.options.commentPropName){const l=e.substring(n+4,o-2);r=this.saveTextToParentTag(r,a,i),a.add(this.options.commentPropName,[{[this.options.textNodeName]:l}])}n=o}else if(e.substr(n+1,2)==="!D"){const o=Ce(e,n);this.docTypeEntities=o.entities,n=o.i}else if(e.substr(n+1,2)==="!["){const o=m(e,"]]>",n,"CDATA is not closed.")-2,l=e.substring(n+9,o);r=this.saveTextToParentTag(r,a,i);let u=this.parseTextData(l,a.tagname,i,!0,!1,!0,!0);u==null&&(u=""),this.options.cdataPropName?a.add(this.options.cdataPropName,[{[this.options.textNodeName]:l}]):a.add(this.options.textNodeName,u),n=o+2}else{let o=L(e,n,this.options.removeNSPrefix),l=o.tagName;const u=o.rawTagName;let d=o.tagExp,c=o.attrExpPresent,f=o.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),a&&r&&a.tagname!=="!xml"&&(r=this.saveTextToParentTag(r,a,i,!1));const $=a;if($&&this.options.unpairedTags.indexOf($.tagname)!==-1&&(a=this.tagsNodeStack.pop(),i=i.substring(0,i.lastIndexOf("."))),l!==s.tagname&&(i+=i?"."+l:l),this.isItStopNode(this.options.stopNodes,i,l)){let g="";if(d.length>0&&d.lastIndexOf("/")===d.length-1)n=o.closeIndex;else if(this.options.unpairedTags.indexOf(l)!==-1)n=o.closeIndex;else{const A=this.readStopNodeData(e,u,f+1);if(!A)throw new Error("Unexpected end of ".concat(u));n=A.i,g=A.tagContent}const N=new y(l);l!==d&&c&&(N[":@"]=this.buildAttributesMap(d,i,l)),g&&(g=this.parseTextData(g,l,i,!0,c,!0,!0)),i=i.substr(0,i.lastIndexOf(".")),N.add(this.options.textNodeName,g),this.addChild(a,N,i)}else{if(d.length>0&&d.lastIndexOf("/")===d.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),i=i.substr(0,i.length-1),d=l):d=d.substr(0,d.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const g=new y(l);l!==d&&c&&(g[":@"]=this.buildAttributesMap(d,i,l)),this.addChild(a,g,i),i=i.substr(0,i.lastIndexOf("."))}else{const g=new y(l);this.tagsNodeStack.push(a),l!==d&&c&&(g[":@"]=this.buildAttributesMap(d,i,l)),this.addChild(a,g,i),a=g}r="",n=f}}else r+=e[n];return s.child};function Ge(e,s,a){const r=this.options.updateTag(s.tagname,a,s[":@"]);r===!1||(typeof r=="string"&&(s.tagname=r),e.addChild(s))}const Ie=function(e){if(this.options.processEntities){for(let s in this.docTypeEntities){const a=this.docTypeEntities[s];e=e.replace(a.regx,a.val)}for(let s in this.lastEntities){const a=this.lastEntities[s];e=e.replace(a.regex,a.val)}if(this.options.htmlEntities)for(let s in this.htmlEntities){const a=this.htmlEntities[s];e=e.replace(a.regex,a.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function De(e,s,a,r){return e&&(r===void 0&&(r=Object.keys(s.child).length===0),e=this.parseTextData(e,s.tagname,a,!1,s[":@"]?Object.keys(s[":@"]).length!==0:!1,r),e!==void 0&&e!==""&&s.add(this.options.textNodeName,e),e=""),e}function Te(e,s,a){const r="*."+a;for(const i in e){const n=e[i];if(r===n||s===n)return!0}return!1}function Pe(e,s,a=">"){let r,i="";for(let n=s;n<e.length;n++){let o=e[n];if(r)o===r&&(r="");else if(o==='"'||o==="'")r=o;else if(o===a[0])if(a[1]){if(e[n+1]===a[1])return{data:i,index:n}}else return{data:i,index:n};else o==="	"&&(o=" ");i+=o}}function m(e,s,a,r){const i=e.indexOf(s,a);if(i===-1)throw new Error(r);return i+s.length-1}function L(e,s,a,r=">"){const i=Pe(e,s+1,r);if(!i)return;let n=i.data;const o=i.index,l=n.search(/\s/);let u=n,d=!0;l!==-1&&(u=n.substring(0,l),n=n.substring(l+1).trimStart());const c=u;if(a){const f=u.indexOf(":");f!==-1&&(u=u.substr(f+1),d=u!==i.data.substr(f+1))}return{tagName:u,tagExp:n,closeIndex:o,attrExpPresent:d,rawTagName:c}}function Me(e,s,a){const r=a;let i=1;for(;a<e.length;a++)if(e[a]==="<")if(e[a+1]==="/"){const n=m(e,">",a,"".concat(s," is not closed"));if(e.substring(a+2,n).trim()===s&&(i--,i===0))return{tagContent:e.substring(r,a),i:n};a=n}else if(e[a+1]==="?")a=m(e,"?>",a+1,"StopNode is not closed.");else if(e.substr(a+1,3)==="!--")a=m(e,"-->",a+3,"StopNode is not closed.");else if(e.substr(a+1,2)==="![")a=m(e,"]]>",a,"StopNode is not closed.")-2;else{const n=L(e,a,">");n&&((n&&n.tagName)===s&&n.tagExp[n.tagExp.length-1]!=="/"&&i++,a=n.closeIndex)}}function O(e,s,a){if(s&&typeof e=="string"){const r=e.trim();return r==="true"?!0:r==="false"?!1:Ne(e,a)}else return j.isExist(e)?e:""}var ke=Ae;const{buildOptions:Fe}=de,ze=ke,{prettify:Qe}=ue,Be=z;let je=class{constructor(e){this.externalEntities={},this.options=Fe(e)}parse(e,s){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(s){s===!0&&(s={});const i=Be.validate(e,s);if(i!==!0)throw Error("".concat(i.err.msg,":").concat(i.err.line,":").concat(i.err.col))}const a=new ze(this.options);a.addExternalEntities(this.externalEntities);const r=a.parseXml(e);return this.options.preserveOrder||r===void 0?r:Qe(r,this.options)}addEntity(e,s){if(s.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(s==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=s}};var He=je;const Ve=z,Re=He,We=ce;var I={XMLParser:Re,XMLValidator:Ve,XMLBuilder:We};x.directive("elementVisibility",H);const S=3,Xe=x.extend({name:"VirtualList",props:{dataComponent:{type:[Object,Function],required:!0},dataKey:{type:String,required:!0},dataSources:{type:Array,required:!0},itemHeight:{type:Number,required:!0},extraProps:{type:Object,default:()=>({})}},data(){return{bufferItems:S,index:0,headerHeight:0,tableHeight:0,resizeObserver:null}},computed:{startIndex(){return Math.max(0,this.index-S)},shownItems(){return Math.ceil((this.tableHeight-this.headerHeight)/this.itemHeight)+S*2},renderedItems(){return this.dataSources.slice(this.startIndex,this.startIndex+this.shownItems)},tbodyStyle(){const e=this.startIndex+this.shownItems>this.dataSources.length,s=this.dataSources.length-this.startIndex-this.shownItems,a=Math.min(this.dataSources.length-this.startIndex,s);return{paddingTop:"".concat(this.startIndex*this.itemHeight,"px"),paddingBottom:e?0:"".concat(a*this.itemHeight,"px")}}},mounted(){var e,s;const a=this.$el,r=(e=this.$refs)==null?void 0:e.tfoot,i=(s=this.$refs)==null?void 0:s.thead;this.resizeObserver=new ResizeObserver(oe.debounce(()=>{var n,o;this.headerHeight=(n=i==null?void 0:i.clientHeight)!=null?n:0,this.tableHeight=(o=a==null?void 0:a.clientHeight)!=null?o:0,C.debug("VirtualList resizeObserver updated"),this.onScroll()},100,!1)),this.resizeObserver.observe(a),this.resizeObserver.observe(r),this.resizeObserver.observe(i),this.$el.addEventListener("scroll",this.onScroll)},beforeDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()},methods:{handleFooterVisibility(e){e&&this.$emit("scroll-end")},onScroll(){this.index=Math.max(0,Math.round(this.$el.scrollTop/this.itemHeight))}}});var Ye=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("table",{staticClass:"user-list"},[e._t("before"),s("thead",{ref:"thead",staticClass:"user-list__header",attrs:{role:"rowgroup"}},[e._t("header")],2),s("tbody",{staticClass:"user-list__body",style:e.tbodyStyle},e._l(e.renderedItems,function(a,r){return s(e.dataComponent,e._b({key:a[e.dataKey],tag:"component",attrs:{user:a,visible:(r>=e.bufferItems||e.index<=e.bufferItems)&&r<e.shownItems-e.bufferItems}},"component",e.extraProps,!1))}),1),s("tfoot",{directives:[{name:"element-visibility",rawName:"v-element-visibility",value:e.handleFooterVisibility,expression:"handleFooterVisibility"}],ref:"tfoot",staticClass:"user-list__footer",attrs:{role:"rowgroup"}},[e._t("footer")],2)],2)},Ke=[],Ze=p(Xe,Ye,Ke,!1,null,"1efaf525");const Je=Ze.exports,et={name:"NewUserDialog",components:{NcButton:V,NcDialog:R,NcPasswordField:W,NcSelect:T,NcTextField:P},props:{loading:{type:Object,required:!0},newUser:{type:Object,required:!0},quotaOptions:{type:Array,required:!0}},data(){return{possibleManagers:[],managerInputLabel:t("settings","Manager"),managerLabel:t("settings","Set account manager")}},computed:{showConfig(){return this.$store.getters.getShowConfig},settings(){return this.$store.getters.getServerData},usernameLabel(){return this.settings.newUserGenerateUserID?t("settings","Account name will be autogenerated"):t("settings","Account name (required)")},minPasswordLength(){return this.$store.getters.getPasswordPolicyMinLength},groups(){return this.$store.getters.getGroups.filter(e=>e.id!=="disabled").sort((e,s)=>e.name.localeCompare(s.name))},subAdminsGroups(){return this.$store.getters.getSubadminGroups},canAddGroups(){return this.groups.map(e=>(e=Object.assign({},e),e.$isDisabled=e.canAdd===!1,e))},languages(){return[{name:t("settings","Common languages"),languages:this.settings.languages.commonLanguages},...this.settings.languages.commonLanguages,{name:t("settings","Other languages"),languages:this.settings.languages.otherLanguages},...this.settings.languages.otherLanguages]}},async beforeMount(){await this.searchUserManager()},mounted(){var e,s;(s=(e=this.$refs.username)==null?void 0:e.focus)==null||s.call(e)},methods:{async createUser(){var e,s,a,r,i,n;this.loading.all=!0;try{await this.$store.dispatch("addUser",{userid:this.newUser.id,password:this.newUser.password,displayName:this.newUser.displayName,email:this.newUser.mailAddress,groups:this.newUser.groups.map(o=>o.id),subadmin:this.newUser.subAdminsGroups.map(o=>o.id),quota:this.newUser.quota.id,language:this.newUser.language.code,manager:this.newUser.manager.id}),this.$emit("reset"),(s=(e=this.$refs.username)==null?void 0:e.focus)==null||s.call(e),this.$emit("closing")}catch(o){if(this.loading.all=!1,o.response&&o.response.data&&o.response.data.ocs&&o.response.data.ocs.meta){const l=o.response.data.ocs.meta.statuscode;l===102?(r=(a=this.$refs.username)==null?void 0:a.focus)==null||r.call(a):l===107&&((n=(i=this.$refs.password)==null?void 0:i.focus)==null||n.call(i))}}},handleGroupInput(e){this.newUser.groups=e.filter(s=>!!s.id)},async createGroup({name:e}){this.loading.groups=!0;try{await this.$store.dispatch("addGroup",e),this.newUser.groups.push(this.groups.find(s=>s.id===e)),this.loading.groups=!1}catch{this.loading.groups=!1}},validateQuota(e){const s=OC.Util.computerFileSize(e);return s!==null&&s>=0?(e=OC.Util.humanFileSize(OC.Util.computerFileSize(e)),this.newUser.quota={id:e,label:e},this.newUser.quota):(this.newUser.quota=this.quotaOptions[0],this.quotaOptions[0])},languageFilterBy(e,s,a){return e.languages?e.languages.some(({name:r})=>r.toLocaleLowerCase().includes(a.toLocaleLowerCase())):(s||"").toLocaleLowerCase().includes(a.toLocaleLowerCase())},async searchUserManager(e){await this.$store.dispatch("searchUsers",{offset:0,limit:10,search:e}).then(s=>{const a=s!=null&&s.data?Object.values(s==null?void 0:s.data.ocs.data.users):[];a.length>0&&(this.possibleManagers=a)})}}};var tt=function(){var e=this,s=e._self._c;return s("NcDialog",e._g({staticClass:"dialog",attrs:{size:"small",name:e.t("settings","New account"),"out-transition":""},scopedSlots:e._u([{key:"actions",fn:function(){return[s("NcButton",{staticClass:"dialog__submit",attrs:{"data-test":"submit",form:"new-user-form",type:"primary","native-type":"submit"}},[e._v(" "+e._s(e.t("settings","Add new account"))+" ")])]},proxy:!0}])},e.$listeners),[s("form",{staticClass:"dialog__form",attrs:{id:"new-user-form","data-test":"form",disabled:e.loading.all},on:{submit:function(a){return a.preventDefault(),e.createUser.apply(null,arguments)}}},[s("NcTextField",{ref:"username",staticClass:"dialog__item",attrs:{"data-test":"username",value:e.newUser.id,disabled:e.settings.newUserGenerateUserID,label:e.usernameLabel,autocapitalize:"none",autocomplete:"off",spellcheck:"false",pattern:"[a-zA-Z0-9 _\\.@\\-']+",required:""},on:{"update:value":function(a){return e.$set(e.newUser,"id",a)}}}),s("NcTextField",{staticClass:"dialog__item",attrs:{"data-test":"displayName",value:e.newUser.displayName,label:e.t("settings","Display name"),autocapitalize:"none",autocomplete:"off",spellcheck:"false"},on:{"update:value":function(a){return e.$set(e.newUser,"displayName",a)}}}),e.settings.newUserRequireEmail?e._e():s("span",{staticClass:"dialog__hint",attrs:{id:"password-email-hint"}},[e._v(" "+e._s(e.t("settings","Either password or email is required"))+" ")]),s("NcPasswordField",{ref:"password",staticClass:"dialog__item",attrs:{"data-test":"password",value:e.newUser.password,minlength:e.minPasswordLength,maxlength:469,"aria-describedby":"password-email-hint",label:e.newUser.mailAddress===""?e.t("settings","Password (required)"):e.t("settings","Password"),autocapitalize:"none",autocomplete:"new-password",spellcheck:"false",required:e.newUser.mailAddress===""},on:{"update:value":function(a){return e.$set(e.newUser,"password",a)}}}),s("NcTextField",{staticClass:"dialog__item",attrs:{"data-test":"email",type:"email",value:e.newUser.mailAddress,"aria-describedby":"password-email-hint",label:e.newUser.password===""||e.settings.newUserRequireEmail?e.t("settings","Email (required)"):e.t("settings","Email"),autocapitalize:"none",autocomplete:"off",spellcheck:"false",required:e.newUser.password===""||e.settings.newUserRequireEmail},on:{"update:value":function(a){return e.$set(e.newUser,"mailAddress",a)}}}),s("div",{staticClass:"dialog__item"},[s("NcSelect",{staticClass:"dialog__select",attrs:{"input-label":e.settings.isAdmin?e.t("settings","Groups"):e.t("settings","Groups (required)"),placeholder:e.t("settings","Set account groups"),disabled:e.loading.groups||e.loading.all,options:e.canAddGroups,value:e.newUser.groups,label:"name","close-on-select":!1,multiple:!0,taggable:!0,required:!e.settings.isAdmin},on:{input:e.handleGroupInput,"option:created":e.createGroup}})],1),e.subAdminsGroups.length>0?s("div",{staticClass:"dialog__item"},[s("NcSelect",{staticClass:"dialog__select",attrs:{"input-label":e.t("settings","Administered groups"),placeholder:e.t("settings","Set account as admin for …"),options:e.subAdminsGroups,"close-on-select":!1,multiple:!0,label:"name"},model:{value:e.newUser.subAdminsGroups,callback:function(a){e.$set(e.newUser,"subAdminsGroups",a)},expression:"newUser.subAdminsGroups"}})],1):e._e(),s("div",{staticClass:"dialog__item"},[s("NcSelect",{staticClass:"dialog__select",attrs:{"input-label":e.t("settings","Quota"),placeholder:e.t("settings","Set account quota"),options:e.quotaOptions,clearable:!1,taggable:!0,"create-option":e.validateQuota},model:{value:e.newUser.quota,callback:function(a){e.$set(e.newUser,"quota",a)},expression:"newUser.quota"}})],1),e.showConfig.showLanguages?s("div",{staticClass:"dialog__item"},[s("NcSelect",{staticClass:"dialog__select",attrs:{"input-label":e.t("settings","Language"),placeholder:e.t("settings","Set default language"),clearable:!1,selectable:a=>!a.languages,"filter-by":e.languageFilterBy,options:e.languages,label:"name"},model:{value:e.newUser.language,callback:function(a){e.$set(e.newUser,"language",a)},expression:"newUser.language"}})],1):e._e(),s("div",{class:["dialog__item dialog__managers",{"icon-loading-small":e.loading.manager}]},[s("NcSelect",{staticClass:"dialog__select",attrs:{"input-label":e.managerInputLabel,placeholder:e.managerLabel,options:e.possibleManagers,"user-select":!0,label:"displayname"},on:{search:e.searchUserManager},model:{value:e.newUser.manager,callback:function(a){e.$set(e.newUser,"manager",a)},expression:"newUser.manager"}})],1)],1)])},st=[],at=p(et,tt,st,!1,null,"04f6f32a");const it=at.exports,rt=x.extend({name:"UserListFooter",components:{NcLoadingIcon:q},props:{loading:{type:Boolean,required:!0},filteredUsers:{type:Array,required:!0}},computed:{userCount(){return this.loading?this.n("settings","{userCount} account …","{userCount} accounts …",this.filteredUsers.length,{userCount:this.filteredUsers.length}):this.n("settings","{userCount} account","{userCount} accounts",this.filteredUsers.length,{userCount:this.filteredUsers.length})}},methods:{t:h,n:X}});var nt=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("tr",{staticClass:"footer"},[s("th",{attrs:{scope:"row"}},[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Total rows summary")))])]),s("td",{staticClass:"footer__cell footer__cell--loading"},[e.loading?s("NcLoadingIcon",{attrs:{title:e.t("settings","Loading accounts …"),size:32}}):e._e()],1),s("td",{staticClass:"footer__cell footer__cell--count footer__cell--multiline"},[s("span",{attrs:{"aria-describedby":"user-count-desc"}},[e._v(e._s(e.userCount))]),s("span",{staticClass:"hidden-visually",attrs:{id:"user-count-desc"}},[e._v(" "+e._s(e.t("settings","Scroll to load more rows"))+" ")])])])},ot=[],lt=p(rt,nt,ot,!1,null,"01acea8d");const dt=lt.exports,ut=x.extend({name:"UserListHeader",props:{hasObfuscated:{type:Boolean,required:!0}},computed:{showConfig(){return this.$store.getters.getShowConfig},settings(){return this.$store.getters.getServerData},subAdminsGroups(){return this.$store.getters.getSubadminGroups},passwordLabel(){return this.hasObfuscated?h("settings","Password or insufficient permissions message"):h("settings","Password")}},methods:{t:h}});var ct=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("tr",{staticClass:"header"},[s("th",{staticClass:"header__cell header__cell--avatar",attrs:{"data-cy-user-list-header-avatar":"",scope:"col"}},[s("span",{staticClass:"hidden-visually"},[e._v(" "+e._s(e.t("settings","Avatar"))+" ")])]),s("th",{staticClass:"header__cell header__cell--displayname",attrs:{"data-cy-user-list-header-displayname":"",scope:"col"}},[s("strong",[e._v(" "+e._s(e.t("settings","Display name"))+" ")])]),s("th",{staticClass:"header__cell header__cell--username",attrs:{"data-cy-user-list-header-username":"",scope:"col"}},[s("span",[e._v(" "+e._s(e.t("settings","Account name"))+" ")])]),s("th",{staticClass:"header__cell",class:{"header__cell--obfuscated":e.hasObfuscated},attrs:{"data-cy-user-list-header-password":"",scope:"col"}},[s("span",[e._v(e._s(e.passwordLabel))])]),s("th",{staticClass:"header__cell",attrs:{"data-cy-user-list-header-email":"",scope:"col"}},[s("span",[e._v(e._s(e.t("settings","Email")))])]),s("th",{staticClass:"header__cell header__cell--large",attrs:{"data-cy-user-list-header-groups":"",scope:"col"}},[s("span",[e._v(e._s(e.t("settings","Groups")))])]),e.subAdminsGroups.length>0&&e.settings.isAdmin?s("th",{staticClass:"header__cell header__cell--large",attrs:{"data-cy-user-list-header-subadmins":"",scope:"col"}},[s("span",[e._v(e._s(e.t("settings","Group admin for")))])]):e._e(),s("th",{staticClass:"header__cell",attrs:{"data-cy-user-list-header-quota":"",scope:"col"}},[s("span",[e._v(e._s(e.t("settings","Quota")))])]),e.showConfig.showLanguages?s("th",{staticClass:"header__cell header__cell--large",attrs:{"data-cy-user-list-header-languages":"",scope:"col"}},[s("span",[e._v(e._s(e.t("settings","Language")))])]):e._e(),e.showConfig.showUserBackend||e.showConfig.showStoragePath?s("th",{staticClass:"header__cell header__cell--large",attrs:{"data-cy-user-list-header-storage-location":"",scope:"col"}},[e.showConfig.showUserBackend?s("span",[e._v(" "+e._s(e.t("settings","Account backend"))+" ")]):e._e(),e.showConfig.showStoragePath?s("span",{staticClass:"header__subtitle"},[e._v(" "+e._s(e.t("settings","Storage location"))+" ")]):e._e()]):e._e(),e.showConfig.showLastLogin?s("th",{staticClass:"header__cell",attrs:{"data-cy-user-list-header-last-login":"",scope:"col"}},[s("span",[e._v(e._s(e.t("settings","Last login")))])]):e._e(),s("th",{staticClass:"header__cell header__cell--large header__cell--fill",attrs:{"data-cy-user-list-header-manager":"",scope:"col"}},[s("span",[e._v(e._s(e.t("settings","Manager")))])]),s("th",{staticClass:"header__cell header__cell--actions",attrs:{"data-cy-user-list-header-actions":"",scope:"col"}},[s("span",{staticClass:"hidden-visually"},[e._v(" "+e._s(e.t("settings","Account actions"))+" ")])])])},gt=[],ht=p(ut,ct,gt,!1,null,"768a9bf9");const pt=ht.exports;function mt(e){if(typeof e!="string")throw new TypeError("Expected a `string`, got `".concat(typeof e,"`"));if(e=e.trim(),e.length===0||I.XMLValidator.validate(e)!==!0)return!1;let s;const a=new I.XMLParser;try{s=a.parse(e)}catch{return!1}return!(!s||!Object.keys(s).some(r=>r.toLowerCase()==="svg"))}const ft=M({components:{NcActionButton:Y,NcActions:K,NcIconSvgWrapper:k},props:{actions:{type:Array,required:!0},disabled:{type:Boolean,required:!0},edit:{type:Boolean,required:!0},user:{type:Object,required:!0}},computed:{editSvg(){return this.edit?ie:re},enabledActions(){return this.actions.filter(e=>typeof e.enabled=="function"?e.enabled(this.user):!0)}},methods:{isSvg:mt,toggleEdit(){this.$emit("update:edit",!this.edit)}}});var bt=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("NcActions",{attrs:{"aria-label":e.t("settings","Toggle account actions menu"),disabled:e.disabled,inline:1}},[s("NcActionButton",{attrs:{"data-cy-user-list-action-toggle-edit":"".concat(e.edit),disabled:e.disabled},on:{click:e.toggleEdit},scopedSlots:e._u([{key:"icon",fn:function(){return[s("NcIconSvgWrapper",{key:e.editSvg,attrs:{svg:e.editSvg,"aria-hidden":"true"}})]},proxy:!0}])},[e._v(" "+e._s(e.edit?e.t("settings","Done"):e.t("settings","Edit"))+" ")]),e._l(e.enabledActions,function({action:a,icon:r,text:i},n){return s("NcActionButton",{key:n,attrs:{disabled:e.disabled,"aria-label":i,icon:r,"close-after-click":""},on:{click:o=>a(o,{...e.user})},scopedSlots:e._u([e.isSvg(r)?{key:"icon",fn:function(){return[s("NcIconSvgWrapper",{attrs:{svg:r,"aria-hidden":"true"}})]},proxy:!0}:null],null,!0)},[e._v(" "+e._s(i)+" ")])})],2)},wt=[],_t=p(ft,bt,wt,!1,null,null);const yt=_t.exports,vt={props:{user:{type:Object,required:!0},settings:{type:Object,default:()=>({})},groups:{type:Array,default:()=>[]},subAdminsGroups:{type:Array,default:()=>[]},quotaOptions:{type:Array,default:()=>[]},languages:{type:Array,required:!0},externalActions:{type:Array,default:()=>[]}},computed:{showConfig(){return this.$store.getters.getShowConfig},userGroups(){return this.groups.filter(e=>this.user.groups.includes(e.id))},userSubAdminsGroups(){return this.subAdminsGroups.filter(e=>this.user.subadmin.includes(e.id))},availableGroups(){return this.groups.map(e=>{const s=Object.assign({},e);return s.$isDisabled=e.canAdd===!1&&!this.user.groups.includes(e.id)||e.canRemove===!1&&this.user.groups.includes(e.id),s})},usedSpace(){return this.user.quota.used?t("settings","{size} used",{size:OC.Util.humanFileSize(this.user.quota.used)}):t("settings","{size} used",{size:OC.Util.humanFileSize(0)})},usedQuota(){let e=this.user.quota.quota;return e>0?e=Math.min(100,Math.round(this.user.quota.used/e*100)):e=95*(1-1/(this.user.quota.used/(10*Math.pow(2,30))+1)),isNaN(e)?0:e},userQuota(){if(this.user.quota.quota>=0){const e=OC.Util.humanFileSize(this.user.quota.quota);return this.quotaOptions.find(s=>s.id===e)||{id:e,label:e}}else if(this.user.quota.quota==="default")return this.quotaOptions[0];return this.quotaOptions[1]},minPasswordLength(){return this.$store.getters.getPasswordPolicyMinLength},userLanguage(){const e=this.languages[0].languages.concat(this.languages[1].languages).find(s=>s.code===this.user.language);return typeof e!="object"&&this.user.language!==""?{code:this.user.language,name:this.user.language}:this.user.language===""?!1:e},userLastLoginTooltip(){return this.user.lastLogin>0?OC.Util.formatDate(this.user.lastLogin):""},userLastLogin(){return this.user.lastLogin>0?OC.Util.relativeModifiedDate(this.user.lastLogin):t("settings","Never")}}},xt={name:"UserRow",components:{NcAvatar:Z,NcLoadingIcon:q,NcProgressBar:J,NcSelect:T,NcTextField:P,UserRowActions:yt},mixins:[vt],props:{user:{type:Object,required:!0},visible:{type:Boolean,required:!0},users:{type:Array,required:!0},hasObfuscated:{type:Boolean,required:!0},groups:{type:Array,default:()=>[]},subAdminsGroups:{type:Array,required:!0},quotaOptions:{type:Array,required:!0},languages:{type:Array,required:!0},settings:{type:Object,required:!0},externalActions:{type:Array,default:()=>[]}},data(){var e;return{selectedQuota:!1,rand:Math.random().toString(36).substring(2),loadingPossibleManagers:!1,possibleManagers:[],currentManager:"",editing:!1,loading:{all:!1,displayName:!1,password:!1,mailAddress:!1,groups:!1,subadmins:!1,quota:!1,delete:!1,disable:!1,languages:!1,wipe:!1,manager:!1},editedDisplayName:this.user.displayname,editedPassword:"",editedMail:(e=this.user.email)!=null?e:""}},computed:{managerLabel(){return t("settings","Set line manager")},isObfuscated(){return Q(this.user)},showConfig(){return this.$store.getters.getShowConfig},isLoadingUser(){return this.loading.delete||this.loading.disable||this.loading.wipe},isLoadingField(){return this.loading.delete||this.loading.disable||this.loading.all},uniqueId(){return encodeURIComponent(this.user.id+this.rand)},userGroupsLabels(){return this.userGroups.map(e=>e.name).join(", ")},userSubAdminsGroupsLabels(){return this.userSubAdminsGroups.map(e=>e.name).join(", ")},usedSpace(){var e,s;return(e=this.user.quota)!=null&&e.used?t("settings","{size} used",{size:w((s=this.user.quota)==null?void 0:s.used)}):t("settings","{size} used",{size:w(0)})},canEdit(){return ee().uid!==this.user.id||this.settings.isAdmin},userQuota(){var s;let e=(s=this.user.quota)==null?void 0:s.quota;return e==="default"&&(e=this.settings.defaultQuota,e!=="none"&&(e=_(e,!0))),e==="none"||e===-3?t("settings","Unlimited"):e>=0?w(e):w(0)},userActions(){const e=[{icon:"icon-delete",text:t("settings","Delete account"),action:this.deleteUser},{icon:"icon-delete",text:t("settings","Disconnect all devices and delete local data"),action:this.wipeUserDevices},{icon:this.user.enabled?"icon-close":"icon-add",text:this.user.enabled?t("settings","Disable account"):t("settings","Enable account"),action:this.enableDisableUser}];return this.user.email!==null&&this.user.email!==""&&e.push({icon:"icon-mail",text:t("settings","Resend welcome email"),action:this.sendWelcomeMail}),e.concat(this.externalActions)},editedUserQuota:{get(){return this.selectedQuota!==!1?this.selectedQuota:this.settings.defaultQuota!==v.id&&_(this.settings.defaultQuota,!0)>=0?{id:this.settings.defaultQuota,label:this.settings.defaultQuota}:v},set(e){this.selectedQuota=e}},availableLanguages(){return this.languages[0].languages.concat(this.languages[1].languages)}},async beforeMount(){this.user.manager&&await this.initManager(this.user.manager)},methods:{wipeUserDevices(){const e=this.user.id;OC.dialogs.confirmDestructive(t("settings","In case of lost device or exiting the organization, this can remotely wipe the Nextcloud data from all devices associated with {userid}. Only works if the devices are connected to the internet.",{userid:e}),t("settings","Remote wipe of devices"),{type:OC.dialogs.YES_NO_BUTTONS,confirm:t("settings","Wipe {userid}'s devices",{userid:e}),confirmClasses:"error",cancel:t("settings","Cancel")},s=>{s&&(this.loading.wipe=!0,this.loading.all=!0,this.$store.dispatch("wipeUserDevices",e).then(()=>b(t("settings","Wiped {userid}'s devices",{userid:e})),{timeout:2e3}).finally(()=>{this.loading.wipe=!1,this.loading.all=!1}))},!0)},filterManagers(e){return e.filter(s=>s.id!==this.user.id)},async initManager(e){await this.$store.dispatch("getUser",e).then(s=>{this.currentManager=s==null?void 0:s.data.ocs.data})},async searchInitialUserManager(){this.loadingPossibleManagers=!0,await this.searchUserManager(),this.loadingPossibleManagers=!1},async searchUserManager(e){await this.$store.dispatch("searchUsers",{offset:0,limit:10,search:e}).then(s=>{const a=s!=null&&s.data?this.filterManagers(Object.values(s==null?void 0:s.data.ocs.data.users)):[];a.length>0&&(this.possibleManagers=a)})},async updateUserManager(e){e===null&&(this.currentManager=""),this.loading.manager=!0;try{await this.$store.dispatch("setUserData",{userid:this.user.id,key:"manager",value:this.currentManager?this.currentManager.id:""})}catch(s){U(t("setting","Failed to update line manager")),console.error(s)}finally{this.loading.manager=!1}},deleteUser(){const e=this.user.id;OC.dialogs.confirmDestructive(t("settings","Fully delete {userid}'s account including all their personal files, app data, etc.",{userid:e}),t("settings","Account deletion"),{type:OC.dialogs.YES_NO_BUTTONS,confirm:t("settings","Delete {userid}'s account",{userid:e}),confirmClasses:"error",cancel:t("settings","Cancel")},s=>{if(s)return this.loading.delete=!0,this.loading.all=!0,this.$store.dispatch("deleteUser",e).then(()=>{this.loading.delete=!1,this.loading.all=!1})},!0)},enableDisableUser(){this.loading.delete=!0,this.loading.all=!0;const e=this.user.id,s=!this.user.enabled;return this.$store.dispatch("enableDisableUser",{userid:e,enabled:s}).then(()=>{this.loading.delete=!1,this.loading.all=!1})},updateDisplayName(){this.loading.displayName=!0,this.$store.dispatch("setUserData",{userid:this.user.id,key:"displayname",value:this.editedDisplayName}).then(()=>{this.loading.displayName=!1,this.editedDisplayName===this.user.displayname&&b(t("setting","Display name was successfully changed"))})},updatePassword(){this.loading.password=!0,this.editedPassword.length===0?(U(t("setting","Password can't be empty")),this.loading.password=!1):this.$store.dispatch("setUserData",{userid:this.user.id,key:"password",value:this.editedPassword}).then(()=>{this.loading.password=!1,this.editedPassword="",b(t("setting","Password was successfully changed"))})},updateEmail(){this.loading.mailAddress=!0,this.editedMail===""?(U(t("setting","Email can't be empty")),this.loading.mailAddress=!1,this.editedMail=this.user.email):this.$store.dispatch("setUserData",{userid:this.user.id,key:"email",value:this.editedMail}).then(()=>{this.loading.mailAddress=!1,this.editedMail===this.user.email&&b(t("setting","Email was successfully changed"))})},async createGroup({name:e}){this.loading={groups:!0,subadmins:!0};try{await this.$store.dispatch("addGroup",e);const s=this.user.id;await this.$store.dispatch("addUserGroup",{userid:s,gid:e})}catch(s){console.error(s)}finally{this.loading={groups:!1,subadmins:!1}}return this.$store.getters.getGroups[this.groups.length]},async addUserGroup(e){if(e.isCreating)return;this.loading.groups=!0;const s=this.user.id,a=e.id;if(e.canAdd===!1)return!1;try{await this.$store.dispatch("addUserGroup",{userid:s,gid:a})}catch(r){console.error(r)}finally{this.loading.groups=!1}},async removeUserGroup(e){if(e.canRemove===!1)return!1;this.loading.groups=!0;const s=this.user.id,a=e.id;try{await this.$store.dispatch("removeUserGroup",{userid:s,gid:a}),this.loading.groups=!1,this.$route.params.selectedGroup===a&&this.$store.commit("deleteUser",s)}catch{this.loading.groups=!1}},async addUserSubAdmin(e){this.loading.subadmins=!0;const s=this.user.id,a=e.id;try{await this.$store.dispatch("addUserSubAdmin",{userid:s,gid:a}),this.loading.subadmins=!1}catch(r){console.error(r)}},async removeUserSubAdmin(e){this.loading.subadmins=!0;const s=this.user.id,a=e.id;try{await this.$store.dispatch("removeUserSubAdmin",{userid:s,gid:a})}catch(r){console.error(r)}finally{this.loading.subadmins=!1}},async setUserQuota(e="none"){e==="none"&&(e=v),this.loading.quota=!0,e=e.id?e.id:e;try{const s=(_(e,!0)||e).toString();await this.$store.dispatch("setUserData",{userid:this.user.id,key:"quota",value:s})}catch(s){console.error(s)}finally{this.loading.quota=!1}return e},validateQuota(e){return typeof e=="object"&&(e=(e==null?void 0:e.id)||e.label),_(e,!0)===null?v:(e=w(_(e,!0)),{id:e,label:e})},async setUserLanguage(e){this.loading.languages=!0;try{await this.$store.dispatch("setUserData",{userid:this.user.id,key:"language",value:e.code}),this.loading.languages=!1}catch(s){console.error(s)}return e},sendWelcomeMail(){this.loading.all=!0,this.$store.dispatch("sendWelcomeMail",this.user.id).then(()=>b(t("setting","Welcome mail sent!"),{timeout:2e3})).finally(()=>{this.loading.all=!1})},async toggleEdit(){var e,s,a,r,i,n;this.editing=!this.editing,this.editing&&(await this.$nextTick(),(i=(r=(a=(s=(e=this.$refs.displayNameField)==null?void 0:e.$refs)==null?void 0:s.inputField)==null?void 0:a.$refs)==null?void 0:r.input)==null||i.focus()),this.editedDisplayName!==this.user.displayname?this.editedDisplayName=this.user.displayname:this.editedMail!==this.user.email&&(this.editedMail=(n=this.user.email)!=null?n:"")}}};var Ut=function(){var a,r,i,n;var e=this,s=e._self._c;return s("tr",{staticClass:"user-list__row",attrs:{"data-cy-user-row":e.user.id}},[s("td",{staticClass:"row__cell row__cell--avatar",attrs:{"data-cy-user-list-cell-avatar":""}},[e.isLoadingUser?s("NcLoadingIcon",{attrs:{name:e.t("settings","Loading account …"),size:32}}):e.visible?s("NcAvatar",{attrs:{"disable-menu":"","show-user-status":!1,user:e.user.id}}):e._e()],1),s("td",{staticClass:"row__cell row__cell--displayname",attrs:{"data-cy-user-list-cell-displayname":""}},[e.editing&&e.user.backendCapabilities.setDisplayName?[s("NcTextField",{ref:"displayNameField",staticClass:"user-row-text-field",class:{"icon-loading-small":e.loading.displayName},attrs:{"data-cy-user-list-input-displayname":"","data-loading":e.loading.displayName||void 0,"trailing-button-label":e.t("settings","Submit"),"show-trailing-button":!0,disabled:e.loading.displayName||e.isLoadingField,label:e.t("settings","Change display name"),"trailing-button-icon":"arrowRight",value:e.editedDisplayName,autocapitalize:"off",autocomplete:"off",spellcheck:"false"},on:{"update:value":function(o){e.editedDisplayName=o},"trailing-button-click":e.updateDisplayName}})]:e.isObfuscated?e._e():s("strong",{attrs:{title:((a=e.user.displayname)==null?void 0:a.length)>20?e.user.displayname:null}},[e._v(" "+e._s(e.user.displayname)+" ")])],2),s("td",{staticClass:"row__cell row__cell--username",attrs:{"data-cy-user-list-cell-username":""}},[s("span",{staticClass:"row__subtitle"},[e._v(e._s(e.user.id))])]),s("td",{staticClass:"row__cell",class:{"row__cell--obfuscated":e.hasObfuscated},attrs:{"data-cy-user-list-cell-password":""}},[e.editing&&e.settings.canChangePassword&&e.user.backendCapabilities.setPassword?[s("NcTextField",{staticClass:"user-row-text-field",class:{"icon-loading-small":e.loading.password},attrs:{"data-cy-user-list-input-password":"","data-loading":e.loading.password||void 0,"trailing-button-label":e.t("settings","Submit"),"show-trailing-button":!0,disabled:e.loading.password||e.isLoadingField,minlength:e.minPasswordLength,maxlength:"469",label:e.t("settings","Set new password"),"trailing-button-icon":"arrowRight",value:e.editedPassword,autocapitalize:"off",autocomplete:"new-password",required:"",spellcheck:"false",type:"password"},on:{"update:value":function(o){e.editedPassword=o},"trailing-button-click":e.updatePassword}})]:e.isObfuscated?s("span",[e._v(" "+e._s(e.t("settings","You do not have permissions to see the details of this account"))+" ")]):e._e()],2),s("td",{staticClass:"row__cell",attrs:{"data-cy-user-list-cell-email":""}},[e.editing?[s("NcTextField",{staticClass:"user-row-text-field",class:{"icon-loading-small":e.loading.mailAddress},attrs:{"data-cy-user-list-input-email":"","data-loading":e.loading.mailAddress||void 0,"show-trailing-button":!0,"trailing-button-label":e.t("settings","Submit"),label:e.t("settings","Set new email address"),disabled:e.loading.mailAddress||e.isLoadingField,"trailing-button-icon":"arrowRight",value:e.editedMail,autocapitalize:"off",autocomplete:"email",spellcheck:"false",type:"email"},on:{"update:value":function(o){e.editedMail=o},"trailing-button-click":e.updateEmail}})]:e.isObfuscated?e._e():s("span",{attrs:{title:((r=e.user.email)==null?void 0:r.length)>20?e.user.email:null}},[e._v(" "+e._s(e.user.email)+" ")])],2),s("td",{staticClass:"row__cell row__cell--large row__cell--multiline",attrs:{"data-cy-user-list-cell-groups":""}},[e.editing?[s("label",{staticClass:"hidden-visually",attrs:{for:"groups"+e.uniqueId}},[e._v(" "+e._s(e.t("settings","Add account to group"))+" ")]),s("NcSelect",{attrs:{"data-cy-user-list-input-groups":"","data-loading":e.loading.groups||void 0,"input-id":"groups"+e.uniqueId,"close-on-select":!1,disabled:e.isLoadingField,loading:e.loading.groups,multiple:!0,"append-to-body":!1,options:e.availableGroups,placeholder:e.t("settings","Add account to group"),taggable:e.settings.isAdmin,value:e.userGroups,label:"name","no-wrap":!0,"create-option":o=>({name:o,isCreating:!0})},on:{"option:created":e.createGroup,"option:selected":o=>e.addUserGroup(o.at(-1)),"option:deselected":e.removeUserGroup}})]:e.isObfuscated?e._e():s("span",{attrs:{title:((i=e.userGroupsLabels)==null?void 0:i.length)>40?e.userGroupsLabels:null}},[e._v(" "+e._s(e.userGroupsLabels)+" ")])],2),e.subAdminsGroups.length>0&&e.settings.isAdmin?s("td",{staticClass:"row__cell row__cell--large row__cell--multiline",attrs:{"data-cy-user-list-cell-subadmins":""}},[e.editing&&e.settings.isAdmin&&e.subAdminsGroups.length>0?[s("label",{staticClass:"hidden-visually",attrs:{for:"subadmins"+e.uniqueId}},[e._v(" "+e._s(e.t("settings","Set account as admin for"))+" ")]),s("NcSelect",{attrs:{"data-cy-user-list-input-subadmins":"","data-loading":e.loading.subadmins||void 0,"input-id":"subadmins"+e.uniqueId,"close-on-select":!1,disabled:e.isLoadingField,loading:e.loading.subadmins,label:"name","append-to-body":!1,multiple:!0,"no-wrap":!0,options:e.subAdminsGroups,placeholder:e.t("settings","Set account as admin for"),value:e.userSubAdminsGroups},on:{"option:deselected":e.removeUserSubAdmin,"option:selected":o=>e.addUserSubAdmin(o.at(-1))}})]:e.isObfuscated?e._e():s("span",{attrs:{title:((n=e.userSubAdminsGroupsLabels)==null?void 0:n.length)>40?e.userSubAdminsGroupsLabels:null}},[e._v(" "+e._s(e.userSubAdminsGroupsLabels)+" ")])],2):e._e(),s("td",{staticClass:"row__cell",attrs:{"data-cy-user-list-cell-quota":""}},[e.editing?[s("label",{staticClass:"hidden-visually",attrs:{for:"quota"+e.uniqueId}},[e._v(" "+e._s(e.t("settings","Select account quota"))+" ")]),s("NcSelect",{attrs:{"close-on-select":!0,"create-option":e.validateQuota,"data-cy-user-list-input-quota":"","data-loading":e.loading.quota||void 0,disabled:e.isLoadingField,loading:e.loading.quota,"append-to-body":!1,clearable:!1,"input-id":"quota"+e.uniqueId,options:e.quotaOptions,placeholder:e.t("settings","Select account quota"),taggable:!0},on:{"option:selected":e.setUserQuota},model:{value:e.editedUserQuota,callback:function(o){e.editedUserQuota=o},expression:"editedUserQuota"}})]:e.isObfuscated?e._e():[s("span",{attrs:{id:"quota-progress"+e.uniqueId}},[e._v(e._s(e.userQuota)+" ("+e._s(e.usedSpace)+")")]),s("NcProgressBar",{staticClass:"row__progress",class:{"row__progress--warn":e.usedQuota>80},attrs:{"aria-labelledby":"quota-progress"+e.uniqueId,value:e.usedQuota}})]],2),e.showConfig.showLanguages?s("td",{staticClass:"row__cell row__cell--large",attrs:{"data-cy-user-list-cell-language":""}},[e.editing?[s("label",{staticClass:"hidden-visually",attrs:{for:"language"+e.uniqueId}},[e._v(" "+e._s(e.t("settings","Set the language"))+" ")]),s("NcSelect",{attrs:{id:"language"+e.uniqueId,"data-cy-user-list-input-language":"","data-loading":e.loading.languages||void 0,"allow-empty":!1,disabled:e.isLoadingField,loading:e.loading.languages,clearable:!1,"append-to-body":!1,options:e.availableLanguages,placeholder:e.t("settings","No language set"),value:e.userLanguage,label:"name"},on:{input:e.setUserLanguage}})]:e.isObfuscated?e._e():s("span",[e._v(" "+e._s(e.userLanguage.name)+" ")])],2):e._e(),e.showConfig.showUserBackend||e.showConfig.showStoragePath?s("td",{staticClass:"row__cell row__cell--large",attrs:{"data-cy-user-list-cell-storage-location":""}},[e.isObfuscated?e._e():[e.showConfig.showUserBackend?s("span",[e._v(e._s(e.user.backend))]):e._e(),e.showConfig.showStoragePath?s("span",{staticClass:"row__subtitle",attrs:{title:e.user.storageLocation}},[e._v(" "+e._s(e.user.storageLocation)+" ")]):e._e()]],2):e._e(),e.showConfig.showLastLogin?s("td",{staticClass:"row__cell",attrs:{title:e.userLastLoginTooltip,"data-cy-user-list-cell-last-login":""}},[e.isObfuscated?e._e():s("span",[e._v(e._s(e.userLastLogin))])]):e._e(),s("td",{staticClass:"row__cell row__cell--large row__cell--fill",attrs:{"data-cy-user-list-cell-manager":""}},[e.editing?[s("label",{staticClass:"hidden-visually",attrs:{for:"manager"+e.uniqueId}},[e._v(" "+e._s(e.managerLabel)+" ")]),s("NcSelect",{staticClass:"select--fill",attrs:{"data-cy-user-list-input-manager":"","data-loading":e.loading.manager||void 0,"input-id":"manager"+e.uniqueId,"close-on-select":!0,disabled:e.isLoadingField,"append-to-body":!1,loading:e.loadingPossibleManagers||e.loading.manager,label:"displayname",options:e.possibleManagers,placeholder:e.managerLabel},on:{open:e.searchInitialUserManager,search:e.searchUserManager,"option:selected":e.updateUserManager},model:{value:e.currentManager,callback:function(o){e.currentManager=o},expression:"currentManager"}})]:e.isObfuscated?e._e():s("span",[e._v(" "+e._s(e.user.manager)+" ")])],2),s("td",{staticClass:"row__cell row__cell--actions",attrs:{"data-cy-user-list-cell-actions":""}},[e.visible&&!e.isObfuscated&&e.canEdit&&!e.loading.all?s("UserRowActions",{attrs:{actions:e.userActions,disabled:e.isLoadingField,edit:e.editing,user:e.user},on:{"update:edit":e.toggleEdit}}):e._e()],1)])},Ct=[],Nt=p(xt,Ut,Ct,!1,null,"c927da90");const At=Nt.exports,D=Object.freeze({id:"",displayName:"",password:"",mailAddress:"",groups:[],manager:"",subAdminsGroups:[],quota:B,language:{code:"en",name:t("settings","Default language")}}),St={name:"UserList",components:{Fragment:te,NcEmptyContent:se,NcIconSvgWrapper:k,NcLoadingIcon:q,NewUserDialog:it,UserListFooter:dt,UserListHeader:pt,VirtualList:Je},props:{selectedGroup:{type:String,default:null},externalActions:{type:Array,default:()=>[]}},setup(){return{mdiAccountGroup:ne,rowHeight:55,UserRow:At}},data(){return{loading:{all:!1,groups:!1,users:!1},newUser:{...D},isInitialLoad:!0,searchQuery:""}},computed:{showConfig(){return this.$store.getters.getShowConfig},settings(){return this.$store.getters.getServerData},style(){return{"--row-height":"".concat(this.rowHeight,"px")}},hasObfuscated(){return this.filteredUsers.some(e=>Q(e))},users(){return this.$store.getters.getUsers},filteredUsers(){return this.selectedGroup==="disabled"?this.users.filter(e=>e.enabled===!1):this.settings.isAdmin?this.users.filter(e=>e.enabled!==!1):this.users.filter(e=>e.enabled!==!1)},groups(){return this.$store.getters.getGroups.filter(e=>e.id!=="disabled").sort((e,s)=>e.name.localeCompare(s.name))},subAdminsGroups(){return this.$store.getters.getSubadminGroups},quotaOptions(){const e=this.settings.quotaPreset.reduce((s,a)=>s.concat({id:a,label:a}),[]);return this.settings.allowUnlimitedQuota&&e.unshift(v),e.unshift(B),e},usersOffset(){return this.$store.getters.getUsersOffset},usersLimit(){return this.$store.getters.getUsersLimit},disabledUsersOffset(){return this.$store.getters.getDisabledUsersOffset},disabledUsersLimit(){return this.$store.getters.getDisabledUsersLimit},usersCount(){return this.users.length},languages(){return[{label:t("settings","Common languages"),languages:this.settings.languages.commonLanguages},{label:t("settings","Other languages"),languages:this.settings.languages.otherLanguages}]}},watch:{async selectedGroup(e){this.isInitialLoad=!0,await this.redirectIfDisabled(),this.$store.commit("resetUsers"),await this.loadUsers(),this.setNewUserDefaultGroup(e)},filteredUsers(e){C.debug("".concat(e.length," filtered user(s)"))}},async created(){await this.loadUsers()},async mounted(){this.settings.canChangePassword||OC.Notification.showTemporary(t("settings","Password change is disabled because the master key is disabled")),this.resetForm(),E("nextcloud:unified-search.search",this.search),E("nextcloud:unified-search.reset",this.resetSearch),await this.redirectIfDisabled()},beforeDestroy(){G("nextcloud:unified-search.search",this.search),G("nextcloud:unified-search.reset",this.resetSearch)},methods:{async handleScrollEnd(){await this.loadUsers()},async loadUsers(){this.loading.users=!0;try{this.selectedGroup==="disabled"?await this.$store.dispatch("getDisabledUsers",{offset:this.disabledUsersOffset,limit:this.disabledUsersLimit,search:this.searchQuery}):await this.$store.dispatch("getUsers",{offset:this.usersOffset,limit:this.usersLimit,group:this.selectedGroup,search:this.searchQuery}),C.debug("".concat(this.users.length," total user(s) loaded"))}catch(e){C.error("Failed to load accounts",{error:e}),U("Failed to load accounts")}this.loading.users=!1,this.isInitialLoad=!1},closeDialog(){this.$store.commit("setShowConfig",{key:"showNewUserForm",value:!1})},async search({query:e}){this.searchQuery=e,this.$store.commit("resetUsers"),await this.loadUsers()},resetSearch(){this.search({query:""})},resetForm(){this.newUser=Object.assign({},D),this.settings.defaultLanguage&&x.set(this.newUser.language,"code",this.settings.defaultLanguage),this.setNewUserDefaultGroup(this.selectedGroup),this.loading.all=!1},setNewUserDefaultGroup(e){if(e&&e.length>0){const s=this.groups.find(a=>a.id===e);if(s){this.newUser.groups=[s];return}}this.newUser.groups=[]},async redirectIfDisabled(){const e=this.$store.getters.getGroups;this.selectedGroup==="disabled"&&e.findIndex(s=>s.id==="disabled"&&s.usercount===0)>-1&&(this.$router.push({name:"users"}),await this.loadUsers())}}};var Lt=function(){var e=this,s=e._self._c;return s("Fragment",[e.showConfig.showNewUserForm?s("NewUserDialog",{attrs:{loading:e.loading,"new-user":e.newUser,"quota-options":e.quotaOptions},on:{reset:e.resetForm,closing:e.closeDialog}}):e._e(),e.filteredUsers.length===0?s("NcEmptyContent",{staticClass:"empty",attrs:{name:e.isInitialLoad&&e.loading.users?null:e.t("settings","No accounts")},scopedSlots:e._u([{key:"icon",fn:function(){return[e.isInitialLoad&&e.loading.users?s("NcLoadingIcon",{attrs:{name:e.t("settings","Loading accounts …"),size:64}}):s("NcIconSvgWrapper",{attrs:{path:e.mdiAccountGroup,size:64}})]},proxy:!0}],null,!1,226056511)}):s("VirtualList",{style:e.style,attrs:{"data-component":e.UserRow,"data-sources":e.filteredUsers,"data-key":"id","data-cy-user-list":"","item-height":e.rowHeight,"extra-props":{users:e.users,settings:e.settings,hasObfuscated:e.hasObfuscated,groups:e.groups,subAdminsGroups:e.subAdminsGroups,quotaOptions:e.quotaOptions,languages:e.languages,externalActions:e.externalActions}},on:{"scroll-end":e.handleScrollEnd},scopedSlots:e._u([{key:"before",fn:function(){return[s("caption",{staticClass:"hidden-visually"},[e._v(" "+e._s(e.t("settings","List of accounts. This list is not fully rendered for performance reasons. The accounts will be rendered as you navigate through the list."))+" ")])]},proxy:!0},{key:"header",fn:function(){return[s("UserListHeader",{attrs:{"has-obfuscated":e.hasObfuscated}})]},proxy:!0},{key:"footer",fn:function(){return[s("UserListFooter",{attrs:{loading:e.loading.users,"filtered-users":e.filteredUsers}})]},proxy:!0}])})],1)},Ot=[],qt=p(St,Lt,Ot,!1,null,"b37a6507");const $t=qt.exports,Et=M({name:"UserManagement",components:{NcAppContent:ae,UserList:$t},data(){return{externalActions:[]}},computed:{pageHeading(){var e;return this.selectedGroupDecoded===null?h("settings","Active accounts"):(e={admin:h("settings","Admins"),disabled:h("settings","Disabled accounts")}[this.selectedGroupDecoded])!=null?e:h("settings","Account group: {group}",{group:this.selectedGroupDecoded})},selectedGroup(){return this.$route.params.selectedGroup},selectedGroupDecoded(){return this.selectedGroup?decodeURIComponent(this.selectedGroup):null}},beforeMount(){this.$store.commit("initGroups",{groups:this.$store.getters.getServerData.groups,orderBy:this.$store.getters.getServerData.sortGroups,userCount:this.$store.getters.getServerData.userCount}),this.$store.dispatch("getPasswordPolicyMinLength")},created(){var e,s,a;window.OCA=(e=window.OCA)!=null?e:{},window.OCA.Settings=(s=window.OCA.Settings)!=null?s:{},window.OCA.Settings.UserList=(a=window.OCA.Settings.UserList)!=null?a:{},window.OCA.Settings.UserList.registerAction=this.registerAction},methods:{t:h,registerAction(e,s,a,r){return this.externalActions.push({icon:e,text:s,action:a,enabled:r}),this.externalActions}}});var Gt=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("NcAppContent",{attrs:{"page-heading":e.pageHeading}},[s("UserList",{attrs:{"selected-group":e.selectedGroupDecoded,"external-actions":e.externalActions}})],1)},It=[],Dt=p(Et,Gt,It,!1,null,"50a2c02c");const Wt=Dt.exports;export{Wt as default};
