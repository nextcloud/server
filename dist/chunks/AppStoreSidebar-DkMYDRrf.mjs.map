{"version":3,"file":"AppStoreSidebar-DkMYDRrf.mjs","sources":["../../apps/settings/src/components/Markdown.vue","../../apps/settings/src/components/AppStoreSidebar/AppDetailsTab.vue","../../apps/settings/src/components/AppStoreSidebar/AppReleasesTab.vue","../../apps/settings/src/composables/useAppIcon.ts","../../apps/settings/src/views/AppStoreSidebar.vue"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"settings-markdown\" v-html=\"renderMarkdown\" />\n</template>\n\n<script>\nimport { marked } from 'marked'\nimport dompurify from 'dompurify'\n\nexport default {\n\tname: 'Markdown',\n\tprops: {\n\t\ttext: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tminHeading: {\n\t\t\ttype: Number,\n\t\t\tdefault: 1,\n\t\t},\n\t},\n\tcomputed: {\n\t\trenderMarkdown() {\n\t\t\tconst renderer = new marked.Renderer()\n\t\t\trenderer.link = function(href, title, text) {\n\t\t\t\tlet prot\n\t\t\t\ttry {\n\t\t\t\t\tprot = decodeURIComponent(unescape(href))\n\t\t\t\t\t\t.replace(/[^\\w:]/g, '')\n\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\n\t\t\t\tif (prot.indexOf('http:') !== 0 && prot.indexOf('https:') !== 0) {\n\t\t\t\t\treturn ''\n\t\t\t\t}\n\n\t\t\t\tlet out = '<a href=\"' + href + '\" rel=\"noreferrer noopener\"'\n\t\t\t\tif (title) {\n\t\t\t\t\tout += ' title=\"' + title + '\"'\n\t\t\t\t}\n\t\t\t\tout += '>' + text + '</a>'\n\t\t\t\treturn out\n\t\t\t}\n\t\t\trenderer.heading = (text, level) => {\n\t\t\t\tlevel = Math.min(6, level + (this.minHeading - 1))\n\t\t\t\treturn `<h${level}>${text}</h${level}>`\n\t\t\t}\n\t\t\trenderer.image = function(href, title, text) {\n\t\t\t\tif (text) {\n\t\t\t\t\treturn text\n\t\t\t\t}\n\t\t\t\treturn title\n\t\t\t}\n\t\t\trenderer.blockquote = function(quote) {\n\t\t\t\treturn quote\n\t\t\t}\n\t\t\treturn dompurify.sanitize(\n\t\t\t\tmarked(this.text.trim(), {\n\t\t\t\t\trenderer,\n\t\t\t\t\tgfm: false,\n\t\t\t\t\thighlight: false,\n\t\t\t\t\ttables: false,\n\t\t\t\t\tbreaks: false,\n\t\t\t\t\tpedantic: false,\n\t\t\t\t\tsanitize: true,\n\t\t\t\t\tsmartLists: true,\n\t\t\t\t\tsmartypants: false,\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\tSAFE_FOR_JQUERY: true,\n\t\t\t\t\tALLOWED_TAGS: [\n\t\t\t\t\t\t'h1',\n\t\t\t\t\t\t'h2',\n\t\t\t\t\t\t'h3',\n\t\t\t\t\t\t'h4',\n\t\t\t\t\t\t'h5',\n\t\t\t\t\t\t'h6',\n\t\t\t\t\t\t'strong',\n\t\t\t\t\t\t'p',\n\t\t\t\t\t\t'a',\n\t\t\t\t\t\t'ul',\n\t\t\t\t\t\t'ol',\n\t\t\t\t\t\t'li',\n\t\t\t\t\t\t'em',\n\t\t\t\t\t\t'del',\n\t\t\t\t\t\t'blockquote',\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t)\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n\t.settings-markdown::v-deep {\n\n\th1,\n\th2,\n\th3,\n\th4,\n\th5,\n\th6 {\n\t\tfont-weight: 600;\n\t\tline-height: 120%;\n\t\tmargin-top: 24px;\n\t\tmargin-bottom: 12px;\n\t\tcolor: var(--color-main-text);\n\t}\n\n\th1 {\n\t\tfont-size: 36px;\n\t\tmargin-top: 48px;\n\t}\n\n\th2 {\n\t\tfont-size: 28px;\n\t\tmargin-top: 48px;\n\t}\n\n\th3 {\n\t\tfont-size: 24px;\n\t}\n\n\th4 {\n\t\tfont-size: 21px;\n\t}\n\n\th5 {\n\t\tfont-size: 17px;\n\t}\n\n\th6 {\n\t\tfont-size: var(--default-font-size);\n\t}\n\n\tpre {\n\t\twhite-space: pre;\n\t\toverflow-x: auto;\n\t\tbackground-color: var(--color-background-dark);\n\t\tborder-radius: var(--border-radius);\n\t\tpadding: 1em 1.3em;\n\t\tmargin-bottom: 1em;\n\t}\n\n\tp code {\n\t\tbackground-color: var(--color-background-dark);\n\t\tborder-radius: var(--border-radius);\n\t\tpadding: .1em .3em;\n\t}\n\n\tli {\n\t\tposition: relative;\n\t}\n\n\tul, ol {\n\t\tpadding-left: 10px;\n\t\tmargin-left: 10px;\n\t}\n\n\tul li {\n\t\tlist-style-type: disc;\n\t}\n\n\tul > li > ul > li {\n\t\tlist-style-type: circle;\n\t}\n\n\tul > li > ul > li ul li {\n\t\tlist-style-type: square;\n\t}\n\n\tblockquote {\n\t\tpadding-left: 1em;\n\t\tborder-left: 4px solid var(--color-primary-element);\n\t\tcolor: var(--color-text-maxcontrast);\n\t\tmargin-left: 0;\n\t\tmargin-right: 0;\n\t}\n\n\t}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcAppSidebarTab id=\"details\"\n\t\t:name=\"t('settings', 'Details')\"\n\t\t:order=\"1\">\n\t\t<template #icon>\n\t\t\t<NcIconSvgWrapper :path=\"mdiTextBox\" />\n\t\t</template>\n\t\t<div class=\"app-details\">\n\t\t\t<div class=\"app-details__actions\">\n\t\t\t\t<div v-if=\"app.active && canLimitToGroups(app)\" class=\"app-details__actions-groups\">\n\t\t\t\t\t<input :id=\"`groups_enable_${app.id}`\"\n\t\t\t\t\t\tv-model=\"groupCheckedAppsData\"\n\t\t\t\t\t\ttype=\"checkbox\"\n\t\t\t\t\t\t:value=\"app.id\"\n\t\t\t\t\t\tclass=\"groups-enable__checkbox checkbox\"\n\t\t\t\t\t\t@change=\"setGroupLimit\">\n\t\t\t\t\t<label :for=\"`groups_enable_${app.id}`\">{{ t('settings', 'Limit to groups') }}</label>\n\t\t\t\t\t<input type=\"hidden\"\n\t\t\t\t\t\tclass=\"group_select\"\n\t\t\t\t\t\t:title=\"t('settings', 'All')\"\n\t\t\t\t\t\tvalue=\"\">\n\t\t\t\t\t<br>\n\t\t\t\t\t<label for=\"limitToGroups\">\n\t\t\t\t\t\t<span>{{ t('settings', 'Limit app usage to groups') }}</span>\n\t\t\t\t\t</label>\n\t\t\t\t\t<NcSelect v-if=\"isLimitedToGroups(app)\"\n\t\t\t\t\t\tinput-id=\"limitToGroups\"\n\t\t\t\t\t\t:options=\"groups\"\n\t\t\t\t\t\t:value=\"appGroups\"\n\t\t\t\t\t\t:limit=\"5\"\n\t\t\t\t\t\tlabel=\"name\"\n\t\t\t\t\t\t:multiple=\"true\"\n\t\t\t\t\t\t:close-on-select=\"false\"\n\t\t\t\t\t\t@option:selected=\"addGroupLimitation\"\n\t\t\t\t\t\t@option:deselected=\"removeGroupLimitation\"\n\t\t\t\t\t\t@search=\"asyncFindGroup\">\n\t\t\t\t\t\t<span slot=\"noResult\">{{ t('settings', 'No results') }}</span>\n\t\t\t\t\t</NcSelect>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"app-details__actions-manage\">\n\t\t\t\t\t<input v-if=\"app.update\"\n\t\t\t\t\t\tclass=\"update primary\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t:value=\"t('settings', 'Update to {version}', { version: app.update })\"\n\t\t\t\t\t\t:disabled=\"installing || isLoading\"\n\t\t\t\t\t\t@click=\"update(app.id)\">\n\t\t\t\t\t<input v-if=\"app.canUnInstall\"\n\t\t\t\t\t\tclass=\"uninstall\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t:value=\"t('settings', 'Remove')\"\n\t\t\t\t\t\t:disabled=\"installing || isLoading\"\n\t\t\t\t\t\t@click=\"remove(app.id)\">\n\t\t\t\t\t<input v-if=\"app.active\"\n\t\t\t\t\t\tclass=\"enable\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t:value=\"t('settings','Disable')\"\n\t\t\t\t\t\t:disabled=\"installing || isLoading\"\n\t\t\t\t\t\t@click=\"disable(app.id)\">\n\t\t\t\t\t<input v-if=\"!app.active && (app.canInstall || app.isCompatible)\"\n\t\t\t\t\t\t:title=\"enableButtonTooltip\"\n\t\t\t\t\t\t:aria-label=\"enableButtonTooltip\"\n\t\t\t\t\t\tclass=\"enable primary\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t:value=\"enableButtonText\"\n\t\t\t\t\t\t:disabled=\"!app.canInstall || installing || isLoading\"\n\t\t\t\t\t\t@click=\"enable(app.id)\">\n\t\t\t\t\t<input v-else-if=\"!app.active && !app.canInstall\"\n\t\t\t\t\t\t:title=\"forceEnableButtonTooltip\"\n\t\t\t\t\t\t:aria-label=\"forceEnableButtonTooltip\"\n\t\t\t\t\t\tclass=\"enable force\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t:value=\"forceEnableButtonText\"\n\t\t\t\t\t\t:disabled=\"installing || isLoading\"\n\t\t\t\t\t\t@click=\"forceEnable(app.id)\">\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<ul class=\"app-details__dependencies\">\n\t\t\t\t<li v-if=\"app.missingMinOwnCloudVersion\">\n\t\t\t\t\t{{ t('settings', 'This app has no minimum Nextcloud version assigned. This will be an error in the future.') }}\n\t\t\t\t</li>\n\t\t\t\t<li v-if=\"app.missingMaxOwnCloudVersion\">\n\t\t\t\t\t{{ t('settings', 'This app has no maximum Nextcloud version assigned. This will be an error in the future.') }}\n\t\t\t\t</li>\n\t\t\t\t<li v-if=\"!app.canInstall\">\n\t\t\t\t\t{{ t('settings', 'This app cannot be installed because the following dependencies are not fulfilled:') }}\n\t\t\t\t\t<ul class=\"missing-dependencies\">\n\t\t\t\t\t\t<li v-for=\"(dep, index) in app.missingDependencies\" :key=\"index\">\n\t\t\t\t\t\t\t{{ dep }}\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</li>\n\t\t\t</ul>\n\n\t\t\t<div v-if=\"lastModified\" class=\"app-details__section\">\n\t\t\t\t<h4>\n\t\t\t\t\t{{ t('settings', 'Latest updated') }}\n\t\t\t\t</h4>\n\t\t\t\t<NcDateTime :timestamp=\"lastModified\" />\n\t\t\t</div>\n\n\t\t\t<div class=\"app-details__section\">\n\t\t\t\t<h4>\n\t\t\t\t\t{{ t('settings', 'Author') }}\n\t\t\t\t</h4>\n\t\t\t\t<p class=\"app-details__authors\">\n\t\t\t\t\t{{ appAuthors }}\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div class=\"app-details__section\">\n\t\t\t\t<h4>\n\t\t\t\t\t{{ t('settings', 'Categories') }}\n\t\t\t\t</h4>\n\t\t\t\t<p>\n\t\t\t\t\t{{ appCategories }}\n\t\t\t\t</p>\n\t\t\t</div>\n\n\t\t\t<div v-if=\"externalResources.length > 0\" class=\"app-details__section\">\n\t\t\t\t<h4>{{ t('settings', 'Resources') }}</h4>\n\t\t\t\t<ul class=\"app-details__documentation\" :aria-label=\"t('settings', 'Documentation')\">\n\t\t\t\t\t<li v-for=\"resource of externalResources\" :key=\"resource.id\">\n\t\t\t\t\t\t<a class=\"appslink\"\n\t\t\t\t\t\t\t:href=\"resource.href\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\trel=\"noreferrer noopener\">\n\t\t\t\t\t\t\t{{ resource.label }} â†—\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</div>\n\n\t\t\t<div class=\"app-details__section\">\n\t\t\t\t<h4>{{ t('settings', 'Interact') }}</h4>\n\t\t\t\t<div class=\"app-details__interact\">\n\t\t\t\t\t<NcButton :disabled=\"!app.bugs\"\n\t\t\t\t\t\t:href=\"app.bugs ?? '#'\"\n\t\t\t\t\t\t:aria-label=\"t('settings', 'Report a bug')\"\n\t\t\t\t\t\t:title=\"t('settings', 'Report a bug')\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<NcIconSvgWrapper :path=\"mdiBug\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t\t<NcButton :disabled=\"!app.bugs\"\n\t\t\t\t\t\t:href=\"app.bugs ?? '#'\"\n\t\t\t\t\t\t:aria-label=\"t('settings', 'Request feature')\"\n\t\t\t\t\t\t:title=\"t('settings', 'Request feature')\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<NcIconSvgWrapper :path=\"mdiFeatureSearch\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t\t<NcButton v-if=\"app.appstoreData?.discussion\"\n\t\t\t\t\t\t:href=\"app.appstoreData.discussion\"\n\t\t\t\t\t\t:aria-label=\"t('settings', 'Ask questions or discuss')\"\n\t\t\t\t\t\t:title=\"t('settings', 'Ask questions or discuss')\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<NcIconSvgWrapper :path=\"mdiTooltipQuestion\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t\t<NcButton v-if=\"!app.internal\"\n\t\t\t\t\t\t:href=\"rateAppUrl\"\n\t\t\t\t\t\t:aria-label=\"t('settings', 'Rate the app')\"\n\t\t\t\t\t\t:title=\"t('settings', 'Rate')\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<NcIconSvgWrapper :path=\"mdiStar\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</NcAppSidebarTab>\n</template>\n\n<script>\nimport NcAppSidebarTab from '@nextcloud/vue/dist/Components/NcAppSidebarTab.js'\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcDateTime from '@nextcloud/vue/dist/Components/NcDateTime.js'\nimport NcIconSvgWrapper from '@nextcloud/vue/dist/Components/NcIconSvgWrapper.js'\nimport NcSelect from '@nextcloud/vue/dist/Components/NcSelect.js'\n\nimport AppManagement from '../../mixins/AppManagement.js'\nimport { mdiBug, mdiFeatureSearch, mdiStar, mdiTextBox, mdiTooltipQuestion } from '@mdi/js'\nimport { useAppsStore } from '../../store/apps-store'\n\nexport default {\n\tname: 'AppDetailsTab',\n\n\tcomponents: {\n\t\tNcAppSidebarTab,\n\t\tNcButton,\n\t\tNcDateTime,\n\t\tNcIconSvgWrapper,\n\t\tNcSelect,\n\t},\n\tmixins: [AppManagement],\n\n\tprops: {\n\t\tapp: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tsetup() {\n\t\tconst store = useAppsStore()\n\n\t\treturn {\n\t\t\tstore,\n\n\t\t\tmdiBug,\n\t\t\tmdiFeatureSearch,\n\t\t\tmdiStar,\n\t\t\tmdiTextBox,\n\t\t\tmdiTooltipQuestion,\n\t\t}\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\tgroupCheckedAppsData: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tlastModified() {\n\t\t\treturn (this.app.appstoreData?.releases ?? [])\n\t\t\t\t.map(({ lastModified }) => Date.parse(lastModified))\n\t\t\t\t.sort()\n\t\t\t\t.at(0) ?? null\n\t\t},\n\t\t/**\n\t\t * App authors as comma separated string\n\t\t */\n\t\tappAuthors() {\n\t\t\tconsole.warn(this.app)\n\t\t\tif (!this.app) {\n\t\t\t\treturn ''\n\t\t\t}\n\n\t\t\tconst authorName = (xmlNode) => {\n\t\t\t\tif (xmlNode['@value']) {\n\t\t\t\t\t// Complex node (with email or homepage attribute)\n\t\t\t\t\treturn xmlNode['@value']\n\t\t\t\t}\n\t\t\t\t// Simple text node\n\t\t\t\treturn xmlNode\n\t\t\t}\n\n\t\t\tconst authors = Array.isArray(this.app.author)\n\t\t\t\t? this.app.author.map(authorName)\n\t\t\t\t: [authorName(this.app.author)]\n\n\t\t\treturn authors\n\t\t\t\t.sort((a, b) => a.split(' ').at(-1).localeCompare(b.split(' ').at(-1)))\n\t\t\t\t.join(', ')\n\t\t},\n\n\t\tappstoreUrl() {\n\t\t\treturn `https://apps.nextcloud.com/apps/${this.app.id}`\n\t\t},\n\n\t\t/**\n\t\t * Further external resources (e.g. website)\n\t\t */\n\t\texternalResources() {\n\t\t\tconst resources = []\n\t\t\tif (!this.app.internal) {\n\t\t\t\tresources.push({\n\t\t\t\t\tid: 'appstore',\n\t\t\t\t\thref: this.appstoreUrl,\n\t\t\t\t\tlabel: t('settings', 'View in store'),\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (this.app.website) {\n\t\t\t\tresources.push({\n\t\t\t\t\tid: 'website',\n\t\t\t\t\thref: this.app.website,\n\t\t\t\t\tlabel: t('settings', 'Visit website'),\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (this.app.documentation) {\n\t\t\t\tif (this.app.documentation.user) {\n\t\t\t\t\tresources.push({\n\t\t\t\t\t\tid: 'doc-user',\n\t\t\t\t\t\thref: this.app.documentation.user,\n\t\t\t\t\t\tlabel: t('settings', 'Usage documentation'),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (this.app.documentation.admin) {\n\t\t\t\t\tresources.push({\n\t\t\t\t\t\tid: 'doc-admin',\n\t\t\t\t\t\thref: this.app.documentation.admin,\n\t\t\t\t\t\tlabel: t('settings', 'Admin documentation'),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\tif (this.app.documentation.developer) {\n\t\t\t\t\tresources.push({\n\t\t\t\t\t\tid: 'doc-developer',\n\t\t\t\t\t\thref: this.app.documentation.developer,\n\t\t\t\t\t\tlabel: t('settings', 'Developer documentation'),\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn resources\n\t\t},\n\n\t\tappCategories() {\n\t\t\treturn [this.app.category].flat()\n\t\t\t\t.map((id) => this.store.getCategoryById(id)?.displayName ?? id)\n\t\t\t\t.join(', ')\n\t\t},\n\n\t\trateAppUrl() {\n\t\t\treturn `${this.appstoreUrl}#comments`\n\t\t},\n\t\tappGroups() {\n\t\t\treturn this.app.groups.map(group => { return { id: group, name: group } })\n\t\t},\n\t\tgroups() {\n\t\t\treturn this.$store.getters.getGroups\n\t\t\t\t.filter(group => group.id !== 'disabled')\n\t\t\t\t.sort((a, b) => a.name.localeCompare(b.name))\n\t\t},\n\t},\n\tmounted() {\n\t\tif (this.app.groups.length > 0) {\n\t\t\tthis.groupCheckedAppsData = true\n\t\t}\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.app-details {\n\tpadding: 20px;\n\n\t&__actions {\n\t\t// app management\n\t\t&-manage {\n\t\t\t// if too many, shrink them and ellipsis\n\t\t\tdisplay: flex;\n\t\t\tinput {\n\t\t\t\tflex: 0 1 auto;\n\t\t\t\tmin-width: 0;\n\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\twhite-space: nowrap;\n\t\t\t\toverflow: hidden;\n\t\t\t}\n\t\t}\n\t}\n\t&__authors {\n\t\tcolor: var(--color-text-maxcontrast);\n\t}\n\n\t&__section {\n\t\tmargin-top: 15px;\n\n\t\th4 {\n\t\t\tfont-size: 16px;\n\t\t\tfont-weight: bold;\n\t\t\tmargin-block-end: 5px;\n\t\t}\n\t}\n\n\t&__interact {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tflex-wrap: wrap;\n\t\tgap: 12px;\n\t}\n\n\t&__documentation {\n\t\ta {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t\tli {\n\t\t\tpadding-inline-start: 20px;\n\n\t\t\t&::before {\n\t\t\t\twidth: 5px;\n\t\t\t\theight: 5px;\n\t\t\t\tborder-radius: 100%;\n\t\t\t\tbackground-color: var(--color-main-text);\n\t\t\t\tcontent: \"\";\n\t\t\t\tfloat: inline-start;\n\t\t\t\tmargin-inline-start: -13px;\n\t\t\t\tposition: relative;\n\t\t\t\ttop: 10px;\n\t\t\t}\n\t\t}\n\t}\n}\n\n.force {\n\tcolor: var(--color-error);\n\tborder-color: var(--color-error);\n\tbackground: var(--color-main-background);\n}\n.force:hover,\n.force:active {\n\tcolor: var(--color-main-background);\n\tborder-color: var(--color-error) !important;\n\tbackground: var(--color-error);\n}\n\n.missing-dependencies {\n\tlist-style: initial;\n\tlist-style-type: initial;\n\tlist-style-position: inside;\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcAppSidebarTab v-if=\"hasChangelog\"\n\t\tid=\"changelog\"\n\t\t:name=\"t('settings', 'Changelog')\"\n\t\t:order=\"2\">\n\t\t<template #icon>\n\t\t\t<NcIconSvgWrapper :path=\"mdiClockFast\" :size=\"24\" />\n\t\t</template>\n\t\t<div v-for=\"release in app.releases\" :key=\"release.version\" class=\"app-sidebar-tabs__release\">\n\t\t\t<h2>{{ release.version }}</h2>\n\t\t\t<Markdown class=\"app-sidebar-tabs__release-text\"\n\t\t\t\t:text=\"createChangelogFromRelease(release)\" />\n\t\t</div>\n\t</NcAppSidebarTab>\n</template>\n\n<script setup lang=\"ts\">\nimport type { IAppstoreApp, IAppstoreAppRelease } from '../../app-types.ts'\n\nimport { mdiClockFast } from '@mdi/js'\nimport { getLanguage, translate as t } from '@nextcloud/l10n'\nimport { computed } from 'vue'\n\nimport NcAppSidebarTab from '@nextcloud/vue/dist/Components/NcAppSidebarTab.js'\nimport NcIconSvgWrapper from '@nextcloud/vue/dist/Components/NcIconSvgWrapper.js'\nimport Markdown from '../Markdown.vue'\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst props = defineProps<{ app: IAppstoreApp }>()\n\nconst hasChangelog = computed(() => Object.values(props.app.releases?.[0]?.translations ?? {}).some(({ changelog }) => !!changelog))\n\nconst createChangelogFromRelease = (release: IAppstoreAppRelease) => release.translations?.[getLanguage()]?.changelog ?? release.translations?.en?.changelog ?? ''\n</script>\n\n<style scoped lang=\"scss\">\n.app-sidebar-tabs__release {\n\th2 {\n\t\tborder-bottom: 1px solid var(--color-border);\n\t\tfont-size: 24px;\n\t}\n\n\t&-text {\n\t\t// Overwrite changelog heading styles\n\t\t:deep(h3) {\n\t\t\tfont-size: 20px;\n\t\t}\n\t\t:deep(h4) {\n\t\t\tfont-size: 17px;\n\t\t}\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport type { Ref } from 'vue'\nimport type { IAppstoreApp } from '../app-types.ts'\n\nimport { mdiCog } from '@mdi/js'\nimport { computed, ref, watchEffect } from 'vue'\nimport AppstoreCategoryIcons from '../constants/AppstoreCategoryIcons.ts'\nimport logger from '../logger.ts'\n\n/**\n * Get the app icon raw SVG for use with `NcIconSvgWrapper` (do never use without sanitizing)\n * It has a fallback to the categroy icon.\n *\n * @param app The app to get the icon for\n */\nexport function useAppIcon(app: Ref<IAppstoreApp>) {\n\tconst appIcon = ref<string|null>(null)\n\n\t/**\n\t * Fallback value if no app icon available\n\t */\n\tconst categoryIcon = computed(() => {\n\t\tconst path = [app.value?.category ?? []].flat()\n\t\t\t.map((name) => AppstoreCategoryIcons[name])\n\t\t\t.filter((icon) => !!icon)\n\t\t\t.at(0)\n\t\t\t?? mdiCog\n\t\treturn path ? `<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"${path}\" /></svg>` : null\n\t})\n\n\twatchEffect(async () => {\n\t\t// Note: Only variables until the first `await` will be watched!\n\t\tif (!app.value?.preview) {\n\t\t\tappIcon.value = categoryIcon.value\n\t\t} else {\n\t\t\tappIcon.value = null\n\t\t\t// Now try to load the real app icon\n\t\t\ttry {\n\t\t\t\tconst response = await window.fetch(app.value.preview)\n\t\t\t\tconst blob = await response.blob()\n\t\t\t\tconst rawSvg = await blob.text()\n\t\t\t\tappIcon.value = rawSvg.replaceAll(/fill=\"#(fff|ffffff)([a-z0-9]{1,2})?\"/ig, 'fill=\"currentColor\"')\n\t\t\t} catch (error) {\n\t\t\t\tappIcon.value = categoryIcon.value\n\t\t\t\tlogger.error('Could not load app icon', { error })\n\t\t\t}\n\t\t}\n\t})\n\n\treturn {\n\t\tappIcon,\n\t}\n}\n","<!--\n  - SPDX-FileCopyrightText: 2018 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<!-- Selected app details -->\n\t<NcAppSidebar v-if=\"showSidebar\"\n\t\tclass=\"app-sidebar\"\n\t\t:class=\"{ 'app-sidebar--with-screenshot': hasScreenshot }\"\n\t\t:active.sync=\"activeTab\"\n\t\t:background=\"hasScreenshot ? app.screenshot : undefined\"\n\t\t:compact=\"!hasScreenshot\"\n\t\t:name=\"app.name\"\n\t\t:title=\"app.name\"\n\t\t:subname=\"licenseText\"\n\t\t:subtitle=\"licenseText\"\n\t\t@close=\"hideAppDetails\">\n\t\t<!-- Fallback icon incase no app icon is available -->\n\t\t<template v-if=\"!hasScreenshot\" #header>\n\t\t\t<NcIconSvgWrapper class=\"app-sidebar__fallback-icon\"\n\t\t\t\t:svg=\"appIcon ?? ''\"\n\t\t\t\t:size=\"64\" />\n\t\t</template>\n\n\t\t<template #description>\n\t\t\t<!-- Featured/Supported badges -->\n\t\t\t<div class=\"app-sidebar__badges\">\n\t\t\t\t<AppLevelBadge :level=\"app.level\" />\n\t\t\t\t<AppScore v-if=\"hasRating\" :score=\"rating\" />\n\t\t\t</div>\n\t\t</template>\n\n\t\t<!-- Tab content -->\n\t\t<AppDescriptionTab :app=\"app\" />\n\t\t<AppDetailsTab :app=\"app\" />\n\t\t<AppReleasesTab :app=\"app\" />\n\t</NcAppSidebar>\n</template>\n\n<script setup lang=\"ts\">\nimport { translate as t } from '@nextcloud/l10n'\nimport { computed, onMounted, ref, watch } from 'vue'\nimport { useRoute, useRouter } from 'vue-router/composables'\nimport { useAppsStore } from '../store/apps-store'\n\nimport NcAppSidebar from '@nextcloud/vue/dist/Components/NcAppSidebar.js'\nimport NcIconSvgWrapper from '@nextcloud/vue/dist/Components/NcIconSvgWrapper.js'\nimport AppScore from '../components/AppList/AppScore.vue'\nimport AppDescriptionTab from '../components/AppStoreSidebar/AppDescriptionTab.vue'\nimport AppDetailsTab from '../components/AppStoreSidebar/AppDetailsTab.vue'\nimport AppReleasesTab from '../components/AppStoreSidebar/AppReleasesTab.vue'\nimport AppLevelBadge from '../components/AppList/AppLevelBadge.vue'\nimport { useAppIcon } from '../composables/useAppIcon.ts'\n\nconst route = useRoute()\nconst router = useRouter()\nconst store = useAppsStore()\n\nconst appId = computed(() => route.params.id ?? '')\nconst app = computed(() => store.getAppById(appId.value)!)\nconst hasRating = computed(() => app.value.appstoreData?.ratingNumOverall > 5)\nconst rating = computed(() => app.value.appstoreData?.ratingNumRecent > 5\n\t? app.value.appstoreData.ratingRecent\n\t: (app.value.appstoreData?.ratingOverall ?? 0.5))\nconst showSidebar = computed(() => app.value !== null)\n\nconst { appIcon } = useAppIcon(app)\n\n/**\n * The second text line shown on the sidebar\n */\nconst licenseText = computed(() => app.value ? t('settings', 'Version {version}, {license}-licensed', { version: app.value.version, license: app.value.licence.toString().toUpperCase() }) : '')\n\nconst activeTab = ref('details')\nwatch([app], () => { activeTab.value = 'details' })\n\n/**\n * Hide the details sidebar by pushing a new route\n */\nconst hideAppDetails = () => {\n\trouter.push({\n\t\tname: 'apps-category',\n\t\tparams: { category: route.params.category },\n\t})\n}\n\n/**\n * Whether the app screenshot is loaded\n */\nconst screenshotLoaded = ref(false)\nconst hasScreenshot = computed(() => app.value?.screenshot && screenshotLoaded.value)\n/**\n * Preload the app screenshot\n */\nconst loadScreenshot = () => {\n\tif (app.value?.releases && app.value?.screenshot) {\n\t\tconst image = new Image()\n\t\timage.onload = () => {\n\t\t\tscreenshotLoaded.value = true\n\t\t}\n\t\timage.src = app.value.screenshot\n\t}\n}\n// Watch app and set screenshot loaded when\nwatch([app], loadScreenshot)\nonMounted(loadScreenshot)\n</script>\n\n<style scoped lang=\"scss\">\n.app-sidebar {\n\t// If a screenshot is available it should cover the whole figure\n\t&--with-screenshot {\n\t\t:deep(.app-sidebar-header__figure) {\n\t\t\tbackground-size: cover;\n\t\t}\n\t}\n\n\t&__fallback-icon {\n\t\t// both 100% to center the icon\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\n\t&__badges {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tgap: 12px;\n\t}\n\n\t&__version {\n\t\tcolor: var(--color-text-maxcontrast);\n\t}\n}\n</style>\n"],"names":["_sfc_main","renderer","marked","href","title","text","prot","out","level","quote","dompurify","NcAppSidebarTab","NcButton","NcDateTime","NcIconSvgWrapper","NcSelect","AppManagement","useAppsStore","mdiBug","mdiFeatureSearch","mdiStar","mdiTextBox","mdiTooltipQuestion","_c","_b","_a","lastModified","authorName","xmlNode","b","resources","id","group","a","hasChangelog","computed","props","changelog","release","_f","_e","getLanguage","_d","useAppIcon","app","appIcon","ref","categoryIcon","path","name","AppstoreCategoryIcons","icon","mdiCog","watchEffect","rawSvg","error","logger","route","useRoute","router","useRouter","store","appId","hasRating","rating","showSidebar","licenseText","t","activeTab","watch","hideAppDetails","screenshotLoaded","hasScreenshot","loadScreenshot","image","onMounted"],"mappings":"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"}