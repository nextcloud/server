/*! third party licenses: dist/vendor.LICENSE.txt */
import{cf as R,a_ as A,bS as y,C as k,a1 as _,F as L,P as B,af as M,aX as c,cj as G,bu as C,bL as W,bK as S,bj as F,B as U}from"../core-common.mjs";import{u as O,a as E}from"./composables-CBXUeqOy.mjs";import{u as w,A as $}from"./apps-store-CNQC26NP.mjs";import{b as q,a as j,A as P}from"./AppManagement-xpdtPrBe.mjs";import{n as m,aC as z,aD as V,aE as H,b as Q,aF as J,aG as K,aH as X,k as Y}from"./icons-TElqpmA8.mjs";import{m as T}from"./marked.esm-C_q1v7Sb.mjs";import{l as Z}from"./logger-C7fGMvfA.mjs";import"./index-PaKKd09k.mjs";import"./_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import"./pinia-CcZmjq9w.mjs";import"./rebuild-navigation-C1f1Ra5A.mjs";import"./index-CiG5J8j_.mjs";const ee={name:"Markdown",props:{text:{type:String,default:""},minHeading:{type:Number,default:1}},computed:{renderMarkdown(){const e=new T.Renderer;return e.link=function(a,s,n){let r;try{r=decodeURIComponent(unescape(a)).replace(/[^\w:]/g,"").toLowerCase()}catch{return""}if(r.indexOf("http:")!==0&&r.indexOf("https:")!==0)return"";let i='<a href="'+a+'" rel="noreferrer noopener"';return s&&(i+=' title="'+s+'"'),i+=">"+n+"</a>",i},e.heading=(a,s)=>(s=Math.min(6,s+(this.minHeading-1)),"<h".concat(s,">").concat(a,"</h").concat(s,">")),e.image=function(a,s,n){return n||s},e.blockquote=function(a){return a},R.sanitize(T(this.text.trim(),{renderer:e,gfm:!1,highlight:!1,tables:!1,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),{SAFE_FOR_JQUERY:!0,ALLOWED_TAGS:["h1","h2","h3","h4","h5","h6","strong","p","a","ul","ol","li","em","del","blockquote"]})}}};var te=function(){var e=this,a=e._self._c;return a("div",{staticClass:"settings-markdown",domProps:{innerHTML:e._s(e.renderMarkdown)}})},ae=[],se=m(ee,te,ae,!1,null,"7194e2ad");const D=se.exports,ie=A({__name:"AppDescriptionTab",props:{app:null},setup(e){return{__sfc:!0,mdiTextShort:z,t:y,NcAppSidebarTab:k,NcIconSvgWrapper:_,Markdown:D}}});var ne=function(){var e=this,a=e._self._c,s=e._self._setupProxy;return a(s.NcAppSidebarTab,{attrs:{id:"desc",name:s.t("settings","Description"),order:0},scopedSlots:e._u([{key:"icon",fn:function(){return[a(s.NcIconSvgWrapper,{attrs:{path:s.mdiTextShort}})]},proxy:!0}])},[a("div",{staticClass:"app-description"},[a(s.Markdown,{attrs:{text:e.app.description,"min-heading":4}})],1)])},re=[],pe=m(ie,ne,re,!1,null,"a49eb225");const oe=pe.exports,le={name:"AppDetailsTab",components:{NcAppSidebarTab:k,NcButton:L,NcDateTime:B,NcIconSvgWrapper:_,NcSelect:M},mixins:[q],props:{app:{type:Object,required:!0}},setup(){return{store:w(),mdiBug:V,mdiFeatureSearch:H,mdiStar:Q,mdiTextBox:J,mdiTooltipQuestion:K}},data(){return{groupCheckedAppsData:!1}},computed:{lastModified(){var e,a,s;return(s=((a=(e=this.app.appstoreData)==null?void 0:e.releases)!=null?a:[]).map(({lastModified:n})=>Date.parse(n)).sort().at(0))!=null?s:null},appAuthors(){if(console.warn(this.app),!this.app)return"";const e=a=>a["@value"]?a["@value"]:a;return(Array.isArray(this.app.author)?this.app.author.map(e):[e(this.app.author)]).sort((a,s)=>a.split(" ").at(-1).localeCompare(s.split(" ").at(-1))).join(", ")},appstoreUrl(){return"https://apps.nextcloud.com/apps/".concat(this.app.id)},externalResources(){const e=[];return this.app.internal||e.push({id:"appstore",href:this.appstoreUrl,label:t("settings","View in store")}),this.app.website&&e.push({id:"website",href:this.app.website,label:t("settings","Visit website")}),this.app.documentation&&(this.app.documentation.user&&e.push({id:"doc-user",href:this.app.documentation.user,label:t("settings","Usage documentation")}),this.app.documentation.admin&&e.push({id:"doc-admin",href:this.app.documentation.admin,label:t("settings","Admin documentation")}),this.app.documentation.developer&&e.push({id:"doc-developer",href:this.app.documentation.developer,label:t("settings","Developer documentation")})),e},appCategories(){return[this.app.category].flat().map(e=>{var a,s;return(s=(a=this.store.getCategoryById(e))==null?void 0:a.displayName)!=null?s:e}).join(", ")},rateAppUrl(){return"".concat(this.appstoreUrl,"#comments")},appGroups(){return this.app.groups.map(e=>({id:e,name:e}))},groups(){return this.$store.getters.getGroups.filter(e=>e.id!=="disabled").sort((e,a)=>e.name.localeCompare(a.name))}},mounted(){this.app.groups.length>0&&(this.groupCheckedAppsData=!0)}};var ce=function(){var s,n,r;var e=this,a=e._self._c;return a("NcAppSidebarTab",{attrs:{id:"details",name:e.t("settings","Details"),order:1},scopedSlots:e._u([{key:"icon",fn:function(){return[a("NcIconSvgWrapper",{attrs:{path:e.mdiTextBox}})]},proxy:!0}])},[a("div",{staticClass:"app-details"},[a("div",{staticClass:"app-details__actions"},[e.app.active&&e.canLimitToGroups(e.app)?a("div",{staticClass:"app-details__actions-groups"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.groupCheckedAppsData,expression:"groupCheckedAppsData"}],staticClass:"groups-enable__checkbox checkbox",attrs:{id:"groups_enable_".concat(e.app.id),type:"checkbox"},domProps:{value:e.app.id,checked:Array.isArray(e.groupCheckedAppsData)?e._i(e.groupCheckedAppsData,e.app.id)>-1:e.groupCheckedAppsData},on:{change:[function(i){var p=e.groupCheckedAppsData,l=i.target,d=!!l.checked;if(Array.isArray(p)){var u=e.app.id,h=e._i(p,u);l.checked?h<0&&(e.groupCheckedAppsData=p.concat([u])):h>-1&&(e.groupCheckedAppsData=p.slice(0,h).concat(p.slice(h+1)))}else e.groupCheckedAppsData=d},e.setGroupLimit]}}),a("label",{attrs:{for:"groups_enable_".concat(e.app.id)}},[e._v(e._s(e.t("settings","Limit to groups")))]),a("input",{staticClass:"group_select",attrs:{type:"hidden",title:e.t("settings","All"),value:""}}),a("br"),a("label",{attrs:{for:"limitToGroups"}},[a("span",[e._v(e._s(e.t("settings","Limit app usage to groups")))])]),e.isLimitedToGroups(e.app)?a("NcSelect",{attrs:{"input-id":"limitToGroups",options:e.groups,value:e.appGroups,limit:5,label:"name",multiple:!0,"close-on-select":!1},on:{"option:selected":e.addGroupLimitation,"option:deselected":e.removeGroupLimitation,search:e.asyncFindGroup}},[a("span",{attrs:{slot:"noResult"},slot:"noResult"},[e._v(e._s(e.t("settings","No results")))])]):e._e()],1):e._e(),a("div",{staticClass:"app-details__actions-manage"},[e.app.update?a("input",{staticClass:"update primary",attrs:{type:"button",value:e.t("settings","Update to {version}",{version:e.app.update}),disabled:e.installing||e.isLoading},on:{click:function(i){return e.update(e.app.id)}}}):e._e(),e.app.canUnInstall?a("input",{staticClass:"uninstall",attrs:{type:"button",value:e.t("settings","Remove"),disabled:e.installing||e.isLoading},on:{click:function(i){return e.remove(e.app.id)}}}):e._e(),e.app.active?a("input",{staticClass:"enable",attrs:{type:"button",value:e.t("settings","Disable"),disabled:e.installing||e.isLoading},on:{click:function(i){return e.disable(e.app.id)}}}):e._e(),!e.app.active&&(e.app.canInstall||e.app.isCompatible)?a("input",{staticClass:"enable primary",attrs:{title:e.enableButtonTooltip,"aria-label":e.enableButtonTooltip,type:"button",value:e.enableButtonText,disabled:!e.app.canInstall||e.installing||e.isLoading},on:{click:function(i){return e.enable(e.app.id)}}}):!e.app.active&&!e.app.canInstall?a("input",{staticClass:"enable force",attrs:{title:e.forceEnableButtonTooltip,"aria-label":e.forceEnableButtonTooltip,type:"button",value:e.forceEnableButtonText,disabled:e.installing||e.isLoading},on:{click:function(i){return e.forceEnable(e.app.id)}}}):e._e()])]),a("ul",{staticClass:"app-details__dependencies"},[e.app.missingMinOwnCloudVersion?a("li",[e._v(" "+e._s(e.t("settings","This app has no minimum Nextcloud version assigned. This will be an error in the future."))+" ")]):e._e(),e.app.missingMaxOwnCloudVersion?a("li",[e._v(" "+e._s(e.t("settings","This app has no maximum Nextcloud version assigned. This will be an error in the future."))+" ")]):e._e(),e.app.canInstall?e._e():a("li",[e._v(" "+e._s(e.t("settings","This app cannot be installed because the following dependencies are not fulfilled:"))+" "),a("ul",{staticClass:"missing-dependencies"},e._l(e.app.missingDependencies,function(i,p){return a("li",{key:p},[e._v(" "+e._s(i)+" ")])}),0)])]),e.lastModified?a("div",{staticClass:"app-details__section"},[a("h4",[e._v(" "+e._s(e.t("settings","Latest updated"))+" ")]),a("NcDateTime",{attrs:{timestamp:e.lastModified}})],1):e._e(),a("div",{staticClass:"app-details__section"},[a("h4",[e._v(" "+e._s(e.t("settings","Author"))+" ")]),a("p",{staticClass:"app-details__authors"},[e._v(" "+e._s(e.appAuthors)+" ")])]),a("div",{staticClass:"app-details__section"},[a("h4",[e._v(" "+e._s(e.t("settings","Categories"))+" ")]),a("p",[e._v(" "+e._s(e.appCategories)+" ")])]),e.externalResources.length>0?a("div",{staticClass:"app-details__section"},[a("h4",[e._v(e._s(e.t("settings","Resources")))]),a("ul",{staticClass:"app-details__documentation",attrs:{"aria-label":e.t("settings","Documentation")}},e._l(e.externalResources,function(i){return a("li",{key:i.id},[a("a",{staticClass:"appslink",attrs:{href:i.href,target:"_blank",rel:"noreferrer noopener"}},[e._v(" "+e._s(i.label)+" â†— ")])])}),0)]):e._e(),a("div",{staticClass:"app-details__section"},[a("h4",[e._v(e._s(e.t("settings","Interact")))]),a("div",{staticClass:"app-details__interact"},[a("NcButton",{attrs:{disabled:!e.app.bugs,href:(s=e.app.bugs)!=null?s:"#","aria-label":e.t("settings","Report a bug"),title:e.t("settings","Report a bug")},scopedSlots:e._u([{key:"icon",fn:function(){return[a("NcIconSvgWrapper",{attrs:{path:e.mdiBug}})]},proxy:!0}])}),a("NcButton",{attrs:{disabled:!e.app.bugs,href:(n=e.app.bugs)!=null?n:"#","aria-label":e.t("settings","Request feature"),title:e.t("settings","Request feature")},scopedSlots:e._u([{key:"icon",fn:function(){return[a("NcIconSvgWrapper",{attrs:{path:e.mdiFeatureSearch}})]},proxy:!0}])}),(r=e.app.appstoreData)!=null&&r.discussion?a("NcButton",{attrs:{href:e.app.appstoreData.discussion,"aria-label":e.t("settings","Ask questions or discuss"),title:e.t("settings","Ask questions or discuss")},scopedSlots:e._u([{key:"icon",fn:function(){return[a("NcIconSvgWrapper",{attrs:{path:e.mdiTooltipQuestion}})]},proxy:!0}],null,!1,1288192462)}):e._e(),e.app.internal?e._e():a("NcButton",{attrs:{href:e.rateAppUrl,"aria-label":e.t("settings","Rate the app"),title:e.t("settings","Rate")},scopedSlots:e._u([{key:"icon",fn:function(){return[a("NcIconSvgWrapper",{attrs:{path:e.mdiStar}})]},proxy:!0}],null,!1,422450625)})],1)])])])},ue=[],de=m(le,ce,ue,!1,null,"4597aae7");const he=de.exports,ge=A({__name:"AppReleasesTab",props:{app:null},setup(e){const a=e,s=c(()=>{var n,r,i;return Object.values((i=(r=(n=a.app.releases)==null?void 0:n[0])==null?void 0:r.translations)!=null?i:{}).some(({changelog:p})=>!!p)});return{__sfc:!0,props:a,hasChangelog:s,createChangelogFromRelease:n=>{var r,i,p,l,d,u;return(u=(d=(i=(r=n.translations)==null?void 0:r[G()])==null?void 0:i.changelog)!=null?d:(l=(p=n.translations)==null?void 0:p.en)==null?void 0:l.changelog)!=null?u:""},mdiClockFast:X,t:y,NcAppSidebarTab:k,NcIconSvgWrapper:_,Markdown:D}}});var ve=function(){var e=this,a=e._self._c,s=e._self._setupProxy;return s.hasChangelog?a(s.NcAppSidebarTab,{attrs:{id:"changelog",name:s.t("settings","Changelog"),order:2},scopedSlots:e._u([{key:"icon",fn:function(){return[a(s.NcIconSvgWrapper,{attrs:{path:s.mdiClockFast,size:24}})]},proxy:!0}],null,!1,1849836872)},e._l(e.app.releases,function(n){return a("div",{key:n.version,staticClass:"app-sidebar-tabs__release"},[a("h2",[e._v(e._s(n.version))]),a(s.Markdown,{staticClass:"app-sidebar-tabs__release-text",attrs:{text:s.createChangelogFromRelease(n)}})],1)}),0):e._e()},me=[],_e=m(ge,ve,me,!1,null,"fac4d95d");const be=_e.exports;function fe(e){const a=C(null),s=c(()=>{var n,r,i;const p=(i=[(r=(n=e.value)==null?void 0:n.category)!=null?r:[]].flat().map(l=>$[l]).filter(l=>!!l).at(0))!=null?i:Y;return p?'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="'.concat(p,'" /></svg>'):null});return W(async()=>{var n;if(!((n=e.value)!=null&&n.preview))a.value=s.value;else{a.value=null;try{const r=await(await(await window.fetch(e.value.preview)).blob()).text();a.value=r.replaceAll(/fill="#(fff|ffffff)([a-z0-9]{1,2})?"/ig,'fill="currentColor"')}catch(r){a.value=s.value,Z.error("Could not load app icon",{error:r})}}}),{appIcon:a}}const Ce=A({__name:"AppStoreSidebar",setup(e){const a=O(),s=E(),n=w(),r=c(()=>{var o;return(o=a.params.id)!=null?o:""}),i=c(()=>n.getAppById(r.value)),p=c(()=>{var o;return((o=i.value.appstoreData)==null?void 0:o.ratingNumOverall)>5}),l=c(()=>{var o,g,v;return((o=i.value.appstoreData)==null?void 0:o.ratingNumRecent)>5?i.value.appstoreData.ratingRecent:(v=(g=i.value.appstoreData)==null?void 0:g.ratingOverall)!=null?v:.5}),d=c(()=>i.value!==null),{appIcon:u}=fe(i),h=c(()=>i.value?y("settings","Version {version}, {license}-licensed",{version:i.value.version,license:i.value.licence.toString().toUpperCase()}):""),x=C("details");S([i],()=>{x.value="details"});const N=()=>{s.push({name:"apps-category",params:{category:a.params.category}})},b=C(!1),I=c(()=>{var o;return((o=i.value)==null?void 0:o.screenshot)&&b.value}),f=()=>{var o,g;if((o=i.value)!=null&&o.releases&&(g=i.value)!=null&&g.screenshot){const v=new Image;v.onload=()=>{b.value=!0},v.src=i.value.screenshot}};return S([i],f),F(f),{__sfc:!0,route:a,router:s,store:n,appId:r,app:i,hasRating:p,rating:l,showSidebar:d,appIcon:u,licenseText:h,activeTab:x,hideAppDetails:N,screenshotLoaded:b,hasScreenshot:I,loadScreenshot:f,NcAppSidebar:U,NcIconSvgWrapper:_,AppScore:j,AppDescriptionTab:oe,AppDetailsTab:he,AppReleasesTab:be,AppLevelBadge:P}}});var Ae=function(){var e=this,a=e._self._c,s=e._self._setupProxy;return s.showSidebar?a(s.NcAppSidebar,{staticClass:"app-sidebar",class:{"app-sidebar--with-screenshot":s.hasScreenshot},attrs:{active:s.activeTab,background:s.hasScreenshot?s.app.screenshot:void 0,compact:!s.hasScreenshot,name:s.app.name,title:s.app.name,subname:s.licenseText,subtitle:s.licenseText},on:{"update:active":function(n){s.activeTab=n},close:s.hideAppDetails},scopedSlots:e._u([s.hasScreenshot?null:{key:"header",fn:function(){var n;return[a(s.NcIconSvgWrapper,{staticClass:"app-sidebar__fallback-icon",attrs:{svg:(n=s.appIcon)!=null?n:"",size:64}})]},proxy:!0},{key:"description",fn:function(){return[a("div",{staticClass:"app-sidebar__badges"},[a(s.AppLevelBadge,{attrs:{level:s.app.level}}),s.hasRating?a(s.AppScore,{attrs:{score:s.rating}}):e._e()],1)]},proxy:!0}],null,!0)},[a(s.AppDescriptionTab,{attrs:{app:s.app}}),a(s.AppDetailsTab,{attrs:{app:s.app}}),a(s.AppReleasesTab,{attrs:{app:s.app}})],1):e._e()},ye=[],ke=m(Ce,Ae,ye,!1,null,"5ddbd4d7");const We=ke.exports;export{We as default};
