/*! third party licenses: dist/vendor.LICENSE.txt */
import{bV as it}from"../core-common.mjs";var R={exports:{}};(function(s){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function h(n,o,c){this.fn=n,this.context=o,this.once=c||!1}function v(n,o,c,y,b){if(typeof c!="function")throw new TypeError("The listener must be a function");var m=new h(c,y||n,b),w=e?e+o:o;return n._events[w]?n._events[w].fn?n._events[w]=[n._events[w],m]:n._events[w].push(m):(n._events[w]=m,n._eventsCount++),n}function d(n,o){--n._eventsCount===0?n._events=new r:delete n._events[o]}function f(){this._events=new r,this._eventsCount=0}f.prototype.eventNames=function(){var n=[],o,c;if(this._eventsCount===0)return n;for(c in o=this._events)t.call(o,c)&&n.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(o)):n},f.prototype.listeners=function(n){var o=e?e+n:n,c=this._events[o];if(!c)return[];if(c.fn)return[c.fn];for(var y=0,b=c.length,m=new Array(b);y<b;y++)m[y]=c[y].fn;return m},f.prototype.listenerCount=function(n){var o=e?e+n:n,c=this._events[o];return c?c.fn?1:c.length:0},f.prototype.emit=function(n,o,c,y,b,m){var w=e?e+n:n;if(!this._events[w])return!1;var a=this._events[w],E=arguments.length,k,p;if(a.fn){switch(a.once&&this.removeListener(n,a.fn,void 0,!0),E){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,o),!0;case 3:return a.fn.call(a.context,o,c),!0;case 4:return a.fn.call(a.context,o,c,y),!0;case 5:return a.fn.call(a.context,o,c,y,b),!0;case 6:return a.fn.call(a.context,o,c,y,b,m),!0}for(p=1,k=new Array(E-1);p<E;p++)k[p-1]=arguments[p];a.fn.apply(a.context,k)}else{var et=a.length,M;for(p=0;p<et;p++)switch(a[p].once&&this.removeListener(n,a[p].fn,void 0,!0),E){case 1:a[p].fn.call(a[p].context);break;case 2:a[p].fn.call(a[p].context,o);break;case 3:a[p].fn.call(a[p].context,o,c);break;case 4:a[p].fn.call(a[p].context,o,c,y);break;default:if(!k)for(M=1,k=new Array(E-1);M<E;M++)k[M-1]=arguments[M];a[p].fn.apply(a[p].context,k)}}return!0},f.prototype.on=function(n,o,c){return v(this,n,o,c,!1)},f.prototype.once=function(n,o,c){return v(this,n,o,c,!0)},f.prototype.removeListener=function(n,o,c,y){var b=e?e+n:n;if(!this._events[b])return this;if(!o)return d(this,b),this;var m=this._events[b];if(m.fn)m.fn===o&&(!y||m.once)&&(!c||m.context===c)&&d(this,b);else{for(var w=0,a=[],E=m.length;w<E;w++)(m[w].fn!==o||y&&!m[w].once||c&&m[w].context!==c)&&a.push(m[w]);a.length?this._events[b]=a.length===1?a[0]:a:d(this,b)}return this},f.prototype.removeAllListeners=function(n){var o;return n?(o=e?e+n:n,this._events[o]&&d(this,o)):(this._events=new r,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=e,f.EventEmitter=f,s.exports=f})(R);var nt=R.exports;const rt=it(nt);class U extends Error{constructor(t){super(t),this.name="TimeoutError"}}let st=class extends Error{constructor(s){super(),this.name="AbortError",this.message=s}};const B=s=>globalThis.DOMException===void 0?new st(s):new DOMException(s),G=s=>{const t=s.reason===void 0?B("This operation was aborted."):s.reason;return t instanceof Error?t:B(t)};function ot(s,t,e,r){let h;const v=new Promise((d,f)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError("Expected `milliseconds` to be a positive number, got `".concat(t,"`"));if(t===Number.POSITIVE_INFINITY){d(s);return}if(r={customTimers:{setTimeout,clearTimeout},...r},r.signal){const{signal:n}=r;n.aborted&&f(G(n)),n.addEventListener("abort",()=>{f(G(n))})}h=r.customTimers.setTimeout.call(void 0,()=>{const n="Promise timed out after ".concat(t," milliseconds"),o=e instanceof Error?e:new U(n);typeof s.cancel=="function"&&s.cancel(),f(o)},t),(async()=>{try{d(await s)}catch(n){f(n)}finally{r.customTimers.clearTimeout.call(void 0,h)}})()});return v.clear=()=>{clearTimeout(h),h=void 0},v}function at(s,t,e){let r=0,h=s.length;for(;h>0;){const v=Math.trunc(h/2);let d=r+v;e(s[d],t)<=0?(r=++d,h-=v+1):h=v}return r}var P=function(s,t,e,r){if(e==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!r:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?r:e==="a"?r.call(s):r?r.value:t.get(s)},_;class ct{constructor(){_.set(this,[])}enqueue(t,e){e={priority:0,...e};const r={priority:e.priority,run:t};if(this.size&&P(this,_,"f")[this.size-1].priority>=e.priority){P(this,_,"f").push(r);return}const h=at(P(this,_,"f"),r,(v,d)=>d.priority-v.priority);P(this,_,"f").splice(h,0,r)}dequeue(){const t=P(this,_,"f").shift();return t==null?void 0:t.run}filter(t){return P(this,_,"f").filter(e=>e.priority===t.priority).map(e=>e.run)}get size(){return P(this,_,"f").length}}_=new WeakMap;var l=function(s,t,e,r,h){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!h)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!h:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?h.call(s,e):h?h.value=e:t.set(s,e),e},i=function(s,t,e,r){if(e==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!r:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?r:e==="a"?r.call(s):r?r.value:t.get(s)},u,N,O,I,F,z,j,x,W,g,L,T,S,C,$,H,J,X,K,Q,q,D,Y,V,Z,A;class tt extends Error{}class ft extends rt{constructor(t){var e,r,h,v;if(super(),u.add(this),N.set(this,void 0),O.set(this,void 0),I.set(this,0),F.set(this,void 0),z.set(this,void 0),j.set(this,0),x.set(this,void 0),W.set(this,void 0),g.set(this,void 0),L.set(this,void 0),T.set(this,0),S.set(this,void 0),C.set(this,void 0),$.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:ct,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError("Expected `intervalCap` to be a number from 1 and up, got `".concat((r=(e=t.intervalCap)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"","` (").concat(typeof t.intervalCap,")"));if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError("Expected `interval` to be a finite number >= 0, got `".concat((v=(h=t.interval)===null||h===void 0?void 0:h.toString())!==null&&v!==void 0?v:"","` (").concat(typeof t.interval,")"));l(this,N,t.carryoverConcurrencyCount,"f"),l(this,O,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0,"f"),l(this,F,t.intervalCap,"f"),l(this,z,t.interval,"f"),l(this,g,new t.queueClass,"f"),l(this,L,t.queueClass,"f"),this.concurrency=t.concurrency,this.timeout=t.timeout,l(this,$,t.throwOnTimeout===!0,"f"),l(this,C,t.autoStart===!1,"f")}get concurrency(){return i(this,S,"f")}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError("Expected `concurrency` to be a number from 1 and up, got `".concat(t,"` (").concat(typeof t,")"));l(this,S,t,"f"),i(this,u,"m",V).call(this)}async add(t,e={}){return e={timeout:this.timeout,throwOnTimeout:i(this,$,"f"),...e},new Promise((r,h)=>{i(this,g,"f").enqueue(async()=>{var v,d,f;l(this,T,(d=i(this,T,"f"),d++,d),"f"),l(this,I,(f=i(this,I,"f"),f++,f),"f");try{if(!((v=e.signal)===null||v===void 0)&&v.aborted)throw new tt("The task was aborted.");let n=t({signal:e.signal});e.timeout&&(n=ot(Promise.resolve(n),e.timeout)),e.signal&&(n=Promise.race([n,i(this,u,"m",Z).call(this,e.signal)]));const o=await n;r(o),this.emit("completed",o)}catch(n){if(n instanceof U&&!e.throwOnTimeout){r();return}h(n),this.emit("error",n)}finally{i(this,u,"m",X).call(this)}},e),this.emit("add"),i(this,u,"m",q).call(this)})}async addAll(t,e){return Promise.all(t.map(async r=>this.add(r,e)))}start(){return i(this,C,"f")?(l(this,C,!1,"f"),i(this,u,"m",V).call(this),this):this}pause(){l(this,C,!0,"f")}clear(){l(this,g,new(i(this,L,"f")),"f")}async onEmpty(){i(this,g,"f").size!==0&&await i(this,u,"m",A).call(this,"empty")}async onSizeLessThan(t){i(this,g,"f").size<t||await i(this,u,"m",A).call(this,"next",()=>i(this,g,"f").size<t)}async onIdle(){i(this,T,"f")===0&&i(this,g,"f").size===0||await i(this,u,"m",A).call(this,"idle")}get size(){return i(this,g,"f").size}sizeBy(t){return i(this,g,"f").filter(t).length}get pending(){return i(this,T,"f")}get isPaused(){return i(this,C,"f")}}N=new WeakMap,O=new WeakMap,I=new WeakMap,F=new WeakMap,z=new WeakMap,j=new WeakMap,x=new WeakMap,W=new WeakMap,g=new WeakMap,L=new WeakMap,T=new WeakMap,S=new WeakMap,C=new WeakMap,$=new WeakMap,u=new WeakSet,H=function(){return i(this,O,"f")||i(this,I,"f")<i(this,F,"f")},J=function(){return i(this,T,"f")<i(this,S,"f")},X=function(){var s;l(this,T,(s=i(this,T,"f"),s--,s),"f"),i(this,u,"m",q).call(this),this.emit("next")},K=function(){i(this,u,"m",Y).call(this),i(this,u,"m",D).call(this),l(this,W,void 0,"f")},Q=function(){const s=Date.now();if(i(this,x,"f")===void 0){const t=i(this,j,"f")-s;if(t<0)l(this,I,i(this,N,"f")?i(this,T,"f"):0,"f");else return i(this,W,"f")===void 0&&l(this,W,setTimeout(()=>{i(this,u,"m",K).call(this)},t),"f"),!0}return!1},q=function(){if(i(this,g,"f").size===0)return i(this,x,"f")&&clearInterval(i(this,x,"f")),l(this,x,void 0,"f"),this.emit("empty"),i(this,T,"f")===0&&this.emit("idle"),!1;if(!i(this,C,"f")){const s=!i(this,u,"a",Q);if(i(this,u,"a",H)&&i(this,u,"a",J)){const t=i(this,g,"f").dequeue();return t?(this.emit("active"),t(),s&&i(this,u,"m",D).call(this),!0):!1}}return!1},D=function(){i(this,O,"f")||i(this,x,"f")!==void 0||(l(this,x,setInterval(()=>{i(this,u,"m",Y).call(this)},i(this,z,"f")),"f"),l(this,j,Date.now()+i(this,z,"f"),"f"))},Y=function(){i(this,I,"f")===0&&i(this,T,"f")===0&&i(this,x,"f")&&(clearInterval(i(this,x,"f")),l(this,x,void 0,"f")),l(this,I,i(this,N,"f")?i(this,T,"f"):0,"f"),i(this,u,"m",V).call(this)},V=function(){for(;i(this,u,"m",q).call(this););},Z=async function(s){return new Promise((t,e)=>{s.addEventListener("abort",()=>{e(new tt("The task was aborted."))},{once:!0})})},A=async function(s,t){return new Promise(e=>{const r=()=>{t&&!t()||(this.off(s,r),e())};this.on(s,r)})};export{ft as P};
