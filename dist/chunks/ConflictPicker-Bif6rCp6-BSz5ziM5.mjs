/*! third party licenses: dist/vendor.LICENSE.txt */
import{p as h}from"./index-PaKKd09k.mjs";import{a_ as m,F as _,G as g,T as S,P as k,bZ as w}from"../core-common.mjs";import{i as y,e as p}from"./index-DG15V7L3.mjs";import{z as v}from"./_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import{y as a,u as d,G as u,g as o}from"./LivePhotos-CMdH4wdf.mjs";import"./index-CiG5J8j_.mjs";import"./index-CPb3EwrS.mjs";import"./index-tn-fAC9x.mjs";import"./pinia-CcZmjq9w.mjs";import"./index-D0hy_tCT.mjs";import"./preload-helper-BG02UnR2.mjs";import"./icons-TElqpmA8.mjs";import"./index-C20CehWT.mjs";import"./logger-R_K4lHwR.mjs";const C={name:"ArrowRightIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var b=function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon arrow-right-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])},x=[],N=a(C,b,x,!1,null,null);const L=N.exports,z={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var A=function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon close-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])},P=[],F=a(z,A,P,!1,null,null);const $=F.exports,B={name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var O=function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon file-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])},I=[],M=a(B,O,I,!1,null,null);const U=M.exports,E={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var R=function(){var e=this,t=e._self._c;return t("span",e._b({staticClass:"material-design-icon folder-icon",attrs:{"aria-hidden":e.title?null:!0,"aria-label":e.title,role:"img"},on:{click:function(i){return e.$emit("click",i)}}},"span",e.$attrs,!1),[t("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 24 24"}},[t("path",{attrs:{d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"}},[e.title?t("title",[e._v(e._s(e.title))]):e._e()])])])},V=[],q=a(E,R,V,!1,null,null);const D=q.exports,f=64,T=m({name:"NodesPicker",components:{FileSvg:U,FolderSvg:D,NcCheckboxRadioSwitch:g,NcDateTime:k},props:{incoming:{type:[File,Object],required:!0},existing:{type:Object,required:!0},newSelected:{type:Array,required:!0},oldSelected:{type:Array,required:!0}},data(){return{asyncPreview:null}},computed:{isEnoughSelected(){return this.isChecked(this.incoming,this.newSelected)||this.isChecked(this.existing,this.oldSelected)},incomingPreview(){return this.asyncPreview?this.asyncPreview:this.previewUrl(this.incoming)},existingPreview(){return this.previewUrl(this.existing)},incomingLastModified(){return this.lastModified(this.incoming)},existingLastModified(){return this.lastModified(this.existing)}},methods:{lastModified(e){var t;return(t=e instanceof File?new Date(e.lastModified):e.mtime)!=null?t:null},size(e){return e.size?y(e.size,!0):d("Unknown size")},previewUrl(e){if(e instanceof File){this.previewImage(e).then(t=>{this.asyncPreview=t});return}if(e.type===p.Folder)return null;try{const t=e.attributes.previewUrl||w("/core/preview?fileId={fileid}",{fileid:e.fileid}),i=new URL(window.location.origin+t);return i.searchParams.set("x",f.toString()),i.searchParams.set("y",f.toString()),i.searchParams.set("mimeFallback","true"),i.href}catch{return null}},isFolder(e){return e.type===p.Folder||e.type==="httpd/unix-directory"},isChecked(e,t){return t.includes(e)},onUpdateIncomingChecked(e){e?this.$emit("update:newSelected",[this.incoming,...this.newSelected]):this.$emit("update:newSelected",this.newSelected.filter(t=>t!==this.incoming))},onUpdateExistingChecked(e){e?this.$emit("update:oldSelected",[this.existing,...this.oldSelected]):this.$emit("update:oldSelected",this.oldSelected.filter(t=>t!==this.existing))},async previewImage(e){return new Promise(t=>{if(e.type.startsWith("image/")){const i=new FileReader;i.onload=async s=>{var n;const l=(n=s==null?void 0:s.target)==null?void 0:n.result;if(l instanceof ArrayBuffer){const c=new Blob([l],{type:e.type}),r=URL.createObjectURL(c);t(r);return}t(null)},i.readAsArrayBuffer(e)}})},t:d}});var H=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("fieldset",{staticClass:"node-picker__wrapper",attrs:{"data-cy-conflict-picker-fieldset":e.existing.basename}},[t("legend",[e._v(e._s(e.existing.basename))]),t("NcCheckboxRadioSwitch",{attrs:{checked:e.isChecked(e.incoming,e.newSelected),required:!e.isEnoughSelected,"data-cy-conflict-picker-input-incoming":e.existing.basename},on:{"update:checked":e.onUpdateIncomingChecked}},[t("span",{staticClass:"node-picker node-picker--incoming"},[e.incomingPreview?t("img",{staticClass:"node-picker__preview",attrs:{src:e.incomingPreview,alt:e.t("Preview image"),loading:"lazy"}}):[e.isFolder(e.existing)?t("FolderSvg",{staticClass:"node-picker__icon",attrs:{size:48}}):t("FileSvg",{staticClass:"node-picker__icon",attrs:{size:48}})],t("span",{staticClass:"node-picker__desc"},[t("span",{staticClass:"node-picker__name"},[e._v(e._s(e.t("New version")))]),e.incomingLastModified?t("NcDateTime",{staticClass:"node-picker__mtime",attrs:{timestamp:e.incomingLastModified,"relative-time":!1,format:{timeStyle:"short",dateStyle:"medium"}}}):t("span",{staticClass:"node-picker__mtime"},[e._v(" "+e._s(e.t("Last modified date unknown"))+" ")]),t("span",{staticClass:"node-picker__size"},[e._v(e._s(e.size(e.incoming)))])],1)],2)]),t("NcCheckboxRadioSwitch",{attrs:{checked:e.isChecked(e.existing,e.oldSelected),required:!e.isEnoughSelected,"data-cy-conflict-picker-input-existing":e.existing.basename},on:{"update:checked":e.onUpdateExistingChecked}},[t("span",{staticClass:"node-picker node-picker--existing"},[e.existingPreview?t("img",{staticClass:"node-picker__preview",attrs:{src:e.existingPreview,alt:e.t("Preview image"),loading:"lazy"}}):[e.isFolder(e.existing)?t("FolderSvg",{staticClass:"node-picker__icon",attrs:{size:48}}):t("FileSvg",{staticClass:"node-picker__icon",attrs:{size:48}})],t("span",{staticClass:"node-picker__desc"},[t("span",{staticClass:"node-picker__name"},[e._v(e._s(e.t("Existing version")))]),e.existingLastModified?t("NcDateTime",{staticClass:"node-picker__mtime",attrs:{timestamp:e.existingLastModified,"relative-time":!1,format:{timeStyle:"short",dateStyle:"medium"}}}):t("span",{staticClass:"node-picker__mtime"},[e._v(" "+e._s(e.t("Last modified date unknown"))+" ")]),t("span",{staticClass:"node-picker__size"},[e._v(e._s(e.size(e.existing)))])],1)],2)])],1)},Z=[],j=a(T,H,Z,!1,null,"f85db9fe");const W=j.exports,G=m({name:"ConflictPicker",components:{ArrowRight:L,Close:$,NcButton:_,NcCheckboxRadioSwitch:g,NcDialog:S,NodesPicker:W},props:{dirname:{type:String,default:""},content:{type:Array,required:!0},conflicts:{type:Array,required:!0}},emits:["cancel","submit"],data(){return{files:[],opened:!0,blockedTitle:d("You need to select at least one version of each file to continue."),newSelected:[],oldSelected:[]}},computed:{name(){var e,t;return((t=(e=this==null?void 0:this.dirname)==null?void 0:e.trim)==null?void 0:t.call(e))!==""?u("{count} file conflict in {dirname}","{count} file conflicts in {dirname}",this.conflicts.length,{count:this.conflicts.length,dirname:this.dirname}):u("{count} file conflict","{count} files conflict",this.conflicts.length,{count:this.conflicts.length})},skipButtonLabel(){return u("Skip this file","Skip {count} files",this.conflicts.length,{count:this.conflicts.length})},selectAllNewBind(){const e=this.isNoneNewSelected||this.isSomeNewSelected?this.t("Select all"):this.t("Unselect all");return{"aria-label":e,checked:this.isAllNewSelected,indeterminate:this.isSomeNewSelected,title:e}},isAllNewSelected(){return this.newSelected.length===this.conflicts.length},isNoneNewSelected(){return this.newSelected.length===0},isSomeNewSelected(){return!this.isAllNewSelected&&!this.isNoneNewSelected},selectAllOldBind(){const e=this.isNoneOldSelected||this.isSomeOldSelected?this.t("Select all"):this.t("Unselect all");return{"aria-label":e,checked:this.isAllOldSelected,indeterminate:this.isSomeOldSelected,title:e}},isAllOldSelected(){return this.oldSelected.length===this.files.length},isNoneOldSelected(){return this.oldSelected.length===0},isSomeOldSelected(){return!this.isAllOldSelected&&!this.isNoneOldSelected},isEnoughSelected(){var e,t,i;return this.isAllOldSelected||this.isAllNewSelected?!0:(i=(t=(e=this.$refs)==null?void 0:e.nodesPicker)==null?void 0:t.every)==null?void 0:i.call(t,s=>s.isEnoughSelected)}},mounted(){if(this.files=this.conflicts.map(e=>{const t=e instanceof File?e.name:e.basename;return this.content.find(i=>i.basename===t)}).filter(Boolean),this.conflicts.length===0||this.files.length===0){const e=new Error("ConflictPicker: files and conflicts must not be empty");throw this.onCancel(e),e}if(this.conflicts.length!==this.files.length){const e=new Error("ConflictPicker: files and conflicts must have the same length. Make sure you filter out non conflicting files from the conflicts array.");throw this.onCancel(e),e}o.debug("ConflictPicker initialised",{files:this.files,conflicts:this.conflicts,content:this.content})},methods:{onCancel(e){this.opened=!1,this.$emit("cancel",e)},onSkip(){o.debug("Conflict skipped. Ignoring all conflicting files"),this.opened=!1,this.$emit("submit",{selected:[],renamed:[]})},onSubmit(){if(!this.isEnoughSelected){this.scrollValidityInputIntoView(),this.$refs.form.reportValidity(),v(this.blockedTitle);return}const e=this.oldSelected.map(n=>n.basename),t=this.content.map(n=>n.basename),i=[],s=this.newSelected.filter(n=>{const c=n instanceof File?n.name:n.basename;return e.includes(c)});s.length>0&&s.forEach(n=>{const c=n instanceof File?n.name:n.basename,r=this.getUniqueName(c,t);if(n instanceof File){Object.defineProperty(n,"name",{value:r}),i.push(n);return}n.rename(r),i.push(n)});const l=this.newSelected.filter(n=>{const c=n instanceof File?n.name:n.basename;return!e.includes(c)&&!s.includes(n)});o.debug("Conflict resolved",{selected:l,renamed:i}),this.opened=!1,this.$emit("submit",{selected:l,renamed:i})},getUniqueName(e,t){let i=e,s=1;for(;t.includes(i);){const l=h.extname(e);i="".concat(h.basename(e,l)," (").concat(s++,")").concat(l)}return i},scrollValidityInputIntoView(){const e='.checkbox-radio-switch input[type="checkbox"]';[...this.$el.querySelectorAll(e)].forEach(i=>{var s;return(s=i==null?void 0:i.setCustomValidity)==null?void 0:s.call(i,"")});const t=this.$el.querySelector(e+":invalid");t&&(t.setCustomValidity(this.blockedTitle),t.scrollIntoView({behavior:"instant",block:"center"}))},onSelectAllNew(e){e?(o.debug("Selected all new files"),this.newSelected=this.conflicts):(o.debug("Cleared new selection"),this.newSelected=[])},onSelectAllOld(e){e?(o.debug("Selected all existing files"),this.oldSelected=this.files):(o.debug("Cleared old selection"),this.oldSelected=[])},t:d}});var Y=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("NcDialog",{staticClass:"conflict-picker",attrs:{"data-cy-conflict-picker":"","close-on-click-outside":!1,"can-close":!0,show:e.opened,name:e.name,size:"large"},on:{closing:e.onCancel},scopedSlots:e._u([{key:"actions",fn:function(){return[t("NcButton",{attrs:{"aria-label":e.t("Cancel"),title:e.t("Cancel the entire operation"),"data-cy-conflict-picker-cancel":"",type:"tertiary"},on:{click:e.onCancel},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Close",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("Cancel"))+" ")]),t("span",{staticClass:"dialog__actions-separator"}),t("NcButton",{attrs:{"aria-label":e.skipButtonLabel,"data-cy-conflict-picker-skip":""},on:{click:e.onSkip},scopedSlots:e._u([{key:"icon",fn:function(){return[t("Close",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.skipButtonLabel)+" ")]),t("NcButton",{class:{"button-vue--disabled":!e.isEnoughSelected},attrs:{"aria-label":e.t("Continue"),title:e.isEnoughSelected?"":e.blockedTitle,"data-cy-conflict-picker-submit":"","native-type":"submit",type:"primary"},on:{click:function(i){return i.stopPropagation(),i.preventDefault(),e.onSubmit.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[t("ArrowRight",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("Continue"))+" ")])]},proxy:!0}])},[t("div",{staticClass:"conflict-picker__header"},[t("p",{staticClass:"conflict-picker__description",attrs:{id:"conflict-picker-description"}},[e._v(" "+e._s(e.t("Which files do you want to keep?"))),t("br"),e._v(" "+e._s(e.t("If you select both versions, the copied file will have a number added to its name."))),t("br"),e._v(" "+e._s(e.t("When an incoming folder is selected, any conflicting files within it will also be overwritten."))+" ")])]),t("form",{ref:"form",staticClass:"conflict-picker__form",attrs:{"aria-labelledby":"conflict-picker-description","data-cy-conflict-picker-form":""},on:{submit:function(i){return i.preventDefault(),i.stopPropagation(),e.onSubmit.apply(null,arguments)}}},[t("fieldset",{staticClass:"conflict-picker__all",attrs:{"data-cy-conflict-picker-fieldset":"all"}},[t("legend",{staticClass:"hidden-visually"},[e._v(" "+e._s(e.t("Select all checkboxes"))+" ")]),t("NcCheckboxRadioSwitch",e._b({attrs:{"data-cy-conflict-picker-input-incoming":"all"},on:{"update:checked":e.onSelectAllNew}},"NcCheckboxRadioSwitch",e.selectAllNewBind,!1),[e._v(" "+e._s(e.t("Select all new files"))+" ")]),t("NcCheckboxRadioSwitch",e._b({attrs:{"data-cy-conflict-picker-input-existing":"all"},on:{"update:checked":e.onSelectAllOld}},"NcCheckboxRadioSwitch",e.selectAllOldBind,!1),[e._v(" "+e._s(e.t("Select all existing files"))+" ")])],1),e._l(e.files,function(i,s){return t("NodesPicker",{key:i.fileid,ref:"nodesPicker",refInFor:!0,attrs:{incoming:e.conflicts[s],existing:e.files[s],"new-selected":e.newSelected,"old-selected":e.oldSelected},on:{"update:newSelected":function(l){e.newSelected=l},"update:new-selected":function(l){e.newSelected=l},"update:oldSelected":function(l){e.oldSelected=l},"update:old-selected":function(l){e.oldSelected=l}}})})],2)])},J=[],K=a(G,Y,J,!1,null,"12c4204f");const he=K.exports;export{he as default};
