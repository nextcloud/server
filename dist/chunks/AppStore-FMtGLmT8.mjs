const __vite__fileDeps=["./PostType-Ff8ion8P.mjs","./icons-TElqpmA8.mjs","../core-common.mjs","./vue-router.esm-CkRP8kF4.mjs","./CarouselType-DFdUKWOg.mjs","./ShowcaseType-CcOf8UHz.mjs","./apps-store-CNQC26NP.mjs","./index-PaKKd09k.mjs","./_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs","./pinia-CcZmjq9w.mjs","./logger-C7fGMvfA.mjs","./index-CiG5J8j_.mjs","./composables-CBXUeqOy.mjs","./AppsConstants-D0cb4_9X.mjs","./AppManagement-xpdtPrBe.mjs","./rebuild-navigation-C1f1Ra5A.mjs","./index-BhGDpaQm.mjs","./preload-helper-BG02UnR2.mjs"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
/*! third party licenses: dist/vendor.LICENSE.txt */
import{F as I,cg as w,c0 as C,a_ as y,aZ as g,bu as A,be as L,bR as N,bZ as V,bS as d,X as S,a1 as D,a4 as x,aX as _,bL as k,H as T,b1 as E}from"../core-common.mjs";import{u as $}from"./composables-CBXUeqOy.mjs";import{u as P}from"./apps-store-CNQC26NP.mjs";import{A as O}from"./AppsConstants-D0cb4_9X.mjs";import{A as U,a as R,b as H}from"./AppManagement-xpdtPrBe.mjs";import{n as u,ay as M}from"./icons-TElqpmA8.mjs";import{p as q}from"./index-BhGDpaQm.mjs";import{_ as m}from"./preload-helper-BG02UnR2.mjs";import"./index-PaKKd09k.mjs";import{z}from"./_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import{l as v}from"./logger-C7fGMvfA.mjs";const j={name:"SvgFilterMixin",data(){return{filterId:""}},computed:{filterUrl(){return"url(#".concat(this.filterId,")")}},mounted(){this.filterId="invertIconApps-"+Math.random().toString(36).substring(2)}},F=null,W=null;var X=u(j,F,W,!1,null,null);const Z=X.exports,G={name:"AppItem",components:{AppLevelBadge:U,AppScore:R,NcButton:I},mixins:[H,Z],props:{app:{type:Object,required:!0},category:{type:String,required:!0},listView:{type:Boolean,default:!0},useBundleView:{type:Boolean,default:!1},headers:{type:String,default:null},inline:{type:Boolean,default:!1}},data(){return{isSelected:!1,scrolled:!1,screenshotLoaded:!1}},computed:{hasRating(){return this.app.appstoreData&&this.app.appstoreData.ratingNumOverall>5},dataItemTag(){return this.listView?"td":"div"},withSidebar(){return!!this.$route.params.id}},watch:{"$route.params.id"(e){this.isSelected=this.app.id===e}},mounted(){if(this.isSelected=this.app.id===this.$route.params.id,this.app.releases&&this.app.screenshot){const e=new Image;e.onload=()=>{this.screenshotLoaded=!0},e.src=this.app.screenshot}},watchers:{},methods:{prefix(e,s){return e+"_"+s},getDataItemHeaders(e){return this.useBundleView?[this.headers,e].join(" "):null}}};var Y=function(){var e=this,s=e._self._c;return s(e.listView?"tr":e.inline?"article":"li",{tag:"component",staticClass:"app-item",class:{"app-item--list-view":e.listView,"app-item--store-view":!e.listView,"app-item--selected":e.isSelected,"app-item--with-sidebar":e.withSidebar}},[s(e.dataItemTag,{tag:"component",staticClass:"app-image app-image-icon",attrs:{headers:e.getDataItemHeaders("app-table-col-icon")}},[e.listView&&!e.app.preview||!e.listView&&!e.screenshotLoaded?s("div",{staticClass:"icon-settings-dark"}):e.listView&&e.app.preview?s("svg",{attrs:{width:"32",height:"32",viewBox:"0 0 32 32"}},[s("image",{staticClass:"app-icon",attrs:{x:"0",y:"0",width:"32",height:"32",preserveAspectRatio:"xMinYMin meet","xlink:href":e.app.preview}})]):e._e(),!e.listView&&e.app.screenshot&&e.screenshotLoaded?s("img",{attrs:{src:e.app.screenshot,alt:""}}):e._e()]),s(e.dataItemTag,{tag:"component",staticClass:"app-name",attrs:{headers:e.getDataItemHeaders("app-table-col-name")}},[s("router-link",{staticClass:"app-name--link",attrs:{to:{name:"apps-details",params:{category:e.category,id:e.app.id}},"aria-label":e.t("settings","Show details for {appName} app",{appName:e.app.name})}},[e._v(" "+e._s(e.app.name)+" ")])],1),e.listView?e._e():s(e.dataItemTag,{tag:"component",staticClass:"app-summary",attrs:{headers:e.getDataItemHeaders("app-version")}},[e._v(" "+e._s(e.app.summary)+" ")]),e.listView?s(e.dataItemTag,{tag:"component",staticClass:"app-version",attrs:{headers:e.getDataItemHeaders("app-table-col-version")}},[e.app.version?s("span",[e._v(e._s(e.app.version))]):e.app.appstoreData.releases[0].version?s("span",[e._v(e._s(e.app.appstoreData.releases[0].version))]):e._e()]):e._e(),s(e.dataItemTag,{tag:"component",staticClass:"app-level",attrs:{headers:e.getDataItemHeaders("app-table-col-level")}},[s("AppLevelBadge",{attrs:{level:e.app.level}}),e.hasRating&&!e.listView?s("AppScore",{attrs:{score:e.app.score}}):e._e()],1),e.inline?e._e():s(e.dataItemTag,{tag:"component",staticClass:"app-actions",attrs:{headers:e.getDataItemHeaders("app-table-col-actions")}},[e.app.error?s("div",{staticClass:"warning"},[e._v(" "+e._s(e.app.error)+" ")]):e._e(),e.isLoading?s("div",{staticClass:"icon icon-loading-small"}):e._e(),e.app.update?s("NcButton",{attrs:{type:"primary",disabled:e.installing||e.isLoading},on:{click:function(a){return a.stopPropagation(),e.update(e.app.id)}}},[e._v(" "+e._s(e.t("settings","Update to {update}",{update:e.app.update}))+" ")]):e._e(),e.app.canUnInstall?s("NcButton",{staticClass:"uninstall",attrs:{type:"tertiary",disabled:e.installing||e.isLoading},on:{click:function(a){return a.stopPropagation(),e.remove(e.app.id)}}},[e._v(" "+e._s(e.t("settings","Remove"))+" ")]):e._e(),e.app.active?s("NcButton",{attrs:{disabled:e.installing||e.isLoading},on:{click:function(a){return a.stopPropagation(),e.disable(e.app.id)}}},[e._v(" "+e._s(e.t("settings","Disable"))+" ")]):e._e(),!e.app.active&&(e.app.canInstall||e.app.isCompatible)?s("NcButton",{attrs:{title:e.enableButtonTooltip,"aria-label":e.enableButtonTooltip,type:"primary",disabled:!e.app.canInstall||e.installing||e.isLoading},on:{click:function(a){return a.stopPropagation(),e.enable(e.app.id)}}},[e._v(" "+e._s(e.enableButtonText)+" ")]):e.app.active?e._e():s("NcButton",{attrs:{title:e.forceEnableButtonTooltip,"aria-label":e.forceEnableButtonTooltip,type:"secondary",disabled:e.installing||e.isLoading},on:{click:function(a){return a.stopPropagation(),e.forceEnable(e.app.id)}}},[e._v(" "+e._s(e.forceEnableButtonText)+" ")])],1)],1)},J=[],K=u(G,Y,J,!1,null,"721ce038");const Q=K.exports,tt={name:"AppList",components:{AppItem:Q,NcButton:I},props:{category:{type:String,required:!0}},data(){return{search:""}},computed:{counter(){return this.apps.filter(e=>e.update).length},loading(){return this.$store.getters.loading("list")},hasPendingUpdate(){return this.apps.filter(e=>e.update).length>0},showUpdateAll(){return this.hasPendingUpdate&&this.useListView},apps(){const e=this.$store.getters.getAllApps.filter(s=>s.name.toLowerCase().search(this.search.toLowerCase())!==-1).sort(function(s,a){const n=""+(s.active?0:1)+(s.update?0:1)+s.name,o=""+(a.active?0:1)+(a.update?0:1)+a.name;return OC.Util.naturalSortCompare(n,o)});return this.category==="installed"?e.filter(s=>s.installed):this.category==="enabled"?e.filter(s=>s.active&&s.installed):this.category==="disabled"?e.filter(s=>!s.active&&s.installed):this.category==="app-bundles"?e.filter(s=>s.bundles):this.category==="updates"?e.filter(s=>s.update):this.category==="supported"?e.filter(s=>s.level===300):this.category==="featured"?e.filter(s=>s.level===200):e.filter(s=>s.appstore&&s.category!==void 0&&(s.category===this.category||s.category.indexOf(this.category)>-1))},bundles(){return this.$store.getters.getAppBundles.filter(e=>this.bundleApps(e.id).length>0)},bundleApps(){return function(e){return this.$store.getters.getAllApps.filter(s=>s.bundleIds!==void 0&&s.bundleIds.includes(e))}},searchApps(){return this.search===""?[]:this.$store.getters.getAllApps.filter(e=>e.name.toLowerCase().search(this.search.toLowerCase())!==-1?!this.apps.find(s=>s.id===e.id):!1)},useAppStoreView(){return!this.useListView&&!this.useBundleView},useListView(){return this.category==="installed"||this.category==="enabled"||this.category==="disabled"||this.category==="updates"||this.category==="featured"||this.category==="supported"},useBundleView(){return this.category==="app-bundles"},allBundlesEnabled(){return e=>this.bundleApps(e).filter(s=>!s.active).length===0},bundleToggleText(){return e=>this.allBundlesEnabled(e)?t("settings","Disable all"):t("settings","Download and enable all")}},beforeDestroy(){w("nextcloud:unified-search.search",this.setSearch),w("nextcloud:unified-search.reset",this.resetSearch)},mounted(){C("nextcloud:unified-search.search",this.setSearch),C("nextcloud:unified-search.reset",this.resetSearch)},methods:{setSearch({query:e}){this.search=e},resetSearch(){this.search=""},toggleBundle(e){return this.allBundlesEnabled(e)?this.disableBundle(e):this.enableBundle(e)},enableBundle(e){const s=this.bundleApps(e).map(a=>a.id);this.$store.dispatch("enableApp",{appId:s,groups:[]}).catch(a=>{console.error(a),OC.Notification.show(a)})},disableBundle(e){const s=this.bundleApps(e).map(a=>a.id);this.$store.dispatch("disableApp",{appId:s,groups:[]}).catch(a=>{OC.Notification.show(a)})},updateAll(){const e=q(1);this.apps.filter(s=>s.update).map(s=>e(()=>this.$store.dispatch("updateApp",{appId:s.id})))}}};var et=function(){var e=this,s=e._self._c;return s("div",{attrs:{id:"app-content-inner"}},[s("div",{staticClass:"apps-list",class:{"apps-list--list-view":e.useBundleView||e.useListView,"apps-list--store-view":e.useAppStoreView},attrs:{id:"apps-list"}},[e.useListView?[e.showUpdateAll?s("div",{staticClass:"apps-list__toolbar"},[e._v(" "+e._s(e.n("settings","%n app has an update available","%n apps have an update available",e.counter))+" "),e.showUpdateAll?s("NcButton",{attrs:{id:"app-list-update-all",type:"primary"},on:{click:e.updateAll}},[e._v(" "+e._s(e.n("settings","Update","Update all",e.counter))+" ")]):e._e()],1):e._e(),e.showUpdateAll?e._e():s("div",{staticClass:"apps-list__toolbar"},[e._v(" "+e._s(e.t("settings","All apps are up-to-date."))+" ")]),s("TransitionGroup",{staticClass:"apps-list__list-container",attrs:{name:"apps-list",tag:"table"}},[s("tr",{key:"app-list-view-header"},[s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Icon")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Name")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Version")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Level")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Actions")))])])]),e._l(e.apps,function(a){return s("AppItem",{key:a.id,attrs:{app:a,category:e.category}})})],2)]:e._e(),e.useBundleView?s("table",{staticClass:"apps-list__list-container"},[s("tr",{key:"app-list-view-header"},[s("th",{attrs:{id:"app-table-col-icon"}},[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Icon")))])]),s("th",{attrs:{id:"app-table-col-name"}},[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Name")))])]),s("th",{attrs:{id:"app-table-col-version"}},[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Version")))])]),s("th",{attrs:{id:"app-table-col-level"}},[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Level")))])]),s("th",{attrs:{id:"app-table-col-actions"}},[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Actions")))])])]),e._l(e.bundles,function(a){return[s("tr",{key:a.id},[s("th",{attrs:{id:"app-table-rowgroup-".concat(a.id),colspan:"5",scope:"rowgroup"}},[s("div",{staticClass:"apps-list__bundle-heading"},[s("span",{staticClass:"apps-list__bundle-header"},[e._v(" "+e._s(a.name)+" ")]),s("NcButton",{attrs:{type:"secondary"},on:{click:function(n){return e.toggleBundle(a.id)}}},[e._v(" "+e._s(e.t("settings",e.bundleToggleText(a.id)))+" ")])],1)])]),e._l(e.bundleApps(a.id),function(n){return s("AppItem",{key:a.id+n.id,attrs:{"use-bundle-view":!0,headers:"app-table-rowgroup-".concat(a.id),app:n,category:e.category}})})]})],2):e._e(),e.useAppStoreView?s("ul",{staticClass:"apps-list__store-container"},e._l(e.apps,function(a){return s("AppItem",{key:a.id,attrs:{app:a,category:e.category,"list-view":!1}})}),1):e._e()],2),s("div",{staticClass:"apps-list apps-list--list-view",attrs:{id:"apps-list-search"}},[s("div",{staticClass:"apps-list__list-container"},[e.search!==""&&e.searchApps.length>0?s("table",{staticClass:"apps-list__list-container"},[s("caption",{staticClass:"apps-list__bundle-header"},[e._v(" "+e._s(e.t("settings","Results from other categories"))+" ")]),s("tr",{key:"app-list-view-header"},[s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Icon")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Name")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Version")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Level")))])]),s("th",[s("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("settings","Actions")))])])]),e._l(e.searchApps,function(a){return s("AppItem",{key:a.id,attrs:{app:a,category:e.category}})})],2):e._e()])]),e.search!==""&&!e.loading&&e.searchApps.length===0&&e.apps.length===0?s("div",{staticClass:"emptycontent emptycontent-search",attrs:{id:"apps-list-empty"}},[s("div",{staticClass:"icon-settings-dark",attrs:{id:"app-list-empty-icon"}}),s("h2",[e._v(e._s(e.t("settings","No apps found for your version")))])]):e._e()])},st=[],at=u(tt,et,st,!1,null,"47b5fe37");const it=at.exports,nt=e=>{var s;const a={...e};if(a.date&&(a.date=Date.parse(a.date)),a.expiryDate&&(a.expiryDate=Date.parse(a.expiryDate)),a.type==="post"||a.type==="showcase"||a.type==="carousel")return a;throw new Error("Invalid argument, app discover element with type ".concat((s=e.type)!=null?s:"unknown"," is unknown"))},rt=e=>{const s=Date.now();return!(e.date&&e.date>s||e.expiryDate&&e.expiryDate<s)},pt=y({__name:"AppStoreDiscoverSection",setup(e){const s=g(()=>m(()=>import("./PostType-Ff8ion8P.mjs").then(i=>i.a),__vite__mapDeps([0,1,2,3]),import.meta.url)),a=g(()=>m(()=>import("./CarouselType-DFdUKWOg.mjs"),__vite__mapDeps([4,1,2,0,3]),import.meta.url)),n=g(()=>m(()=>import("./ShowcaseType-CcOf8UHz.mjs"),__vite__mapDeps([5,2,0,1,3,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url)),o=A(!1),c=A([]),p=i=>{for(let r=i.length-1;r>0;r--){const l=Math.floor(Math.random()*(r+1));[i[r],i[l]]=[i[l],i[r]]}return i};return L(async()=>{try{const{data:i}=await N.get(V("/settings/api/apps/discover"));if(i.length===0){v.info("No app discover elements available (empty response)"),o.value=!0;return}const r=i.map(nt).filter(rt),l=p(r);l.sort((h,B)=>{var f,b;return((f=h.order)!=null?f:1/0)<((b=B.order)!=null?b:1/0)?-1:1}),c.value=l}catch(i){o.value=!0,v.error(i),z(d("settings","Could not load app discover section"))}}),{__sfc:!0,PostType:s,CarouselType:a,ShowcaseType:n,hasError:o,elements:c,shuffleArray:p,getComponent:i=>i==="post"?s:i==="carousel"?a:i==="showcase"?n:y({mounted:()=>v.error("Unknown component requested ",i),render:r=>r("div",d("settings","Could not render element"))}),mdiEyeOff:M,t:d,NcEmptyContent:S,NcIconSvgWrapper:D,NcLoadingIcon:x}}});var ot=function(){var e=this,s=e._self._c,a=e._self._setupProxy;return s("div",{staticClass:"app-discover"},[a.hasError?s(a.NcEmptyContent,{attrs:{name:a.t("settings","Nothing to show"),description:a.t("settings","Could not load section content from app store.")},scopedSlots:e._u([{key:"icon",fn:function(){return[s(a.NcIconSvgWrapper,{attrs:{path:a.mdiEyeOff,size:64}})]},proxy:!0}],null,!1,638098482)}):a.elements.length===0?s(a.NcEmptyContent,{attrs:{name:a.t("settings","Loading"),description:a.t("settings","Fetching the latest news…")},scopedSlots:e._u([{key:"icon",fn:function(){return[s(a.NcLoadingIcon,{attrs:{size:64}})]},proxy:!0}])}):e._l(a.elements,function(n,o){var c;return s(a.getComponent(n.type),e._b({key:(c=n.id)!=null?c:o,tag:"component"},"component",n,!1))})],2)},lt=[],ct=u(pt,ot,lt,!1,null,"f72aec82");const dt=ct.exports,ut=y({__name:"AppStore",setup(e){const s=$(),a=P(),n=_(()=>{var r,l;return(l=(r=s.params)==null?void 0:r.category)!=null?l:"discover"}),o=d("settings","App Store"),c=_(()=>{var r,l,h;return(h=(l=O[n.value])!=null?l:(r=a.getCategoryById(n.value))==null?void 0:r.displayName)!=null?h:o});k(()=>{window.document.title="".concat(c.value," - ").concat(o," - Nextcloud")});const p=E(),i=_(()=>(p==null?void 0:p.proxy).$store.getters.loading("list"));return L(()=>{(p==null?void 0:p.proxy).$store.dispatch("getCategories",{shouldRefetchCategories:!0}),(p==null?void 0:p.proxy).$store.dispatch("getAllApps")}),{__sfc:!0,route:s,store:a,currentCategory:n,appStoreLabel:o,viewLabel:c,instance:p,isLoading:i,t:d,NcAppContent:T,NcEmptyContent:S,NcLoadingIcon:x,AppList:it,AppStoreDiscoverSection:dt}}});var ht=function(){var e=this,s=e._self._c,a=e._self._setupProxy;return s(a.NcAppContent,{staticClass:"app-settings-content",attrs:{"page-heading":a.appStoreLabel}},[s("h2",{staticClass:"app-settings-content__label",domProps:{textContent:e._s(a.viewLabel)}}),a.currentCategory==="discover"?s(a.AppStoreDiscoverSection):a.isLoading?s(a.NcEmptyContent,{staticClass:"empty-content__loading",attrs:{name:a.t("settings","Loading app list")},scopedSlots:e._u([{key:"icon",fn:function(){return[s(a.NcLoadingIcon,{attrs:{size:64}})]},proxy:!0}])}):s(a.AppList,{attrs:{category:a.currentCategory}})],1)},gt=[],_t=u(ut,ht,gt,!1,null,"8543c973");const mt=_t.exports,Bt=Object.freeze(Object.defineProperty({__proto__:null,default:mt},Symbol.toStringTag,{value:"Module"}));export{Q as A,Bt as a};
