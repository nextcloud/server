{"version":3,"file":"settings-legacy-admin.mjs","sources":["../apps/settings/src/admin.js"],"sourcesContent":["/**\n * SPDX-FileCopyrightText: 2022 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nwindow.addEventListener('DOMContentLoaded', () => {\n\t$('#loglevel').change(function() {\n\t\t$.post(OC.generateUrl('/settings/admin/log/level'), { level: $(this).val() }, () => {\n\t\t\tOC.Log.reload()\n\t\t})\n\t})\n\n\t$('#mail_smtpauth').change(function() {\n\t\tif (!this.checked) {\n\t\t\t$('#mail_credentials').addClass('hidden')\n\t\t} else {\n\t\t\t$('#mail_credentials').removeClass('hidden')\n\t\t}\n\t})\n\n\t$('#mail_smtpmode').change(function() {\n\t\tif ($(this).val() !== 'smtp') {\n\t\t\t$('#setting_smtpauth').addClass('hidden')\n\t\t\t$('#setting_smtphost').addClass('hidden')\n\t\t\t$('#mail_smtpsecure_label').addClass('hidden')\n\t\t\t$('#mail_smtpsecure').addClass('hidden')\n\t\t\t$('#mail_credentials').addClass('hidden')\n\t\t\t$('#mail_sendmailmode_label, #mail_sendmailmode').removeClass('hidden')\n\t\t} else {\n\t\t\t$('#setting_smtpauth').removeClass('hidden')\n\t\t\t$('#setting_smtphost').removeClass('hidden')\n\t\t\t$('#mail_smtpsecure_label').removeClass('hidden')\n\t\t\t$('#mail_smtpsecure').removeClass('hidden')\n\t\t\tif ($('#mail_smtpauth').is(':checked')) {\n\t\t\t\t$('#mail_credentials').removeClass('hidden')\n\t\t\t}\n\t\t\t$('#mail_sendmailmode_label, #mail_sendmailmode').addClass('hidden')\n\t\t}\n\t})\n\n\tconst changeEmailSettings = function() {\n\t\tif (OC.PasswordConfirmation.requiresPasswordConfirmation()) {\n\t\t\tOC.PasswordConfirmation.requirePasswordConfirmation(changeEmailSettings)\n\t\t\treturn\n\t\t}\n\n\t\tOC.msg.startSaving('#mail_settings_msg')\n\t\t$.ajax({\n\t\t\turl: OC.generateUrl('/settings/admin/mailsettings'),\n\t\t\ttype: 'POST',\n\t\t\tdata: $('#mail_general_settings_form').serialize(),\n\t\t\tsuccess: () => {\n\t\t\t\tOC.msg.finishedSuccess('#mail_settings_msg', t('settings', 'Saved'))\n\t\t\t},\n\t\t\terror: (xhr) => {\n\t\t\t\tOC.msg.finishedError('#mail_settings_msg', xhr.responseJSON)\n\t\t\t},\n\t\t})\n\t}\n\n\tconst toggleEmailCredentials = function() {\n\t\tif (OC.PasswordConfirmation.requiresPasswordConfirmation()) {\n\t\t\tOC.PasswordConfirmation.requirePasswordConfirmation(toggleEmailCredentials)\n\t\t\treturn\n\t\t}\n\n\t\tOC.msg.startSaving('#mail_settings_msg')\n\t\t$.ajax({\n\t\t\turl: OC.generateUrl('/settings/admin/mailsettings/credentials'),\n\t\t\ttype: 'POST',\n\t\t\tdata: $('#mail_credentials_settings').serialize(),\n\t\t\tsuccess: () => {\n\t\t\t\tOC.msg.finishedSuccess('#mail_settings_msg', t('settings', 'Saved'))\n\t\t\t},\n\t\t\terror: (xhr) => {\n\t\t\t\tOC.msg.finishedError('#mail_settings_msg', xhr.responseJSON)\n\t\t\t},\n\t\t})\n\t}\n\n\t$('#mail_general_settings_form').change(changeEmailSettings)\n\t$('#mail_credentials_settings_submit').click(toggleEmailCredentials)\n\t$('#mail_smtppassword').click(() => {\n\t\tif (this.type === 'text' && this.value === '********') {\n\t\t\tthis.type = 'password'\n\t\t\tthis.value = ''\n\t\t}\n\t})\n\n\t$('#sendtestemail').click((event) => {\n\t\tevent.preventDefault()\n\t\tOC.msg.startAction('#sendtestmail_msg', t('settings', 'Sendingâ€¦'))\n\n\t\t$.ajax({\n\t\t\turl: OC.generateUrl('/settings/admin/mailtest'),\n\t\t\ttype: 'POST',\n\t\t\tsuccess: () => {\n\t\t\t\tOC.msg.finishedSuccess('#sendtestmail_msg', t('settings', 'Email sent'))\n\t\t\t},\n\t\t\terror: (xhr) => {\n\t\t\t\tOC.msg.finishedError('#sendtestmail_msg', xhr.responseJSON)\n\t\t\t},\n\t\t})\n\t})\n\n\tconst setupChecks = () => {\n\t\t// run setup checks then gather error messages\n\t\t$.when(\n\t\t\tOC.SetupChecks.checkSetup(),\n\t\t).then((messages) => {\n\t\t\tconst $el = $('#postsetupchecks')\n\t\t\t$('#security-warning-state-loading').addClass('hidden')\n\n\t\t\tlet hasMessages = false\n\t\t\tconst $errorsEl = $el.find('.errors')\n\t\t\tconst $warningsEl = $el.find('.warnings')\n\t\t\tconst $infoEl = $el.find('.info')\n\n\t\t\tfor (let i = 0; i < messages.length; i++) {\n\t\t\t\tswitch (messages[i].type) {\n\t\t\t\tcase OC.SetupChecks.MESSAGE_TYPE_INFO:\n\t\t\t\t\t$infoEl.append('<li>' + messages[i].msg + '</li>')\n\t\t\t\t\tbreak\n\t\t\t\tcase OC.SetupChecks.MESSAGE_TYPE_WARNING:\n\t\t\t\t\t$warningsEl.append('<li>' + messages[i].msg + '</li>')\n\t\t\t\t\tbreak\n\t\t\t\tcase OC.SetupChecks.MESSAGE_TYPE_ERROR:\n\t\t\t\tdefault:\n\t\t\t\t\t$errorsEl.append('<li>' + messages[i].msg + '</li>')\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ($errorsEl.find('li').length > 0) {\n\t\t\t\t$errorsEl.removeClass('hidden')\n\t\t\t\thasMessages = true\n\t\t\t}\n\t\t\tif ($warningsEl.find('li').length > 0) {\n\t\t\t\t$warningsEl.removeClass('hidden')\n\t\t\t\thasMessages = true\n\t\t\t}\n\t\t\tif ($infoEl.find('li').length > 0) {\n\t\t\t\t$infoEl.removeClass('hidden')\n\t\t\t\thasMessages = true\n\t\t\t}\n\n\t\t\tif (hasMessages) {\n\t\t\t\t$('#postsetupchecks-hint').removeClass('hidden')\n\t\t\t\tif ($errorsEl.find('li').length > 0) {\n\t\t\t\t\t$('#security-warning-state-failure').removeClass('hidden')\n\t\t\t\t} else {\n\t\t\t\t\t$('#security-warning-state-warning').removeClass('hidden')\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst securityWarning = $('#security-warning')\n\t\t\t\tif (securityWarning.children('ul').children().length === 0) {\n\t\t\t\t\t$('#security-warning-state-ok').removeClass('hidden')\n\t\t\t\t} else {\n\t\t\t\t\t$('#security-warning-state-failure').removeClass('hidden')\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\n\tif (document.getElementById('security-warning') !== null) {\n\t\tsetupChecks()\n\t}\n})\n"],"names":["changeEmailSettings","xhr","toggleEmailCredentials","this","event","setupChecks","messages","$el","hasMessages","$errorsEl","$warningsEl","$infoEl","i"],"mappings":"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"}