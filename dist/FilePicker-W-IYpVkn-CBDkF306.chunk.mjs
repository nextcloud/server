import{j as Ne,k as de,O as Yt,F as _,o as v,G as $,x as he,y as w,b as fe,t as x,r as je,c as M,a as P,v as Qt,w as k,I as T,H as ge,z as ae,R as Se,P as oe,aK as It,aa as me,au as _a,J as ba,A as Be,B as wa,C as ya,D as Ta,ax as Ia,aw as Na,ad as Aa,a6 as Kt,q as B,ay as Ca,ah as we,K as lt,s as O,ao as st,n as Zt,a5 as Jt,a9 as Ae,a7 as La,l as ea,p as Da,Q as $e,m as Ra,u as Nt,a3 as Oa,aL as Sa,al as ka,U as Fa}from"./_plugin-vue_export-helper-sUpjG1-Y.chunk.mjs";import{r as ct,S as $a,h as Pa,T as Ba,U as ta,g as De,t as Te,V as A,N as xa,W as Ie,s as ut}from"./index-JpgrUA2Z-hoZOv0I-.chunk.mjs";import{P as Ma,a as Ua}from"./index-BpuSV-3Q.chunk.mjs";import{d as za,B as qe,c as aa}from"./index-Cvjfo1ma.chunk.mjs";import{e as ye,g as Va,i as Ce,c as Ga,z as Xa,a as ja,N as ia}from"./string_decoder-CKkZVVJW.chunk.mjs";import{a as qa,u as Ha}from"./index-D8QEQJpI.chunk.mjs";import{N as ra}from"./NcCheckboxRadioSwitch-BCSKF7Tk-46uSoFP3.chunk.mjs";import{a as At,N as Ct,b as Lt,_ as Wa}from"./NcDateTime.vue_vue_type_script_setup_true_lang-BhB8yA4U-Cq-oANUr.chunk.mjs";import{e as Ya,f as Qa,g as Ka,h as Za,i as Ja,j as ei,k as Dt,l as ti,n as ai}from"./mdi-BrEv6Slh.chunk.mjs";import{S as Rt}from"./ShareType-suoNfd7y.chunk.mjs";import{N as ii}from"./NcSelect-Czzsi3P_-BfHbk_qw.chunk.mjs";import{_ as ri}from"./TrashCanOutline-DMH4BocM.chunk.mjs";import"./NcPasswordField-djttkA5Q-BJMJ835s.chunk.mjs";import"./NcInputField-Bwsh2aHY-fSb6LlM4.chunk.mjs";const ni=["aria-labelledby"],si={key:0,class:"empty-content__icon","aria-hidden":"true"},oi=["id"],li={key:2,class:"empty-content__description"},ci={key:3,class:"empty-content__action"},ui=de({__name:"NcEmptyContent",props:{description:{default:""},name:{default:""}},setup(e){const i=Yt();return(t,n)=>(v(),_("div",{"aria-labelledby":w(i),class:"empty-content",role:"note"},[t.$slots.icon?(v(),_("div",si,[he(t.$slots,"icon",{},void 0,!0)])):$("",!0),t.name!==""||t.$slots.name?(v(),_("div",{key:1,id:w(i),class:"empty-content__name"},[he(t.$slots,"name",{},()=>[fe(x(t.name),1)],!0)],8,oi)):$("",!0),t.description!==""||t.$slots.description?(v(),_("p",li,[he(t.$slots,"description",{},()=>[fe(x(t.description),1)],!0)])):$("",!0),t.$slots.action?(v(),_("div",ci,[he(t.$slots,"action",{},void 0,!0)])):$("",!0)],8,ni))}}),Ot=Ne(ui,[["__scopeId","data-v-b101d636"]]),di={name:"ChevronRightIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},pi=["aria-hidden","aria-label"],mi=["fill","width","height"],hi={d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},fi={key:0};function vi(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon chevron-right-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",hi,[t.title?(v(),_("title",fi,x(t.title),1)):$("",!0)])],8,mi))],16,pi)}const gi=Ne(di,[["render",vi]]),Ei={name:"NcBreadcrumb",components:{NcActions:ct,ChevronRight:gi,NcButton:ye},inheritAttrs:!1,props:{name:{type:String,required:!0},title:{type:String,default:null},to:{type:[String,Object],default:void 0},href:{type:String,default:void 0},icon:{type:String,default:""},forceIconText:{type:Boolean,default:!1},disableDrop:{type:Boolean,default:!1},forceMenu:{type:Boolean,default:!1},open:{type:Boolean,default:!1},class:{type:[String,Array,Object],default:""}},emits:["dragenter","dragleave","dropped","update:open"],setup(){const e=Yt();return{actionsContainer:`.vue-crumb[data-crumb-id="${e}"]`,crumbId:e}},data(){return{hovering:!1}},computed:{linkAttributes(){return this.to?{to:this.to,...this.$attrs}:this.href?{href:this.href,...this.$attrs}:this.$attrs}},methods:{onOpenChange(e){this.$emit("update:open",e)},dropped(e){return this.disableDrop||(this.$emit("dropped",e,this.to||this.href),this.$parent.$emit("dropped",e,this.to||this.href),this.hovering=!1),!1},dragEnter(e){this.$emit("dragenter",e),!this.disableDrop&&(this.hovering=!0)},dragLeave(e){this.$emit("dragleave",e),!this.disableDrop&&(e.target.contains(e.relatedTarget)||this.$refs.crumb.contains(e.relatedTarget)||(this.hovering=!1))}}},_i=["data-crumb-id"];function bi(e,i,t,n,c,m){const u=je("NcButton"),f=je("NcActions"),d=je("ChevronRight");return v(),_("li",{ref:"crumb",class:ge(["vue-crumb",[{"vue-crumb--hovered":c.hovering},e.$props.class]]),"data-crumb-id":n.crumbId,draggable:"false",onDragstart:Se(()=>{},["prevent"]),onDrop:i[0]||(i[0]=Se((...p)=>m.dropped&&m.dropped(...p),["prevent"])),onDragover:Se(()=>{},["prevent"]),onDragenter:i[1]||(i[1]=(...p)=>m.dragEnter&&m.dragEnter(...p)),onDragleave:i[2]||(i[2]=(...p)=>m.dragLeave&&m.dragLeave(...p))},[(t.name||t.icon||e.$slots.icon)&&!e.$slots.default?(v(),M(u,ae({key:0,"aria-label":t.icon?t.name:void 0,variant:"tertiary"},m.linkAttributes),Qt({_:2},[e.$slots.icon||t.icon?{name:"icon",fn:k(()=>[he(e.$slots,"icon",{},()=>[T("span",{class:ge([t.icon,"icon"])},null,2)],!0)]),key:"0"}:void 0,!(e.$slots.icon||t.icon)||t.forceIconText?{name:"default",fn:k(()=>[fe(x(t.name),1)]),key:"1"}:void 0]),1040,["aria-label"])):$("",!0),e.$slots.default?(v(),M(f,{key:1,ref:"actions",container:n.actionsContainer,"force-menu":t.forceMenu,"force-name":"","menu-name":t.name,open:t.open,title:t.title,variant:"tertiary","onUpdate:open":m.onOpenChange},{icon:k(()=>[he(e.$slots,"menu-icon",{},void 0,!0)]),default:k(()=>[he(e.$slots,"default",{},void 0,!0)]),_:3},8,["container","force-menu","menu-name","open","title","onUpdate:open"])):$("",!0),P(d,{class:"vue-crumb__separator",size:20})],42,_i)}const Pe=Ne(Ei,[["render",bi],["__scopeId","data-v-28ef52a4"]]),wi={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},yi=["aria-hidden","aria-label"],Ti=["fill","width","height"],Ii={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},Ni={key:0};function Ai(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",Ii,[t.title?(v(),_("title",Ni,x(t.title),1)):$("",!0)])],8,Ti))],16,yi)}const St=Ne(wi,[["render",Ai]]),W="vue-crumb",Ci={name:"NcBreadcrumbs",components:{NcActions:ct,NcActionButton:Lt,NcActionRouter:Ct,NcActionLink:At,NcBreadcrumb:Pe,IconFolder:St},props:{rootIcon:{type:String,default:"icon-home"},ariaLabel:{type:String,default:null}},emits:["dropped"],data(){return{hiddenIndices:[],menuBreadcrumbProps:{name:"",forceMenu:!0,disableDrop:!0,open:!1},breadcrumbsRefs:[]}},created(){window.addEventListener("resize",za(()=>{this.handleWindowResize()},100)),ba("navigation-toggled",this.delayedResize)},mounted(){this.handleWindowResize()},updated(){this.delayedResize(),this.$nextTick(()=>{this.hideCrumbs()})},beforeUnmount(){window.removeEventListener("resize",this.handleWindowResize),_a("navigation-toggled",this.delayedResize)},methods:{closeActions(e){this.$refs.actionsBreadcrumb.$el.contains(e.relatedTarget)||(this.menuBreadcrumbProps.open=!1)},async delayedResize(){await this.$nextTick(),this.handleWindowResize()},handleWindowResize(){if(!this.$refs.container)return;const e=this.breadcrumbsRefs.length,i=[],t=this.$refs.container.offsetWidth;let n=this.getTotalWidth();this.$refs.breadcrumb__actions&&(n+=this.$refs.breadcrumb__actions.offsetWidth);let c=n-t;c+=c>0?64:0;let m=0;const u=Math.floor(e/2);for(;c>0&&m<e-2;){const f=u+(m%2?m+1:m)/2*Math.pow(-1,m+e%2);c-=this.getWidth(this.breadcrumbsRefs[f]?.$el,f===this.breadcrumbsRefs.length-1),i.push(f),m++}this.arraysEqual(this.hiddenIndices,i.sort((f,d)=>f-d))||(this.hiddenIndices=i)},arraysEqual(e,i){if(e.length!==i.length)return!1;if(e===i)return!0;if(e===null||i===null)return!1;for(let t=0;t<e.length;++t)if(e[t]!==i[t])return!1;return!0},getTotalWidth(){return this.breadcrumbsRefs.reduce((e,i,t)=>e+this.getWidth(i.$el,t===this.breadcrumbsRefs.length-1),0)},getWidth(e,i){if(!e?.classList)return 0;const t=e.classList.contains(`${W}--hidden`);e.style.minWidth="auto",i&&(e.style.maxWidth="210px"),e.classList.remove(`${W}--hidden`);const n=e.offsetWidth;return t&&e.classList.add(`${W}--hidden`),e.style.minWidth="",e.style.maxWidth="",n},preventDefault(e){return e.preventDefault&&e.preventDefault(),!1},dragStart(e){return this.preventDefault(e)},dropped(e,i,t){t||this.$emit("dropped",e,i),this.menuBreadcrumbProps.open=!1;const n=document.querySelectorAll(`.${W}`);for(const c of n)c.classList.remove(`${W}--hovered`);return this.preventDefault(e)},dragOver(e){return this.preventDefault(e)},dragEnter(e,i){if(!i&&e.target.closest){const t=e.target.closest(`.${W}`);if(t.classList&&t.classList.contains(W)){const n=document.querySelectorAll(`.${W}`);for(const c of n)c.classList.remove(`${W}--hovered`);t.classList.add(`${W}--hovered`)}}},dragLeave(e,i){if(!i&&!e.target.contains(e.relatedTarget)&&e.target.closest){const t=e.target.closest(`.${W}`);if(t.contains(e.relatedTarget))return;t.classList&&t.classList.contains(W)&&t.classList.remove(`${W}--hovered`)}},hideCrumbs(){this.breadcrumbsRefs.forEach((e,i)=>{e?.$el?.classList&&(this.hiddenIndices.includes(i)?e.$el.classList.add(`${W}--hidden`):e.$el.classList.remove(`${W}--hidden`))})},isBreadcrumb(e){return e?.type?.name==="NcBreadcrumb"}},render(){let e=[];if(this.$slots.default?.().forEach(c=>{if(this.isBreadcrumb(c)){e.push(c);return}c?.type===oe&&c?.children?.forEach?.(m=>{this.isBreadcrumb(m)&&e.push(m)})}),e.length===0)return;e[0]=It(e[0],{icon:this.rootIcon,ref:"breadcrumbs"});const i=[];e=e.map((c,m)=>It(c,{ref:u=>{i[m]=u}}));const t=[...e];this.hiddenIndices.length&&t.splice(Math.round(e.length/2),0,me(Pe,{class:"dropdown",...this.menuBreadcrumbProps,"aria-hidden":!0,ref:"actionsBreadcrumb",key:"actions-breadcrumb-1",onDragenter:()=>{this.menuBreadcrumbProps.open=!0},onDragleave:this.closeActions,"onUpdate:open":c=>{this.menuBreadcrumbProps.open=c}},{default:()=>this.hiddenIndices.filter(c=>c<=e.length-1).map(c=>{const m=e[c],{to:u,href:f,disableDrop:d,name:p,...l}=m.props;delete l.ref;let g=Lt,E="";f&&(g=At,E=f),u&&(g=Ct,E=u);const I=me(St,{size:20});return me(g,{...l,class:W,href:f||null,to:u||null,draggable:!1,onDragstart:this.dragStart,onDrop:G=>this.dropped(G,E,d),onDragover:this.dragOver,onDragenter:G=>this.dragEnter(G,d),onDragleave:G=>this.dragLeave(G,d)},{default:()=>p,icon:()=>I})})}));const n=[me("nav",{"aria-label":this.ariaLabel},[me("ul",{class:"breadcrumb__crumbs"},[t])])];return $a(this.$slots.actions?.())&&n.push(me("div",{class:"breadcrumb__actions",ref:"breadcrumb__actions"},this.$slots.actions?.())),this.breadcrumbsRefs=i,me("div",{class:["breadcrumb",{"breadcrumb--collapsed":this.hiddenIndices.length===e.length-2}],ref:"container"},n)}},Li=Ne(Ci,[["__scopeId","data-v-af2b1226"]]);function ue(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function kt(e,i,t){Di(e,i),i.set(e,t)}function Di(e,i){if(i.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function q(e,i){var t=na(e,i,"get");return Ri(e,t)}function Ri(e,i){return i.get?i.get.call(e):i.value}function Ft(e,i,t){var n=na(e,i,"set");return Oi(e,n,t),t}function na(e,i,t){if(!i.has(e))throw new TypeError("attempted to "+t+" private field on non-instance");return i.get(e)}function Oi(e,i,t){if(i.set)i.set.call(e,t);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=t}}var Si=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",Y=new WeakMap,_e=new WeakMap;class xe{constructor(i){var{executor:t=()=>{},internals:n=pt(),promise:c=new Promise((m,u)=>t(m,u,f=>{n.onCancelList.push(f)}))}=i;kt(this,Y,{writable:!0,value:void 0}),kt(this,_e,{writable:!0,value:void 0}),ue(this,Si,"CancelablePromise"),this.cancel=this.cancel.bind(this),Ft(this,Y,n),Ft(this,_e,c||new Promise((m,u)=>t(m,u,f=>{n.onCancelList.push(f)})))}then(i,t){return ke(q(this,_e).then(Re(i,q(this,Y)),Re(t,q(this,Y))),q(this,Y))}catch(i){return ke(q(this,_e).catch(Re(i,q(this,Y))),q(this,Y))}finally(i,t){return t&&q(this,Y).onCancelList.push(i),ke(q(this,_e).finally(Re(()=>{if(i)return t&&(q(this,Y).onCancelList=q(this,Y).onCancelList.filter(n=>n!==i)),i()},q(this,Y))),q(this,Y))}cancel(){q(this,Y).isCanceled=!0;var i=q(this,Y).onCancelList;q(this,Y).onCancelList=[];for(var t of i)if(typeof t=="function")try{t()}catch(n){console.error(n)}}isCanceled(){return q(this,Y).isCanceled===!0}}class ie extends xe{constructor(i){super({executor:i})}}ue(ie,"all",function(e){return Oe(e,Promise.all(e))}),ue(ie,"allSettled",function(e){return Oe(e,Promise.allSettled(e))}),ue(ie,"any",function(e){return Oe(e,Promise.any(e))}),ue(ie,"race",function(e){return Oe(e,Promise.race(e))}),ue(ie,"resolve",function(e){return $t(Promise.resolve(e))}),ue(ie,"reject",function(e){return $t(Promise.reject(e))}),ue(ie,"isCancelable",dt);function $t(e){return ke(e,pt())}function dt(e){return e instanceof ie||e instanceof xe}function Re(e,i){if(e)return t=>{if(!i.isCanceled){var n=e(t);return dt(n)&&i.onCancelList.push(n.cancel),n}return t}}function ke(e,i){return new xe({internals:i,promise:e})}function Oe(e,i){var t=pt();return t.onCancelList.push(()=>{for(var n of e)dt(n)&&n.cancel()}),new xe({internals:t,promise:i})}function pt(){return{isCanceled:!1,onCancelList:[]}}const ki=Va().setApp("@nextcloud/files").detectUser().build();var le=(e=>(e.Folder="folder",e.File="file",e))(le||{}),ee=(e=>(e[e.NONE=0]="NONE",e[e.CREATE=4]="CREATE",e[e.READ=1]="READ",e[e.UPDATE=2]="UPDATE",e[e.DELETE=8]="DELETE",e[e.SHARE=16]="SHARE",e[e.ALL=31]="ALL",e))(ee||{});const sa=function(e,i){return e.match(i)!==null},ce=(e,i)=>{if(e.id&&typeof e.id!="number")throw new Error("Invalid id type of value");if(!e.source)throw new Error("Missing mandatory source");try{new URL(e.source)}catch{throw new Error("Invalid source format, source must be a valid URL")}if(!e.source.startsWith("http"))throw new Error("Invalid source format, only http(s) is supported");if(e.displayname&&typeof e.displayname!="string")throw new Error("Invalid displayname type");if(e.mtime&&!(e.mtime instanceof Date))throw new Error("Invalid mtime type");if(e.crtime&&!(e.crtime instanceof Date))throw new Error("Invalid crtime type");if(!e.mime||typeof e.mime!="string"||!e.mime.match(/^[-\w.]+\/[-+\w.]+$/gi))throw new Error("Missing or invalid mandatory mime");if("size"in e&&typeof e.size!="number"&&e.size!==void 0)throw new Error("Invalid size type");if("permissions"in e&&e.permissions!==void 0&&!(typeof e.permissions=="number"&&e.permissions>=ee.NONE&&e.permissions<=ee.ALL))throw new Error("Invalid permissions");if(e.owner&&e.owner!==null&&typeof e.owner!="string")throw new Error("Invalid owner type");if(e.attributes&&typeof e.attributes!="object")throw new Error("Invalid attributes type");if(e.root&&typeof e.root!="string")throw new Error("Invalid root type");if(e.root&&!e.root.startsWith("/"))throw new Error("Root must start with a leading slash");if(e.root&&!e.source.includes(e.root))throw new Error("Root must be part of the source");if(e.root&&sa(e.source,i)){const t=e.source.match(i)[0];if(!e.source.includes(Te(t,e.root)))throw new Error("The root must be relative to the service. e.g /files/emma")}if(e.status&&!Object.values(mt).includes(e.status))throw new Error("Status must be a valid NodeStatus")};var mt=(e=>(e.NEW="new",e.FAILED="failed",e.LOADING="loading",e.LOCKED="locked",e))(mt||{});class Me{_data;_attributes;_knownDavService=/(remote|public)\.php\/(web)?dav/i;readonlyAttributes=Object.entries(Object.getOwnPropertyDescriptors(Me.prototype)).filter(i=>typeof i[1].get=="function"&&i[0]!=="__proto__").map(i=>i[0]);handler={set:(i,t,n)=>this.readonlyAttributes.includes(t)?!1:Reflect.set(i,t,n),deleteProperty:(i,t)=>this.readonlyAttributes.includes(t)?!1:Reflect.deleteProperty(i,t),get:(i,t,n)=>this.readonlyAttributes.includes(t)?(ki.warn(`Accessing "Node.attributes.${t}" is deprecated, access it directly on the Node instance.`),Reflect.get(this,t)):Reflect.get(i,t,n)};constructor(i,t){i.mime||(i.mime="application/octet-stream"),ce(i,t||this._knownDavService),this._data={displayname:i.attributes?.displayname,...i,attributes:{}},this._attributes=new Proxy(this._data.attributes,this.handler),this.update(i.attributes??{}),t&&(this._knownDavService=t)}get source(){return this._data.source.replace(/\/$/i,"")}get encodedSource(){const{origin:i}=new URL(this.source);return i+Pa(this.source.slice(i.length))}get basename(){return Ba(this.source)}get displayname(){return this._data.displayname||this.basename}set displayname(i){ce({...this._data,displayname:i},this._knownDavService),this._data.displayname=i}get extension(){return ta(this.source)}get dirname(){if(this.root){let t=this.source;this.isDavResource&&(t=t.split(this._knownDavService).pop());const n=t.indexOf(this.root),c=this.root.replace(/\/$/,"");return De(t.slice(n+c.length)||"/")}const i=new URL(this.source);return De(i.pathname)}get mime(){return this._data.mime||"application/octet-stream"}set mime(i){i??="application/octet-stream",ce({...this._data,mime:i},this._knownDavService),this._data.mime=i}get mtime(){return this._data.mtime}set mtime(i){ce({...this._data,mtime:i},this._knownDavService),this._data.mtime=i}get crtime(){return this._data.crtime}get size(){return this._data.size}set size(i){ce({...this._data,size:i},this._knownDavService),this.updateMtime(),this._data.size=i}get attributes(){return this._attributes}get permissions(){return this.owner===null&&!this.isDavResource?ee.READ:this._data.permissions!==void 0?this._data.permissions:ee.NONE}set permissions(i){ce({...this._data,permissions:i},this._knownDavService),this.updateMtime(),this._data.permissions=i}get owner(){return this.isDavResource?this._data.owner:null}get isDavResource(){return sa(this.source,this._knownDavService)}get isDavRessource(){return this.isDavResource}get root(){return this._data.root?this._data.root.replace(/^(.+)\/$/,"$1"):this.isDavResource&&De(this.source).split(this._knownDavService).pop()||null}get path(){if(this.root){let i=this.source;this.isDavResource&&(i=i.split(this._knownDavService).pop());const t=i.indexOf(this.root),n=this.root.replace(/\/$/,"");return i.slice(t+n.length)||"/"}return(this.dirname+"/"+this.basename).replace(/\/\//g,"/")}get fileid(){return this._data?.id}get status(){return this._data?.status}set status(i){ce({...this._data,status:i},this._knownDavService),this._data.status=i}get data(){return structuredClone(this._data)}move(i){ce({...this._data,source:i},this._knownDavService);const t=this.basename;this._data.source=i,this.displayname===t&&this.basename!==t&&(this.displayname=this.basename)}rename(i){if(i.includes("/"))throw new Error("Invalid basename");this.move(De(this.source)+"/"+i)}updateMtime(){this._data.mtime&&(this._data.mtime=new Date)}update(i){for(const[t,n]of Object.entries(i))try{n===void 0?delete this.attributes[t]:this.attributes[t]=n}catch(c){if(c instanceof TypeError)continue;throw c}}}class ht extends Me{get type(){return le.File}clone(){return new ht(this.data)}}class ft extends Me{constructor(i){super({...i,mime:"httpd/unix-directory"})}get type(){return le.Folder}get extension(){return null}get mime(){return"httpd/unix-directory"}clone(){return new ft(this.data)}}const Fi=function(e=""){let i=ee.NONE;return e&&((e.includes("C")||e.includes("K"))&&(i|=ee.CREATE),e.includes("G")&&(i|=ee.READ),(e.includes("W")||e.includes("N")||e.includes("V"))&&(i|=ee.UPDATE),e.includes("D")&&(i|=ee.DELETE),e.includes("R")&&(i|=ee.SHARE)),i},$i=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],Pi={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},vt=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...$i]),window._nc_dav_properties.map(e=>`<${e} />`).join(" ")},gt=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...Pi}),Object.keys(window._nc_dav_namespaces).map(e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`).join(" ")},oa=function(){return`<?xml version="1.0"?>
		<d:propfind ${gt()}>
			<d:prop>
				${vt()}
			</d:prop>
		</d:propfind>`},Bi=function(){return`<?xml version="1.0"?>
		<oc:filter-files ${gt()}>
			<d:prop>
				${vt()}
			</d:prop>
			<oc:filter-rules>
				<oc:favorite>1</oc:favorite>
			</oc:filter-rules>
		</oc:filter-files>`},xi=function(e){return`<?xml version="1.0" encoding="UTF-8"?>
<d:searchrequest ${gt()}
	xmlns:ns="https://github.com/icewind1991/SearchDAV/ns">
	<d:basicsearch>
		<d:select>
			<d:prop>
				${vt()}
			</d:prop>
		</d:select>
		<d:from>
			<d:scope>
				<d:href>/files/${Be()?.uid}/</d:href>
				<d:depth>infinity</d:depth>
			</d:scope>
		</d:from>
		<d:where>
			<d:and>
				<d:or>
					<d:not>
						<d:eq>
							<d:prop>
								<d:getcontenttype/>
							</d:prop>
							<d:literal>httpd/unix-directory</d:literal>
						</d:eq>
					</d:not>
					<d:eq>
						<d:prop>
							<oc:size/>
						</d:prop>
						<d:literal>0</d:literal>
					</d:eq>
				</d:or>
				<d:gt>
					<d:prop>
						<d:getlastmodified/>
					</d:prop>
					<d:literal>${e}</d:literal>
				</d:gt>
			</d:and>
		</d:where>
		<d:orderby>
			<d:order>
				<d:prop>
					<d:getlastmodified/>
				</d:prop>
				<d:descending/>
			</d:order>
		</d:orderby>
		<d:limit>
			<d:nresults>100</d:nresults>
			<ns:firstresult>0</ns:firstresult>
		</d:limit>
	</d:basicsearch>
</d:searchrequest>`};function Mi(){return Ce()?`/files/${Ga()}`:`/files/${Be()?.uid}`}const Le=Mi();function Ui(){const e=wa("dav");return Ce()?e.replace("remote.php","public.php"):e}const la=Ui(),zi=function(e=la,i={}){const t=qa(e,{headers:i});function n(c){t.setHeaders({...i,"X-Requested-With":"XMLHttpRequest",requesttoken:c??""})}return Ta(n),n(ya()),Ha().patch("fetch",(c,m)=>{const u=m.headers;return u?.method&&(m.method=u.method,delete u.method),fetch(c,m)}),t},Vi=(e,i="/",t=Le)=>{const n=new AbortController;return new ie(async(c,m,u)=>{u(()=>n.abort());try{const f=(await e.getDirectoryContents(`${t}${i}`,{signal:n.signal,details:!0,data:Bi(),headers:{method:"REPORT"},includeSelf:!0})).data.filter(d=>d.filename!==i).map(d=>Ue(d,t));c(f)}catch(f){m(f)}})},Ue=function(e,i=Le,t=la){let n=Be()?.uid;if(Ce())n=n??"anonymous";else if(!n)throw new Error("No user id found");const c=e.props,m=Fi(c?.permissions),u=String(c?.["owner-id"]||n),f=c.fileid||0,d=new Date(Date.parse(e.lastmod)),p=new Date(Date.parse(c.creationdate)),l={id:f,source:`${t}${e.filename}`,mtime:!isNaN(d.getTime())&&d.getTime()!==0?d:void 0,crtime:!isNaN(p.getTime())&&p.getTime()!==0?p:void 0,mime:e.mime||"application/octet-stream",displayname:c.displayname!==void 0?String(c.displayname):void 0,size:c?.size||Number.parseInt(c.getcontentlength||"0"),status:f<0?mt.FAILED:void 0,permissions:m,owner:u,root:i,attributes:{...e,...c,hasPreview:c?.["has-preview"]}};return delete l.attributes?.props,e.type==="file"?new ht(l):new ft(l)};var Gi=Xa();const Xi=Ia(Gi);var He={},Pt,Bt;function ca(){return Bt||(Bt=1,Pt=typeof Na=="object"&&He&&He.NODE_DEBUG&&/\bsemver\b/i.test(He.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}),Pt}var We,xt;function ua(){if(xt)return We;xt=1;const e="2.0.0",i=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,c=i-6;return We={MAX_LENGTH:i,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:c,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:e,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},We}var Ye={exports:{}},Mt;function ji(){return Mt||(Mt=1,(function(e,i){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:c}=ua(),m=ca();i=e.exports={};const u=i.re=[],f=i.safeRe=[],d=i.src=[],p=i.safeSrc=[],l=i.t={};let g=0;const E="[a-zA-Z0-9-]",I=[["\\s",1],["\\d",c],[E,n]],G=H=>{for(const[X,te]of I)H=H.split(`${X}*`).join(`${X}{0,${te}}`).split(`${X}+`).join(`${X}{1,${te}}`);return H},b=(H,X,te)=>{const J=G(X),C=g++;m(H,C,X),l[H]=C,d[C]=X,p[C]=J,u[C]=new RegExp(X,te?"g":void 0),f[C]=new RegExp(J,te?"g":void 0)};b("NUMERICIDENTIFIER","0|[1-9]\\d*"),b("NUMERICIDENTIFIERLOOSE","\\d+"),b("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${E}*`),b("MAINVERSION",`(${d[l.NUMERICIDENTIFIER]})\\.(${d[l.NUMERICIDENTIFIER]})\\.(${d[l.NUMERICIDENTIFIER]})`),b("MAINVERSIONLOOSE",`(${d[l.NUMERICIDENTIFIERLOOSE]})\\.(${d[l.NUMERICIDENTIFIERLOOSE]})\\.(${d[l.NUMERICIDENTIFIERLOOSE]})`),b("PRERELEASEIDENTIFIER",`(?:${d[l.NONNUMERICIDENTIFIER]}|${d[l.NUMERICIDENTIFIER]})`),b("PRERELEASEIDENTIFIERLOOSE",`(?:${d[l.NONNUMERICIDENTIFIER]}|${d[l.NUMERICIDENTIFIERLOOSE]})`),b("PRERELEASE",`(?:-(${d[l.PRERELEASEIDENTIFIER]}(?:\\.${d[l.PRERELEASEIDENTIFIER]})*))`),b("PRERELEASELOOSE",`(?:-?(${d[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${d[l.PRERELEASEIDENTIFIERLOOSE]})*))`),b("BUILDIDENTIFIER",`${E}+`),b("BUILD",`(?:\\+(${d[l.BUILDIDENTIFIER]}(?:\\.${d[l.BUILDIDENTIFIER]})*))`),b("FULLPLAIN",`v?${d[l.MAINVERSION]}${d[l.PRERELEASE]}?${d[l.BUILD]}?`),b("FULL",`^${d[l.FULLPLAIN]}$`),b("LOOSEPLAIN",`[v=\\s]*${d[l.MAINVERSIONLOOSE]}${d[l.PRERELEASELOOSE]}?${d[l.BUILD]}?`),b("LOOSE",`^${d[l.LOOSEPLAIN]}$`),b("GTLT","((?:<|>)?=?)"),b("XRANGEIDENTIFIERLOOSE",`${d[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),b("XRANGEIDENTIFIER",`${d[l.NUMERICIDENTIFIER]}|x|X|\\*`),b("XRANGEPLAIN",`[v=\\s]*(${d[l.XRANGEIDENTIFIER]})(?:\\.(${d[l.XRANGEIDENTIFIER]})(?:\\.(${d[l.XRANGEIDENTIFIER]})(?:${d[l.PRERELEASE]})?${d[l.BUILD]}?)?)?`),b("XRANGEPLAINLOOSE",`[v=\\s]*(${d[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[l.XRANGEIDENTIFIERLOOSE]})(?:${d[l.PRERELEASELOOSE]})?${d[l.BUILD]}?)?)?`),b("XRANGE",`^${d[l.GTLT]}\\s*${d[l.XRANGEPLAIN]}$`),b("XRANGELOOSE",`^${d[l.GTLT]}\\s*${d[l.XRANGEPLAINLOOSE]}$`),b("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),b("COERCE",`${d[l.COERCEPLAIN]}(?:$|[^\\d])`),b("COERCEFULL",d[l.COERCEPLAIN]+`(?:${d[l.PRERELEASE]})?(?:${d[l.BUILD]})?(?:$|[^\\d])`),b("COERCERTL",d[l.COERCE],!0),b("COERCERTLFULL",d[l.COERCEFULL],!0),b("LONETILDE","(?:~>?)"),b("TILDETRIM",`(\\s*)${d[l.LONETILDE]}\\s+`,!0),i.tildeTrimReplace="$1~",b("TILDE",`^${d[l.LONETILDE]}${d[l.XRANGEPLAIN]}$`),b("TILDELOOSE",`^${d[l.LONETILDE]}${d[l.XRANGEPLAINLOOSE]}$`),b("LONECARET","(?:\\^)"),b("CARETTRIM",`(\\s*)${d[l.LONECARET]}\\s+`,!0),i.caretTrimReplace="$1^",b("CARET",`^${d[l.LONECARET]}${d[l.XRANGEPLAIN]}$`),b("CARETLOOSE",`^${d[l.LONECARET]}${d[l.XRANGEPLAINLOOSE]}$`),b("COMPARATORLOOSE",`^${d[l.GTLT]}\\s*(${d[l.LOOSEPLAIN]})$|^$`),b("COMPARATOR",`^${d[l.GTLT]}\\s*(${d[l.FULLPLAIN]})$|^$`),b("COMPARATORTRIM",`(\\s*)${d[l.GTLT]}\\s*(${d[l.LOOSEPLAIN]}|${d[l.XRANGEPLAIN]})`,!0),i.comparatorTrimReplace="$1$2$3",b("HYPHENRANGE",`^\\s*(${d[l.XRANGEPLAIN]})\\s+-\\s+(${d[l.XRANGEPLAIN]})\\s*$`),b("HYPHENRANGELOOSE",`^\\s*(${d[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${d[l.XRANGEPLAINLOOSE]})\\s*$`),b("STAR","(<|>)?=?\\s*\\*"),b("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),b("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Ye,Ye.exports)),Ye.exports}var Qe,Ut;function qi(){if(Ut)return Qe;Ut=1;const e=Object.freeze({loose:!0}),i=Object.freeze({});return Qe=t=>t?typeof t!="object"?e:t:i,Qe}var Ke,zt;function Hi(){if(zt)return Ke;zt=1;const e=/^[0-9]+$/,i=(t,n)=>{if(typeof t=="number"&&typeof n=="number")return t===n?0:t<n?-1:1;const c=e.test(t),m=e.test(n);return c&&m&&(t=+t,n=+n),t===n?0:c&&!m?-1:m&&!c?1:t<n?-1:1};return Ke={compareIdentifiers:i,rcompareIdentifiers:(t,n)=>i(n,t)},Ke}var Ze,Vt;function da(){if(Vt)return Ze;Vt=1;const e=ca(),{MAX_LENGTH:i,MAX_SAFE_INTEGER:t}=ua(),{safeRe:n,t:c}=ji(),m=qi(),{compareIdentifiers:u}=Hi();class f{constructor(p,l){if(l=m(l),p instanceof f){if(p.loose===!!l.loose&&p.includePrerelease===!!l.includePrerelease)return p;p=p.version}else if(typeof p!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof p}".`);if(p.length>i)throw new TypeError(`version is longer than ${i} characters`);e("SemVer",p,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const g=p.trim().match(l.loose?n[c.LOOSE]:n[c.FULL]);if(!g)throw new TypeError(`Invalid Version: ${p}`);if(this.raw=p,this.major=+g[1],this.minor=+g[2],this.patch=+g[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");g[4]?this.prerelease=g[4].split(".").map(E=>{if(/^[0-9]+$/.test(E)){const I=+E;if(I>=0&&I<t)return I}return E}):this.prerelease=[],this.build=g[5]?g[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(p){if(e("SemVer.compare",this.version,this.options,p),!(p instanceof f)){if(typeof p=="string"&&p===this.version)return 0;p=new f(p,this.options)}return p.version===this.version?0:this.compareMain(p)||this.comparePre(p)}compareMain(p){return p instanceof f||(p=new f(p,this.options)),this.major<p.major?-1:this.major>p.major?1:this.minor<p.minor?-1:this.minor>p.minor?1:this.patch<p.patch?-1:this.patch>p.patch?1:0}comparePre(p){if(p instanceof f||(p=new f(p,this.options)),this.prerelease.length&&!p.prerelease.length)return-1;if(!this.prerelease.length&&p.prerelease.length)return 1;if(!this.prerelease.length&&!p.prerelease.length)return 0;let l=0;do{const g=this.prerelease[l],E=p.prerelease[l];if(e("prerelease compare",l,g,E),g===void 0&&E===void 0)return 0;if(E===void 0)return 1;if(g===void 0)return-1;if(g!==E)return u(g,E)}while(++l)}compareBuild(p){p instanceof f||(p=new f(p,this.options));let l=0;do{const g=this.build[l],E=p.build[l];if(e("build compare",l,g,E),g===void 0&&E===void 0)return 0;if(E===void 0)return 1;if(g===void 0)return-1;if(g!==E)return u(g,E)}while(++l)}inc(p,l,g){if(p.startsWith("pre")){if(!l&&g===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const E=`-${l}`.match(this.options.loose?n[c.PRERELEASELOOSE]:n[c.PRERELEASE]);if(!E||E[1]!==l)throw new Error(`invalid identifier: ${l}`)}}switch(p){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,g);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,g);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,g),this.inc("pre",l,g);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,g),this.inc("pre",l,g);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const E=Number(g)?1:0;if(this.prerelease.length===0)this.prerelease=[E];else{let I=this.prerelease.length;for(;--I>=0;)typeof this.prerelease[I]=="number"&&(this.prerelease[I]++,I=-2);if(I===-1){if(l===this.prerelease.join(".")&&g===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(E)}}if(l){let I=[l,E];g===!1&&(I=[l]),u(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=I):this.prerelease=I}break}default:throw new Error(`invalid increment argument: ${p}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Ze=f,Ze}var Je,Gt;function Wi(){if(Gt)return Je;Gt=1;const e=da();return Je=(i,t)=>new e(i,t).major,Je}Wi();var et,Xt;function Yi(){if(Xt)return et;Xt=1;const e=da();return et=(i,t,n=!1)=>{if(i instanceof e)return i;try{return new e(i,t)}catch(c){if(!n)return null;throw c}},et}var tt,jt;function Qi(){if(jt)return tt;jt=1;const e=Yi();return tt=(i,t)=>{const n=e(i,t);return n?n.version:null},tt}Qi();var qt={},Ht;function Ki(){return Ht||(Ht=1,(function(e){(function(i){i.parser=function(r,a){return new n(r,a)},i.SAXParser=n,i.SAXStream=l,i.createStream=p,i.MAX_BUFFER_LENGTH=64*1024;var t=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];i.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(r,a){if(!(this instanceof n))return new n(r,a);var h=this;m(h),h.q=h.c="",h.bufferCheckPosition=i.MAX_BUFFER_LENGTH,h.opt=a||{},h.opt.lowercase=h.opt.lowercase||h.opt.lowercasetags,h.looseCase=h.opt.lowercase?"toLowerCase":"toUpperCase",h.tags=[],h.closed=h.closedRoot=h.sawRoot=!1,h.tag=h.error=null,h.strict=!!r,h.noscript=!!(r||h.opt.noscript),h.state=o.BEGIN,h.strictEntities=h.opt.strictEntities,h.ENTITIES=h.strictEntities?Object.create(i.XML_ENTITIES):Object.create(i.ENTITIES),h.attribList=[],h.opt.xmlns&&(h.ns=Object.create(b)),h.opt.unquotedAttributeValues===void 0&&(h.opt.unquotedAttributeValues=!r),h.trackPosition=h.opt.position!==!1,h.trackPosition&&(h.position=h.line=h.column=0),y(h,"onready")}Object.create||(Object.create=function(r){function a(){}a.prototype=r;var h=new a;return h}),Object.keys||(Object.keys=function(r){var a=[];for(var h in r)r.hasOwnProperty(h)&&a.push(h);return a});function c(r){for(var a=Math.max(i.MAX_BUFFER_LENGTH,10),h=0,s=0,L=t.length;s<L;s++){var z=r[t[s]].length;if(z>a)switch(t[s]){case"textNode":ne(r);break;case"cdata":N(r,"oncdata",r.cdata),r.cdata="";break;case"script":N(r,"onscript",r.script),r.script="";break;default:Ee(r,"Max buffer length exceeded: "+t[s])}h=Math.max(h,z)}var V=i.MAX_BUFFER_LENGTH-h;r.bufferCheckPosition=V+r.position}function m(r){for(var a=0,h=t.length;a<h;a++)r[t[a]]=""}function u(r){ne(r),r.cdata!==""&&(N(r,"oncdata",r.cdata),r.cdata=""),r.script!==""&&(N(r,"onscript",r.script),r.script="")}n.prototype={end:function(){_t(this)},write:ga,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){u(this)}};var f;try{f=require("stream").Stream}catch{f=function(){}}f||(f=function(){});var d=i.EVENTS.filter(function(r){return r!=="error"&&r!=="end"});function p(r,a){return new l(r,a)}function l(r,a){if(!(this instanceof l))return new l(r,a);f.apply(this),this._parser=new n(r,a),this.writable=!0,this.readable=!0;var h=this;this._parser.onend=function(){h.emit("end")},this._parser.onerror=function(s){h.emit("error",s),h._parser.error=null},this._decoder=null,d.forEach(function(s){Object.defineProperty(h,"on"+s,{get:function(){return h._parser["on"+s]},set:function(L){if(!L)return h.removeAllListeners(s),h._parser["on"+s]=L,L;h.on(s,L)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(f.prototype,{constructor:{value:l}}),l.prototype.write=function(r){if(typeof qe=="function"&&typeof qe.isBuffer=="function"&&qe.isBuffer(r)){if(!this._decoder){var a=Xi.StringDecoder;this._decoder=new a("utf8")}r=this._decoder.write(r)}return this._parser.write(r.toString()),this.emit("data",r),!0},l.prototype.end=function(r){return r&&r.length&&this.write(r),this._parser.end(),!0},l.prototype.on=function(r,a){var h=this;return!h._parser["on"+r]&&d.indexOf(r)!==-1&&(h._parser["on"+r]=function(){var s=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);s.splice(0,0,r),h.emit.apply(h,s)}),f.prototype.on.call(h,r,a)};var g="[CDATA[",E="DOCTYPE",I="http://www.w3.org/XML/1998/namespace",G="http://www.w3.org/2000/xmlns/",b={xml:I,xmlns:G},H=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,X=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,te=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,J=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function C(r){return r===" "||r===`
`||r==="\r"||r==="	"}function F(r){return r==='"'||r==="'"}function U(r){return r===">"||C(r)}function D(r,a){return r.test(a)}function re(r,a){return!D(r,a)}var o=0;i.STATE={BEGIN:o++,BEGIN_WHITESPACE:o++,TEXT:o++,TEXT_ENTITY:o++,OPEN_WAKA:o++,SGML_DECL:o++,SGML_DECL_QUOTED:o++,DOCTYPE:o++,DOCTYPE_QUOTED:o++,DOCTYPE_DTD:o++,DOCTYPE_DTD_QUOTED:o++,COMMENT_STARTING:o++,COMMENT:o++,COMMENT_ENDING:o++,COMMENT_ENDED:o++,CDATA:o++,CDATA_ENDING:o++,CDATA_ENDING_2:o++,PROC_INST:o++,PROC_INST_BODY:o++,PROC_INST_ENDING:o++,OPEN_TAG:o++,OPEN_TAG_SLASH:o++,ATTRIB:o++,ATTRIB_NAME:o++,ATTRIB_NAME_SAW_WHITE:o++,ATTRIB_VALUE:o++,ATTRIB_VALUE_QUOTED:o++,ATTRIB_VALUE_CLOSED:o++,ATTRIB_VALUE_UNQUOTED:o++,ATTRIB_VALUE_ENTITY_Q:o++,ATTRIB_VALUE_ENTITY_U:o++,CLOSE_TAG:o++,CLOSE_TAG_SAW_WHITE:o++,SCRIPT:o++,SCRIPT_ENDING:o++},i.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},i.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(i.ENTITIES).forEach(function(r){var a=i.ENTITIES[r],h=typeof a=="number"?String.fromCharCode(a):a;i.ENTITIES[r]=h});for(var S in i.STATE)i.STATE[i.STATE[S]]=S;o=i.STATE;function y(r,a,h){r[a]&&r[a](h)}function N(r,a,h){r.textNode&&ne(r),y(r,a,h)}function ne(r){r.textNode=Et(r.opt,r.textNode),r.textNode&&y(r,"ontext",r.textNode),r.textNode=""}function Et(r,a){return r.trim&&(a=a.trim()),r.normalize&&(a=a.replace(/\s+/g," ")),a}function Ee(r,a){return ne(r),r.trackPosition&&(a+=`
Line: `+r.line+`
Column: `+r.column+`
Char: `+r.c),a=new Error(a),r.error=a,y(r,"onerror",a),r}function _t(r){return r.sawRoot&&!r.closedRoot&&R(r,"Unclosed root tag"),r.state!==o.BEGIN&&r.state!==o.BEGIN_WHITESPACE&&r.state!==o.TEXT&&Ee(r,"Unexpected end"),ne(r),r.c="",r.closed=!0,y(r,"onend"),n.call(r,r.strict,r.opt),r}function R(r,a){if(typeof r!="object"||!(r instanceof n))throw new Error("bad call to strictFail");r.strict&&Ee(r,a)}function fa(r){r.strict||(r.tagName=r.tagName[r.looseCase]());var a=r.tags[r.tags.length-1]||r,h=r.tag={name:r.tagName,attributes:{}};r.opt.xmlns&&(h.ns=a.ns),r.attribList.length=0,N(r,"onopentagstart",h)}function ze(r,a){var h=r.indexOf(":"),s=h<0?["",r]:r.split(":"),L=s[0],z=s[1];return a&&r==="xmlns"&&(L="xmlns",z=""),{prefix:L,local:z}}function Ve(r){if(r.strict||(r.attribName=r.attribName[r.looseCase]()),r.attribList.indexOf(r.attribName)!==-1||r.tag.attributes.hasOwnProperty(r.attribName)){r.attribName=r.attribValue="";return}if(r.opt.xmlns){var a=ze(r.attribName,!0),h=a.prefix,s=a.local;if(h==="xmlns")if(s==="xml"&&r.attribValue!==I)R(r,"xml: prefix must be bound to "+I+`
Actual: `+r.attribValue);else if(s==="xmlns"&&r.attribValue!==G)R(r,"xmlns: prefix must be bound to "+G+`
Actual: `+r.attribValue);else{var L=r.tag,z=r.tags[r.tags.length-1]||r;L.ns===z.ns&&(L.ns=Object.create(z.ns)),L.ns[s]=r.attribValue}r.attribList.push([r.attribName,r.attribValue])}else r.tag.attributes[r.attribName]=r.attribValue,N(r,"onattribute",{name:r.attribName,value:r.attribValue});r.attribName=r.attribValue=""}function pe(r,a){if(r.opt.xmlns){var h=r.tag,s=ze(r.tagName);h.prefix=s.prefix,h.local=s.local,h.uri=h.ns[s.prefix]||"",h.prefix&&!h.uri&&(R(r,"Unbound namespace prefix: "+JSON.stringify(r.tagName)),h.uri=s.prefix);var L=r.tags[r.tags.length-1]||r;h.ns&&L.ns!==h.ns&&Object.keys(h.ns).forEach(function(Tt){N(r,"onopennamespace",{prefix:Tt,uri:h.ns[Tt]})});for(var z=0,V=r.attribList.length;z<V;z++){var Q=r.attribList[z],K=Q[0],ve=Q[1],j=ze(K,!0),se=j.prefix,Ea=j.local,yt=se===""?"":h.ns[se]||"",Xe={name:K,value:ve,prefix:se,local:Ea,uri:yt};se&&se!=="xmlns"&&!yt&&(R(r,"Unbound namespace prefix: "+JSON.stringify(se)),Xe.uri=se),r.tag.attributes[K]=Xe,N(r,"onattribute",Xe)}r.attribList.length=0}r.tag.isSelfClosing=!!a,r.sawRoot=!0,r.tags.push(r.tag),N(r,"onopentag",r.tag),a||(!r.noscript&&r.tagName.toLowerCase()==="script"?r.state=o.SCRIPT:r.state=o.TEXT,r.tag=null,r.tagName=""),r.attribName=r.attribValue="",r.attribList.length=0}function Ge(r){if(!r.tagName){R(r,"Weird empty close tag."),r.textNode+="</>",r.state=o.TEXT;return}if(r.script){if(r.tagName!=="script"){r.script+="</"+r.tagName+">",r.tagName="",r.state=o.SCRIPT;return}N(r,"onscript",r.script),r.script=""}var a=r.tags.length,h=r.tagName;r.strict||(h=h[r.looseCase]());for(var s=h;a--;){var L=r.tags[a];if(L.name!==s)R(r,"Unexpected close tag");else break}if(a<0){R(r,"Unmatched closing tag: "+r.tagName),r.textNode+="</"+r.tagName+">",r.state=o.TEXT;return}r.tagName=h;for(var z=r.tags.length;z-- >a;){var V=r.tag=r.tags.pop();r.tagName=r.tag.name,N(r,"onclosetag",r.tagName);var Q={};for(var K in V.ns)Q[K]=V.ns[K];var ve=r.tags[r.tags.length-1]||r;r.opt.xmlns&&V.ns!==ve.ns&&Object.keys(V.ns).forEach(function(j){var se=V.ns[j];N(r,"onclosenamespace",{prefix:j,uri:se})})}a===0&&(r.closedRoot=!0),r.tagName=r.attribValue=r.attribName="",r.attribList.length=0,r.state=o.TEXT}function va(r){var a=r.entity,h=a.toLowerCase(),s,L="";return r.ENTITIES[a]?r.ENTITIES[a]:r.ENTITIES[h]?r.ENTITIES[h]:(a=h,a.charAt(0)==="#"&&(a.charAt(1)==="x"?(a=a.slice(2),s=parseInt(a,16),L=s.toString(16)):(a=a.slice(1),s=parseInt(a,10),L=s.toString(10))),a=a.replace(/^0+/,""),isNaN(s)||L.toLowerCase()!==a?(R(r,"Invalid character entity"),"&"+r.entity+";"):String.fromCodePoint(s))}function bt(r,a){a==="<"?(r.state=o.OPEN_WAKA,r.startTagPosition=r.position):C(a)||(R(r,"Non-whitespace before first tag."),r.textNode=a,r.state=o.TEXT)}function wt(r,a){var h="";return a<r.length&&(h=r.charAt(a)),h}function ga(r){var a=this;if(this.error)throw this.error;if(a.closed)return Ee(a,"Cannot write after close. Assign an onready handler.");if(r===null)return _t(a);typeof r=="object"&&(r=r.toString());for(var h=0,s="";s=wt(r,h++),a.c=s,!!s;)switch(a.trackPosition&&(a.position++,s===`
`?(a.line++,a.column=0):a.column++),a.state){case o.BEGIN:if(a.state=o.BEGIN_WHITESPACE,s==="\uFEFF")continue;bt(a,s);continue;case o.BEGIN_WHITESPACE:bt(a,s);continue;case o.TEXT:if(a.sawRoot&&!a.closedRoot){for(var L=h-1;s&&s!=="<"&&s!=="&";)s=wt(r,h++),s&&a.trackPosition&&(a.position++,s===`
`?(a.line++,a.column=0):a.column++);a.textNode+=r.substring(L,h-1)}s==="<"&&!(a.sawRoot&&a.closedRoot&&!a.strict)?(a.state=o.OPEN_WAKA,a.startTagPosition=a.position):(!C(s)&&(!a.sawRoot||a.closedRoot)&&R(a,"Text data outside of root node."),s==="&"?a.state=o.TEXT_ENTITY:a.textNode+=s);continue;case o.SCRIPT:s==="<"?a.state=o.SCRIPT_ENDING:a.script+=s;continue;case o.SCRIPT_ENDING:s==="/"?a.state=o.CLOSE_TAG:(a.script+="<"+s,a.state=o.SCRIPT);continue;case o.OPEN_WAKA:if(s==="!")a.state=o.SGML_DECL,a.sgmlDecl="";else if(!C(s))if(D(H,s))a.state=o.OPEN_TAG,a.tagName=s;else if(s==="/")a.state=o.CLOSE_TAG,a.tagName="";else if(s==="?")a.state=o.PROC_INST,a.procInstName=a.procInstBody="";else{if(R(a,"Unencoded <"),a.startTagPosition+1<a.position){var z=a.position-a.startTagPosition;s=new Array(z).join(" ")+s}a.textNode+="<"+s,a.state=o.TEXT}continue;case o.SGML_DECL:if(a.sgmlDecl+s==="--"){a.state=o.COMMENT,a.comment="",a.sgmlDecl="";continue}a.doctype&&a.doctype!==!0&&a.sgmlDecl?(a.state=o.DOCTYPE_DTD,a.doctype+="<!"+a.sgmlDecl+s,a.sgmlDecl=""):(a.sgmlDecl+s).toUpperCase()===g?(N(a,"onopencdata"),a.state=o.CDATA,a.sgmlDecl="",a.cdata=""):(a.sgmlDecl+s).toUpperCase()===E?(a.state=o.DOCTYPE,(a.doctype||a.sawRoot)&&R(a,"Inappropriately located doctype declaration"),a.doctype="",a.sgmlDecl=""):s===">"?(N(a,"onsgmldeclaration",a.sgmlDecl),a.sgmlDecl="",a.state=o.TEXT):(F(s)&&(a.state=o.SGML_DECL_QUOTED),a.sgmlDecl+=s);continue;case o.SGML_DECL_QUOTED:s===a.q&&(a.state=o.SGML_DECL,a.q=""),a.sgmlDecl+=s;continue;case o.DOCTYPE:s===">"?(a.state=o.TEXT,N(a,"ondoctype",a.doctype),a.doctype=!0):(a.doctype+=s,s==="["?a.state=o.DOCTYPE_DTD:F(s)&&(a.state=o.DOCTYPE_QUOTED,a.q=s));continue;case o.DOCTYPE_QUOTED:a.doctype+=s,s===a.q&&(a.q="",a.state=o.DOCTYPE);continue;case o.DOCTYPE_DTD:s==="]"?(a.doctype+=s,a.state=o.DOCTYPE):s==="<"?(a.state=o.OPEN_WAKA,a.startTagPosition=a.position):F(s)?(a.doctype+=s,a.state=o.DOCTYPE_DTD_QUOTED,a.q=s):a.doctype+=s;continue;case o.DOCTYPE_DTD_QUOTED:a.doctype+=s,s===a.q&&(a.state=o.DOCTYPE_DTD,a.q="");continue;case o.COMMENT:s==="-"?a.state=o.COMMENT_ENDING:a.comment+=s;continue;case o.COMMENT_ENDING:s==="-"?(a.state=o.COMMENT_ENDED,a.comment=Et(a.opt,a.comment),a.comment&&N(a,"oncomment",a.comment),a.comment=""):(a.comment+="-"+s,a.state=o.COMMENT);continue;case o.COMMENT_ENDED:s!==">"?(R(a,"Malformed comment"),a.comment+="--"+s,a.state=o.COMMENT):a.doctype&&a.doctype!==!0?a.state=o.DOCTYPE_DTD:a.state=o.TEXT;continue;case o.CDATA:s==="]"?a.state=o.CDATA_ENDING:a.cdata+=s;continue;case o.CDATA_ENDING:s==="]"?a.state=o.CDATA_ENDING_2:(a.cdata+="]"+s,a.state=o.CDATA);continue;case o.CDATA_ENDING_2:s===">"?(a.cdata&&N(a,"oncdata",a.cdata),N(a,"onclosecdata"),a.cdata="",a.state=o.TEXT):s==="]"?a.cdata+="]":(a.cdata+="]]"+s,a.state=o.CDATA);continue;case o.PROC_INST:s==="?"?a.state=o.PROC_INST_ENDING:C(s)?a.state=o.PROC_INST_BODY:a.procInstName+=s;continue;case o.PROC_INST_BODY:if(!a.procInstBody&&C(s))continue;s==="?"?a.state=o.PROC_INST_ENDING:a.procInstBody+=s;continue;case o.PROC_INST_ENDING:s===">"?(N(a,"onprocessinginstruction",{name:a.procInstName,body:a.procInstBody}),a.procInstName=a.procInstBody="",a.state=o.TEXT):(a.procInstBody+="?"+s,a.state=o.PROC_INST_BODY);continue;case o.OPEN_TAG:D(X,s)?a.tagName+=s:(fa(a),s===">"?pe(a):s==="/"?a.state=o.OPEN_TAG_SLASH:(C(s)||R(a,"Invalid character in tag name"),a.state=o.ATTRIB));continue;case o.OPEN_TAG_SLASH:s===">"?(pe(a,!0),Ge(a)):(R(a,"Forward-slash in opening tag not followed by >"),a.state=o.ATTRIB);continue;case o.ATTRIB:if(C(s))continue;s===">"?pe(a):s==="/"?a.state=o.OPEN_TAG_SLASH:D(H,s)?(a.attribName=s,a.attribValue="",a.state=o.ATTRIB_NAME):R(a,"Invalid attribute name");continue;case o.ATTRIB_NAME:s==="="?a.state=o.ATTRIB_VALUE:s===">"?(R(a,"Attribute without value"),a.attribValue=a.attribName,Ve(a),pe(a)):C(s)?a.state=o.ATTRIB_NAME_SAW_WHITE:D(X,s)?a.attribName+=s:R(a,"Invalid attribute name");continue;case o.ATTRIB_NAME_SAW_WHITE:if(s==="=")a.state=o.ATTRIB_VALUE;else{if(C(s))continue;R(a,"Attribute without value"),a.tag.attributes[a.attribName]="",a.attribValue="",N(a,"onattribute",{name:a.attribName,value:""}),a.attribName="",s===">"?pe(a):D(H,s)?(a.attribName=s,a.state=o.ATTRIB_NAME):(R(a,"Invalid attribute name"),a.state=o.ATTRIB)}continue;case o.ATTRIB_VALUE:if(C(s))continue;F(s)?(a.q=s,a.state=o.ATTRIB_VALUE_QUOTED):(a.opt.unquotedAttributeValues||Ee(a,"Unquoted attribute value"),a.state=o.ATTRIB_VALUE_UNQUOTED,a.attribValue=s);continue;case o.ATTRIB_VALUE_QUOTED:if(s!==a.q){s==="&"?a.state=o.ATTRIB_VALUE_ENTITY_Q:a.attribValue+=s;continue}Ve(a),a.q="",a.state=o.ATTRIB_VALUE_CLOSED;continue;case o.ATTRIB_VALUE_CLOSED:C(s)?a.state=o.ATTRIB:s===">"?pe(a):s==="/"?a.state=o.OPEN_TAG_SLASH:D(H,s)?(R(a,"No whitespace between attributes"),a.attribName=s,a.attribValue="",a.state=o.ATTRIB_NAME):R(a,"Invalid attribute name");continue;case o.ATTRIB_VALUE_UNQUOTED:if(!U(s)){s==="&"?a.state=o.ATTRIB_VALUE_ENTITY_U:a.attribValue+=s;continue}Ve(a),s===">"?pe(a):a.state=o.ATTRIB;continue;case o.CLOSE_TAG:if(a.tagName)s===">"?Ge(a):D(X,s)?a.tagName+=s:a.script?(a.script+="</"+a.tagName,a.tagName="",a.state=o.SCRIPT):(C(s)||R(a,"Invalid tagname in closing tag"),a.state=o.CLOSE_TAG_SAW_WHITE);else{if(C(s))continue;re(H,s)?a.script?(a.script+="</"+s,a.state=o.SCRIPT):R(a,"Invalid tagname in closing tag."):a.tagName=s}continue;case o.CLOSE_TAG_SAW_WHITE:if(C(s))continue;s===">"?Ge(a):R(a,"Invalid characters in closing tag");continue;case o.TEXT_ENTITY:case o.ATTRIB_VALUE_ENTITY_Q:case o.ATTRIB_VALUE_ENTITY_U:var V,Q;switch(a.state){case o.TEXT_ENTITY:V=o.TEXT,Q="textNode";break;case o.ATTRIB_VALUE_ENTITY_Q:V=o.ATTRIB_VALUE_QUOTED,Q="attribValue";break;case o.ATTRIB_VALUE_ENTITY_U:V=o.ATTRIB_VALUE_UNQUOTED,Q="attribValue";break}if(s===";"){var K=va(a);a.opt.unparsedEntities&&!Object.values(i.XML_ENTITIES).includes(K)?(a.entity="",a.state=V,a.write(K)):(a[Q]+=K,a.entity="",a.state=V)}else D(a.entity.length?J:te,s)?a.entity+=s:(R(a,"Invalid character in entity name"),a[Q]+="&"+a.entity+s,a.entity="",a.state=V);continue;default:throw new Error(a,"Unknown state: "+a.state)}return a.position>=a.bufferCheckPosition&&c(a),a}String.fromCodePoint||(function(){var r=String.fromCharCode,a=Math.floor,h=function(){var s=16384,L=[],z,V,Q=-1,K=arguments.length;if(!K)return"";for(var ve="";++Q<K;){var j=Number(arguments[Q]);if(!isFinite(j)||j<0||j>1114111||a(j)!==j)throw RangeError("Invalid code point: "+j);j<=65535?L.push(j):(j-=65536,z=(j>>10)+55296,V=j%1024+56320,L.push(z,V)),(Q+1===K||L.length>s)&&(ve+=r.apply(null,L),L.length=0)}return ve};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:h,configurable:!0,writable:!0}):String.fromCodePoint=h})()})(e)})(qt)),qt}Ki();var Fe=(e=>(e.ReservedName="reserved name",e.Character="character",e.Extension="extension",e))(Fe||{});class be extends Error{constructor(i){super(`Invalid ${i.reason} '${i.segment}' in filename '${i.filename}'`,{cause:i})}get filename(){return this.cause.filename}get reason(){return this.cause.reason}get segment(){return this.cause.segment}}function Zi(e){const i=ja().files,t=i.forbidden_filename_characters??window._oc_config?.forbidden_filenames_characters??["/","\\"];for(const u of t)if(e.includes(u))throw new be({segment:u,reason:"character",filename:e});if(e=e.toLocaleLowerCase(),(i.forbidden_filenames??[".htaccess"]).includes(e))throw new be({filename:e,segment:e,reason:"reserved name"});const n=e.indexOf(".",1),c=e.substring(0,n===-1?void 0:n);if((i.forbidden_filename_basenames??[]).includes(c))throw new be({filename:e,segment:c,reason:"reserved name"});const m=i.forbidden_filename_extensions??[".part",".filepart"];for(const u of m)if(e.length>u.length&&e.endsWith(u))throw new be({segment:u,reason:"extension",filename:e})}const at=["B","KB","MB","GB","TB","PB"],it=["B","KiB","MiB","GiB","TiB","PiB"];function Ji(e,i=!1,t=!1,n=!1){t=t&&!n,typeof e=="string"&&(e=Number(e));let c=e>0?Math.floor(Math.log(e)/Math.log(n?1e3:1024)):0;c=Math.min((t?it.length:at.length)-1,c);const m=t?it[c]:at[c];let u=(e/Math.pow(n?1e3:1024,c)).toFixed(1);return i===!0&&c===0?(u!=="0.0"?"< 1 ":"0 ")+(t?it[1]:at[1]):(c<2?u=parseFloat(u).toFixed(0):u=parseFloat(u).toLocaleString(Kt()),u+" "+m)}function Wt(e){return e instanceof Date?e.toISOString():String(e)}function er(e,i,t){i=i??[m=>m],t=t??[];const n=i.map((m,u)=>(t[u]??"asc")==="asc"?1:-1),c=Intl.Collator([Aa(),Kt()],{numeric:!0,usage:"sort"});return[...e].sort((m,u)=>{for(const[f,d]of i.entries()){const p=c.compare(Wt(d(m)),Wt(d(u)));if(p!==0)return p*n[f]}return 0})}function tr(e,i={}){const t={sortingMode:"basename",sortingOrder:"asc",...i};function n(u){const f=u.displayname||u.attributes?.displayname||u.basename||"";return u.type===le.Folder?f:f.lastIndexOf(".")>0?f.slice(0,f.lastIndexOf(".")):f}const c=[...t.sortFavoritesFirst?[u=>u.attributes?.favorite!==1]:[],...t.sortFoldersFirst?[u=>u.type!=="folder"]:[],...t.sortingMode!=="basename"?[u=>u[t.sortingMode]??u.attributes[t.sortingMode]]:[],u=>n(u),u=>u.basename],m=[...t.sortFavoritesFirst?["asc"]:[],...t.sortFoldersFirst?["asc"]:[],...t.sortingMode==="mtime"?[t.sortingOrder==="asc"?"desc":"asc"]:[],...t.sortingMode!=="mtime"&&t.sortingMode!=="basename"?[t.sortingOrder]:[],t.sortingOrder,t.sortingOrder];return er(e,c,m)}const ar=new Ma({concurrency:5});function ir(e){const{resolve:i,promise:t}=Promise.withResolvers();return ar.add(()=>{const n=new Image;return n.onerror=()=>i(!1),n.onload=()=>i(!0),n.src=e,t}),t}function rr(e,i={}){i={size:32,cropPreview:!1,mimeFallback:!0,...i};try{const t=e.attributes?.previewUrl||lt("/core/preview?fileId={fileid}",{fileid:e.fileid});let n;try{n=new URL(t)}catch{n=new URL(t,window.location.origin)}return n.searchParams.set("x",`${i.size}`),n.searchParams.set("y",`${i.size}`),n.searchParams.set("mimeFallback",`${i.mimeFallback}`),n.searchParams.set("a",i.cropPreview===!0?"0":"1"),n.searchParams.set("c",`${e.attributes.etag}`),n}catch{return null}}function nr(e,i){const t=B(null),n=B(!1);return Ca(()=>{n.value=!1,t.value=rr(we(e),we(i||{})),t.value&&we(e).type===le.File&&ir(t.value.href).then(c=>{n.value=c})}),{previewURL:t,previewLoaded:n}}const Z=(e,i)=>{const t=e.__vccOpts||e;for(const[n,c]of i)t[n]=c;return t},sr={name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},or=["aria-hidden","aria-label"],lr=["fill","width","height"],cr={d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"},ur={key:0};function dr(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon file-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",cr,[t.title?(v(),_("title",ur,x(t.title),1)):$("",!0)])],8,lr))],16,or)}const ot=Z(sr,[["render",dr]]),pr={name:"MenuDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},mr=["aria-hidden","aria-label"],hr=["fill","width","height"],fr={d:"M7,10L12,15L17,10H7Z"},vr={key:0};function gr(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon menu-down-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",fr,[t.title?(v(),_("title",vr,x(t.title),1)):$("",!0)])],8,hr))],16,mr)}const rt=Z(pr,[["render",gr]]),Er={name:"MenuUpIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},_r=["aria-hidden","aria-label"],br=["fill","width","height"],wr={d:"M7,15L12,10L17,15H7Z"},yr={key:0};function Tr(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon menu-up-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",wr,[t.title?(v(),_("title",yr,x(t.title),1)):$("",!0)])],8,br))],16,_r)}const nt=Z(Er,[["render",Tr]]),Ir={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Nr=["aria-hidden","aria-label"],Ar=["fill","width","height"],Cr={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},Lr={key:0};function Dr(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",Cr,[t.title?(v(),_("title",Lr,x(t.title),1)):$("",!0)])],8,Ar))],16,Nr)}const pa=Z(Ir,[["render",Dr]]),ma={"file-picker__file-icon":"_file-picker__file-icon_3v9zx_9","file-picker__file-icon--primary":"_file-picker__file-icon--primary_3v9zx_21","file-picker__file-icon-overlay":"_file-picker__file-icon-overlay_3v9zx_25"},Rr=de({__name:"FilePreview",props:{node:{},cropImagePreviews:{type:Boolean}},setup(e){const i=e,t=B(ma),{previewURL:n,previewLoaded:c}=nr(Jt(i,"node"),O(()=>({cropPreview:i.cropImagePreviews}))),m=O(()=>i.node.type===le.File),u=O(()=>{if(i.node.type!==le.Folder)return null;if(i.node.attributes?.["is-encrypted"]===1)return Za;if(i.node.attributes?.["is-tag"])return Ja;const f=Object.values(i.node.attributes?.["share-types"]||{}).flat();if(f.some(d=>d===Rt.Link||d===Rt.Email))return ei;if(f.length>0)return Dt;switch(i.node.attributes?.["mount-type"]){case"external":case"external-session":return ai;case"group":return ti;case"shared":return Dt}return null});return(f,d)=>(v(),_("div",{style:Fa(w(c)?{backgroundImage:`url(${w(n)})`}:void 0),class:ge(t.value["file-picker__file-icon"])},[w(c)?$("",!0):(v(),_(oe,{key:0},[m.value?(v(),M(ot,{key:0,size:32})):(v(),_(oe,{key:1},[u.value?(v(),M(w(ia),{key:0,class:ge(t.value["file-picker__file-icon-overlay"]),inline:"",path:u.value,size:16},null,8,["class","path"])):$("",!0),P(pa,{class:ge(t.value["file-picker__file-icon--primary"]),size:32},null,8,["class"])],64))],64))],6))}}),Or=["tabindex","aria-selected","data-filename"],Sr={class:"row-name"},kr={class:"file-picker__name-container","data-testid":"row-name"},Fr=["title","textContent"],$r=["textContent"],Pr={class:"row-size"},Br={class:"row-modified"},xr=de({__name:"FileListRow",props:{allowPickDirectory:{type:Boolean},selected:{type:Boolean},showCheckbox:{type:Boolean},canPick:{type:Boolean},node:{},cropImagePreviews:{type:Boolean}},emits:["update:selected","enterDirectory"],setup(e,{emit:i}){const t=e,n=i,c=O(()=>t.node.mtime??0),m=O(()=>ta(t.node.displayname)),u=O(()=>t.node.displayname.slice(0,m.value?-m.value.length:void 0)),f=O(()=>t.node.type===le.Folder),d=O(()=>t.canPick&&(t.allowPickDirectory||!f.value)),p=O(()=>(t.node.permissions&ee.READ)===ee.READ);function l(){d.value&&n("update:selected",!t.selected)}function g(){f.value?p.value&&n("enterDirectory",t.node):l()}function E(I){I.key==="Enter"&&g()}return(I,G)=>(v(),_("tr",ae({tabindex:e.showCheckbox&&!f.value?void 0:0,"aria-selected":d.value?e.selected:void 0,class:["file-picker__row",[{"file-picker__row--selected":e.selected&&!e.showCheckbox,"file-picker__row--not-navigatable":f.value&&!p.value,"file-picker__row--not-pickable":!d.value}]],"data-filename":e.node.basename,"data-testid":"file-list-row"},ka({click:g,...!e.showCheckbox||f.value?{keydown:E}:{}},!0)),[e.showCheckbox?(v(),_("td",{key:0,class:"row-checkbox",onClick:Se(()=>{},["stop"])},[P(w(ra),{"aria-label":w(A)("Select the row for {nodename}",{nodename:u.value}),disabled:!d.value,"data-testid":"row-checkbox","model-value":e.selected,"onUpdate:modelValue":l},null,8,["aria-label","disabled","model-value"])])):$("",!0),T("td",Sr,[T("div",kr,[P(Rr,{node:e.node,"crop-image-previews":e.cropImagePreviews},null,8,["node","crop-image-previews"]),T("div",{class:"file-picker__file-name",title:u.value,textContent:x(u.value)},null,8,Fr),T("div",{class:"file-picker__file-extension",textContent:x(m.value)},null,8,$r)])]),T("td",Pr,x(w(Ji)(e.node.size||0)),1),T("td",Br,[P(w(Wa),{timestamp:c.value,"ignore-seconds":""},null,8,["timestamp"])])],16,Or))}}),Mr=Z(xr,[["__scopeId","data-v-2af740c4"]]),Ur={"aria-hidden":"true",class:"file-picker__row loading-row"},zr={key:0,class:"row-checkbox"},Vr={class:"row-name"},Gr={class:"row-wrapper"},Xr=de({__name:"LoadingTableRow",props:{showCheckbox:{type:Boolean}},setup(e){return(i,t)=>(v(),_("tr",Ur,[e.showCheckbox?(v(),_("td",zr,[...t[0]||(t[0]=[T("span",null,null,-1)])])):$("",!0),T("td",Vr,[T("div",Gr,[T("span",{class:ge(w(ma)["file-picker__file-icon"])},null,2),t[1]||(t[1]=T("span",null,null,-1))])]),t[2]||(t[2]=T("td",{class:"row-size"},[T("span")],-1)),t[3]||(t[3]=T("td",{class:"row-modified"},[T("span")],-1))]))}}),jr=Z(Xr,[["__scopeId","data-v-1f96131b"]]);function ha(){const e=ea("files","config",null),i=B(e?.show_hidden??!0),t=B(e?.sort_favorites_first??!0),n=B(e?.crop_image_previews??!0);return Ae(async()=>{if(Ce())Ie.debug("Skip loading files settings - currently on public share");else try{const{data:c}=await aa.get(lt("/apps/files/api/v1/configs"));i.value=c?.data?.show_hidden??!1,t.value=c?.data?.sort_favorites_first??!0,n.value=c?.data?.crop_image_previews??!0}catch(c){Ie.error("Could not load files settings",{error:c}),ut(A("Could not load files settings"))}}),{showHiddenFiles:i,sortFavoritesFirst:t,cropImagePreviews:n}}function qr(e){const i=p=>p==="asc"?"ascending":p==="desc"?"descending":"none",t=ea("files","viewConfigs",null),n=B({sortBy:t?.files?.sorting_mode??"basename",order:i(t?.files?.sorting_direction??"asc")}),c=B({sortBy:t?.recent?.sorting_mode??"basename",order:i(t?.recent?.sorting_direction??"asc")}),m=B({sortBy:t?.favorites?.sorting_mode??"basename",order:i(t?.favorites?.sorting_direction??"asc")});Ae(async()=>{if(Ce())Ie.debug("Skip loading files views - currently on public share");else try{const{data:p}=await aa.get(lt("/apps/files/api/v1/views"));n.value={sortBy:p?.data?.files?.sorting_mode??"basename",order:i(p?.data?.files?.sorting_direction)},m.value={sortBy:p?.data?.favorites?.sorting_mode??"basename",order:i(p?.data?.favorites?.sorting_direction)},c.value={sortBy:p?.data?.recent?.sorting_mode??"basename",order:i(p?.data?.recent?.sorting_direction)}}catch(p){Ie.error("Could not load files views",{error:p}),ut(A("Could not load files views"))}});const u=O(()=>we(e||"files")==="files"?n.value:we(e)==="recent"?c.value:m.value),f=O(()=>u.value.sortBy),d=O(()=>u.value.order);return{filesViewConfig:n,favoritesViewConfig:m,recentViewConfig:c,currentConfig:u,sortBy:f,order:d}}const Hr={key:0,class:"row-checkbox"},Wr={class:"hidden-visually"},Yr=["aria-sort"],Qr={class:"header-wrapper"},Kr={key:2,style:{width:"44px"}},Zr=["aria-sort"],Jr={key:2,style:{width:"44px"}},en=["aria-sort"],tn={key:2,style:{width:"44px"}},an=de({__name:"FileList",props:Ra({currentView:{},multiselect:{type:Boolean},allowPickDirectory:{type:Boolean},loading:{type:Boolean},files:{},canPick:{type:Function}},{path:{required:!0},pathModifiers:{},selectedFiles:{required:!0},selectedFilesModifiers:{}}),emits:["update:path","update:selectedFiles"],setup(e){const i=Nt(e,"path"),t=Nt(e,"selectedFiles"),n=e,c=B(),{currentConfig:m}=qr(n.currentView),u=O(()=>c.value??m.value),f=O(()=>u.value.sortBy==="basename"?u.value.order==="none"?void 0:u.value.order:void 0),d=O(()=>u.value.sortBy==="size"?u.value.order==="none"?void 0:u.value.order:void 0),p=O(()=>u.value.sortBy==="mtime"?u.value.order==="none"?void 0:u.value.order:void 0);function l(F){u.value.sortBy===F?u.value.order==="ascending"?c.value={sortBy:u.value.sortBy,order:"descending"}:c.value={sortBy:u.value.sortBy,order:"ascending"}:c.value={sortBy:F,order:"ascending"}}const{sortFavoritesFirst:g,cropImagePreviews:E}=ha(),I=O(()=>tr(n.files,{sortFoldersFirst:!0,sortFavoritesFirst:g.value,sortingOrder:u.value.order==="descending"?"desc":"asc",sortingMode:u.value.sortBy})),G=O(()=>n.files.filter(F=>n.allowPickDirectory||F.type!==le.Folder)),b=O(()=>!n.loading&&t.value.length>0&&t.value.length>=G.value.length);function H(){t.value.length<G.value.length?t.value=[...G.value]:t.value=[]}function X(F){t.value.includes(F)?t.value=t.value.filter(U=>U.path!==F.path):n.multiselect?t.value=[...t.value,F]:t.value=[F]}function te(F){i.value=F.path}const J=B(4),C=B();{const F=()=>Oa(()=>{const U=C.value?.parentElement?.children||[];let D=C.value?.parentElement?.clientHeight||450;for(let re=0;re<U.length;re++)C.value?.isSameNode(U[re])||(D-=U[re].clientHeight);J.value=Math.max(1,Math.floor((D-50)/50))});Ae(()=>{window.addEventListener("resize",F),F()}),Sa(()=>{window.removeEventListener("resize",F)})}return(F,U)=>(v(),_("div",{ref_key:"fileContainer",ref:C,class:"file-picker__files"},[T("table",null,[T("thead",null,[T("tr",null,[e.multiselect?(v(),_("th",Hr,[T("span",Wr,x(w(A)("Select entry")),1),e.multiselect?(v(),M(w(ra),{key:0,"aria-label":w(A)("Select all entries"),"data-testid":"select-all-checkbox","model-value":b.value,"onUpdate:modelValue":H},null,8,["aria-label","model-value"])):$("",!0)])):$("",!0),T("th",{"aria-sort":f.value,class:"row-name"},[T("div",Qr,[U[3]||(U[3]=T("span",{class:"file-picker__header-preview"},null,-1)),P(w(ye),{"data-test":"file-picker_sort-name",variant:"tertiary",wide:"",onClick:U[0]||(U[0]=D=>l("basename"))},{icon:k(()=>[f.value==="ascending"?(v(),M(nt,{key:0,size:20})):f.value==="descending"?(v(),M(rt,{key:1,size:20})):(v(),_("span",Kr))]),default:k(()=>[fe(" "+x(w(A)("Name")),1)]),_:1})])],8,Yr),T("th",{"aria-sort":d.value,class:"row-size"},[P(w(ye),{variant:"tertiary",wide:"",onClick:U[1]||(U[1]=D=>l("size"))},{icon:k(()=>[d.value==="ascending"?(v(),M(nt,{key:0,size:20})):d.value==="descending"?(v(),M(rt,{key:1,size:20})):(v(),_("span",Jr))]),default:k(()=>[fe(" "+x(w(A)("Size")),1)]),_:1})],8,Zr),T("th",{"aria-sort":p.value,class:"row-modified"},[P(w(ye),{variant:"tertiary",wide:"",onClick:U[2]||(U[2]=D=>l("mtime"))},{icon:k(()=>[p.value==="ascending"?(v(),M(nt,{key:0,size:20})):p.value==="descending"?(v(),M(rt,{key:1,size:20})):(v(),_("span",tn))]),default:k(()=>[fe(" "+x(w(A)("Modified")),1)]),_:1})],8,en)])]),T("tbody",null,[e.loading?(v(!0),_(oe,{key:0},$e(J.value,D=>(v(),M(jr,{key:D,"show-checkbox":e.multiselect},null,8,["show-checkbox"]))),128)):(v(!0),_(oe,{key:1},$e(I.value,D=>(v(),M(Mr,{key:D.fileid||D.path,"allow-pick-directory":e.allowPickDirectory,"show-checkbox":e.multiselect,"can-pick":(e.multiselect||t.value.length===0||t.value.includes(D))&&(e.canPick===void 0||e.canPick(D)),selected:t.value.includes(D),node:D,"crop-image-previews":w(E),"onUpdate:selected":re=>X(D),onEnterDirectory:te},null,8,["allow-pick-directory","show-checkbox","can-pick","selected","node","crop-image-previews","onUpdate:selected"]))),128))])])],512))}}),rn=Z(an,[["__scopeId","data-v-68ec5c33"]]),nn={name:"HomeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},sn=["aria-hidden","aria-label"],on=["fill","width","height"],ln={d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"},cn={key:0};function un(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon home-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",ln,[t.title?(v(),_("title",cn,x(t.title),1)):$("",!0)])],8,on))],16,sn)}const dn=Z(nn,[["render",un]]),pn={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},mn=["aria-hidden","aria-label"],hn=["fill","width","height"],fn={d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},vn={key:0};function gn(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon plus-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",fn,[t.title?(v(),_("title",vn,x(t.title),1)):$("",!0)])],8,hn))],16,mn)}const En=Z(pn,[["render",gn]]),_n=de({__name:"FilePickerBreadcrumbs",props:{path:{},showMenu:{type:Boolean}},emits:["update:path","create-node"],setup(e,{emit:i}){const t=e,n=i,c=B(!1),m=B(""),u=Da("nameInput");function f(){const l=m.value.trim(),g=u.value?.$el?.querySelector("input");let E="";try{Zi(l)}catch(I){if(!(I instanceof be))throw I;switch(I.reason){case Fe.Character:E=A('"{char}" is not allowed inside a folder name.',{char:I.segment});break;case Fe.ReservedName:E=A('"{segment}" is a reserved name and not allowed for folder names.',{segment:I.segment});break;case Fe.Extension:E=A('Folder names must not end with "{extension}".',{extension:I.segment});break;default:E=A("Invalid folder name.")}}return g&&g.setCustomValidity(E),E===""}function d(){const l=m.value.trim();f()&&(c.value=!1,n("create-node",l),m.value="")}const p=O(()=>t.path.split("/").filter(l=>l!=="").map((l,g,E)=>({name:l,path:"/"+E.slice(0,g+1).join("/")})));return(l,g)=>(v(),M(w(Li),{class:"file-picker__breadcrumbs"},Qt({default:k(()=>[P(w(Pe),{name:w(A)("All files"),title:w(A)("Home"),onClick:g[0]||(g[0]=E=>n("update:path","/"))},{icon:k(()=>[P(dn,{size:20})]),_:1},8,["name","title"]),(v(!0),_(oe,null,$e(p.value,E=>(v(),M(w(Pe),{key:E.path,name:E.name,title:E.path,onClick:I=>n("update:path",E.path)},null,8,["name","title","onClick"]))),128))]),_:2},[e.showMenu?{name:"actions",fn:k(()=>[P(w(ct),{open:c.value,"onUpdate:open":g[2]||(g[2]=E=>c.value=E),"aria-label":w(A)("Create directory"),"force-menu":!0,"force-name":!0,"menu-name":w(A)("New"),variant:"secondary",onClose:g[3]||(g[3]=E=>m.value="")},{icon:k(()=>[P(En,{size:20})]),default:k(()=>[P(w(Ua),{ref_key:"nameInput",ref:u,modelValue:m.value,"onUpdate:modelValue":[g[1]||(g[1]=E=>m.value=E),f],label:w(A)("New folder"),placeholder:w(A)("New folder name"),onSubmit:d},{icon:k(()=>[P(pa,{size:20})]),_:1},8,["modelValue","label","placeholder"])]),_:1},8,["open","aria-label","menu-name"])]),key:"0"}:void 0]),1024))}}),bn=Z(_n,[["__scopeId","data-v-4ce40fd0"]]),wn={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},yn=["aria-hidden","aria-label"],Tn=["fill","width","height"],In={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},Nn={key:0};function An(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon close-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",In,[t.title?(v(),_("title",Nn,x(t.title),1)):$("",!0)])],8,Tn))],16,yn)}const Cn=Z(wn,[["render",An]]),Ln={name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Dn=["aria-hidden","aria-label"],Rn=["fill","width","height"],On={d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},Sn={key:0};function kn(e,i,t,n,c,m){return v(),_("span",ae(e.$attrs,{"aria-hidden":t.title?null:"true","aria-label":t.title,class:"material-design-icon magnify-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(v(),_("svg",{fill:t.fillColor,class:"material-design-icon__svg",width:t.size,height:t.size,viewBox:"0 0 24 24"},[T("path",On,[t.title?(v(),_("title",Sn,x(t.title),1)):$("",!0)])],8,Rn))],16,Dn)}const Fn=Z(Ln,[["render",kn]]);function $n(e){const i=[{id:"files",label:A("All files"),icon:Ya},{id:"recent",label:A("Recent"),icon:Qa},{id:"favorites",label:A("Favorites"),icon:Ka}],t=e.value?i.filter(({id:n})=>n==="files"):i;return{allViews:i,availableViews:t}}const Pn={key:0,class:"file-picker__side"},Bn=de({__name:"FilePickerNavigation",props:{currentView:{},filterString:{},isCollapsed:{type:Boolean},disabledNavigation:{type:Boolean}},emits:["update:currentView","update:filterString"],setup(e,{emit:i}){const t=e,n=i,{availableViews:c}=$n(B(Be()===null)),m=O(()=>c.filter(f=>f.id===t.currentView)[0]??c[0]),u=f=>n("update:filterString",f.toString());return(f,d)=>(v(),_(oe,null,[P(w(ri),{class:"file-picker__filter-input",label:w(A)("Filter file list"),"show-trailing-button":!!e.filterString,"model-value":e.filterString,"onUpdate:modelValue":u,onTrailingButtonClick:d[0]||(d[0]=p=>u(""))},{"trailing-button-icon":k(()=>[P(Cn,{size:16})]),default:k(()=>[P(Fn,{size:16})]),_:1},8,["label","show-trailing-button","model-value"]),w(c).length>1&&!e.disabledNavigation?(v(),_(oe,{key:0},[e.isCollapsed?(v(),M(w(ii),{key:1,"aria-label":w(A)("Current view selector"),clearable:!1,searchable:!1,options:w(c),"model-value":m.value,"onUpdate:modelValue":d[1]||(d[1]=p=>n("update:currentView",p.id))},null,8,["aria-label","options","model-value"])):(v(),_("ul",Pn,[(v(!0),_(oe,null,$e(w(c),p=>(v(),_("li",{key:p.id},[P(w(ye),{variant:e.currentView===p.id?"primary":"tertiary",wide:!0,onClick:l=>f.$emit("update:currentView",p.id)},{icon:k(()=>[P(w(ia),{path:p.icon,size:20},null,8,["path"])]),default:k(()=>[fe(" "+x(p.label),1)]),_:2},1032,["variant","onClick"])]))),128))]))],64)):$("",!0)],64))}}),xn=Z(Bn,[["__scopeId","data-v-b91fd905"]]);function Mn(e){const i=new AbortController,t=Math.round(Date.now()/1e3)-3600*24*14;return new ie(async(n,c,m)=>{m(()=>i.abort());try{const{data:u}=await e.search("/",{signal:i.signal,details:!0,data:xi(t)}),f=u.results.map(d=>Ue(d));n(f)}catch(u){c(u)}})}function Un(e,i){const t=new AbortController;return new ie(async(n,c,m)=>{m(()=>t.abort());try{const u=(await e.getDirectoryContents(Te(Le,i),{signal:t.signal,details:!0,includeSelf:!0,data:oa()})).data.map(f=>Ue(f));n({contents:u.filter(({path:f})=>f!==i),folder:u.find(({path:f})=>f===i)})}catch(u){c(u)}})}async function zn(e,i){const{data:t}=await e.stat(Te(Le,i),{details:!0,data:oa()});return Ue(t)}function Vn(e,i){const t=zi(),n=st([]),c=st(null),m=B(!0),u=B(null);async function f(p){const l=Te(i.value,p);await t.createDirectory(Te(Le,l));const g=await zn(t,l);return n.value=[...n.value,g],g}async function d(){u.value&&u.value.cancel(),m.value=!0,e.value==="favorites"?u.value=Vi(t,i.value):e.value==="recent"?u.value=Mn(t):u.value=Un(t,i.value);const p=await u.value;if(p)"folder"in p?(c.value=p.folder,n.value=p.contents):(c.value=null,n.value=p);else return;u.value=null,m.value=!1}return Zt([e,i],()=>d()),Ae(()=>d()),{isLoading:m,files:n,folder:c,loadFiles:d,createDirectory:f}}function Gn(e){const i=O(()=>e.value.map(t=>t.split("/")));return{isSupportedMimeType:t=>{const n=t.split("/");return i.value.some(([c,m])=>(n[0]===c||c==="*")&&(n[1]===m||m==="*"))}}}const Xn={class:"file-picker__main"},jn={key:1,class:"file-picker__view"},qn=de({__name:"FilePicker",props:{buttons:{},name:{},allowPickDirectory:{type:Boolean,default:!1},noMenu:{type:Boolean,default:!1},disabledNavigation:{type:Boolean,default:!1},filterFn:{type:Function,default:void 0},canPickFn:{type:Function,default:void 0},mimetypeFilter:{default:()=>[]},multiselect:{type:Boolean,default:!1},path:{default:void 0}},emits:["close"],setup(e,{emit:i}){const t=e,n=i,c=B(!0),m=B("files"),u=B(window?.sessionStorage.getItem("NC.FilePicker.LastPath")||"/"),f=B(""),d=O({get:()=>m.value==="files"?f.value||t.path||u.value:"/",set:S=>{f.value=S}}),p=st([]),{files:l,folder:g,isLoading:E,loadFiles:I,createDirectory:G}=Vn(m,d);Zt([f],()=>{t.path===void 0&&f.value&&window.sessionStorage.setItem("NC.FilePicker.LastPath",f.value),p.value=[]});let b=!1;const H=O(()=>{const S=p.value.length===0&&t.allowPickDirectory&&g.value?[g.value]:p.value;return(typeof t.buttons=="function"?t.buttons(S,d.value,m.value):t.buttons).map(y=>({...y,disabled:y.disabled||E.value,callback:()=>{b=!0,X(y.callback,S)}}))});async function X(S,y){await S(y),n("close",y),b=!1}const te=O(()=>m.value==="favorites"?A("Favorites"):m.value==="recent"?A("Recent"):""),J=B(""),{isSupportedMimeType:C}=Gn(Jt(t,"mimetypeFilter"));Ae(()=>I());const{showHiddenFiles:F}=ha(),U=O(()=>{let S=l.value;return F.value||(S=S.filter(y=>!y.basename.startsWith("."))),t.mimetypeFilter.length>0&&(S=S.filter(y=>y.type==="folder"||y.mime&&C(y.mime))),J.value&&(S=S.filter(y=>y.basename.toLowerCase().includes(J.value.toLowerCase()))),t.filterFn&&(S=S.filter(y=>t.filterFn(y))),S}),D=O(()=>m.value==="files"?A("Upload some content or sync with your devices!"):m.value==="recent"?A("Files and folders you recently modified will show up here."):A("Files and folders you mark as favorite will show up here."));async function re(S){try{const y=await G(S);f.value=y.path,La("files:node:created",l.value.filter(N=>N.basename===S)[0])}catch(y){Ie.warn("Could not create new folder",{name:S,error:y}),ut(A("Could not create the new folder"))}}function o(S){!S&&!b&&n("close")}return(S,y)=>(v(),M(w(xa),{open:c.value,"onUpdate:open":[y[6]||(y[6]=N=>c.value=N),o],buttons:H.value,name:e.name,size:"large","content-classes":"file-picker__content","dialog-classes":"file-picker","navigation-classes":"file-picker__navigation"},{navigation:k(({isCollapsed:N})=>[P(xn,{"current-view":m.value,"onUpdate:currentView":y[0]||(y[0]=ne=>m.value=ne),"filter-string":J.value,"onUpdate:filterString":y[1]||(y[1]=ne=>J.value=ne),"is-collapsed":N,"disabled-navigation":e.disabledNavigation},null,8,["current-view","filter-string","is-collapsed","disabled-navigation"])]),default:k(()=>[T("div",Xn,[m.value==="files"?(v(),M(bn,{key:0,path:d.value,"onUpdate:path":y[2]||(y[2]=N=>d.value=N),"show-menu":!e.noMenu,onCreateNode:re},null,8,["path","show-menu"])):(v(),_("div",jn,[T("h3",null,x(te.value),1)])),w(E)||U.value.length>0?(v(),M(rn,{key:2,path:d.value,"onUpdate:path":[y[3]||(y[3]=N=>d.value=N),y[5]||(y[5]=N=>m.value="files")],"selected-files":p.value,"onUpdate:selectedFiles":y[4]||(y[4]=N=>p.value=N),"allow-pick-directory":e.allowPickDirectory,"current-view":m.value,files:U.value,multiselect:e.multiselect,loading:w(E),name:te.value,"can-pick":e.canPickFn},null,8,["path","selected-files","allow-pick-directory","current-view","files","multiselect","loading","name","can-pick"])):J.value?(v(),M(w(Ot),{key:3,name:w(A)("No matching files"),description:w(A)("No files matching your filter were found.")},{icon:k(()=>[P(ot)]),_:1},8,["name","description"])):(v(),M(w(Ot),{key:4,name:w(A)("No files in here"),description:D.value},{icon:k(()=>[P(ot)]),_:1},8,["name","description"]))])]),_:1},8,["open","buttons","name"]))}}),os=Z(qn,[["__scopeId","data-v-303416d3"]]);export{os as default};
//# sourceMappingURL=FilePicker-W-IYpVkn-CBDkF306.chunk.mjs.map
