import{f as re,j as c,o as s,c as C,l as L,e as _,y as Pe,w,m as ne,k as f,n as W,g as q,t as $,z as D,H as J,F as M,a8 as be,a6 as H,a5 as Ee,r as z,a2 as Z,b as U,v as Fe,a9 as de,A as Y,p as y,u as d,q as ue,s as pe,x as We,C as K,L as Te,B as qe,a0 as Ze,M as Oe,Y as Se}from"./runtime-dom.esm-bundler-nUg13ekW.chunk.mjs";import{u as je,d as Qe,s as Ye,e as Ge,a as Je}from"./index-6_gsQFyp.chunk.mjs";import{a as me,k as Ke,N as Xe}from"./index-7g--DU3C.chunk.mjs";import{N as we}from"./Plus-BaNqZv8i.chunk.mjs";import{v as et,I as tt,d as se,f as it,s as at}from"./index-CZqtY2I6.chunk.mjs";import{N as O}from"./logger-D3RVzcfQ-B4GxPQ5t.chunk.mjs";import{N as xe}from"./NcCheckboxRadioSwitch-BMsPx74L-DIBi32kw.chunk.mjs";import{l as Ve,j as X,b as lt}from"./index-Ma7sfat2.chunk.mjs";import{N as ke,a as _e,_ as rt}from"./NcDateTime.vue_vue_type_script_setup_true_lang-BhB8yA4U-Ti3vqDZ2.chunk.mjs";import{r as nt,s as st,t as ot,u as ct,v as dt,w as ut,x as Ce,o as pt,c as ft}from"./mdi-DK5BPbEO.chunk.mjs";import{S as ze}from"./ShareType-suoNfd7y.chunk.mjs";import{_ as te,c as mt,g as he,N as Ne}from"./createElementId-DhjFt1I9-CRJVCjcq.chunk.mjs";import{F as j,i as Ie,P as $e}from"./public-BJJBqhxW.chunk.mjs";import"./translation-DoG5ZELJ-2ffMJaM4.chunk.mjs";import{P as ht,a as vt}from"./NcBreadcrumbs-5gl8Syfa-DWvLR5b6.chunk.mjs";import{t as h,l as Q,a as ve}from"./index-C1xmmKTZ-DjoGZapX.chunk.mjs";import{c as De}from"./index-zFO0wb5J.chunk.mjs";import{N as Le}from"./PencilOutline-DTERglfp.chunk.mjs";import{N as gt}from"./NcSelect-DLheQ2yp-BLkpbU2H.chunk.mjs";import{_ as yt}from"./TrashCanOutline-YYyMK6ia.chunk.mjs";import{g as bt,h as wt,i as ge,j as kt,r as ye,k as Me}from"./dav-DxC6BCcd.chunk.mjs";import"./index-sH3U_332.chunk.mjs";import"./NcPasswordField-uaMO2pdt-orYaHCDA.chunk.mjs";import"./NcInputField-o5OFv3z6-DGXgkff4.chunk.mjs";import"./NcNoteCard-Cok_4Fld-BLQT242e.chunk.mjs";import"./index-Gli2NTV8.chunk.mjs";const _t={name:"ChevronRightIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Ct=["aria-hidden","aria-label"],zt=["fill","width","height"],$t={d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},Lt={key:0};function Bt(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon chevron-right-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",$t,[e.title?(s(),c("title",Lt,$(e.title),1)):L("",!0)])],8,zt))],16,Ct)}const Pt=te(_t,[["render",Bt]]),Ft={name:"NcBreadcrumb",components:{NcActions:me,ChevronRight:Pt,NcButton:O},inheritAttrs:!1,props:{name:{type:String,required:!0},title:{type:String,default:null},to:{type:[String,Object],default:void 0},href:{type:String,default:void 0},icon:{type:String,default:""},forceIconText:{type:Boolean,default:!1},disableDrop:{type:Boolean,default:!1},forceMenu:{type:Boolean,default:!1},open:{type:Boolean,default:!1},class:{type:[String,Array,Object],default:""}},emits:["dragenter","dragleave","dropped","update:open"],setup(){const t=mt();return{actionsContainer:`.vue-crumb[data-crumb-id="${t}"]`,crumbId:t}},data(){return{hovering:!1}},computed:{linkAttributes(){return this.to?{to:this.to,...this.$attrs}:this.href?{href:this.href,...this.$attrs}:this.$attrs}},methods:{onOpenChange(t){this.$emit("update:open",t)},dropped(t){return this.disableDrop||(this.$emit("dropped",t,this.to||this.href),this.$parent.$emit("dropped",t,this.to||this.href),this.hovering=!1),!1},dragEnter(t){this.$emit("dragenter",t),!this.disableDrop&&(this.hovering=!0)},dragLeave(t){this.$emit("dragleave",t),!this.disableDrop&&(t.target.contains(t.relatedTarget)||this.$refs.crumb.contains(t.relatedTarget)||(this.hovering=!1))}}},St=["data-crumb-id"];function xt(t,i,e,a,l,r){const n=re("NcButton"),u=re("NcActions"),p=re("ChevronRight");return s(),c("li",{ref:"crumb",class:W(["vue-crumb",[{"vue-crumb--hovered":l.hovering},t.$props.class]]),"data-crumb-id":a.crumbId,draggable:"false",onDragstart:J(()=>{},["prevent"]),onDrop:i[0]||(i[0]=J((...o)=>r.dropped&&r.dropped(...o),["prevent"])),onDragover:J(()=>{},["prevent"]),onDragenter:i[1]||(i[1]=(...o)=>r.dragEnter&&r.dragEnter(...o)),onDragleave:i[2]||(i[2]=(...o)=>r.dragLeave&&r.dragLeave(...o))},[(e.name||e.icon||t.$slots.icon)&&!t.$slots.default?(s(),C(n,D({key:0,"aria-label":e.icon?e.name:void 0,variant:"tertiary"},r.linkAttributes),Pe({_:2},[t.$slots.icon||e.icon?{name:"icon",fn:w(()=>[ne(t.$slots,"icon",{},()=>[f("span",{class:W([e.icon,"icon"])},null,2)],!0)]),key:"0"}:void 0,!(t.$slots.icon||e.icon)||e.forceIconText?{name:"default",fn:w(()=>[q($(e.name),1)]),key:"1"}:void 0]),1040,["aria-label"])):L("",!0),t.$slots.default?(s(),C(u,{key:1,ref:"actions",container:a.actionsContainer,forceMenu:e.forceMenu,forceName:"",menuName:e.name,open:e.open,title:e.title,variant:"tertiary","onUpdate:open":r.onOpenChange},{icon:w(()=>[ne(t.$slots,"menu-icon",{},void 0,!0)]),default:w(()=>[ne(t.$slots,"default",{},void 0,!0)]),_:3},8,["container","forceMenu","menuName","open","title","onUpdate:open"])):L("",!0),_(p,{class:"vue-crumb__separator",size:20})],42,St)}const ee=te(Ft,[["render",xt],["__scopeId","data-v-46306025"]]),Vt={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Nt=["aria-hidden","aria-label"],It=["fill","width","height"],Dt={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},Mt={key:0};function Rt(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",Dt,[e.title?(s(),c("title",Mt,$(e.title),1)):L("",!0)])],8,It))],16,Nt)}const Be=te(Vt,[["render",Rt]]),x="vue-crumb",At={name:"NcBreadcrumbs",components:{NcActions:me,NcActionButton:Le,NcActionRouter:_e,NcActionLink:ke,NcBreadcrumb:ee,IconFolder:Be},props:{rootIcon:{type:String,default:"icon-home"},ariaLabel:{type:String,default:null}},emits:["dropped"],data(){return{hiddenIndices:[],menuBreadcrumbProps:{name:"",forceMenu:!0,disableDrop:!0,open:!1},breadcrumbsRefs:[]}},created(){window.addEventListener("resize",Qe(()=>{this.handleWindowResize()},100)),Ye("navigation-toggled",this.delayedResize)},mounted(){this.handleWindowResize()},updated(){this.delayedResize(),this.$nextTick(()=>{this.hideCrumbs()})},beforeUnmount(){window.removeEventListener("resize",this.handleWindowResize),je("navigation-toggled",this.delayedResize)},methods:{closeActions(t){this.$refs.actionsBreadcrumb.$el.contains(t.relatedTarget)||(this.menuBreadcrumbProps.open=!1)},async delayedResize(){await this.$nextTick(),this.handleWindowResize()},handleWindowResize(){if(!this.$refs.container)return;const t=this.breadcrumbsRefs.length,i=[],e=this.$refs.container.offsetWidth;let a=this.getTotalWidth();this.$refs.breadcrumb__actions&&(a+=this.$refs.breadcrumb__actions.offsetWidth);let l=a-e;l+=l>0?64:0;let r=0;const n=Math.floor(t/2);for(;l>0&&r<t-2;){const u=n+(r%2?r+1:r)/2*Math.pow(-1,r+t%2);l-=this.getWidth(this.breadcrumbsRefs[u]?.$el,u===this.breadcrumbsRefs.length-1),i.push(u),r++}this.arraysEqual(this.hiddenIndices,i.sort((u,p)=>u-p))||(this.hiddenIndices=i)},arraysEqual(t,i){if(t.length!==i.length)return!1;if(t===i)return!0;if(t===null||i===null)return!1;for(let e=0;e<t.length;++e)if(t[e]!==i[e])return!1;return!0},getTotalWidth(){return this.breadcrumbsRefs.reduce((t,i,e)=>t+this.getWidth(i.$el,e===this.breadcrumbsRefs.length-1),0)},getWidth(t,i){if(!t?.classList)return 0;const e=t.classList.contains(`${x}--hidden`);t.style.minWidth="auto",i&&(t.style.maxWidth="210px"),t.classList.remove(`${x}--hidden`);const a=t.offsetWidth;return e&&t.classList.add(`${x}--hidden`),t.style.minWidth="",t.style.maxWidth="",a},preventDefault(t){return t.preventDefault&&t.preventDefault(),!1},dragStart(t){return this.preventDefault(t)},dropped(t,i,e){e||this.$emit("dropped",t,i),this.menuBreadcrumbProps.open=!1;const a=document.querySelectorAll(`.${x}`);for(const l of a)l.classList.remove(`${x}--hovered`);return this.preventDefault(t)},dragOver(t){return this.preventDefault(t)},dragEnter(t,i){if(!i&&t.target.closest){const e=t.target.closest(`.${x}`);if(e.classList&&e.classList.contains(x)){const a=document.querySelectorAll(`.${x}`);for(const l of a)l.classList.remove(`${x}--hovered`);e.classList.add(`${x}--hovered`)}}},dragLeave(t,i){if(!i&&!t.target.contains(t.relatedTarget)&&t.target.closest){const e=t.target.closest(`.${x}`);if(e.contains(t.relatedTarget))return;e.classList&&e.classList.contains(x)&&e.classList.remove(`${x}--hovered`)}},hideCrumbs(){this.breadcrumbsRefs.forEach((t,i)=>{t?.$el?.classList&&(this.hiddenIndices.includes(i)?t.$el.classList.add(`${x}--hidden`):t.$el.classList.remove(`${x}--hidden`))})},isBreadcrumb(t){return t?.type?.name==="NcBreadcrumb"}},render(){let t=[];if(this.$slots.default?.().forEach(l=>{if(this.isBreadcrumb(l)){t.push(l);return}l?.type===M&&l?.children?.forEach?.(r=>{this.isBreadcrumb(r)&&t.push(r)})}),t.length===0)return;t[0]=be(t[0],{icon:this.rootIcon,ref:"breadcrumbs"});const i=[];t=t.map((l,r)=>be(l,{ref:n=>{i[r]=n}}));const e=[...t];this.hiddenIndices.length&&e.splice(Math.round(t.length/2),0,H(ee,{class:"dropdown",...this.menuBreadcrumbProps,"aria-hidden":!0,ref:"actionsBreadcrumb",key:"actions-breadcrumb-1",onDragenter:()=>{this.menuBreadcrumbProps.open=!0},onDragleave:this.closeActions,"onUpdate:open":l=>{this.menuBreadcrumbProps.open=l}},{default:()=>this.hiddenIndices.filter(l=>l<=t.length-1).map(l=>{const r=t[l],{to:n,href:u,disableDrop:p,name:o,...b}=r.props;delete b.ref;let g=Le,v="";u&&(g=ke,v=u),n&&(g=_e,v=n);const S=H(Be,{size:20});return H(g,{...b,class:x,href:u||null,to:n||null,draggable:!1,onDragstart:this.dragStart,onDrop:N=>this.dropped(N,v,p),onDragover:this.dragOver,onDragenter:N=>this.dragEnter(N,p),onDragleave:N=>this.dragLeave(N,p)},{default:()=>o,icon:()=>S})})}));const a=[H("nav",{"aria-label":this.ariaLabel},[H("ul",{class:"breadcrumb__crumbs"},[e])])];return Ke(this.$slots.actions?.())&&a.push(H("div",{class:"breadcrumb__actions",ref:"breadcrumb__actions"},this.$slots.actions?.())),this.breadcrumbsRefs=i,H("div",{class:["breadcrumb",{"breadcrumb--collapsed":this.hiddenIndices.length===t.length-2}],ref:"container"},a)}},Ht=te(At,[["__scopeId","data-v-0015282c"]]),Ut=new ht({concurrency:5});function Et(t){const{resolve:i,promise:e}=Promise.withResolvers();return Ut.add(()=>{const a=new Image;return a.onerror=()=>i(!1),a.onload=()=>i(!0),a.src=t,e}),e}function Wt(t,i={}){i={size:32,cropPreview:!1,mimeFallback:!0,...i};try{const e=t.attributes?.previewUrl||he("/core/preview?fileId={fileid}",{fileid:t.fileid});let a;try{a=new URL(e)}catch{a=new URL(e,window.location.origin)}return a.searchParams.set("x",`${i.size}`),a.searchParams.set("y",`${i.size}`),a.searchParams.set("mimeFallback",`${i.mimeFallback}`),a.searchParams.set("a",i.cropPreview===!0?"0":"1"),a.searchParams.set("c",`${t.attributes.etag}`),a}catch{return null}}function Tt(t,i){const e=z(null),a=z(!1);return Ee(()=>{a.value=!1,e.value=Wt(Z(t),Z(i||{})),e.value&&Z(t).type===j.File&&Et(e.value.href).then(l=>{a.value=l})}),{previewURL:e,previewLoaded:a}}const V=(t,i)=>{const e=t.__vccOpts||t;for(const[a,l]of i)e[a]=l;return e},qt={name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Zt=["aria-hidden","aria-label"],Ot=["fill","width","height"],jt={d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"},Qt={key:0};function Yt(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon file-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",jt,[e.title?(s(),c("title",Qt,$(e.title),1)):L("",!0)])],8,Ot))],16,Zt)}const fe=V(qt,[["render",Yt]]),Gt={name:"MenuDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Jt=["aria-hidden","aria-label"],Kt=["fill","width","height"],Xt={d:"M7,10L12,15L17,10H7Z"},ei={key:0};function ti(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon menu-down-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",Xt,[e.title?(s(),c("title",ei,$(e.title),1)):L("",!0)])],8,Kt))],16,Jt)}const oe=V(Gt,[["render",ti]]),ii={name:"MenuUpIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ai=["aria-hidden","aria-label"],li=["fill","width","height"],ri={d:"M7,15L12,10L17,15H7Z"},ni={key:0};function si(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon menu-up-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",ri,[e.title?(s(),c("title",ni,$(e.title),1)):L("",!0)])],8,li))],16,ai)}const ce=V(ii,[["render",si]]),oi={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ci=["aria-hidden","aria-label"],di=["fill","width","height"],ui={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},pi={key:0};function fi(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",ui,[e.title?(s(),c("title",pi,$(e.title),1)):L("",!0)])],8,di))],16,ci)}const Re=V(oi,[["render",fi]]),Ae={"file-picker__file-icon":"_file-picker__file-icon_3v9zx_9","file-picker__file-icon--primary":"_file-picker__file-icon--primary_3v9zx_21","file-picker__file-icon-overlay":"_file-picker__file-icon-overlay_3v9zx_25"},mi=U({__name:"FilePreview",props:{node:{},cropImagePreviews:{type:Boolean}},setup(t){const i=t,e=z(Ae),{previewURL:a,previewLoaded:l}=Tt(Se(i,"node"),y(()=>({cropPreview:i.cropImagePreviews}))),r=y(()=>i.node.type===j.File),n=y(()=>{if(i.node.type!==j.Folder)return null;if(i.node.attributes?.["is-encrypted"]===1)return ct;if(i.node.attributes?.["is-tag"])return dt;const u=Object.values(i.node.attributes?.["share-types"]||{}).flat();if(u.some(p=>p===ze.Link||p===ze.Email))return ut;if(u.length>0)return Ce;switch(i.node.attributes?.["mount-type"]){case"external":case"external-session":return ft;case"group":return pt;case"shared":return Ce}return null});return(u,p)=>(s(),c("div",{style:Oe(d(l)?{backgroundImage:`url(${d(a)})`}:void 0),class:W(e.value["file-picker__file-icon"])},[d(l)?L("",!0):(s(),c(M,{key:0},[r.value?(s(),C(fe,{key:0,size:32})):(s(),c(M,{key:1},[n.value?(s(),C(d(Ne),{key:0,class:W(e.value["file-picker__file-icon-overlay"]),inline:"",path:n.value,size:16},null,8,["class","path"])):L("",!0),_(Re,{class:W(e.value["file-picker__file-icon--primary"]),size:32},null,8,["class"])],64))],64))],6))}}),hi=["tabindex","aria-selected","data-filename"],vi={class:"row-name"},gi={class:"file-picker__name-container","data-testid":"row-name"},yi=["title","textContent"],bi=["textContent"],wi={class:"row-size"},ki={class:"row-modified"},_i=U({__name:"FileListRow",props:{allowPickDirectory:{type:Boolean},selected:{type:Boolean},showCheckbox:{type:Boolean},canPick:{type:Boolean},node:{},cropImagePreviews:{type:Boolean}},emits:["update:selected","enterDirectory"],setup(t,{emit:i}){const e=t,a=i,l=y(()=>e.node.mtime??0),r=y(()=>lt(e.node.displayname)),n=y(()=>e.node.displayname.slice(0,r.value?-r.value.length:void 0)),u=y(()=>e.node.type===j.Folder),p=y(()=>e.canPick&&(e.allowPickDirectory||!u.value)),o=y(()=>(e.node.permissions&$e.READ)===$e.READ);function b(){p.value&&a("update:selected",!e.selected)}function g(){u.value?o.value&&a("enterDirectory",e.node):b()}function v(S){S.key==="Enter"&&g()}return(S,N)=>(s(),c("tr",D({tabindex:t.showCheckbox&&!u.value?void 0:0,"aria-selected":p.value?t.selected:void 0,class:["file-picker__row",[{"file-picker__row--selected":t.selected&&!t.showCheckbox,"file-picker__row--not-navigatable":u.value&&!o.value,"file-picker__row--not-pickable":!p.value}]],"data-filename":t.node.basename,"data-testid":"file-list-row"},Ze({click:g,...!t.showCheckbox||u.value?{keydown:v}:{}},!0)),[t.showCheckbox?(s(),c("td",{key:0,class:"row-checkbox",onClick:J(()=>{},["stop"])},[_(d(xe),{"aria-label":d(h)("Select the row for {nodename}",{nodename:n.value}),disabled:!p.value,"data-testid":"row-checkbox",modelValue:t.selected,"onUpdate:modelValue":b},null,8,["aria-label","disabled","modelValue"])])):L("",!0),f("td",vi,[f("div",gi,[_(mi,{node:t.node,cropImagePreviews:t.cropImagePreviews},null,8,["node","cropImagePreviews"]),f("div",{class:"file-picker__file-name",title:n.value,textContent:$(n.value)},null,8,yi),f("div",{class:"file-picker__file-extension",textContent:$(r.value)},null,8,bi)])]),f("td",wi,$(d(it)(t.node.size||0)),1),f("td",ki,[_(d(rt),{timestamp:l.value,ignoreSeconds:""},null,8,["timestamp"])])],16,hi))}}),Ci=V(_i,[["__scopeId","data-v-7857e8bd"]]),zi={"aria-hidden":"true",class:"file-picker__row loading-row"},$i={key:0,class:"row-checkbox"},Li={class:"row-name"},Bi={class:"row-wrapper"},Pi=U({__name:"LoadingTableRow",props:{showCheckbox:{type:Boolean}},setup(t){return(i,e)=>(s(),c("tr",zi,[t.showCheckbox?(s(),c("td",$i,[...e[0]||(e[0]=[f("span",null,null,-1)])])):L("",!0),f("td",Li,[f("div",Bi,[f("span",{class:W(d(Ae)["file-picker__file-icon"])},null,2),e[1]||(e[1]=f("span",null,null,-1))])]),e[2]||(e[2]=f("td",{class:"row-size"},[f("span")],-1)),e[3]||(e[3]=f("td",{class:"row-modified"},[f("span")],-1))]))}}),Fi=V(Pi,[["__scopeId","data-v-1f96131b"]]);function He(){const t=Ve("files","config",null),i=z(t?.show_hidden??!0),e=z(t?.sort_favorites_first??!0),a=z(t?.crop_image_previews??!0);return Y(async()=>{if(Ie())Q.debug("Skip loading files settings - currently on public share");else try{const{data:l}=await De.get(he("/apps/files/api/v1/configs"));i.value=l?.data?.show_hidden??!1,e.value=l?.data?.sort_favorites_first??!0,a.value=l?.data?.crop_image_previews??!0}catch(l){Q.error("Could not load files settings",{error:l}),ve(h("Could not load files settings"))}}),{showHiddenFiles:i,sortFavoritesFirst:e,cropImagePreviews:a}}function Si(t){const i=o=>o==="asc"?"ascending":o==="desc"?"descending":"none",e=Ve("files","viewConfigs",null),a=z({sortBy:e?.files?.sorting_mode??"basename",order:i(e?.files?.sorting_direction??"asc")}),l=z({sortBy:e?.recent?.sorting_mode??"basename",order:i(e?.recent?.sorting_direction??"asc")}),r=z({sortBy:e?.favorites?.sorting_mode??"basename",order:i(e?.favorites?.sorting_direction??"asc")});Y(async()=>{if(Ie())Q.debug("Skip loading files views - currently on public share");else try{const{data:o}=await De.get(he("/apps/files/api/v1/views"));a.value={sortBy:o?.data?.files?.sorting_mode??"basename",order:i(o?.data?.files?.sorting_direction)},r.value={sortBy:o?.data?.favorites?.sorting_mode??"basename",order:i(o?.data?.favorites?.sorting_direction)},l.value={sortBy:o?.data?.recent?.sorting_mode??"basename",order:i(o?.data?.recent?.sorting_direction)}}catch(o){Q.error("Could not load files views",{error:o}),ve(h("Could not load files views"))}});const n=y(()=>Z(t||"files")==="files"?a.value:Z(t)==="recent"?l.value:r.value),u=y(()=>n.value.sortBy),p=y(()=>n.value.order);return{filesViewConfig:a,favoritesViewConfig:r,recentViewConfig:l,currentConfig:n,sortBy:u,order:p}}const xi={key:0,class:"row-checkbox"},Vi={class:"hidden-visually"},Ni=["aria-sort"],Ii={class:"header-wrapper"},Di={key:2,style:{width:"44px"}},Mi=["aria-sort"],Ri={key:2,style:{width:"44px"}},Ai=["aria-sort"],Hi={key:2,style:{width:"44px"}},Ui=U({__name:"FileList",props:ue({currentView:{},multiselect:{type:Boolean},allowPickDirectory:{type:Boolean},loading:{type:Boolean},files:{},canPick:{type:Function}},{path:{required:!0},pathModifiers:{},selectedFiles:{required:!0},selectedFilesModifiers:{}}),emits:["update:path","update:selectedFiles"],setup(t){const i=pe(t,"path"),e=pe(t,"selectedFiles"),a=t,l=z(),{currentConfig:r}=Si(a.currentView),n=y(()=>l.value??r.value),u=y(()=>n.value.sortBy==="basename"?n.value.order==="none"?void 0:n.value.order:void 0),p=y(()=>n.value.sortBy==="size"?n.value.order==="none"?void 0:n.value.order:void 0),o=y(()=>n.value.sortBy==="mtime"?n.value.order==="none"?void 0:n.value.order:void 0);function b(B){n.value.sortBy===B?n.value.order==="ascending"?l.value={sortBy:n.value.sortBy,order:"descending"}:l.value={sortBy:n.value.sortBy,order:"ascending"}:l.value={sortBy:B,order:"ascending"}}const{sortFavoritesFirst:g,cropImagePreviews:v}=He(),S=y(()=>at(a.files,{sortFoldersFirst:!0,sortFavoritesFirst:g.value,sortingOrder:n.value.order==="descending"?"desc":"asc",sortingMode:n.value.sortBy})),N=y(()=>a.files.filter(B=>a.allowPickDirectory||B.type!==j.Folder)),T=y(()=>!a.loading&&e.value.length>0&&e.value.length>=N.value.length);function ie(){e.value.length<N.value.length?e.value=[...N.value]:e.value=[]}function ae(B){e.value.includes(B)?e.value=e.value.filter(P=>P.path!==B.path):a.multiselect?e.value=[...e.value,B]:e.value=[B]}function G(B){i.value=B.path}const R=z(4),E=z();{const B=()=>Te(()=>{const P=E.value?.parentElement?.children||[];let F=E.value?.parentElement?.clientHeight||450;for(let A=0;A<P.length;A++)E.value?.isSameNode(P[A])||(F-=P[A].clientHeight);R.value=Math.max(1,Math.floor((F-50)/50))});Y(()=>{window.addEventListener("resize",B),B()}),qe(()=>{window.removeEventListener("resize",B)})}return(B,P)=>(s(),c("div",{ref_key:"fileContainer",ref:E,class:"file-picker__files"},[f("table",null,[f("thead",null,[f("tr",null,[t.multiselect?(s(),c("th",xi,[f("span",Vi,$(d(h)("Select entry")),1),t.multiselect?(s(),C(d(xe),{key:0,"aria-label":d(h)("Select all entries"),"data-testid":"select-all-checkbox",modelValue:T.value,"onUpdate:modelValue":ie},null,8,["aria-label","modelValue"])):L("",!0)])):L("",!0),f("th",{"aria-sort":u.value,class:"row-name"},[f("div",Ii,[P[3]||(P[3]=f("span",{class:"file-picker__header-preview"},null,-1)),_(d(O),{"data-test":"file-picker_sort-name",variant:"tertiary",wide:"",onClick:P[0]||(P[0]=F=>b("basename"))},{icon:w(()=>[u.value==="ascending"?(s(),C(ce,{key:0,size:20})):u.value==="descending"?(s(),C(oe,{key:1,size:20})):(s(),c("span",Di))]),default:w(()=>[q(" "+$(d(h)("Name")),1)]),_:1})])],8,Ni),f("th",{"aria-sort":p.value,class:"row-size"},[_(d(O),{variant:"tertiary",wide:"",onClick:P[1]||(P[1]=F=>b("size"))},{icon:w(()=>[p.value==="ascending"?(s(),C(ce,{key:0,size:20})):p.value==="descending"?(s(),C(oe,{key:1,size:20})):(s(),c("span",Ri))]),default:w(()=>[q(" "+$(d(h)("Size")),1)]),_:1})],8,Mi),f("th",{"aria-sort":o.value,class:"row-modified"},[_(d(O),{variant:"tertiary",wide:"",onClick:P[2]||(P[2]=F=>b("mtime"))},{icon:w(()=>[o.value==="ascending"?(s(),C(ce,{key:0,size:20})):o.value==="descending"?(s(),C(oe,{key:1,size:20})):(s(),c("span",Hi))]),default:w(()=>[q(" "+$(d(h)("Modified")),1)]),_:1})],8,Ai)])]),f("tbody",null,[t.loading?(s(!0),c(M,{key:0},K(R.value,F=>(s(),C(Fi,{key:F,showCheckbox:t.multiselect},null,8,["showCheckbox"]))),128)):(s(!0),c(M,{key:1},K(S.value,F=>(s(),C(Ci,{key:F.fileid||F.path,allowPickDirectory:t.allowPickDirectory,showCheckbox:t.multiselect,canPick:(t.multiselect||e.value.length===0||e.value.includes(F))&&(t.canPick===void 0||t.canPick(F)),selected:e.value.includes(F),node:F,cropImagePreviews:d(v),"onUpdate:selected":A=>ae(F),onEnterDirectory:G},null,8,["allowPickDirectory","showCheckbox","canPick","selected","node","cropImagePreviews","onUpdate:selected"]))),128))])])],512))}}),Ei=V(Ui,[["__scopeId","data-v-412efd5c"]]),Wi={name:"HomeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Ti=["aria-hidden","aria-label"],qi=["fill","width","height"],Zi={d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"},Oi={key:0};function ji(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon home-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",Zi,[e.title?(s(),c("title",Oi,$(e.title),1)):L("",!0)])],8,qi))],16,Ti)}const Qi=V(Wi,[["render",ji]]),Yi={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Gi=["aria-hidden","aria-label"],Ji=["fill","width","height"],Ki={d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},Xi={key:0};function ea(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon plus-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",Ki,[e.title?(s(),c("title",Xi,$(e.title),1)):L("",!0)])],8,Ji))],16,Gi)}const ta=V(Yi,[["render",ea]]),ia=U({__name:"FilePickerBreadcrumbs",props:ue({showMenu:{type:Boolean}},{path:{required:!0},pathModifiers:{}}),emits:ue(["createNode"],["update:path"]),setup(t,{emit:i}){const e=pe(t,"path"),a=i,l=z(!1),r=z(""),n=We("nameInput");function u(){const b=r.value.trim(),g=n.value?.$el?.querySelector("input");let v="";try{et(b)}catch(S){if(!(S instanceof tt))throw S;switch(S.reason){case se.Character:v=h('"{char}" is not allowed inside a folder name.',{char:S.segment});break;case se.ReservedName:v=h('"{segment}" is a reserved name and not allowed for folder names.',{segment:S.segment});break;case se.Extension:v=h('Folder names must not end with "{extension}".',{extension:S.segment});break;default:v=h("Invalid folder name.")}}return g&&g.setCustomValidity(v),v===""}function p(){const b=r.value.trim();u()&&(l.value=!1,a("createNode",b),r.value="")}const o=y(()=>e.value.split("/").filter(b=>b!=="").map((b,g,v)=>({name:b,path:"/"+v.slice(0,g+1).join("/")})));return(b,g)=>(s(),C(d(Ht),{class:"file-picker__breadcrumbs"},Pe({default:w(()=>[_(d(ee),{name:d(h)("All files"),title:d(h)("Home"),onClick:g[0]||(g[0]=v=>e.value="/")},{icon:w(()=>[_(Qi,{size:20})]),_:1},8,["name","title"]),(s(!0),c(M,null,K(o.value,v=>(s(),C(d(ee),{key:v.path,name:v.name,title:v.path,onClick:S=>e.value=v.path},null,8,["name","title","onClick"]))),128))]),_:2},[t.showMenu?{name:"actions",fn:w(()=>[_(d(me),{open:l.value,"onUpdate:open":g[2]||(g[2]=v=>l.value=v),"aria-label":d(h)("Create directory"),forceMenu:!0,forceName:!0,menuName:d(h)("New"),variant:"secondary",onClose:g[3]||(g[3]=v=>r.value="")},{icon:w(()=>[_(ta,{size:20})]),default:w(()=>[_(d(vt),{ref_key:"nameInput",ref:n,modelValue:r.value,"onUpdate:modelValue":[g[1]||(g[1]=v=>r.value=v),u],label:d(h)("New folder"),placeholder:d(h)("New folder name"),onSubmit:p},{icon:w(()=>[_(Re,{size:20})]),_:1},8,["modelValue","label","placeholder"])]),_:1},8,["open","aria-label","menuName"])]),key:"0"}:void 0]),1024))}}),aa=V(ia,[["__scopeId","data-v-b448b141"]]),la={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ra=["aria-hidden","aria-label"],na=["fill","width","height"],sa={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},oa={key:0};function ca(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon close-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",sa,[e.title?(s(),c("title",oa,$(e.title),1)):L("",!0)])],8,na))],16,ra)}const da=V(la,[["render",ca]]),ua={name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},pa=["aria-hidden","aria-label"],fa=["fill","width","height"],ma={d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},ha={key:0};function va(t,i,e,a,l,r){return s(),c("span",D(t.$attrs,{"aria-hidden":e.title?null:"true","aria-label":e.title,class:"material-design-icon magnify-icon",role:"img",onClick:i[0]||(i[0]=n=>t.$emit("click",n))}),[(s(),c("svg",{fill:e.fillColor,class:"material-design-icon__svg",width:e.size,height:e.size,viewBox:"0 0 24 24"},[f("path",ma,[e.title?(s(),c("title",ha,$(e.title),1)):L("",!0)])],8,fa))],16,pa)}const ga=V(ua,[["render",va]]);function ya(t){const i=[{id:"files",label:h("All files"),icon:nt},{id:"recent",label:h("Recent"),icon:st},{id:"favorites",label:h("Favorites"),icon:ot}],e=t.value?i.filter(({id:a})=>a==="files"):i;return{allViews:i,availableViews:e}}const ba={key:0,class:"file-picker__side"},wa=U({__name:"FilePickerNavigation",props:{currentView:{},filterString:{},isCollapsed:{type:Boolean},disabledNavigation:{type:Boolean}},emits:["update:currentView","update:filterString"],setup(t,{emit:i}){const e=t,a=i,{availableViews:l}=ya(z(Je()===null)),r=y(()=>l.filter(u=>u.id===e.currentView)[0]??l[0]),n=u=>a("update:filterString",u.toString());return(u,p)=>(s(),c(M,null,[_(d(yt),{class:"file-picker__filter-input",label:d(h)("Filter file list"),showTrailingButton:!!t.filterString,modelValue:t.filterString,"onUpdate:modelValue":n,onTrailingButtonClick:p[0]||(p[0]=o=>n(""))},{"trailing-button-icon":w(()=>[_(da,{size:16})]),default:w(()=>[_(ga,{size:16})]),_:1},8,["label","showTrailingButton","modelValue"]),d(l).length>1&&!t.disabledNavigation?(s(),c(M,{key:0},[t.isCollapsed?(s(),C(d(gt),{key:1,"aria-label":d(h)("Current view selector"),clearable:!1,searchable:!1,options:d(l),modelValue:r.value,"onUpdate:modelValue":p[1]||(p[1]=o=>a("update:currentView",o.id))},null,8,["aria-label","options","modelValue"])):(s(),c("ul",ba,[(s(!0),c(M,null,K(d(l),o=>(s(),c("li",{key:o.id},[_(d(O),{variant:t.currentView===o.id?"primary":"tertiary",wide:!0,onClick:b=>u.$emit("update:currentView",o.id)},{icon:w(()=>[_(d(Ne),{path:o.icon,size:20},null,8,["path"])]),default:w(()=>[q(" "+$(o.label),1)]),_:2},1032,["variant","onClick"])]))),128))]))],64)):L("",!0)],64))}}),ka=V(wa,[["__scopeId","data-v-e1c54e23"]]);async function _a({client:t,signal:i}){const e=Math.round(Date.now()/1e3)-1209600,{data:a}=await t.search("/",{signal:i,details:!0,data:kt(e)});return a.results.map(l=>ye(l))}async function Ca({client:t,path:i,signal:e}){const a=(await t.getDirectoryContents(X(ge,i),{signal:e,details:!0,includeSelf:!0,data:Me()})).data.map(l=>ye(l));return{contents:a.filter(({path:l})=>l!==i),folder:a.find(({path:l})=>i===l)}}async function za(t,i){const{data:e}=await t.stat(X(ge,i),{details:!0,data:Me()});return ye(e)}function $a(t,i){const e=bt(),a=de([]),l=de(null),r=z(!0);let n;async function u(o){const b=X(i.value,o);await e.createDirectory(X(ge,b));const g=await za(e,b);return a.value=[...a.value,g],g}async function p(){n&&(n.abort(),n=void 0),n=new AbortController,r.value=!0;try{if(t.value==="favorites")a.value=await wt({client:e,path:i.value,signal:n.signal}),l.value=null;else if(t.value==="recent")a.value=await _a({client:e,signal:n.signal}),l.value=null;else{const o=await Ca({client:e,path:i.value,signal:n.signal});l.value=o.folder,a.value=o.contents}}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{n=void 0,r.value=!1}}return Fe([t,i],()=>p()),Y(()=>p()),{isLoading:r,files:a,folder:l,loadFiles:p,createDirectory:u}}function La(t){const i=y(()=>t.value.map(e=>e.split("/")));return{isSupportedMimeType:e=>{const a=e.split("/");return i.value.some(([l,r])=>(a[0]===l||l==="*")&&(a[1]===r||r==="*"))}}}const Ba={class:"file-picker__main"},Pa={key:1,class:"file-picker__view"},Fa=U({__name:"FilePicker",props:{buttons:{},name:{},allowPickDirectory:{type:Boolean,default:!1},noMenu:{type:Boolean,default:!1},disabledNavigation:{type:Boolean,default:!1},filterFn:{type:Function,default:void 0},canPickFn:{type:Function,default:void 0},mimetypeFilter:{default:()=>[]},multiselect:{type:Boolean,default:!1},path:{default:void 0}},emits:["close"],setup(t,{emit:i}){const e=t,a=i,l=z(!0),r=z("files"),n=z(window?.sessionStorage.getItem("NC.FilePicker.LastPath")||"/"),u=z(""),p=y({get:()=>r.value==="files"?u.value||e.path||n.value:"/",set:k=>{u.value=k}}),o=de([]),{files:b,folder:g,isLoading:v,loadFiles:S,createDirectory:N}=$a(r,p);Fe([u],()=>{e.path===void 0&&u.value&&window.sessionStorage.setItem("NC.FilePicker.LastPath",u.value),o.value=[]});let T=!1;const ie=y(()=>{const k=o.value.length===0&&e.allowPickDirectory&&g.value?[g.value]:o.value;return(typeof e.buttons=="function"?e.buttons(k,p.value,r.value):e.buttons).map(m=>({...m,disabled:m.disabled||v.value,callback:()=>{T=!0,ae(m.callback,k)}}))});async function ae(k,m){await k(m),a("close",m),T=!1}const G=y(()=>r.value==="favorites"?h("Favorites"):r.value==="recent"?h("Recent"):""),R=z(""),{isSupportedMimeType:E}=La(Se(e,"mimetypeFilter"));Y(()=>S());const{showHiddenFiles:B}=He(),P=y(()=>{let k=b.value;return B.value||(k=k.filter(m=>!m.basename.startsWith("."))),e.mimetypeFilter.length>0&&(k=k.filter(m=>m.type==="folder"||m.mime&&E(m.mime))),R.value&&(k=k.filter(m=>m.basename.toLowerCase().includes(R.value.toLowerCase()))),e.filterFn&&(k=k.filter(m=>e.filterFn(m))),k}),F=y(()=>r.value==="files"?h("Upload some content or sync with your devices!"):r.value==="recent"?h("Files and folders you recently modified will show up here."):h("Files and folders you mark as favorite will show up here."));async function A(k){try{const m=await N(k);u.value=m.path,Ge("files:node:created",b.value.filter(I=>I.basename===k)[0])}catch(m){Q.warn("Could not create new folder",{name:k,error:m}),ve(h("Could not create the new folder"))}}function Ue(k){!k&&!T&&a("close")}return(k,m)=>(s(),C(d(Xe),{open:l.value,"onUpdate:open":[m[6]||(m[6]=I=>l.value=I),Ue],buttons:ie.value,name:t.name,size:"large",contentClasses:"file-picker__content",dialogClasses:"file-picker",navigationClasses:"file-picker__navigation"},{navigation:w(({isCollapsed:I})=>[_(ka,{currentView:r.value,"onUpdate:currentView":m[0]||(m[0]=le=>r.value=le),filterString:R.value,"onUpdate:filterString":m[1]||(m[1]=le=>R.value=le),isCollapsed:I,disabledNavigation:t.disabledNavigation},null,8,["currentView","filterString","isCollapsed","disabledNavigation"])]),default:w(()=>[f("div",Ba,[r.value==="files"?(s(),C(aa,{key:0,path:p.value,"onUpdate:path":m[2]||(m[2]=I=>p.value=I),showMenu:!t.noMenu,onCreateNode:A},null,8,["path","showMenu"])):(s(),c("div",Pa,[f("h3",null,$(G.value),1)])),d(v)||P.value.length>0?(s(),C(Ei,{key:2,path:p.value,"onUpdate:path":[m[3]||(m[3]=I=>p.value=I),m[5]||(m[5]=I=>r.value="files")],selectedFiles:o.value,"onUpdate:selectedFiles":m[4]||(m[4]=I=>o.value=I),allowPickDirectory:t.allowPickDirectory,currentView:r.value,files:P.value,multiselect:t.multiselect,loading:d(v),name:G.value,canPick:t.canPickFn},null,8,["path","selectedFiles","allowPickDirectory","currentView","files","multiselect","loading","name","canPick"])):R.value?(s(),C(d(we),{key:3,name:d(h)("No matching files"),description:d(h)("No files matching your filter were found.")},{icon:w(()=>[_(fe)]),_:1},8,["name","description"])):(s(),C(d(we),{key:4,name:d(h)("No files in here"),description:F.value},{icon:w(()=>[_(fe)]),_:1},8,["name","description"]))])]),_:1},8,["open","buttons","name"]))}}),il=V(Fa,[["__scopeId","data-v-9b6534b1"]]);export{il as default};
//# sourceMappingURL=FilePicker-C1yRZfLt-DpU9ZbB3.chunk.mjs.map
