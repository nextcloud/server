import{_ as O,r as w,a as c,o as r,b as f,A as T,g as U,e as b,M as L,E as A,t as d,C as st,h as G,w as M,T as ut,c as at,al as ct,y as dt,v as H,am as ht,an as pt,ao as K,ag as ft,G as nt,n as mt,ap as gt,aq as bt,N as q,j as _t,q as j,ar as yt,as as vt,z as Q,H as St,I as kt,a8 as xt,i as Ct,aj as W,F as P}from"./_plugin-vue_export-helper-CkDS_aHW.chunk.mjs";import{c as it}from"./index-D_jg0qLx.chunk.mjs";import{i as It,j as V,k as wt,l as R,m as Ut,n as Lt,o as Y,p as At,q as Mt,I as Nt}from"./index-JpgrUA2Z-CosWrxLg.chunk.mjs";import{N as ot,k as Dt,o as $t,a as Ot,l as X,c as Tt}from"./NcNoteCard-CVhtNL04-Lr3K6fmX.chunk.mjs";import{g as Et}from"./colors-Go3zmZRD-0_rU0xTg.chunk.mjs";import{N as Vt,g as zt}from"./NcUserStatusIcon-CGEf7fej-onghoEJ3.chunk.mjs";import{N as Bt}from"./NcLoadingIcon-b_ajZ_nQ-w7Nn62Bk.chunk.mjs";const jt={beforeUpdate(){this.text=this.getText()},data(){return{text:this.getText()}},computed:{isLongText(){return this.text&&this.text.trim().length>20}},methods:{getText(){return this.$slots.default?.()[0].children?.trim?.()||""}}},z={mixins:[jt],props:{icon:{type:String,default:""},name:{type:String,default:""},title:{type:String,default:""},closeAfterClick:{type:Boolean,default:!1},ariaLabel:{type:String,default:null}},inject:{closeMenu:{from:It}},emits:["click"],created(){"ariaHidden"in this.$attrs},computed:{isIconUrl(){try{return!!new URL(this.icon,this.icon.startsWith("/")?window.location.origin:void 0)}catch{return!1}}},methods:{onClick(i){this.$emit("click",i),this.closeAfterClick&&this.closeMenu(!1)}}},Wt={name:"NcActionButton",components:{NcIconSvgWrapper:ot},mixins:[z],inject:{isInSemanticMenu:{from:V,default:!1}},props:{disabled:{type:Boolean,default:!1},isMenu:{type:Boolean,default:!1},type:{type:String,default:"button",validator:i=>["button","checkbox","radio","reset","submit"].includes(i)},modelValue:{type:[Boolean,String],default:null},value:{type:String,default:null},description:{type:String,default:""}},emits:["update:modelValue"],setup(){return{mdiCheck:$t,mdiChevronRight:Dt}},computed:{isFocusable(){return!this.disabled},isChecked(){return this.type==="radio"&&typeof this.modelValue!="boolean"?this.modelValue===this.value:this.modelValue},nativeType(){return this.type==="submit"||this.type==="reset"?this.type:"button"},buttonAttributes(){const i={};return this.isInSemanticMenu?(i.role="menuitem",this.type==="radio"?(i.role="menuitemradio",i["aria-checked"]=this.isChecked?"true":"false"):(this.type==="checkbox"||this.nativeType==="button"&&this.modelValue!==null)&&(i.role="menuitemcheckbox",i["aria-checked"]=this.modelValue===null?"mixed":this.modelValue?"true":"false")):this.modelValue!==null&&this.nativeType==="button"&&(i["aria-pressed"]=this.modelValue?"true":"false"),i}},methods:{handleClick(i){this.onClick(i),(this.modelValue!==null||this.type!=="button")&&(this.type==="radio"?typeof this.modelValue!="boolean"?this.isChecked||this.$emit("update:modelValue",this.value):this.$emit("update:modelValue",!this.isChecked):this.$emit("update:modelValue",!this.isChecked))}}},Pt=["role"],Ft=["aria-label","disabled","title","type"],Gt={class:"action-button__longtext-wrapper"},Ht={key:0,class:"action-button__name"},qt=["textContent"],Rt={key:2,class:"action-button__text"},Xt=["textContent"],Jt={key:2,class:"action-button__pressed-icon material-design-icon"};function Kt(i,o,a,s,t,e){const n=w("NcIconSvgWrapper");return r(),c("li",{class:A(["action",{"action--disabled":a.disabled}]),role:e.isInSemanticMenu&&"presentation"},[f("button",st({"aria-label":i.ariaLabel,class:["action-button button-vue",{"action-button--active":e.isChecked,focusable:e.isFocusable}],disabled:a.disabled,title:i.title,type:e.nativeType},e.buttonAttributes,{onClick:o[0]||(o[0]=(...h)=>e.handleClick&&e.handleClick(...h))}),[T(i.$slots,"icon",{},()=>[f("span",{class:A([[i.isIconUrl?"action-button__icon--url":i.icon],"action-button__icon"]),style:L({backgroundImage:i.isIconUrl?`url(${i.icon})`:null}),"aria-hidden":"true"},null,6)],!0),f("span",Gt,[i.name?(r(),c("strong",Ht,d(i.name),1)):b("",!0),i.isLongText?(r(),c("span",{key:1,class:"action-button__longtext",textContent:d(i.text)},null,8,qt)):(r(),c("span",Rt,d(i.text),1)),a.description?(r(),c("span",{key:3,class:"action-button__description",textContent:d(a.description)},null,8,Xt)):b("",!0)]),a.isMenu?(r(),U(n,{key:0,class:"action-button__menu-icon",directional:"",path:s.mdiChevronRight},null,8,["path"])):e.isChecked?(r(),U(n,{key:1,path:s.mdiCheck,class:"action-button__pressed-icon"},null,8,["path"])):e.isChecked===!1?(r(),c("span",Jt)):b("",!0),b("",!0)],16,Ft)],10,Pt)}const Qt=O(Wt,[["render",Kt],["__scopeId","data-v-6c2daf4e"]]),Yt={name:"NcActionLink",mixins:[z],inject:{isInSemanticMenu:{from:V,default:!1}},props:{href:{type:String,required:!0,validator:i=>{try{return new URL(i)}catch{return i.startsWith("#")||i.startsWith("/")}}},download:{type:String,default:null},target:{type:String,default:"_self",validator:i=>i&&(!i.startsWith("_")||["_blank","_self","_parent","_top"].indexOf(i)>-1)},title:{type:String,default:null}}},Zt=["role"],te=["download","href","aria-label","target","title","role"],ee={key:0,class:"action-link__longtext-wrapper"},se={class:"action-link__name"},ae=["textContent"],ne=["textContent"],ie={key:2,class:"action-link__text"};function oe(i,o,a,s,t,e){return r(),c("li",{class:"action",role:e.isInSemanticMenu&&"presentation"},[f("a",{download:a.download,href:a.href,"aria-label":i.ariaLabel,target:a.target,title:a.title,class:"action-link focusable",rel:"nofollow noreferrer noopener",role:e.isInSemanticMenu&&"menuitem",onClick:o[0]||(o[0]=(...n)=>i.onClick&&i.onClick(...n))},[T(i.$slots,"icon",{},()=>[f("span",{"aria-hidden":"true",class:A(["action-link__icon",[i.isIconUrl?"action-link__icon--url":i.icon]]),style:L({backgroundImage:i.isIconUrl?`url(${i.icon})`:null})},null,6)],!0),i.name?(r(),c("span",ee,[f("strong",se,d(i.name),1),o[1]||(o[1]=f("br",null,null,-1)),f("span",{class:"action-link__longtext",textContent:d(i.text)},null,8,ae)])):i.isLongText?(r(),c("span",{key:1,class:"action-link__longtext",textContent:d(i.text)},null,8,ne)):(r(),c("span",ie,d(i.text),1)),b("",!0)],8,te)],8,Zt)}const re=O(Yt,[["render",oe],["__scopeId","data-v-32f01b7a"]]),le={name:"NcActionRouter",mixins:[z],inject:{isInSemanticMenu:{from:V,default:!1}},props:{to:{type:[String,Object],required:!0}}},ue=["role"],ce={key:0,class:"action-router__longtext-wrapper"},de={class:"action-router__name"},he=["textContent"],pe=["textContent"],fe={key:2,class:"action-router__text"};function me(i,o,a,s,t,e){const n=w("RouterLink");return r(),c("li",{class:"action",role:e.isInSemanticMenu&&"presentation"},[G(n,{"aria-label":i.ariaLabel,class:"action-router focusable",rel:"nofollow noreferrer noopener",role:e.isInSemanticMenu&&"menuitem",title:i.title,to:a.to,onClick:i.onClick},{default:M(()=>[T(i.$slots,"icon",{},()=>[f("span",{"aria-hidden":"true",class:A(["action-router__icon",[i.isIconUrl?"action-router__icon--url":i.icon]]),style:L({backgroundImage:i.isIconUrl?`url(${i.icon})`:null})},null,6)],!0),i.name?(r(),c("span",ce,[f("strong",de,d(i.name),1),o[0]||(o[0]=f("br",null,null,-1)),f("span",{class:"action-router__longtext",textContent:d(i.text)},null,8,he)])):i.isLongText?(r(),c("span",{key:1,class:"action-router__longtext",textContent:d(i.text)},null,8,pe)):(r(),c("span",fe,d(i.text),1)),b("",!0)]),_:3},8,["aria-label","role","title","to","onClick"])],8,ue)}const ge=O(le,[["render",me],["__scopeId","data-v-87267750"]]),be={name:"NcActionText",mixins:[z],inject:{isInSemanticMenu:{from:V,default:!1}}},_e=["role"],ye={key:0,class:"action-text__longtext-wrapper"},ve={class:"action-text__name"},Se=["textContent"],ke=["textContent"],xe={key:2,class:"action-text__text"};function Ce(i,o,a,s,t,e){return r(),c("li",{class:"action",role:e.isInSemanticMenu&&"presentation"},[f("span",{class:"action-text",onClick:o[0]||(o[0]=(...n)=>i.onClick&&i.onClick(...n))},[T(i.$slots,"icon",{},()=>[i.icon!==""?(r(),c("span",{key:0,"aria-hidden":"true",class:A(["action-text__icon",[i.isIconUrl?"action-text__icon--url":i.icon]]),style:L({backgroundImage:i.isIconUrl?`url(${i.icon})`:null})},null,6)):b("",!0)],!0),i.name?(r(),c("span",ye,[f("strong",ve,d(i.name),1),f("span",{class:"action-text__longtext",textContent:d(i.text)},null,8,Se)])):i.isLongText?(r(),c("span",{key:1,class:"action-text__longtext",textContent:d(i.text)},null,8,ke)):(r(),c("span",xe,d(i.text),1)),b("",!0)])],8,_e)}const Ie=O(be,[["render",Ce],["__scopeId","data-v-fa684b48"]]),we=Symbol.for("nc:theme:enforced");function Ue(i){const o=at(()=>ct(i)??document.body),a=dt(R(o.value)),s=Lt();function t(){a.value=R(o.value)}return Ut(o,t,{attributes:!0}),H(o,t),H(s,t,{immediate:!0}),ht(a)}const Le=wt(()=>Ue());function Ae(){const i=Le(),o=ut(we,void 0);return at(()=>o?.value?o.value==="dark":i.value)}const F=new WeakMap,Me={mounted(i,o){const a=!o.modifiers.bubble;let s;if(typeof o.value=="function")s=Y(i,o.value,{capture:a});else{const[t,e]=o.value;s=Y(i,t,Object.assign({capture:a},e))}F.set(i,s)},unmounted(i){const o=F.get(i);o&&typeof o=="function"?o():o?.stop(),F.delete(i)}};function Ne(){let i=!1;const o=pt(!1);return(a,s)=>{if(o.value=s.value,i)return;i=!0;const t=At(a,s.value);H(o,e=>t.value=e)}}Ne();function De(i,o){const a=(y,k)=>y.startsWith(k)?y.slice(k.length):y,s=(y,...k)=>k.reduce((N,_)=>a(N,_),y);if(!i)return null;const t=/^https?:\/\//.test(o),e=/^[a-z][a-z0-9+.-]*:.+/.test(o);if(!t&&e||t&&!o.startsWith(K())||!t&&!o.startsWith("/"))return null;const n=t?s(o,K(),"/index.php"):o,h=s(i.options.history.base,ft(),"/index.php"),S=s(n,h)||"/",C=i.resolve(S);return C.matched.length?C.fullPath:null}function $e(i){return window._nc_contacts_menu_hooks?Object.values(window._nc_contacts_menu_hooks).filter(o=>o.enabled(i)):[]}const Oe=new Int32Array(4);class m{static hashStr(o,a=!1){return this.onePassHasher.start().appendStr(o).end(a)}static hashAsciiStr(o,a=!1){return this.onePassHasher.start().appendAsciiStr(o).end(a)}static stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);static buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);static hexChars="0123456789abcdef";static hexOut=[];static onePassHasher=new m;static _hex(o){const a=m.hexChars,s=m.hexOut;let t,e,n,h;for(h=0;h<4;h+=1)for(e=h*8,t=o[h],n=0;n<8;n+=2)s[e+1+n]=a.charAt(t&15),t>>>=4,s[e+0+n]=a.charAt(t&15),t>>>=4;return s.join("")}static _md5cycle(o,a){let s=o[0],t=o[1],e=o[2],n=o[3];s+=(t&e|~t&n)+a[0]-680876936|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[1]-389564586|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[2]+606105819|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[3]-1044525330|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+a[4]-176418897|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[5]+1200080426|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[6]-1473231341|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[7]-45705983|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+a[8]+1770035416|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[9]-1958414417|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[10]-42063|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[11]-1990404162|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+a[12]+1804603682|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[13]-40341101|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[14]-1502002290|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[15]+1236535329|0,t=(t<<22|t>>>10)+e|0,s+=(t&n|e&~n)+a[1]-165796510|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[6]-1069501632|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[11]+643717713|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[0]-373897302|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+a[5]-701558691|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[10]+38016083|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[15]-660478335|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[4]-405537848|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+a[9]+568446438|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[14]-1019803690|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[3]-187363961|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[8]+1163531501|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+a[13]-1444681467|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[2]-51403784|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[7]+1735328473|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[12]-1926607734|0,t=(t<<20|t>>>12)+e|0,s+=(t^e^n)+a[5]-378558|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[8]-2022574463|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[11]+1839030562|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[14]-35309556|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+a[1]-1530992060|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[4]+1272893353|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[7]-155497632|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[10]-1094730640|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+a[13]+681279174|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[0]-358537222|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[3]-722521979|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[6]+76029189|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+a[9]-640364487|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[12]-421815835|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[15]+530742520|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[2]-995338651|0,t=(t<<23|t>>>9)+e|0,s+=(e^(t|~n))+a[0]-198630844|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[7]+1126891415|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[14]-1416354905|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[5]-57434055|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+a[12]+1700485571|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[3]-1894986606|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[10]-1051523|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[1]-2054922799|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+a[8]+1873313359|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[15]-30611744|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[6]-1560198380|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[13]+1309151649|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+a[4]-145523070|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[11]-1120210379|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[2]+718787259|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[9]-343485551|0,t=(t<<21|t>>>11)+e|0,o[0]=s+o[0]|0,o[1]=t+o[1]|0,o[2]=e+o[2]|0,o[3]=n+o[3]|0}_dataLength=0;_bufferLength=0;_state=new Int32Array(4);_buffer=new ArrayBuffer(68);_buffer8;_buffer32;constructor(){this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(m.stateIdentity),this}appendStr(o){const a=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n;for(n=0;n<o.length;n+=1){if(e=o.charCodeAt(n),e<128)a[t++]=e;else if(e<2048)a[t++]=(e>>>6)+192,a[t++]=e&63|128;else if(e<55296||e>56319)a[t++]=(e>>>12)+224,a[t++]=e>>>6&63|128,a[t++]=e&63|128;else{if(e=(e-55296)*1024+(o.charCodeAt(++n)-56320)+65536,e>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");a[t++]=(e>>>18)+240,a[t++]=e>>>12&63|128,a[t++]=e>>>6&63|128,a[t++]=e&63|128}t>=64&&(this._dataLength+=64,m._md5cycle(this._state,s),t-=64,s[0]=s[16])}return this._bufferLength=t,this}appendAsciiStr(o){const a=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n=0;for(;;){for(e=Math.min(o.length-n,64-t);e--;)a[t++]=o.charCodeAt(n++);if(t<64)break;this._dataLength+=64,m._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}appendByteArray(o){const a=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n=0;for(;;){for(e=Math.min(o.length-n,64-t);e--;)a[t++]=o[n++];if(t<64)break;this._dataLength+=64,m._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}getState(){const o=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[o[0],o[1],o[2],o[3]]}}setState(o){const a=o.buffer,s=o.state,t=this._state;let e;for(this._dataLength=o.length,this._bufferLength=o.buflen,t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],e=0;e<a.length;e+=1)this._buffer8[e]=a.charCodeAt(e)}end(o=!1){const a=this._bufferLength,s=this._buffer8,t=this._buffer32,e=(a>>2)+1;this._dataLength+=a;const n=this._dataLength*8;if(s[a]=128,s[a+1]=s[a+2]=s[a+3]=0,t.set(m.buffer32Identity.subarray(e),e),a>55&&(m._md5cycle(this._state,t),t.set(m.buffer32Identity)),n<=4294967295)t[14]=n;else{const h=n.toString(16).match(/(.*?)(.{0,8})$/);if(h===null)return o?Oe:"";const S=parseInt(h[2],16),C=parseInt(h[1],16)||0;t[14]=S,t[15]=C}return m._md5cycle(this._state,t),o?this._state:m._hex(this._state)}}if(m.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");function Te(i){let o=i;i.match(/^([0-9a-f]{4}-?){8}$/)===null&&(o=m.hashStr(i)),o=o.replace(/[^0-9a-f]/g,"");let a=0;for(let s=0;s<o.length;s++)a+=parseInt(o.charAt(s),16);return a}function Z(i){const o=Et(6),a=Te(i.toLocaleLowerCase());return o[a%o.length]}var J={exports:{}},Ee=J.exports,tt;function Ve(){return tt||(tt=1,(function(i){(function(o){if(typeof a!="function"){var a=function(u){return u};a.nonNative=!0}const s=a("plaintext"),t=a("html"),e=a("comment"),n=/<(\w*)>/g,h=/<\/?([^\s\/>]+)/;function S(u,l,v){u=u||"",l=l||[],v=v||"";let D=y(l,v);return k(u,D)}function C(u,l){u=u||[],l=l||"";let v=y(u,l);return function(D){return k(D||"",v)}}S.init_streaming_mode=C;function y(u,l){return u=N(u),{allowable_tags:u,tag_replacement:l,state:s,tag_buffer:"",depth:0,in_quote_char:""}}function k(u,l){if(typeof u!="string")throw new TypeError("'html' parameter must be a string");let v=l.allowable_tags,D=l.tag_replacement,x=l.state,p=l.tag_buffer,E=l.depth,I=l.in_quote_char,$="";for(let B=0,lt=u.length;B<lt;B++){let g=u[B];if(x===s)g==="<"?(x=t,p+=g):$+=g;else if(x===t)switch(g){case"<":if(I)break;E++;break;case">":if(I)break;if(E){E--;break}I="",x=s,p+=">",v.has(_(p))?$+=p:$+=D,p="";break;case'"':case"'":g===I?I="":I=I||g,p+=g;break;case"-":p==="<!-"&&(x=e),p+=g;break;case" ":case`
`:if(p==="<"){x=s,$+="< ",p="";break}p+=g;break;default:p+=g;break}else x===e&&(g===">"?(p.slice(-2)=="--"&&(x=s),p=""):p+=g)}return l.state=x,l.tag_buffer=p,l.depth=E,l.in_quote_char=I,$}function N(u){let l=new Set;if(typeof u=="string"){let v;for(;v=n.exec(u);)l.add(v[1])}else!a.nonNative&&typeof u[a.iterator]=="function"?l=new Set(u):typeof u.forEach=="function"&&u.forEach(l.add,l);return l}function _(u){let l=h.exec(u);return l?l[1].toLowerCase():null}i.exports?i.exports=S:o.striptags=S})(Ee)})(J)),J.exports}Ve();function ze(i,o){const a=(o?.size||64)<=64?64:512,s=o?.isGuest?"/guest":"",t=o?.isDarkTheme??R(document.body)?"/dark":"";return nt(`/avatar${s}/{user}/{size}${t}`,{user:i,size:a})}mt(gt);const Be={data(){return{hasStatus:!1,userStatus:{status:null,message:null,icon:null}}},methods:{async fetchUserStatus(i){if(!i)return;const o=Ot();if(!(!Object.hasOwn(o,"user_status")||!o.user_status.enabled)&&q())try{const{data:a}=await it.get(_t("apps/user_status/api/v1/statuses/{userId}",{userId:i}));this.setUserStatus(a.ocs.data)}catch(a){if(a.response.status===404&&a.response.data.ocs?.data?.length===0)return;X.error("Failed to fetch user status",{error:a})}},setUserStatus({status:i,message:o,icon:a}){this.userStatus.status=i||"",this.userStatus.message=o||"",this.userStatus.icon=a||"",this.hasStatus=!!i}}},rt=bt("nextcloud").persist().build();function je(i){const o=rt.getItem("user-has-avatar."+i);return typeof o=="string"?!!o:null}function et(i,o){i&&rt.setItem("user-has-avatar."+i,o)}const We={name:"NcAvatar",directives:{ClickOutside:Me},components:{IconDotsHorizontal:Nt,NcActions:Mt,NcButton:Tt,NcIconSvgWrapper:ot,NcLoadingIcon:Bt,NcUserStatusIcon:Vt},mixins:[Be],props:{url:{type:String,default:void 0},iconClass:{type:String,default:void 0},user:{type:String,default:void 0},hideStatus:{type:Boolean,default:!1},verboseStatus:{type:Boolean,default:!1},preloadedUserStatus:{type:Object,default:void 0},isGuest:{type:Boolean,default:!1},displayName:{type:String,default:void 0},size:{type:Number,default:32},noPlaceholder:{type:Boolean,default:!1},disableTooltip:{type:Boolean,default:!1},disableMenu:{type:Boolean,default:!1},tooltipMessage:{type:String,default:null},isNoUser:{type:Boolean,default:!1},menuContainer:{type:[Boolean,String,Object,Element],default:"body"}},setup(){return{isDarkTheme:Ae()}},data(){return{avatarUrlLoaded:null,avatarSrcSetLoaded:null,userDoesNotExist:!1,isAvatarLoaded:!1,isMenuLoaded:!1,contactsMenuLoading:!1,contactsMenuData:{},contactsMenuActions:[],contactsMenuOpenState:!1}},computed:{avatarAriaLabel(){if(this.hasMenu)return this.canDisplayUserStatus||this.showUserStatusIconOnAvatar?j("Avatar of {displayName}, {status}",{displayName:this.displayName??this.user,status:zt(this.userStatus.status)}):j("Avatar of {displayName}",{displayName:this.displayName??this.user})},canDisplayUserStatus(){return!this.hideStatus&&this.hasStatus&&["online","away","busy","dnd"].includes(this.userStatus.status)},showUserStatusIconOnAvatar(){return!this.hideStatus&&!this.verboseStatus&&this.hasStatus&&this.userStatus.status!=="dnd"&&this.userStatus.icon},userIdentifier(){return this.isDisplayNameDefined?this.displayName:this.isUserDefined?this.user:""},isUserDefined(){return typeof this.user<"u"},isDisplayNameDefined(){return typeof this.displayName<"u"},isUrlDefined(){return typeof this.url<"u"},hasMenu(){return this.disableMenu?!1:this.isMenuLoaded?this.menu.length>0:!(this.user===q()?.uid||this.userDoesNotExist||this.url)},showInitials(){return!this.noPlaceholder&&this.userDoesNotExist&&!(this.iconClass||this.$slots.icon)},avatarStyle(){return{"--avatar-size":this.size+"px",lineHeight:this.showInitials?this.size+"px":0,fontSize:Math.round(this.size*.45)+"px"}},initialsWrapperStyle(){const{r:i,g:o,b:a}=Z(this.userIdentifier);return{backgroundColor:`rgba(${i}, ${o}, ${a}, 0.1)`}},initialsStyle(){const{r:i,g:o,b:a}=Z(this.userIdentifier);return{color:`rgb(${i}, ${o}, ${a})`}},tooltip(){return this.disableTooltip?null:this.tooltipMessage?this.tooltipMessage:this.displayName},initials(){let i="?";if(this.showInitials){const o=this.userIdentifier.trim();if(o==="")return i;const a=o.match(/[\p{L}\p{N}\s]/gu);if(!a)return i;const s=a.join(""),t=s.lastIndexOf(" ");i=String.fromCodePoint(s.codePointAt(0)),t!==-1&&(i=i.concat(String.fromCodePoint(s.codePointAt(t+1))))}return i.toLocaleUpperCase()},menu(){const i=this.contactsMenuActions.map(a=>{const s=De(this.$router,a.hyperlink);return{ncActionComponent:s?ge:re,ncActionComponentProps:s?{to:s,icon:a.icon}:{href:a.hyperlink,icon:a.icon},text:a.title}});for(const a of $e(this.contactsMenuData))try{i.push({ncActionComponent:Qt,ncActionComponentProps:{onClick:()=>a.callback(this.contactsMenuData)},text:a.displayName(this.contactsMenuData),iconSvg:a.iconSvg(this.contactsMenuData)})}catch(s){X.error(`Failed to render ContactsMenu action ${a.id}`,{error:s,action:a})}function o(a){const s=document.createTextNode(a),t=document.createElement("p");return t.appendChild(s),t.innerHTML}if(!this.hideStatus&&(this.userStatus.icon||this.userStatus.message)){const a=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
					<text x="50%" y="50%" text-anchor="middle" style="dominant-baseline: central; font-size: 85%">${o(this.userStatus.icon)}</text>
				</svg>`;return[{ncActionComponent:Ie,ncActionComponentProps:{},iconSvg:this.userStatus.icon?a:void 0,text:`${this.userStatus.message}`}].concat(i)}return i}},watch:{url(){this.userDoesNotExist=!1,this.loadAvatarUrl()},user(){this.userDoesNotExist=!1,this.isMenuLoaded=!1,this.loadAvatarUrl()}},mounted(){this.loadAvatarUrl(),P("settings:avatar:updated",this.loadAvatarUrl),P("settings:display-name:updated",this.loadAvatarUrl),!this.hideStatus&&this.user&&!this.isNoUser?(this.preloadedUserStatus?this.setUserStatus(this.preloadedUserStatus):this.fetchUserStatus(this.user),P("user_status:status.updated",this.handleUserStatusUpdated)):!this.hideStatus&&this.preloadedUserStatus&&this.setUserStatus(this.preloadedUserStatus)},beforeUnmount(){W("settings:avatar:updated",this.loadAvatarUrl),W("settings:display-name:updated",this.loadAvatarUrl),W("user_status:status.updated",this.handleUserStatusUpdated)},methods:{t:j,handleUserStatusUpdated(i){this.user===i.userId&&(this.userStatus={status:i.status,icon:i.icon,message:i.message},this.hasStatus=i.status!==null)},async toggleMenu(i){i.type==="keydown"&&i.key!=="Enter"||(this.contactsMenuOpenState||await this.fetchContactsMenu(),this.contactsMenuOpenState=!this.contactsMenuOpenState)},closeMenu(){this.contactsMenuOpenState=!1},async fetchContactsMenu(){this.contactsMenuLoading=!0;try{const i=encodeURIComponent(this.user),{data:o}=await it.post(nt("contactsmenu/findOne"),`shareType=0&shareWith=${i}`);this.contactsMenuData=o,this.contactsMenuActions=o.topAction?[o.topAction].concat(o.actions):o.actions}catch{this.contactsMenuOpenState=!1}this.contactsMenuLoading=!1,this.isMenuLoaded=!0},loadAvatarUrl(){if(this.isAvatarLoaded=!1,!this.isUrlDefined&&(!this.isUserDefined||this.isNoUser||this.iconClass||this.$slots.icon)){this.isAvatarLoaded=!0,this.userDoesNotExist=!0;return}if(this.isUrlDefined){this.updateImageIfValid(this.url);return}if(this.size<=64){const i=this.avatarUrlGenerator(this.user,64),o=[i+" 1x",this.avatarUrlGenerator(this.user,512)+" 8x"].join(", ");this.updateImageIfValid(i,o)}else{const i=this.avatarUrlGenerator(this.user,512);this.updateImageIfValid(i)}},avatarUrlGenerator(i,o){let a=ze(i,{size:o,isDarkTheme:this.isDarkTheme,isGuest:this.isGuest});return i===q()?.uid&&typeof oc_userconfig<"u"&&(a+="?v="+window.oc_userconfig.avatar.version),a},updateImageIfValid(i,o=null){const a=je(this.user);if(this.isUserDefined&&typeof a=="boolean"){this.isAvatarLoaded=!0,this.avatarUrlLoaded=i,o&&(this.avatarSrcSetLoaded=o),a===!1&&(this.userDoesNotExist=!0);return}const s=new Image;s.onload=()=>{this.avatarUrlLoaded=i,o&&(this.avatarSrcSetLoaded=o),this.isAvatarLoaded=!0,et(this.user,!0)},s.onerror=t=>{X.debug("[NcAvatar] Invalid avatar url",{error:t,url:i}),this.avatarUrlLoaded=null,this.avatarSrcSetLoaded=null,this.userDoesNotExist=!0,this.isAvatarLoaded=!1,et(this.user,!1)},o&&(s.srcset=o),s.src=i}}},Pe=["title"],Fe=["src","srcset"],Ge={key:2,class:"avatardiv__user-status avatardiv__user-status--icon"};function He(i,o,a,s,t,e){const n=w("NcLoadingIcon"),h=w("IconDotsHorizontal"),S=w("NcButton"),C=w("NcIconSvgWrapper"),y=w("NcActions"),k=w("NcUserStatusIcon"),N=yt("click-outside");return vt((r(),c("span",{class:A(["avatardiv popovermenu-wrapper",{"avatardiv--unknown":t.userDoesNotExist,"avatardiv--with-menu":e.hasMenu,"avatardiv--with-menu-loading":t.contactsMenuLoading}]),style:L(e.avatarStyle),title:e.tooltip},[T(i.$slots,"icon",{},()=>[a.iconClass?(r(),c("span",{key:0,class:A([a.iconClass,"avatar-class-icon"])},null,2)):t.isAvatarLoaded&&!t.userDoesNotExist?(r(),c("img",{key:1,src:t.avatarUrlLoaded,srcset:t.avatarSrcSetLoaded,alt:""},null,8,Fe)):b("",!0)],!0),e.hasMenu&&e.menu.length===0?(r(),U(S,{key:0,"aria-label":e.avatarAriaLabel,class:"action-item action-item__menutoggle",variant:"tertiary-no-background",onClick:e.toggleMenu},{icon:M(()=>[t.contactsMenuLoading?(r(),U(n,{key:0})):(r(),U(h,{key:1,size:20}))]),_:1},8,["aria-label","onClick"])):e.hasMenu?(r(),U(y,{key:1,open:t.contactsMenuOpenState,"onUpdate:open":o[0]||(o[0]=_=>t.contactsMenuOpenState=_),"aria-label":e.avatarAriaLabel,container:a.menuContainer,"force-menu":"","manual-open":"",variant:"tertiary-no-background",onClick:e.toggleMenu},Q({default:M(()=>[(r(!0),c(St,null,kt(e.menu,(_,u)=>(r(),U(xt(_.ncActionComponent),st({key:u},{ref_for:!0},_.ncActionComponentProps),Q({default:M(()=>[Ct(" "+d(_.text),1)]),_:2},[_.iconSvg?{name:"icon",fn:M(()=>[G(C,{svg:_.iconSvg},null,8,["svg"])]),key:"0"}:void 0]),1040))),128))]),_:2},[t.contactsMenuLoading?{name:"icon",fn:M(()=>[G(n)]),key:"0"}:void 0]),1032,["open","aria-label","container","onClick"])):b("",!0),e.showUserStatusIconOnAvatar?(r(),c("span",Ge,d(i.userStatus.icon),1)):e.canDisplayUserStatus?(r(),U(k,{key:3,class:"avatardiv__user-status",status:i.userStatus.status,"aria-hidden":String(e.hasMenu)},null,8,["status","aria-hidden"])):b("",!0),e.showInitials?(r(),c("span",{key:4,style:L(e.initialsWrapperStyle),class:"avatardiv__initials-wrapper"},[f("span",{style:L(e.initialsStyle),class:"avatardiv__initials"},d(e.initials),5)],4)):b("",!0)],14,Pe)),[[N,e.closeMenu]])}const Ze=O(We,[["render",He],["__scopeId","data-v-d7dc2a1f"]]);export{Ze as N,Qt as a,re as b,Be as u};
//# sourceMappingURL=NcAvatar-DmUGApWA-Ba0v7jcG.chunk.mjs.map
