import{j as O,s as v}from"./index-JpgrUA2Z-hoZOv0I-.chunk.mjs";import{d as s,_ as S,r as c,F as m,o as n,I as a,a as p,t as l,w as g,b,P as C,Q as $,c as y,ae as M,z as q,R as x,G as I,K as T}from"./_plugin-vue_export-helper-sUpjG1-Y.chunk.mjs";import{e as A}from"./string_decoder-CKkZVVJW.chunk.mjs";import{N as R}from"./NcSelect-Czzsi3P_-BfHbk_qw.chunk.mjs";import{c as B,m as j,a as U,O as L,l as k}from"./user_status-menu.mjs";import{N as E}from"./NcEmojiPicker-pM4Pg2yq-Djq7ah7y.chunk.mjs";import{_ as V}from"./TrashCanOutline-DMH4BocM.chunk.mjs";import{N as z}from"./NcUserStatusIcon-CGEf7fej-CSAsMs-R.chunk.mjs";import"./mdi-BrEv6Slh.chunk.mjs";import"./index-Cvjfo1ma.chunk.mjs";import"./index-I0e37rkN.chunk.mjs";import"./TrayArrowDown-ItfJEWXj.chunk.mjs";import"./NcColorPicker-Kc0JqRtp-44mUS6uA.chunk.mjs";import"./colors-Go3zmZRD-B3dC1KT2.chunk.mjs";import"./NcInputField-Bwsh2aHY-fSb6LlM4.chunk.mjs";function D(){return[{label:s("user_status","Don't clear"),clearAt:null},{label:s("user_status","30 minutes"),clearAt:{type:"period",time:1800}},{label:s("user_status","1 hour"),clearAt:{type:"period",time:3600}},{label:s("user_status","4 hours"),clearAt:{type:"period",time:14400}},{label:s("user_status","Today"),clearAt:{type:"end-of",time:"day"}},{label:s("user_status","This week"),clearAt:{type:"end-of",time:"week"}}]}const H={name:"ClearAtSelect",components:{NcSelect:R},props:{clearAt:{type:Object,default:null}},emits:["selectClearAt"],data(){return{options:D()}},computed:{option(){return{clearAt:this.clearAt,label:B(this.clearAt)}}},methods:{t:s,select(t){t&&this.$emit("selectClearAt",t.clearAt)}}},K={class:"clear-at-select"},W={class:"clear-at-select__label",for:"clearStatus"};function G(t,i,r,_,o,e){const d=c("NcSelect");return n(),m("div",K,[a("label",W,l(e.t("user_status","Clear status after")),1),p(d,{"input-id":"clearStatus",class:"clear-at-select__select",options:o.options,"model-value":e.option,clearable:!1,placement:"top","label-outside":"","onOption:selected":e.select},null,8,["options","model-value","onOption:selected"])])}const Q=S(H,[["render",G],["__scopeId","data-v-84b8c013"]]),Y={name:"CustomMessageInput",components:{NcTextField:V,NcButton:A,NcEmojiPicker:E},props:{icon:{type:String,default:"ðŸ˜€"},message:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["change","selectIcon"],computed:{visibleIcon(){return this.icon||"ðŸ˜€"}},methods:{t:s,focus(){this.$refs.input.focus()},onChange(t){this.$emit("change",t)},setIcon(t){this.$emit("selectIcon",t)}}},J={class:"custom-input",role:"group"},X={class:"custom-input__container"};function Z(t,i,r,_,o,e){const d=c("NcButton"),u=c("NcEmojiPicker"),f=c("NcTextField");return n(),m("div",J,[p(u,{container:".custom-input",onSelect:e.setIcon},{default:g(()=>[p(d,{variant:"tertiary","aria-label":e.t("user_status","Emoji for your status message")},{icon:g(()=>[b(l(e.visibleIcon),1)]),_:1},8,["aria-label"])]),_:1},8,["onSelect"]),a("div",X,[p(f,{ref:"input",maxlength:"80",disabled:r.disabled,placeholder:e.t("user_status","What is your status?"),"model-value":r.message,type:"text",label:e.t("user_status","What is your status?"),"onUpdate:modelValue":e.onChange},null,8,["disabled","placeholder","model-value","label","onUpdate:modelValue"])])])}const ee=S(Y,[["render",Z],["__scopeId","data-v-a19a0a87"]]),te={name:"OnlineStatusSelect",components:{NcUserStatusIcon:z},props:{checked:{type:Boolean,default:!1},type:{type:String,required:!0},label:{type:String,required:!0},subline:{type:String,default:null}},emits:["select"],computed:{id(){return`user-status-online-status-${this.type}`}},methods:{onChange(){this.$emit("select",this.type)}}},se={class:"user-status-online-select"},ae=["id","checked"],ie=["for"],ue={class:"user-status-online-select__icon-wrapper"},re={class:"user-status-online-select__subline"};function le(t,i,r,_,o,e){const d=c("NcUserStatusIcon");return n(),m("div",se,[a("input",{id:e.id,checked:r.checked,class:"hidden-visually user-status-online-select__input",type:"radio",name:"user-status-online",onChange:i[0]||(i[0]=(...u)=>e.onChange&&e.onChange(...u))},null,40,ae),a("label",{for:e.id,class:"user-status-online-select__label"},[a("span",ue,[p(d,{status:r.type,class:"user-status-online-select__icon","aria-hidden":"true"},null,8,["status"])]),b(" "+l(r.label)+" ",1),a("em",re,l(r.subline),1)],8,ie)])}const ne=S(te,[["render",le],["__scopeId","data-v-16876893"]]),ce={name:"PredefinedStatus",props:{messageId:{type:String,required:!0},icon:{type:String,required:!0},message:{type:String,required:!0},clearAt:{type:Object,required:!1,default:null},selected:{type:Boolean,required:!1,default:!1}},emits:["select"],computed:{id(){return`user-status-predefined-status-${this.messageId}`},formattedClearAt(){return B(this.clearAt)}},methods:{select(){this.$emit("select")}}},oe={class:"predefined-status"},de=["id","checked"],pe=["for"],me={"aria-hidden":"true",class:"predefined-status__label--icon"},he={class:"predefined-status__label--message"},ge={class:"predefined-status__label--clear-at"};function Se(t,i,r,_,o,e){return n(),m("li",oe,[a("input",{id:e.id,class:"hidden-visually predefined-status__input",type:"radio",name:"predefined-status",checked:r.selected,onChange:i[0]||(i[0]=(...d)=>e.select&&e.select(...d))},null,40,de),a("label",{class:"predefined-status__label",for:e.id},[a("span",me,l(r.icon),1),a("span",he,l(r.message),1),a("span",ge,l(e.formattedClearAt),1)],8,pe)])}const _e=S(ce,[["render",Se],["__scopeId","data-v-200bf95b"]]),fe={name:"PredefinedStatusesList",components:{PredefinedStatus:_e},emits:["selectStatus"],data(){return{lastSelected:null}},computed:{...U({predefinedStatuses:t=>t.predefinedStatuses.predefinedStatuses,messageId:t=>t.userStatus.messageId}),...j(["statusesHaveLoaded"])},watch:{messageId:{immediate:!0,handler(){this.lastSelected=this.messageId}}},created(){this.$store.dispatch("loadAllPredefinedStatuses")},methods:{t:s,selectStatus(t){this.lastSelected=t.id,this.$emit("selectStatus",t)}}},be=["aria-label"],ye={key:1,class:"predefined-statuses-list"};function ve(t,i,r,_,o,e){const d=c("PredefinedStatus");return t.statusesHaveLoaded?(n(),m("ul",{key:0,class:"predefined-statuses-list","aria-label":e.t("user_status","Predefined statuses")},[(n(!0),m(C,null,$(t.predefinedStatuses,u=>(n(),y(d,{key:u.id,"message-id":u.id,icon:u.icon,message:u.message,"clear-at":u.clearAt,selected:o.lastSelected===u.id,onSelect:f=>e.selectStatus(u)},null,8,["message-id","icon","message","clear-at","selected","onSelect"]))),128))],8,be)):(n(),m("div",ye,[...i[0]||(i[0]=[a("div",{class:"icon icon-loading-small"},null,-1)])]))}const Ie=S(fe,[["render",ve],["__scopeId","data-v-09171ec7"]]),ke={name:"PreviousStatus",components:{NcButton:A},props:{icon:{type:[String,null],required:!0},message:{type:String,required:!0}},emits:["select"],methods:{t:s,select(){this.$emit("select")}}},Ae={class:"predefined-status__icon"},Me={class:"predefined-status__message"},Ce={class:"predefined-status__clear-at"},$e={class:"backup-status__reset-button"};function Be(t,i,r,_,o,e){const d=c("NcButton");return n(),m("div",{class:"predefined-status backup-status",tabindex:"0",onKeyup:[i[0]||(i[0]=M((...u)=>e.select&&e.select(...u),["enter"])),i[1]||(i[1]=M((...u)=>e.select&&e.select(...u),["space"]))],onClick:i[2]||(i[2]=(...u)=>e.select&&e.select(...u))},[a("span",Ae,l(r.icon),1),a("span",Me,l(r.message),1),a("span",Ce,l(e.t("user_status","Previously set")),1),a("div",$e,[p(d,{onClick:e.select},{default:g(()=>[b(l(e.t("user_status","Reset status")),1)]),_:1},8,["onClick"])])],32)}const Pe=S(ke,[["render",Be],["__scopeId","data-v-5fa747a0"]]);function Ne(){return[{type:"online",label:s("user_status","Online")},{type:"away",label:s("user_status","Away")},{type:"busy",label:s("user_status","Busy")},{type:"dnd",label:s("user_status","Do not disturb"),subline:s("user_status","Mute all notifications")},{type:"invisible",label:s("user_status","Invisible"),subline:s("user_status","Appear offline")}]}const we={name:"SetStatusModal",components:{ClearAtSelect:Q,CustomMessageInput:ee,NcModal:O,OnlineStatusSelect:ne,PredefinedStatusesList:Ie,PreviousStatus:Pe,NcButton:A},mixins:[L],props:{inline:{type:Boolean,default:!1}},emits:["close"],data(){return{clearAt:null,editedMessage:"",predefinedMessageId:null,isSavingStatus:!1,statuses:Ne()}},computed:{messageId(){return this.$store.state.userStatus.messageId},icon(){return this.$store.state.userStatus.icon},message(){return this.$store.state.userStatus.message||""},hasBackupStatus(){return this.messageId&&(this.backupIcon||this.backupMessage)},backupIcon(){return this.$store.state.userBackupStatus.icon||""},backupMessage(){return this.$store.state.userBackupStatus.message||""},absencePageUrl(){return T("settings/user/availability#absence")},resetButtonText(){return this.backupIcon&&this.backupMessage?s("user_status",'Reset status to "{icon} {message}"',{icon:this.backupIcon,message:this.backupMessage}):this.backupMessage?s("user_status",'Reset status to "{message}"',{message:this.backupMessage}):this.backupIcon?s("user_status",'Reset status to "{icon}"',{icon:this.backupIcon}):s("user_status","Reset status")},setReturnFocus(){if(!this.inline)return document.querySelector('[aria-controls="header-menu-user-menu"]')??void 0}},watch:{message:{immediate:!0,handler(t){this.editedMessage=t}}},mounted(){this.$store.dispatch("fetchBackupFromServer"),this.predefinedMessageId=this.$store.state.userStatus.messageId,this.$store.state.userStatus.clearAt!==null&&(this.clearAt={type:"_time",time:this.$store.state.userStatus.clearAt})},methods:{t:s,closeModal(){this.$emit("close")},setIcon(t){this.predefinedMessageId=null,this.$store.dispatch("setCustomMessage",{message:this.message,icon:t,clearAt:this.clearAt}),this.$nextTick(()=>{this.$refs.customMessageInput.focus()})},setMessage(t){this.predefinedMessageId=null,this.editedMessage=t},setClearAt(t){this.clearAt=t},selectPredefinedMessage(t){this.predefinedMessageId=t.id,this.clearAt=t.clearAt,this.$store.dispatch("setPredefinedMessage",{messageId:t.id,clearAt:t.clearAt})},async saveStatus(){if(!this.isSavingStatus){try{this.isSavingStatus=!0,this.predefinedMessageId===null?await this.$store.dispatch("setCustomMessage",{message:this.editedMessage,icon:this.icon,clearAt:this.clearAt}):this.$store.dispatch("setPredefinedMessage",{messageId:this.predefinedMessageId,clearAt:this.clearAt})}catch(t){v(s("user_status","There was an error saving the status")),k.debug(t),this.isSavingStatus=!1;return}this.isSavingStatus=!1,this.closeModal()}},async clearStatus(){try{this.isSavingStatus=!0,await this.$store.dispatch("clearMessage")}catch(t){v(s("user_status","There was an error clearing the status")),k.debug(t),this.isSavingStatus=!1;return}this.isSavingStatus=!1,this.predefinedMessageId=null,this.closeModal()},async revertBackupFromServer(){try{this.isSavingStatus=!0,await this.$store.dispatch("revertBackupFromServer",{messageId:this.messageId})}catch(t){v(s("user_status","There was an error reverting the status")),k.debug(t),this.isSavingStatus=!1;return}this.isSavingStatus=!1,this.predefinedMessageId=this.$store.state.userStatus?.messageId}}},Fe={class:"set-status-modal"},Oe={id:"user_status-set-dialog",class:"set-status-modal__header"},qe=["aria-label"],xe={class:"set-status-modal__header"},Te={class:"set-status-modal__custom-input"},Re={key:0,class:"set-status-modal__automation-hint"},je={class:"status-buttons"};function Ue(t,i,r,_,o,e){const d=c("OnlineStatusSelect"),u=c("CustomMessageInput"),f=c("NcButton"),P=c("PreviousStatus"),N=c("PredefinedStatusesList"),w=c("ClearAtSelect"),F=c("NcModal");return n(),y(F,{size:"normal","label-id":"user_status-set-dialog",dark:"","set-return-focus":e.setReturnFocus,onClose:e.closeModal},{default:g(()=>[a("div",Fe,[a("h2",Oe,l(e.t("user_status","Online status")),1),a("div",{class:"set-status-modal__online-status",role:"radiogroup","aria-label":e.t("user_status","Online status")},[(n(!0),m(C,null,$(o.statuses,h=>(n(),y(d,q({key:h.type},{ref_for:!0},h,{checked:h.type===t.statusType,onSelect:t.changeStatus}),null,16,["checked","onSelect"]))),128))],8,qe),a("form",{onSubmit:i[0]||(i[0]=x((...h)=>e.saveStatus&&e.saveStatus(...h),["prevent"])),onReset:i[1]||(i[1]=(...h)=>e.clearStatus&&e.clearStatus(...h))},[a("h3",xe,l(e.t("user_status","Status message")),1),a("div",Te,[p(u,{ref:"customMessageInput",icon:e.icon,message:o.editedMessage,onChange:e.setMessage,onSelectIcon:e.setIcon},null,8,["icon","message","onChange","onSelectIcon"]),e.messageId==="vacationing"?(n(),y(f,{key:0,href:e.absencePageUrl,target:"_blank",variant:"secondary","aria-label":e.t("user_status","Set absence period")},{default:g(()=>[b(l(e.t("user_status","Set absence period and replacement")+" â†—"),1)]),_:1},8,["href","aria-label"])):I("",!0)]),e.hasBackupStatus?(n(),m("div",Re,l(e.t("user_status","Your status was set automatically")),1)):I("",!0),e.hasBackupStatus?(n(),y(P,{key:1,icon:e.backupIcon,message:e.backupMessage,onSelect:e.revertBackupFromServer},null,8,["icon","message","onSelect"])):I("",!0),p(N,{onSelectStatus:e.selectPredefinedMessage},null,8,["onSelectStatus"]),p(w,{"clear-at":o.clearAt,onSelectClearAt:e.setClearAt},null,8,["clear-at","onSelectClearAt"]),a("div",je,[p(f,{wide:!0,variant:"tertiary",type:"reset","aria-label":e.t("user_status","Clear status message"),disabled:o.isSavingStatus},{default:g(()=>[b(l(e.t("user_status","Clear status message")),1)]),_:1},8,["aria-label","disabled"]),p(f,{wide:!0,variant:"primary",type:"submit","aria-label":e.t("user_status","Set status message"),disabled:o.isSavingStatus},{default:g(()=>[b(l(e.t("user_status","Set status message")),1)]),_:1},8,["aria-label","disabled"])])],32)])]),_:1},8,["set-return-focus","onClose"])}const tt=S(we,[["render",Ue],["__scopeId","data-v-40458f54"]]);export{tt as default};
//# sourceMappingURL=SetStatusModal-CLZK-PFi.chunk.mjs.map
