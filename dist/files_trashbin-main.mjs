/*! third party licenses: dist/vendor.LICENSE.txt */
import{bW as u,c1 as h,c9 as C,c8 as N,bZ as k,bS as a,aV as S,an as D,bR as U,bQ as E}from"./core-common.mjs";import{aa as L,ab as R}from"./chunks/icons-TElqpmA8.mjs";import{l as q,m as I,o as z,p as A,k as V,q as f,r as F,F as H,P as M,n as O,V as P}from"./chunks/index-DG15V7L3.mjs";import{c as W}from"./chunks/index-tn-fAC9x.mjs";import{m as v}from"./chunks/index-DaZEPb_2.mjs";import{d as X,e as $}from"./chunks/index-CPb3EwrS.mjs";import{l as B}from"./chunks/logger-R_K4lHwR.mjs";import"./chunks/index-CiG5J8j_.mjs";import"./chunks/index-PaKKd09k.mjs";var y;const m="/trashbin/".concat((y=u())==null?void 0:y.uid,"/trash"),K=h("dav"+m),p=W(K),w=t=>{p.setHeaders({"X-Requested-With":"XMLHttpRequest",requesttoken:t!=null?t:""})};N(w),w(C());const _='<?xml version="1.0"?>\n<d:propfind '.concat(q(),">\n	<d:prop>\n		<nc:trashbin-filename />\n		<nc:trashbin-deletion-time />\n		<nc:trashbin-original-location />\n		<nc:trashbin-title />\n		<nc:trashbin-deleted-by-id />\n		<nc:trashbin-deleted-by-display-name />\n		").concat(I(),"\n	</d:prop>\n</d:propfind>"),g=function(t){var n,e,i,r,s;const l=z((n=t.props)==null?void 0:n.permissions),o=(e=u())==null?void 0:e.uid,x=k("/apps/files_trashbin/preview?fileId={fileid}&x=32&y=32",t.props),c={id:((i=t.props)==null?void 0:i.fileid)||0,source:h("dav"+m+t.filename),mime:t.mime,size:((r=t.props)==null?void 0:r.size)||0,permissions:l,owner:o,root:m,attributes:{...t,...t.props,displayName:(s=t.props)==null?void 0:s["trashbin-filename"],previewUrl:x}};return delete c.attributes.props,t.type==="file"?new A(c):new V(c)},Q=async(t="/")=>{const n=await p.stat(t,{details:!0,data:_}),e=await p.getDirectoryContents(t,{details:!0,data:_});return{folder:g(n.data),contents:e.data.map(g)}},b=t=>{var n,e;const i=((n=t.attributes)==null?void 0:n["trashbin-original-location"])!==void 0?String((e=t.attributes)==null?void 0:e["trashbin-original-location"]):null;if(!i)return a("files_trashbin","Unknown");const r=X(i);return r===i?a("files_trashbin","All files"):r.replace(/^\//,"")},T=(t,n)=>{var e;const i=(e=u())==null?void 0:e.uid;return t===i?a("files_trashbin","You"):!t&&!n?a("files_trashbin","Unknown"):null},d=t=>{var n,e,i,r;const s=((n=t.attributes)==null?void 0:n["trashbin-deleted-by-id"])!==void 0?String((e=t.attributes)==null?void 0:e["trashbin-deleted-by-id"]):null,l=((i=t.attributes)==null?void 0:i["trashbin-deleted-by-display-name"])!==void 0?String((r=t.attributes)==null?void 0:r["trashbin-deleted-by-display-name"]):null,o=T(s,l);return{userId:s,displayName:l,label:o}},Y=new f({id:"original-location",title:a("files_trashbin","Original location"),render(t){const n=b(t),e=document.createElement("span");return e.title=n,e.textContent=n,e},sort(t,n){const e=b(t),i=b(n);return e.localeCompare(i)}}),Z=new f({id:"deleted-by",title:a("files_trashbin","Deleted by"),render(t){const{userId:n,displayName:e,label:i}=d(t);if(i){const l=document.createElement("span");return l.textContent=i,l}const r=S.extend(D),s={size:32,user:n!=null?n:void 0,displayName:e!=null?e:a("files_trashbin","Unknown")};return new r({propsData:s}).$mount().$el},sort(t,n){var e,i,r,s;const l=(i=(e=d(t).label)!=null?e:d(t).displayName)!=null?i:a("files_trashbin","Unknown"),o=(s=(r=d(n).label)!=null?r:d(n).displayName)!=null?s:a("files_trashbin","Unknown");return l.localeCompare(o)}}),j=new f({id:"deleted",title:a("files_trashbin","Deleted"),render(t){var n;const e=(n=t.attributes)==null?void 0:n["trashbin-deletion-time"],i=document.createElement("span");return e?(i.title=v.unix(e).format("LLL"),i.textContent=v.unix(e).fromNow(),i):(i.textContent=a("files_trashbin","A long time ago"),i)},sort(t,n){var e,i;const r=((e=t.attributes)==null?void 0:e["trashbin-deletion-time"])||(t==null?void 0:t.mtime)||0;return(((i=n.attributes)==null?void 0:i["trashbin-deletion-time"])||(n==null?void 0:n.mtime)||0)-r}}),G=[Y,Z,j];F(new H({id:"restore",displayName(){return a("files_trashbin","Restore")},iconSvgInline:()=>L,enabled(t,n){return n.id!=="trashbin"?!1:t.length>0&&t.map(e=>e.permissions).every(e=>(e&M.READ)!==0)},async exec(t){var n;try{const e=h($("dav/trashbin/".concat((n=u())==null?void 0:n.uid,"/restore/").concat(t.basename)));return await U({method:"MOVE",url:t.encodedSource,headers:{destination:e}}),E("files:node:deleted",t),!0}catch(e){return B.error(e),!1}},async execBatch(t,n,e){return Promise.all(t.map(i=>this.exec(i,n,e)))},order:1,inline:()=>!0}));const J=O();J.register(new P({id:"trashbin",name:a("files_trashbin","Deleted files"),caption:a("files_trashbin","List of files that have been deleted."),emptyTitle:a("files_trashbin","No deleted files"),emptyCaption:a("files_trashbin","Files and folders you have deleted will show up here"),icon:R,order:50,sticky:!0,defaultSortKey:"deleted",columns:G,getContents:Q}));
