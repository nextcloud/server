{"version":3,"file":"encryption-settings_personal.mjs","sources":["../build/frontend/apps/encryption/src/components/SettingsPersonalChangePrivateKey.vue","../build/frontend/apps/encryption/src/components/SettingsPersonalEnableRecovery.vue","../build/frontend/apps/encryption/src/views/SettingsPersonal.vue","../build/frontend/apps/encryption/src/settings-personal.ts"],"sourcesContent":["<!--\n - SPDX-FileCopyrightText: 2026 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n -->\n\n<script setup lang=\"ts\">\nimport axios, { isAxiosError } from '@nextcloud/axios'\nimport { showError } from '@nextcloud/dialogs'\nimport { t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport { NcButton, NcFormGroup, NcNoteCard, NcPasswordField } from '@nextcloud/vue'\nimport { ref, useTemplateRef } from 'vue'\n\ndefineProps<{\n\trecoveryEnabledForUser: boolean\n}>()\n\nconst emit = defineEmits<{\n\tupdated: []\n}>()\n\nconst formElement = useTemplateRef('form')\n\nconst isLoading = ref(false)\nconst hasError = ref(false)\nconst oldPrivateKeyPassword = ref('')\nconst newPrivateKeyPassword = ref('')\n\n/**\n * Handle the form submission to change the private key password\n */\nasync function onSubmit() {\n\tif (isLoading.value) {\n\t\treturn\n\t}\n\n\tisLoading.value = true\n\thasError.value = false\n\ttry {\n\t\tawait axios.post(\n\t\t\tgenerateUrl('/apps/encryption/ajax/updatePrivateKeyPassword'),\n\t\t\t{\n\t\t\t\toldPassword: oldPrivateKeyPassword.value,\n\t\t\t\tnewPassword: newPrivateKeyPassword.value,\n\t\t\t},\n\t\t)\n\t\toldPrivateKeyPassword.value = newPrivateKeyPassword.value = ''\n\t\tformElement.value?.reset()\n\t\temit('updated')\n\t} catch (error) {\n\t\tif (isAxiosError(error) && error.response && error.response.data?.data?.message) {\n\t\t\tshowError(error.response.data.data.message)\n\t\t}\n\t\thasError.value = true\n\t} finally {\n\t\tisLoading.value = false\n\t}\n}\n</script>\n\n<template>\n\t<form ref=\"form\" @submit.prevent=\"onSubmit\">\n\t\t<NcFormGroup\n\t\t\t:label=\"t('encryption', 'Update private key password')\"\n\t\t\t:description=\"t('encryption', 'Your private key password no longer matches your log-in password. Set your old private key password to your current log-in password.')\">\n\t\t\t<NcNoteCard v-if=\"recoveryEnabledForUser\">\n\t\t\t\t{{ t('encryption', 'If you do not remember your old password you can ask your administrator to recover your files.') }}\n\t\t\t</NcNoteCard>\n\n\t\t\t<NcPasswordField :label=\"t('encryption', 'Old log-in password')\" />\n\t\t\t<NcPasswordField :label=\"t('encryption', 'Current log-in password')\" />\n\n\t\t\t<NcButton\n\t\t\t\ttype=\"submit\"\n\t\t\t\tvariant=\"primary\">\n\t\t\t\t{{ t('encryption', 'Update') }}\n\t\t\t</NcButton>\n\t\t</NcFormGroup>\n\t</form>\n</template>\n","<!--\n - SPDX-FileCopyrightText: 2026 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n -->\n\n<script setup lang=\"ts\">\nimport axios, { isAxiosError } from '@nextcloud/axios'\nimport { showError, showLoading } from '@nextcloud/dialogs'\nimport { t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport { watchDebounced } from '@vueuse/core'\nimport { ref, watch } from 'vue'\nimport NcCheckboxRadioSwitch from '@nextcloud/vue/components/NcCheckboxRadioSwitch'\n\nconst userEnableRecovery = defineModel<boolean>({ required: true })\nconst isLoading = ref(false)\n\nwatch(userEnableRecovery, () => {\n\tisLoading.value = true\n})\nwatchDebounced([userEnableRecovery], async ([newValue], [oldValue]) => {\n\tif (newValue === oldValue) {\n\t\t// user changed their mind (likely quickly toggled), do nothing\n\t\tisLoading.value = false\n\t\treturn\n\t}\n\n\tconst toast = showLoading(t('encryption', 'Updating recovery keys. This can take some timeâ€¦'))\n\ttry {\n\t\tawait axios.post(\n\t\t\tgenerateUrl('/apps/encryption/ajax/userSetRecovery'),\n\t\t\t{ userEnableRecovery: userEnableRecovery.value },\n\t\t)\n\t} catch (error) {\n\t\tuserEnableRecovery.value = oldValue\n\t\tif (isAxiosError(error) && error.response && error.response.data?.data?.message) {\n\t\t\tshowError(error.response.data.data.message)\n\t\t}\n\t} finally {\n\t\ttoast.hideToast()\n\t\tisLoading.value = false\n\t}\n}, { debounce: 800 })\n</script>\n\n<template>\n\t<NcCheckboxRadioSwitch\n\t\tv-model=\"userEnableRecovery\"\n\t\ttype=\"switch\"\n\t\t:loading=\"isLoading\"\n\t\t:description=\"t('encryption', 'Enabling this option will allow you to reobtain access to your encrypted files in case of password loss')\">\n\t\t{{ t('encryption', 'Enable password recovery') }}\n\t</NcCheckboxRadioSwitch>\n</template>\n","<!--\n - SPDX-FileCopyrightText: 2026 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n -->\n\n<script setup lang=\"ts\">\nimport axios from '@nextcloud/axios'\nimport { showInfo } from '@nextcloud/dialogs'\nimport { loadState } from '@nextcloud/initial-state'\nimport { t } from '@nextcloud/l10n'\nimport { generateUrl } from '@nextcloud/router'\nimport { ref } from 'vue'\nimport NcNoteCard from '@nextcloud/vue/components/NcNoteCard'\nimport NcSettingsSection from '@nextcloud/vue/components/NcSettingsSection'\nimport SettingsPersonalChangePrivateKey from '../components/SettingsPersonalChangePrivateKey.vue'\nimport SettingsPersonalEnableRecovery from '../components/SettingsPersonalEnableRecovery.vue'\nimport { logger } from '../utils/logger.ts'\nimport { InitStatus } from '../utils/types.ts'\n\nconst personalSettings = loadState<{\n\trecoveryEnabled: boolean\n\trecoveryEnabledForUser: boolean\n\tprivateKeySet: boolean\n\tinitialized: typeof InitStatus[keyof typeof InitStatus]\n}>('encryption', 'personalSettings')\n\nconst initialized = ref(personalSettings.initialized)\nconst recoveryEnabledForUser = ref(personalSettings.recoveryEnabledForUser)\n\n/**\n * Reload encryption status\n */\nasync function reloadStatus() {\n\ttry {\n\t\tconst { data } = await axios.get(generateUrl('/apps/encryption/ajax/getStatus'))\n\t\tinitialized.value = data.initStatus\n\t\tif (data.data.message) {\n\t\t\tshowInfo(data.data.message)\n\t\t}\n\t} catch (error) {\n\t\tlogger.error('Failed to fetch current encryption status', { error })\n\t}\n}\n</script>\n\n<template>\n\t<NcSettingsSection :name=\"t('encryption', 'Basic encryption module')\">\n\t\t<NcNoteCard v-if=\"initialized === InitStatus.NotInitialized\" type=\"warning\">\n\t\t\t{{ t('encryption', 'Encryption app is enabled but your keys are not initialized, please log-out and log-in again') }}\n\t\t</NcNoteCard>\n\n\t\t<SettingsPersonalChangePrivateKey\n\t\t\tv-else-if=\"initialized === InitStatus.InitExecuted\"\n\t\t\t:recoveryEnabledForUser\n\t\t\t@updated=\"reloadStatus\" />\n\t\t<SettingsPersonalEnableRecovery\n\t\t\tv-else-if=\"personalSettings.recoveryEnabled && personalSettings.privateKeySet\"\n\t\t\tv-model=\"recoveryEnabledForUser\" />\n\t</NcSettingsSection>\n</template>\n","/*!\n * SPDX-FileCopyrightText: 2026 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { createApp } from 'vue'\nimport SettingsPersonal from './views/SettingsPersonal.vue'\n\nconst app = createApp(SettingsPersonal)\napp.mount('#encryption-settings-section')\n"],"names":["emit","__emit","formElement","useTemplateRef","isLoading","ref","hasError","oldPrivateKeyPassword","newPrivateKeyPassword","onSubmit","axios","generateUrl","error","isAxiosError","showError","_createElementBlock","_createVNode","_unref","NcFormGroup","t","__props","_createBlock","NcNoteCard","NcPasswordField","NcButton","userEnableRecovery","_useModel","watch","watchDebounced","newValue","oldValue","toast","showLoading","NcCheckboxRadioSwitch","$event","personalSettings","loadState","initialized","recoveryEnabledForUser","reloadStatus","data","showInfo","logger","NcSettingsSection","InitStatus","SettingsPersonalChangePrivateKey","SettingsPersonalEnableRecovery","app","createApp","SettingsPersonal"],"mappings":"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"}