import{f as He,j as b,o as g,c as B,l as G,e as $,y as Qt,w as k,m as qe,k as T,n as fe,g as be,t as x,z as re,H as De,F as se,af as At,a6 as pe,a5 as Er,r as P,a1 as _e,b as me,v as Zt,ag as lt,A as Ie,p as O,u as w,x as br,C as ke,q as _r,s as Lt,M as wr,B as yr,a4 as Tr,N as Ir,Z as Kt}from"./runtime-dom.esm-bundler-DSTOTAEf.chunk.mjs";import{u as Nr,d as Ar,s as Lr,g as Cr,a as Pe,b as Rr,o as Dr,c as Or,p as Sr,e as kr}from"./index-6_gsQFyp.chunk.mjs";import{a as ut,H as Fr,N as $r}from"./index-RbJ3SLsu.chunk.mjs";import{N as Ct}from"./Plus-D4QQbLoD.chunk.mjs";import{r as Pr,B as We}from"./string_decoder-BO00msnV.chunk.mjs";import{l as Be,e as Br,b as xr,c as Jt,d as Le,j as ye,g as Mr}from"./index-DCpg1aui.chunk.mjs";import{_ as xe,c as Ur,e as zr,g as dt}from"./createElementId-DhjFt1I9-DnDDFk77.chunk.mjs";import{l as Gr,_ as Vr}from"./index-Dpy2yt9b.chunk.mjs";import{a as er,g as Xr}from"./translation-DoG5ZELJ-2ffMJaM4.chunk.mjs";import{c as we,N as tr}from"./logger-D3RVzcfQ-u5jICcTJ.chunk.mjs";import{N as rr}from"./NcCheckboxRadioSwitch-BCSKF7Tk-C_RQDZ7j.chunk.mjs";import{N as Rt,a as Dt,_ as jr}from"./NcDateTime.vue_vue_type_script_setup_true_lang-BhB8yA4U-BZtT1htT.chunk.mjs";import{r as Hr,s as qr,t as Wr,u as Yr,v as Qr,w as Zr,x as Ot,o as Kr,c as Jr}from"./mdi-Dg3BMFGG.chunk.mjs";import{P as ei,a as ti}from"./NcBreadcrumbs-DYfGaSjT-B0sOzfON.chunk.mjs";import{t as A,l as Te,a as pt}from"./index-JpgrUA2Z-CjbNveLz.chunk.mjs";import{c as ir}from"./index-DKddA51s.chunk.mjs";import{N as St}from"./PencilOutline-BbbiWpuA.chunk.mjs";import{N as ri}from"./NcSelect-Czzsi3P_-DQ1pX7Ad.chunk.mjs";import{_ as ii}from"./TrashCanOutline-MY5RRFZ7.chunk.mjs";import"./NcPasswordField-djttkA5Q-PkdHfBrA.chunk.mjs";import"./NcInputField-Bwsh2aHY-CQ8dmik7.chunk.mjs";import"./NcNoteCard-CVhtNL04-xecBaCCz.chunk.mjs";const ai={name:"ChevronRightIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ni=["aria-hidden","aria-label"],oi=["fill","width","height"],si={d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},li={key:0};function ci(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon chevron-right-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",si,[r.title?(g(),b("title",li,x(r.title),1)):G("",!0)])],8,oi))],16,ni)}const ui=xe(ai,[["render",ci]]),di={name:"NcBreadcrumb",components:{NcActions:ut,ChevronRight:ui,NcButton:we},inheritAttrs:!1,props:{name:{type:String,required:!0},title:{type:String,default:null},to:{type:[String,Object],default:void 0},href:{type:String,default:void 0},icon:{type:String,default:""},forceIconText:{type:Boolean,default:!1},disableDrop:{type:Boolean,default:!1},forceMenu:{type:Boolean,default:!1},open:{type:Boolean,default:!1},class:{type:[String,Array,Object],default:""}},emits:["dragenter","dragleave","dropped","update:open"],setup(){const e=Ur();return{actionsContainer:`.vue-crumb[data-crumb-id="${e}"]`,crumbId:e}},data(){return{hovering:!1}},computed:{linkAttributes(){return this.to?{to:this.to,...this.$attrs}:this.href?{href:this.href,...this.$attrs}:this.$attrs}},methods:{onOpenChange(e){this.$emit("update:open",e)},dropped(e){return this.disableDrop||(this.$emit("dropped",e,this.to||this.href),this.$parent.$emit("dropped",e,this.to||this.href),this.hovering=!1),!1},dragEnter(e){this.$emit("dragenter",e),!this.disableDrop&&(this.hovering=!0)},dragLeave(e){this.$emit("dragleave",e),!this.disableDrop&&(e.target.contains(e.relatedTarget)||this.$refs.crumb.contains(e.relatedTarget)||(this.hovering=!1))}}},pi=["data-crumb-id"];function mi(e,i,r,n,c,m){const u=He("NcButton"),f=He("NcActions"),d=He("ChevronRight");return g(),b("li",{ref:"crumb",class:fe(["vue-crumb",[{"vue-crumb--hovered":c.hovering},e.$props.class]]),"data-crumb-id":n.crumbId,draggable:"false",onDragstart:De(()=>{},["prevent"]),onDrop:i[0]||(i[0]=De((...p)=>m.dropped&&m.dropped(...p),["prevent"])),onDragover:De(()=>{},["prevent"]),onDragenter:i[1]||(i[1]=(...p)=>m.dragEnter&&m.dragEnter(...p)),onDragleave:i[2]||(i[2]=(...p)=>m.dragLeave&&m.dragLeave(...p))},[(r.name||r.icon||e.$slots.icon)&&!e.$slots.default?(g(),B(u,re({key:0,"aria-label":r.icon?r.name:void 0,variant:"tertiary"},m.linkAttributes),Qt({_:2},[e.$slots.icon||r.icon?{name:"icon",fn:k(()=>[qe(e.$slots,"icon",{},()=>[T("span",{class:fe([r.icon,"icon"])},null,2)],!0)]),key:"0"}:void 0,!(e.$slots.icon||r.icon)||r.forceIconText?{name:"default",fn:k(()=>[be(x(r.name),1)]),key:"1"}:void 0]),1040,["aria-label"])):G("",!0),e.$slots.default?(g(),B(f,{key:1,ref:"actions",container:n.actionsContainer,"force-menu":r.forceMenu,"force-name":"","menu-name":r.name,open:r.open,title:r.title,variant:"tertiary","onUpdate:open":m.onOpenChange},{icon:k(()=>[qe(e.$slots,"menu-icon",{},void 0,!0)]),default:k(()=>[qe(e.$slots,"default",{},void 0,!0)]),_:3},8,["container","force-menu","menu-name","open","title","onUpdate:open"])):G("",!0),$(d,{class:"vue-crumb__separator",size:20})],42,pi)}const Fe=xe(di,[["render",mi],["__scopeId","data-v-28ef52a4"]]),hi={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},fi=["aria-hidden","aria-label"],gi=["fill","width","height"],vi={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},Ei={key:0};function bi(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",vi,[r.title?(g(),b("title",Ei,x(r.title),1)):G("",!0)])],8,gi))],16,fi)}const kt=xe(hi,[["render",bi]]),W="vue-crumb",_i={name:"NcBreadcrumbs",components:{NcActions:ut,NcActionButton:St,NcActionRouter:Dt,NcActionLink:Rt,NcBreadcrumb:Fe,IconFolder:kt},props:{rootIcon:{type:String,default:"icon-home"},ariaLabel:{type:String,default:null}},emits:["dropped"],data(){return{hiddenIndices:[],menuBreadcrumbProps:{name:"",forceMenu:!0,disableDrop:!0,open:!1},breadcrumbsRefs:[]}},created(){window.addEventListener("resize",Ar(()=>{this.handleWindowResize()},100)),Lr("navigation-toggled",this.delayedResize)},mounted(){this.handleWindowResize()},updated(){this.delayedResize(),this.$nextTick(()=>{this.hideCrumbs()})},beforeUnmount(){window.removeEventListener("resize",this.handleWindowResize),Nr("navigation-toggled",this.delayedResize)},methods:{closeActions(e){this.$refs.actionsBreadcrumb.$el.contains(e.relatedTarget)||(this.menuBreadcrumbProps.open=!1)},async delayedResize(){await this.$nextTick(),this.handleWindowResize()},handleWindowResize(){if(!this.$refs.container)return;const e=this.breadcrumbsRefs.length,i=[],r=this.$refs.container.offsetWidth;let n=this.getTotalWidth();this.$refs.breadcrumb__actions&&(n+=this.$refs.breadcrumb__actions.offsetWidth);let c=n-r;c+=c>0?64:0;let m=0;const u=Math.floor(e/2);for(;c>0&&m<e-2;){const f=u+(m%2?m+1:m)/2*Math.pow(-1,m+e%2);c-=this.getWidth(this.breadcrumbsRefs[f]?.$el,f===this.breadcrumbsRefs.length-1),i.push(f),m++}this.arraysEqual(this.hiddenIndices,i.sort((f,d)=>f-d))||(this.hiddenIndices=i)},arraysEqual(e,i){if(e.length!==i.length)return!1;if(e===i)return!0;if(e===null||i===null)return!1;for(let r=0;r<e.length;++r)if(e[r]!==i[r])return!1;return!0},getTotalWidth(){return this.breadcrumbsRefs.reduce((e,i,r)=>e+this.getWidth(i.$el,r===this.breadcrumbsRefs.length-1),0)},getWidth(e,i){if(!e?.classList)return 0;const r=e.classList.contains(`${W}--hidden`);e.style.minWidth="auto",i&&(e.style.maxWidth="210px"),e.classList.remove(`${W}--hidden`);const n=e.offsetWidth;return r&&e.classList.add(`${W}--hidden`),e.style.minWidth="",e.style.maxWidth="",n},preventDefault(e){return e.preventDefault&&e.preventDefault(),!1},dragStart(e){return this.preventDefault(e)},dropped(e,i,r){r||this.$emit("dropped",e,i),this.menuBreadcrumbProps.open=!1;const n=document.querySelectorAll(`.${W}`);for(const c of n)c.classList.remove(`${W}--hovered`);return this.preventDefault(e)},dragOver(e){return this.preventDefault(e)},dragEnter(e,i){if(!i&&e.target.closest){const r=e.target.closest(`.${W}`);if(r.classList&&r.classList.contains(W)){const n=document.querySelectorAll(`.${W}`);for(const c of n)c.classList.remove(`${W}--hovered`);r.classList.add(`${W}--hovered`)}}},dragLeave(e,i){if(!i&&!e.target.contains(e.relatedTarget)&&e.target.closest){const r=e.target.closest(`.${W}`);if(r.contains(e.relatedTarget))return;r.classList&&r.classList.contains(W)&&r.classList.remove(`${W}--hovered`)}},hideCrumbs(){this.breadcrumbsRefs.forEach((e,i)=>{e?.$el?.classList&&(this.hiddenIndices.includes(i)?e.$el.classList.add(`${W}--hidden`):e.$el.classList.remove(`${W}--hidden`))})},isBreadcrumb(e){return e?.type?.name==="NcBreadcrumb"}},render(){let e=[];if(this.$slots.default?.().forEach(c=>{if(this.isBreadcrumb(c)){e.push(c);return}c?.type===se&&c?.children?.forEach?.(m=>{this.isBreadcrumb(m)&&e.push(m)})}),e.length===0)return;e[0]=At(e[0],{icon:this.rootIcon,ref:"breadcrumbs"});const i=[];e=e.map((c,m)=>At(c,{ref:u=>{i[m]=u}}));const r=[...e];this.hiddenIndices.length&&r.splice(Math.round(e.length/2),0,pe(Fe,{class:"dropdown",...this.menuBreadcrumbProps,"aria-hidden":!0,ref:"actionsBreadcrumb",key:"actions-breadcrumb-1",onDragenter:()=>{this.menuBreadcrumbProps.open=!0},onDragleave:this.closeActions,"onUpdate:open":c=>{this.menuBreadcrumbProps.open=c}},{default:()=>this.hiddenIndices.filter(c=>c<=e.length-1).map(c=>{const m=e[c],{to:u,href:f,disableDrop:d,name:p,...l}=m.props;delete l.ref;let v=St,E="";f&&(v=Rt,E=f),u&&(v=Dt,E=u);const I=pe(kt,{size:20});return pe(v,{...l,class:W,href:f||null,to:u||null,draggable:!1,onDragstart:this.dragStart,onDrop:V=>this.dropped(V,E,d),onDragover:this.dragOver,onDragenter:V=>this.dragEnter(V,d),onDragleave:V=>this.dragLeave(V,d)},{default:()=>p,icon:()=>I})})}));const n=[pe("nav",{"aria-label":this.ariaLabel},[pe("ul",{class:"breadcrumb__crumbs"},[r])])];return Fr(this.$slots.actions?.())&&n.push(pe("div",{class:"breadcrumb__actions",ref:"breadcrumb__actions"},this.$slots.actions?.())),this.breadcrumbsRefs=i,pe("div",{class:["breadcrumb",{"breadcrumb--collapsed":this.hiddenIndices.length===e.length-2}],ref:"container"},n)}},wi=xe(_i,[["__scopeId","data-v-af2b1226"]]);function Ne(){return Be("files_sharing","isPublic",null)??document.querySelector('input#isPublic[type="hidden"][name="isPublic"][value="1"]')!==null}function yi(){return Be("files_sharing","sharingToken",null)??document.querySelector('input#sharingToken[type="hidden"]')?.value??null}function ue(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function Ft(e,i,r){Ti(e,i),i.set(e,r)}function Ti(e,i){if(i.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function H(e,i){var r=ar(e,i,"get");return Ii(e,r)}function Ii(e,i){return i.get?i.get.call(e):i.value}function $t(e,i,r){var n=ar(e,i,"set");return Ni(e,n,r),r}function ar(e,i,r){if(!i.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return i.get(e)}function Ni(e,i,r){if(i.set)i.set.call(e,r);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=r}}var Ai=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",Y=new WeakMap,ve=new WeakMap;class Me{constructor(i){var{executor:r=()=>{},internals:n=ht(),promise:c=new Promise((m,u)=>r(m,u,f=>{n.onCancelList.push(f)}))}=i;Ft(this,Y,{writable:!0,value:void 0}),Ft(this,ve,{writable:!0,value:void 0}),ue(this,Ai,"CancelablePromise"),this.cancel=this.cancel.bind(this),$t(this,Y,n),$t(this,ve,c||new Promise((m,u)=>r(m,u,f=>{n.onCancelList.push(f)})))}then(i,r){return Oe(H(this,ve).then(Ce(i,H(this,Y)),Ce(r,H(this,Y))),H(this,Y))}catch(i){return Oe(H(this,ve).catch(Ce(i,H(this,Y))),H(this,Y))}finally(i,r){return r&&H(this,Y).onCancelList.push(i),Oe(H(this,ve).finally(Ce(()=>{if(i)return r&&(H(this,Y).onCancelList=H(this,Y).onCancelList.filter(n=>n!==i)),i()},H(this,Y))),H(this,Y))}cancel(){H(this,Y).isCanceled=!0;var i=H(this,Y).onCancelList;H(this,Y).onCancelList=[];for(var r of i)if(typeof r=="function")try{r()}catch(n){console.error(n)}}isCanceled(){return H(this,Y).isCanceled===!0}}class ie extends Me{constructor(i){super({executor:i})}}ue(ie,"all",function(e){return Re(e,Promise.all(e))}),ue(ie,"allSettled",function(e){return Re(e,Promise.allSettled(e))}),ue(ie,"any",function(e){return Re(e,Promise.any(e))}),ue(ie,"race",function(e){return Re(e,Promise.race(e))}),ue(ie,"resolve",function(e){return Pt(Promise.resolve(e))}),ue(ie,"reject",function(e){return Pt(Promise.reject(e))}),ue(ie,"isCancelable",mt);function Pt(e){return Oe(e,ht())}function mt(e){return e instanceof ie||e instanceof Me}function Ce(e,i){if(e)return r=>{if(!i.isCanceled){var n=e(r);return mt(n)&&i.onCancelList.push(n.cancel),n}return r}}function Oe(e,i){return new Me({internals:i,promise:e})}function Re(e,i){var r=ht();return r.onCancelList.push(()=>{for(var n of e)mt(n)&&n.cancel()}),new Me({internals:r,promise:i})}function ht(){return{isCanceled:!1,onCancelList:[]}}const Li=Cr().setApp("@nextcloud/files").detectUser().build();var le=(e=>(e.Folder="folder",e.File="file",e))(le||{}),ee=(e=>(e[e.NONE=0]="NONE",e[e.CREATE=4]="CREATE",e[e.READ=1]="READ",e[e.UPDATE=2]="UPDATE",e[e.DELETE=8]="DELETE",e[e.SHARE=16]="SHARE",e[e.ALL=31]="ALL",e))(ee||{});const nr=function(e,i){return e.match(i)!==null},ce=(e,i)=>{if(e.id&&typeof e.id!="number")throw new Error("Invalid id type of value");if(!e.source)throw new Error("Missing mandatory source");try{new URL(e.source)}catch{throw new Error("Invalid source format, source must be a valid URL")}if(!e.source.startsWith("http"))throw new Error("Invalid source format, only http(s) is supported");if(e.displayname&&typeof e.displayname!="string")throw new Error("Invalid displayname type");if(e.mtime&&!(e.mtime instanceof Date))throw new Error("Invalid mtime type");if(e.crtime&&!(e.crtime instanceof Date))throw new Error("Invalid crtime type");if(!e.mime||typeof e.mime!="string"||!e.mime.match(/^[-\w.]+\/[-+\w.]+$/gi))throw new Error("Missing or invalid mandatory mime");if("size"in e&&typeof e.size!="number"&&e.size!==void 0)throw new Error("Invalid size type");if("permissions"in e&&e.permissions!==void 0&&!(typeof e.permissions=="number"&&e.permissions>=ee.NONE&&e.permissions<=ee.ALL))throw new Error("Invalid permissions");if(e.owner&&e.owner!==null&&typeof e.owner!="string")throw new Error("Invalid owner type");if(e.attributes&&typeof e.attributes!="object")throw new Error("Invalid attributes type");if(e.root&&typeof e.root!="string")throw new Error("Invalid root type");if(e.root&&!e.root.startsWith("/"))throw new Error("Root must start with a leading slash");if(e.root&&!e.source.includes(e.root))throw new Error("Root must be part of the source");if(e.root&&nr(e.source,i)){const r=e.source.match(i)[0];if(!e.source.includes(ye(r,e.root)))throw new Error("The root must be relative to the service. e.g /files/emma")}if(e.status&&!Object.values(ft).includes(e.status))throw new Error("Status must be a valid NodeStatus")};var ft=(e=>(e.NEW="new",e.FAILED="failed",e.LOADING="loading",e.LOCKED="locked",e))(ft||{});class Ue{_data;_attributes;_knownDavService=/(remote|public)\.php\/(web)?dav/i;readonlyAttributes=Object.entries(Object.getOwnPropertyDescriptors(Ue.prototype)).filter(i=>typeof i[1].get=="function"&&i[0]!=="__proto__").map(i=>i[0]);handler={set:(i,r,n)=>this.readonlyAttributes.includes(r)?!1:Reflect.set(i,r,n),deleteProperty:(i,r)=>this.readonlyAttributes.includes(r)?!1:Reflect.deleteProperty(i,r),get:(i,r,n)=>this.readonlyAttributes.includes(r)?(Li.warn(`Accessing "Node.attributes.${r}" is deprecated, access it directly on the Node instance.`),Reflect.get(this,r)):Reflect.get(i,r,n)};constructor(i,r){i.mime||(i.mime="application/octet-stream"),ce(i,r||this._knownDavService),this._data={displayname:i.attributes?.displayname,...i,attributes:{}},this._attributes=new Proxy(this._data.attributes,this.handler),this.update(i.attributes??{}),r&&(this._knownDavService=r)}get source(){return this._data.source.replace(/\/$/i,"")}get encodedSource(){const{origin:i}=new URL(this.source);return i+Br(this.source.slice(i.length))}get basename(){return xr(this.source)}get displayname(){return this._data.displayname||this.basename}set displayname(i){ce({...this._data,displayname:i},this._knownDavService),this._data.displayname=i}get extension(){return Jt(this.source)}get dirname(){if(this.root){let r=this.source;this.isDavResource&&(r=r.split(this._knownDavService).pop());const n=r.indexOf(this.root),c=this.root.replace(/\/$/,"");return Le(r.slice(n+c.length)||"/")}const i=new URL(this.source);return Le(i.pathname)}get mime(){return this._data.mime||"application/octet-stream"}set mime(i){i??="application/octet-stream",ce({...this._data,mime:i},this._knownDavService),this._data.mime=i}get mtime(){return this._data.mtime}set mtime(i){ce({...this._data,mtime:i},this._knownDavService),this._data.mtime=i}get crtime(){return this._data.crtime}get size(){return this._data.size}set size(i){ce({...this._data,size:i},this._knownDavService),this.updateMtime(),this._data.size=i}get attributes(){return this._attributes}get permissions(){return this.owner===null&&!this.isDavResource?ee.READ:this._data.permissions!==void 0?this._data.permissions:ee.NONE}set permissions(i){ce({...this._data,permissions:i},this._knownDavService),this.updateMtime(),this._data.permissions=i}get owner(){return this.isDavResource?this._data.owner:null}get isDavResource(){return nr(this.source,this._knownDavService)}get isDavRessource(){return this.isDavResource}get root(){return this._data.root?this._data.root.replace(/^(.+)\/$/,"$1"):this.isDavResource&&Le(this.source).split(this._knownDavService).pop()||null}get path(){if(this.root){let i=this.source;this.isDavResource&&(i=i.split(this._knownDavService).pop());const r=i.indexOf(this.root),n=this.root.replace(/\/$/,"");return i.slice(r+n.length)||"/"}return(this.dirname+"/"+this.basename).replace(/\/\//g,"/")}get fileid(){return this._data?.id}get status(){return this._data?.status}set status(i){ce({...this._data,status:i},this._knownDavService),this._data.status=i}get data(){return structuredClone(this._data)}move(i){ce({...this._data,source:i},this._knownDavService);const r=this.basename;this._data.source=i,this.displayname===r&&this.basename!==r&&(this.displayname=this.basename)}rename(i){if(i.includes("/"))throw new Error("Invalid basename");this.move(Le(this.source)+"/"+i)}updateMtime(){this._data.mtime&&(this._data.mtime=new Date)}update(i){for(const[r,n]of Object.entries(i))try{n===void 0?delete this.attributes[r]:this.attributes[r]=n}catch(c){if(c instanceof TypeError)continue;throw c}}}class gt extends Ue{get type(){return le.File}clone(){return new gt(this.data)}}class vt extends Ue{constructor(i){super({...i,mime:"httpd/unix-directory"})}get type(){return le.Folder}get extension(){return null}get mime(){return"httpd/unix-directory"}clone(){return new vt(this.data)}}const Ci=function(e=""){let i=ee.NONE;return e&&((e.includes("C")||e.includes("K"))&&(i|=ee.CREATE),e.includes("G")&&(i|=ee.READ),(e.includes("W")||e.includes("N")||e.includes("V"))&&(i|=ee.UPDATE),e.includes("D")&&(i|=ee.DELETE),e.includes("R")&&(i|=ee.SHARE)),i},Ri=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],Di={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},Et=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...Ri]),window._nc_dav_properties.map(e=>`<${e} />`).join(" ")},bt=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...Di}),Object.keys(window._nc_dav_namespaces).map(e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`).join(" ")},or=function(){return`<?xml version="1.0"?>
		<d:propfind ${bt()}>
			<d:prop>
				${Et()}
			</d:prop>
		</d:propfind>`},Oi=function(){return`<?xml version="1.0"?>
		<oc:filter-files ${bt()}>
			<d:prop>
				${Et()}
			</d:prop>
			<oc:filter-rules>
				<oc:favorite>1</oc:favorite>
			</oc:filter-rules>
		</oc:filter-files>`},Si=function(e){return`<?xml version="1.0" encoding="UTF-8"?>
<d:searchrequest ${bt()}
	xmlns:ns="https://github.com/icewind1991/SearchDAV/ns">
	<d:basicsearch>
		<d:select>
			<d:prop>
				${Et()}
			</d:prop>
		</d:select>
		<d:from>
			<d:scope>
				<d:href>/files/${Pe()?.uid}/</d:href>
				<d:depth>infinity</d:depth>
			</d:scope>
		</d:from>
		<d:where>
			<d:and>
				<d:or>
					<d:not>
						<d:eq>
							<d:prop>
								<d:getcontenttype/>
							</d:prop>
							<d:literal>httpd/unix-directory</d:literal>
						</d:eq>
					</d:not>
					<d:eq>
						<d:prop>
							<oc:size/>
						</d:prop>
						<d:literal>0</d:literal>
					</d:eq>
				</d:or>
				<d:gt>
					<d:prop>
						<d:getlastmodified/>
					</d:prop>
					<d:literal>${e}</d:literal>
				</d:gt>
			</d:and>
		</d:where>
		<d:orderby>
			<d:order>
				<d:prop>
					<d:getlastmodified/>
				</d:prop>
				<d:descending/>
			</d:order>
		</d:orderby>
		<d:limit>
			<d:nresults>100</d:nresults>
			<ns:firstresult>0</ns:firstresult>
		</d:limit>
	</d:basicsearch>
</d:searchrequest>`};function ki(){return Ne()?`/files/${yi()}`:`/files/${Pe()?.uid}`}const Ae=ki();function Fi(){const e=zr("dav");return Ne()?e.replace("remote.php","public.php"):e}const sr=Fi(),$i=function(e=sr,i={}){const r=Gr(e,{headers:i});function n(c){r.setHeaders({...i,"X-Requested-With":"XMLHttpRequest",requesttoken:c??""})}return Dr(n),n(Rr()),Vr().patch("fetch",(c,m)=>{const u=m.headers;return u?.method&&(m.method=u.method,delete u.method),fetch(c,m)}),r},Pi=(e,i="/",r=Ae)=>{const n=new AbortController;return new ie(async(c,m,u)=>{u(()=>n.abort());try{const f=(await e.getDirectoryContents(`${r}${i}`,{signal:n.signal,details:!0,data:Oi(),headers:{method:"REPORT"},includeSelf:!0})).data.filter(d=>d.filename!==i).map(d=>ze(d,r));c(f)}catch(f){m(f)}})},ze=function(e,i=Ae,r=sr){let n=Pe()?.uid;if(Ne())n=n??"anonymous";else if(!n)throw new Error("No user id found");const c=e.props,m=Ci(c?.permissions),u=String(c?.["owner-id"]||n),f=c.fileid||0,d=new Date(Date.parse(e.lastmod)),p=new Date(Date.parse(c.creationdate)),l={id:f,source:`${r}${e.filename}`,mtime:!isNaN(d.getTime())&&d.getTime()!==0?d:void 0,crtime:!isNaN(p.getTime())&&p.getTime()!==0?p:void 0,mime:e.mime||"application/octet-stream",displayname:c.displayname!==void 0?String(c.displayname):void 0,size:c?.size||Number.parseInt(c.getcontentlength||"0"),status:f<0?ft.FAILED:void 0,permissions:m,owner:u,root:i,attributes:{...e,...c,hasPreview:c?.["has-preview"]}};return delete l.attributes?.props,e.type==="file"?new gt(l):new vt(l)};var Bi=Pr();const xi=Or(Bi);var Ye={},Bt,xt;function lr(){return xt||(xt=1,Bt=typeof Sr=="object"&&Ye&&Ye.NODE_DEBUG&&/\bsemver\b/i.test(Ye.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}),Bt}var Qe,Mt;function cr(){if(Mt)return Qe;Mt=1;const e="2.0.0",i=256,r=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,c=i-6;return Qe={MAX_LENGTH:i,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:c,MAX_SAFE_INTEGER:r,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:e,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Qe}var Ze={exports:{}},Ut;function Mi(){return Ut||(Ut=1,(function(e,i){const{MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:c}=cr(),m=lr();i=e.exports={};const u=i.re=[],f=i.safeRe=[],d=i.src=[],p=i.safeSrc=[],l=i.t={};let v=0;const E="[a-zA-Z0-9-]",I=[["\\s",1],["\\d",c],[E,n]],V=q=>{for(const[X,te]of I)q=q.split(`${X}*`).join(`${X}{0,${te}}`).split(`${X}+`).join(`${X}{1,${te}}`);return q},_=(q,X,te)=>{const J=V(X),L=v++;m(q,L,X),l[q]=L,d[L]=X,p[L]=J,u[L]=new RegExp(X,te?"g":void 0),f[L]=new RegExp(J,te?"g":void 0)};_("NUMERICIDENTIFIER","0|[1-9]\\d*"),_("NUMERICIDENTIFIERLOOSE","\\d+"),_("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${E}*`),_("MAINVERSION",`(${d[l.NUMERICIDENTIFIER]})\\.(${d[l.NUMERICIDENTIFIER]})\\.(${d[l.NUMERICIDENTIFIER]})`),_("MAINVERSIONLOOSE",`(${d[l.NUMERICIDENTIFIERLOOSE]})\\.(${d[l.NUMERICIDENTIFIERLOOSE]})\\.(${d[l.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASEIDENTIFIER",`(?:${d[l.NONNUMERICIDENTIFIER]}|${d[l.NUMERICIDENTIFIER]})`),_("PRERELEASEIDENTIFIERLOOSE",`(?:${d[l.NONNUMERICIDENTIFIER]}|${d[l.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASE",`(?:-(${d[l.PRERELEASEIDENTIFIER]}(?:\\.${d[l.PRERELEASEIDENTIFIER]})*))`),_("PRERELEASELOOSE",`(?:-?(${d[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${d[l.PRERELEASEIDENTIFIERLOOSE]})*))`),_("BUILDIDENTIFIER",`${E}+`),_("BUILD",`(?:\\+(${d[l.BUILDIDENTIFIER]}(?:\\.${d[l.BUILDIDENTIFIER]})*))`),_("FULLPLAIN",`v?${d[l.MAINVERSION]}${d[l.PRERELEASE]}?${d[l.BUILD]}?`),_("FULL",`^${d[l.FULLPLAIN]}$`),_("LOOSEPLAIN",`[v=\\s]*${d[l.MAINVERSIONLOOSE]}${d[l.PRERELEASELOOSE]}?${d[l.BUILD]}?`),_("LOOSE",`^${d[l.LOOSEPLAIN]}$`),_("GTLT","((?:<|>)?=?)"),_("XRANGEIDENTIFIERLOOSE",`${d[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),_("XRANGEIDENTIFIER",`${d[l.NUMERICIDENTIFIER]}|x|X|\\*`),_("XRANGEPLAIN",`[v=\\s]*(${d[l.XRANGEIDENTIFIER]})(?:\\.(${d[l.XRANGEIDENTIFIER]})(?:\\.(${d[l.XRANGEIDENTIFIER]})(?:${d[l.PRERELEASE]})?${d[l.BUILD]}?)?)?`),_("XRANGEPLAINLOOSE",`[v=\\s]*(${d[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[l.XRANGEIDENTIFIERLOOSE]})(?:${d[l.PRERELEASELOOSE]})?${d[l.BUILD]}?)?)?`),_("XRANGE",`^${d[l.GTLT]}\\s*${d[l.XRANGEPLAIN]}$`),_("XRANGELOOSE",`^${d[l.GTLT]}\\s*${d[l.XRANGEPLAINLOOSE]}$`),_("COERCEPLAIN",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?`),_("COERCE",`${d[l.COERCEPLAIN]}(?:$|[^\\d])`),_("COERCEFULL",d[l.COERCEPLAIN]+`(?:${d[l.PRERELEASE]})?(?:${d[l.BUILD]})?(?:$|[^\\d])`),_("COERCERTL",d[l.COERCE],!0),_("COERCERTLFULL",d[l.COERCEFULL],!0),_("LONETILDE","(?:~>?)"),_("TILDETRIM",`(\\s*)${d[l.LONETILDE]}\\s+`,!0),i.tildeTrimReplace="$1~",_("TILDE",`^${d[l.LONETILDE]}${d[l.XRANGEPLAIN]}$`),_("TILDELOOSE",`^${d[l.LONETILDE]}${d[l.XRANGEPLAINLOOSE]}$`),_("LONECARET","(?:\\^)"),_("CARETTRIM",`(\\s*)${d[l.LONECARET]}\\s+`,!0),i.caretTrimReplace="$1^",_("CARET",`^${d[l.LONECARET]}${d[l.XRANGEPLAIN]}$`),_("CARETLOOSE",`^${d[l.LONECARET]}${d[l.XRANGEPLAINLOOSE]}$`),_("COMPARATORLOOSE",`^${d[l.GTLT]}\\s*(${d[l.LOOSEPLAIN]})$|^$`),_("COMPARATOR",`^${d[l.GTLT]}\\s*(${d[l.FULLPLAIN]})$|^$`),_("COMPARATORTRIM",`(\\s*)${d[l.GTLT]}\\s*(${d[l.LOOSEPLAIN]}|${d[l.XRANGEPLAIN]})`,!0),i.comparatorTrimReplace="$1$2$3",_("HYPHENRANGE",`^\\s*(${d[l.XRANGEPLAIN]})\\s+-\\s+(${d[l.XRANGEPLAIN]})\\s*$`),_("HYPHENRANGELOOSE",`^\\s*(${d[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${d[l.XRANGEPLAINLOOSE]})\\s*$`),_("STAR","(<|>)?=?\\s*\\*"),_("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),_("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Ze,Ze.exports)),Ze.exports}var Ke,zt;function Ui(){if(zt)return Ke;zt=1;const e=Object.freeze({loose:!0}),i=Object.freeze({});return Ke=r=>r?typeof r!="object"?e:r:i,Ke}var Je,Gt;function zi(){if(Gt)return Je;Gt=1;const e=/^[0-9]+$/,i=(r,n)=>{if(typeof r=="number"&&typeof n=="number")return r===n?0:r<n?-1:1;const c=e.test(r),m=e.test(n);return c&&m&&(r=+r,n=+n),r===n?0:c&&!m?-1:m&&!c?1:r<n?-1:1};return Je={compareIdentifiers:i,rcompareIdentifiers:(r,n)=>i(n,r)},Je}var et,Vt;function ur(){if(Vt)return et;Vt=1;const e=lr(),{MAX_LENGTH:i,MAX_SAFE_INTEGER:r}=cr(),{safeRe:n,t:c}=Mi(),m=Ui(),{compareIdentifiers:u}=zi();class f{constructor(p,l){if(l=m(l),p instanceof f){if(p.loose===!!l.loose&&p.includePrerelease===!!l.includePrerelease)return p;p=p.version}else if(typeof p!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof p}".`);if(p.length>i)throw new TypeError(`version is longer than ${i} characters`);e("SemVer",p,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const v=p.trim().match(l.loose?n[c.LOOSE]:n[c.FULL]);if(!v)throw new TypeError(`Invalid Version: ${p}`);if(this.raw=p,this.major=+v[1],this.minor=+v[2],this.patch=+v[3],this.major>r||this.major<0)throw new TypeError("Invalid major version");if(this.minor>r||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>r||this.patch<0)throw new TypeError("Invalid patch version");v[4]?this.prerelease=v[4].split(".").map(E=>{if(/^[0-9]+$/.test(E)){const I=+E;if(I>=0&&I<r)return I}return E}):this.prerelease=[],this.build=v[5]?v[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(p){if(e("SemVer.compare",this.version,this.options,p),!(p instanceof f)){if(typeof p=="string"&&p===this.version)return 0;p=new f(p,this.options)}return p.version===this.version?0:this.compareMain(p)||this.comparePre(p)}compareMain(p){return p instanceof f||(p=new f(p,this.options)),this.major<p.major?-1:this.major>p.major?1:this.minor<p.minor?-1:this.minor>p.minor?1:this.patch<p.patch?-1:this.patch>p.patch?1:0}comparePre(p){if(p instanceof f||(p=new f(p,this.options)),this.prerelease.length&&!p.prerelease.length)return-1;if(!this.prerelease.length&&p.prerelease.length)return 1;if(!this.prerelease.length&&!p.prerelease.length)return 0;let l=0;do{const v=this.prerelease[l],E=p.prerelease[l];if(e("prerelease compare",l,v,E),v===void 0&&E===void 0)return 0;if(E===void 0)return 1;if(v===void 0)return-1;if(v!==E)return u(v,E)}while(++l)}compareBuild(p){p instanceof f||(p=new f(p,this.options));let l=0;do{const v=this.build[l],E=p.build[l];if(e("build compare",l,v,E),v===void 0&&E===void 0)return 0;if(E===void 0)return 1;if(v===void 0)return-1;if(v!==E)return u(v,E)}while(++l)}inc(p,l,v){if(p.startsWith("pre")){if(!l&&v===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const E=`-${l}`.match(this.options.loose?n[c.PRERELEASELOOSE]:n[c.PRERELEASE]);if(!E||E[1]!==l)throw new Error(`invalid identifier: ${l}`)}}switch(p){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,v);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,v);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,v),this.inc("pre",l,v);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,v),this.inc("pre",l,v);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const E=Number(v)?1:0;if(this.prerelease.length===0)this.prerelease=[E];else{let I=this.prerelease.length;for(;--I>=0;)typeof this.prerelease[I]=="number"&&(this.prerelease[I]++,I=-2);if(I===-1){if(l===this.prerelease.join(".")&&v===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(E)}}if(l){let I=[l,E];v===!1&&(I=[l]),u(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=I):this.prerelease=I}break}default:throw new Error(`invalid increment argument: ${p}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return et=f,et}var tt,Xt;function Gi(){if(Xt)return tt;Xt=1;const e=ur();return tt=(i,r)=>new e(i,r).major,tt}Gi();var rt,jt;function Vi(){if(jt)return rt;jt=1;const e=ur();return rt=(i,r,n=!1)=>{if(i instanceof e)return i;try{return new e(i,r)}catch(c){if(!n)return null;throw c}},rt}var it,Ht;function Xi(){if(Ht)return it;Ht=1;const e=Vi();return it=(i,r)=>{const n=e(i,r);return n?n.version:null},it}Xi();var qt={},Wt;function ji(){return Wt||(Wt=1,(function(e){(function(i){i.parser=function(a,t){return new n(a,t)},i.SAXParser=n,i.SAXStream=l,i.createStream=p,i.MAX_BUFFER_LENGTH=64*1024;var r=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];i.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(a,t){if(!(this instanceof n))return new n(a,t);var h=this;m(h),h.q=h.c="",h.bufferCheckPosition=i.MAX_BUFFER_LENGTH,h.opt=t||{},h.opt.lowercase=h.opt.lowercase||h.opt.lowercasetags,h.looseCase=h.opt.lowercase?"toLowerCase":"toUpperCase",h.tags=[],h.closed=h.closedRoot=h.sawRoot=!1,h.tag=h.error=null,h.strict=!!a,h.noscript=!!(a||h.opt.noscript),h.state=s.BEGIN,h.strictEntities=h.opt.strictEntities,h.ENTITIES=h.strictEntities?Object.create(i.XML_ENTITIES):Object.create(i.ENTITIES),h.attribList=[],h.opt.xmlns&&(h.ns=Object.create(_)),h.opt.unquotedAttributeValues===void 0&&(h.opt.unquotedAttributeValues=!a),h.trackPosition=h.opt.position!==!1,h.trackPosition&&(h.position=h.line=h.column=0),y(h,"onready")}Object.create||(Object.create=function(a){function t(){}t.prototype=a;var h=new t;return h}),Object.keys||(Object.keys=function(a){var t=[];for(var h in a)a.hasOwnProperty(h)&&t.push(h);return t});function c(a){for(var t=Math.max(i.MAX_BUFFER_LENGTH,10),h=0,o=0,C=r.length;o<C;o++){var U=a[r[o]].length;if(U>t)switch(r[o]){case"textNode":ne(a);break;case"cdata":N(a,"oncdata",a.cdata),a.cdata="";break;case"script":N(a,"onscript",a.script),a.script="";break;default:ge(a,"Max buffer length exceeded: "+r[o])}h=Math.max(h,U)}var z=i.MAX_BUFFER_LENGTH-h;a.bufferCheckPosition=z+a.position}function m(a){for(var t=0,h=r.length;t<h;t++)a[r[t]]=""}function u(a){ne(a),a.cdata!==""&&(N(a,"oncdata",a.cdata),a.cdata=""),a.script!==""&&(N(a,"onscript",a.script),a.script="")}n.prototype={end:function(){wt(this)},write:gr,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){u(this)}};var f;try{f=require("stream").Stream}catch{f=function(){}}f||(f=function(){});var d=i.EVENTS.filter(function(a){return a!=="error"&&a!=="end"});function p(a,t){return new l(a,t)}function l(a,t){if(!(this instanceof l))return new l(a,t);f.apply(this),this._parser=new n(a,t),this.writable=!0,this.readable=!0;var h=this;this._parser.onend=function(){h.emit("end")},this._parser.onerror=function(o){h.emit("error",o),h._parser.error=null},this._decoder=null,d.forEach(function(o){Object.defineProperty(h,"on"+o,{get:function(){return h._parser["on"+o]},set:function(C){if(!C)return h.removeAllListeners(o),h._parser["on"+o]=C,C;h.on(o,C)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(f.prototype,{constructor:{value:l}}),l.prototype.write=function(a){if(typeof We=="function"&&typeof We.isBuffer=="function"&&We.isBuffer(a)){if(!this._decoder){var t=xi.StringDecoder;this._decoder=new t("utf8")}a=this._decoder.write(a)}return this._parser.write(a.toString()),this.emit("data",a),!0},l.prototype.end=function(a){return a&&a.length&&this.write(a),this._parser.end(),!0},l.prototype.on=function(a,t){var h=this;return!h._parser["on"+a]&&d.indexOf(a)!==-1&&(h._parser["on"+a]=function(){var o=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);o.splice(0,0,a),h.emit.apply(h,o)}),f.prototype.on.call(h,a,t)};var v="[CDATA[",E="DOCTYPE",I="http://www.w3.org/XML/1998/namespace",V="http://www.w3.org/2000/xmlns/",_={xml:I,xmlns:V},q=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,X=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,te=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,J=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function L(a){return a===" "||a===`
`||a==="\r"||a==="	"}function F(a){return a==='"'||a==="'"}function M(a){return a===">"||L(a)}function R(a,t){return a.test(t)}function ae(a,t){return!R(a,t)}var s=0;i.STATE={BEGIN:s++,BEGIN_WHITESPACE:s++,TEXT:s++,TEXT_ENTITY:s++,OPEN_WAKA:s++,SGML_DECL:s++,SGML_DECL_QUOTED:s++,DOCTYPE:s++,DOCTYPE_QUOTED:s++,DOCTYPE_DTD:s++,DOCTYPE_DTD_QUOTED:s++,COMMENT_STARTING:s++,COMMENT:s++,COMMENT_ENDING:s++,COMMENT_ENDED:s++,CDATA:s++,CDATA_ENDING:s++,CDATA_ENDING_2:s++,PROC_INST:s++,PROC_INST_BODY:s++,PROC_INST_ENDING:s++,OPEN_TAG:s++,OPEN_TAG_SLASH:s++,ATTRIB:s++,ATTRIB_NAME:s++,ATTRIB_NAME_SAW_WHITE:s++,ATTRIB_VALUE:s++,ATTRIB_VALUE_QUOTED:s++,ATTRIB_VALUE_CLOSED:s++,ATTRIB_VALUE_UNQUOTED:s++,ATTRIB_VALUE_ENTITY_Q:s++,ATTRIB_VALUE_ENTITY_U:s++,CLOSE_TAG:s++,CLOSE_TAG_SAW_WHITE:s++,SCRIPT:s++,SCRIPT_ENDING:s++},i.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},i.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(i.ENTITIES).forEach(function(a){var t=i.ENTITIES[a],h=typeof t=="number"?String.fromCharCode(t):t;i.ENTITIES[a]=h});for(var S in i.STATE)i.STATE[i.STATE[S]]=S;s=i.STATE;function y(a,t,h){a[t]&&a[t](h)}function N(a,t,h){a.textNode&&ne(a),y(a,t,h)}function ne(a){a.textNode=_t(a.opt,a.textNode),a.textNode&&y(a,"ontext",a.textNode),a.textNode=""}function _t(a,t){return a.trim&&(t=t.trim()),a.normalize&&(t=t.replace(/\s+/g," ")),t}function ge(a,t){return ne(a),a.trackPosition&&(t+=`
Line: `+a.line+`
Column: `+a.column+`
Char: `+a.c),t=new Error(t),a.error=t,y(a,"onerror",t),a}function wt(a){return a.sawRoot&&!a.closedRoot&&D(a,"Unclosed root tag"),a.state!==s.BEGIN&&a.state!==s.BEGIN_WHITESPACE&&a.state!==s.TEXT&&ge(a,"Unexpected end"),ne(a),a.c="",a.closed=!0,y(a,"onend"),n.call(a,a.strict,a.opt),a}function D(a,t){if(typeof a!="object"||!(a instanceof n))throw new Error("bad call to strictFail");a.strict&&ge(a,t)}function hr(a){a.strict||(a.tagName=a.tagName[a.looseCase]());var t=a.tags[a.tags.length-1]||a,h=a.tag={name:a.tagName,attributes:{}};a.opt.xmlns&&(h.ns=t.ns),a.attribList.length=0,N(a,"onopentagstart",h)}function Ge(a,t){var h=a.indexOf(":"),o=h<0?["",a]:a.split(":"),C=o[0],U=o[1];return t&&a==="xmlns"&&(C="xmlns",U=""),{prefix:C,local:U}}function Ve(a){if(a.strict||(a.attribName=a.attribName[a.looseCase]()),a.attribList.indexOf(a.attribName)!==-1||a.tag.attributes.hasOwnProperty(a.attribName)){a.attribName=a.attribValue="";return}if(a.opt.xmlns){var t=Ge(a.attribName,!0),h=t.prefix,o=t.local;if(h==="xmlns")if(o==="xml"&&a.attribValue!==I)D(a,"xml: prefix must be bound to "+I+`
Actual: `+a.attribValue);else if(o==="xmlns"&&a.attribValue!==V)D(a,"xmlns: prefix must be bound to "+V+`
Actual: `+a.attribValue);else{var C=a.tag,U=a.tags[a.tags.length-1]||a;C.ns===U.ns&&(C.ns=Object.create(U.ns)),C.ns[o]=a.attribValue}a.attribList.push([a.attribName,a.attribValue])}else a.tag.attributes[a.attribName]=a.attribValue,N(a,"onattribute",{name:a.attribName,value:a.attribValue});a.attribName=a.attribValue=""}function de(a,t){if(a.opt.xmlns){var h=a.tag,o=Ge(a.tagName);h.prefix=o.prefix,h.local=o.local,h.uri=h.ns[o.prefix]||"",h.prefix&&!h.uri&&(D(a,"Unbound namespace prefix: "+JSON.stringify(a.tagName)),h.uri=o.prefix);var C=a.tags[a.tags.length-1]||a;h.ns&&C.ns!==h.ns&&Object.keys(h.ns).forEach(function(Nt){N(a,"onopennamespace",{prefix:Nt,uri:h.ns[Nt]})});for(var U=0,z=a.attribList.length;U<z;U++){var Q=a.attribList[U],Z=Q[0],he=Q[1],j=Ge(Z,!0),oe=j.prefix,vr=j.local,It=oe===""?"":h.ns[oe]||"",je={name:Z,value:he,prefix:oe,local:vr,uri:It};oe&&oe!=="xmlns"&&!It&&(D(a,"Unbound namespace prefix: "+JSON.stringify(oe)),je.uri=oe),a.tag.attributes[Z]=je,N(a,"onattribute",je)}a.attribList.length=0}a.tag.isSelfClosing=!!t,a.sawRoot=!0,a.tags.push(a.tag),N(a,"onopentag",a.tag),t||(!a.noscript&&a.tagName.toLowerCase()==="script"?a.state=s.SCRIPT:a.state=s.TEXT,a.tag=null,a.tagName=""),a.attribName=a.attribValue="",a.attribList.length=0}function Xe(a){if(!a.tagName){D(a,"Weird empty close tag."),a.textNode+="</>",a.state=s.TEXT;return}if(a.script){if(a.tagName!=="script"){a.script+="</"+a.tagName+">",a.tagName="",a.state=s.SCRIPT;return}N(a,"onscript",a.script),a.script=""}var t=a.tags.length,h=a.tagName;a.strict||(h=h[a.looseCase]());for(var o=h;t--;){var C=a.tags[t];if(C.name!==o)D(a,"Unexpected close tag");else break}if(t<0){D(a,"Unmatched closing tag: "+a.tagName),a.textNode+="</"+a.tagName+">",a.state=s.TEXT;return}a.tagName=h;for(var U=a.tags.length;U-- >t;){var z=a.tag=a.tags.pop();a.tagName=a.tag.name,N(a,"onclosetag",a.tagName);var Q={};for(var Z in z.ns)Q[Z]=z.ns[Z];var he=a.tags[a.tags.length-1]||a;a.opt.xmlns&&z.ns!==he.ns&&Object.keys(z.ns).forEach(function(j){var oe=z.ns[j];N(a,"onclosenamespace",{prefix:j,uri:oe})})}t===0&&(a.closedRoot=!0),a.tagName=a.attribValue=a.attribName="",a.attribList.length=0,a.state=s.TEXT}function fr(a){var t=a.entity,h=t.toLowerCase(),o,C="";return a.ENTITIES[t]?a.ENTITIES[t]:a.ENTITIES[h]?a.ENTITIES[h]:(t=h,t.charAt(0)==="#"&&(t.charAt(1)==="x"?(t=t.slice(2),o=parseInt(t,16),C=o.toString(16)):(t=t.slice(1),o=parseInt(t,10),C=o.toString(10))),t=t.replace(/^0+/,""),isNaN(o)||C.toLowerCase()!==t?(D(a,"Invalid character entity"),"&"+a.entity+";"):String.fromCodePoint(o))}function yt(a,t){t==="<"?(a.state=s.OPEN_WAKA,a.startTagPosition=a.position):L(t)||(D(a,"Non-whitespace before first tag."),a.textNode=t,a.state=s.TEXT)}function Tt(a,t){var h="";return t<a.length&&(h=a.charAt(t)),h}function gr(a){var t=this;if(this.error)throw this.error;if(t.closed)return ge(t,"Cannot write after close. Assign an onready handler.");if(a===null)return wt(t);typeof a=="object"&&(a=a.toString());for(var h=0,o="";o=Tt(a,h++),t.c=o,!!o;)switch(t.trackPosition&&(t.position++,o===`
`?(t.line++,t.column=0):t.column++),t.state){case s.BEGIN:if(t.state=s.BEGIN_WHITESPACE,o==="\uFEFF")continue;yt(t,o);continue;case s.BEGIN_WHITESPACE:yt(t,o);continue;case s.TEXT:if(t.sawRoot&&!t.closedRoot){for(var C=h-1;o&&o!=="<"&&o!=="&";)o=Tt(a,h++),o&&t.trackPosition&&(t.position++,o===`
`?(t.line++,t.column=0):t.column++);t.textNode+=a.substring(C,h-1)}o==="<"&&!(t.sawRoot&&t.closedRoot&&!t.strict)?(t.state=s.OPEN_WAKA,t.startTagPosition=t.position):(!L(o)&&(!t.sawRoot||t.closedRoot)&&D(t,"Text data outside of root node."),o==="&"?t.state=s.TEXT_ENTITY:t.textNode+=o);continue;case s.SCRIPT:o==="<"?t.state=s.SCRIPT_ENDING:t.script+=o;continue;case s.SCRIPT_ENDING:o==="/"?t.state=s.CLOSE_TAG:(t.script+="<"+o,t.state=s.SCRIPT);continue;case s.OPEN_WAKA:if(o==="!")t.state=s.SGML_DECL,t.sgmlDecl="";else if(!L(o))if(R(q,o))t.state=s.OPEN_TAG,t.tagName=o;else if(o==="/")t.state=s.CLOSE_TAG,t.tagName="";else if(o==="?")t.state=s.PROC_INST,t.procInstName=t.procInstBody="";else{if(D(t,"Unencoded <"),t.startTagPosition+1<t.position){var U=t.position-t.startTagPosition;o=new Array(U).join(" ")+o}t.textNode+="<"+o,t.state=s.TEXT}continue;case s.SGML_DECL:if(t.sgmlDecl+o==="--"){t.state=s.COMMENT,t.comment="",t.sgmlDecl="";continue}t.doctype&&t.doctype!==!0&&t.sgmlDecl?(t.state=s.DOCTYPE_DTD,t.doctype+="<!"+t.sgmlDecl+o,t.sgmlDecl=""):(t.sgmlDecl+o).toUpperCase()===v?(N(t,"onopencdata"),t.state=s.CDATA,t.sgmlDecl="",t.cdata=""):(t.sgmlDecl+o).toUpperCase()===E?(t.state=s.DOCTYPE,(t.doctype||t.sawRoot)&&D(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):o===">"?(N(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=s.TEXT):(F(o)&&(t.state=s.SGML_DECL_QUOTED),t.sgmlDecl+=o);continue;case s.SGML_DECL_QUOTED:o===t.q&&(t.state=s.SGML_DECL,t.q=""),t.sgmlDecl+=o;continue;case s.DOCTYPE:o===">"?(t.state=s.TEXT,N(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=o,o==="["?t.state=s.DOCTYPE_DTD:F(o)&&(t.state=s.DOCTYPE_QUOTED,t.q=o));continue;case s.DOCTYPE_QUOTED:t.doctype+=o,o===t.q&&(t.q="",t.state=s.DOCTYPE);continue;case s.DOCTYPE_DTD:o==="]"?(t.doctype+=o,t.state=s.DOCTYPE):o==="<"?(t.state=s.OPEN_WAKA,t.startTagPosition=t.position):F(o)?(t.doctype+=o,t.state=s.DOCTYPE_DTD_QUOTED,t.q=o):t.doctype+=o;continue;case s.DOCTYPE_DTD_QUOTED:t.doctype+=o,o===t.q&&(t.state=s.DOCTYPE_DTD,t.q="");continue;case s.COMMENT:o==="-"?t.state=s.COMMENT_ENDING:t.comment+=o;continue;case s.COMMENT_ENDING:o==="-"?(t.state=s.COMMENT_ENDED,t.comment=_t(t.opt,t.comment),t.comment&&N(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+o,t.state=s.COMMENT);continue;case s.COMMENT_ENDED:o!==">"?(D(t,"Malformed comment"),t.comment+="--"+o,t.state=s.COMMENT):t.doctype&&t.doctype!==!0?t.state=s.DOCTYPE_DTD:t.state=s.TEXT;continue;case s.CDATA:o==="]"?t.state=s.CDATA_ENDING:t.cdata+=o;continue;case s.CDATA_ENDING:o==="]"?t.state=s.CDATA_ENDING_2:(t.cdata+="]"+o,t.state=s.CDATA);continue;case s.CDATA_ENDING_2:o===">"?(t.cdata&&N(t,"oncdata",t.cdata),N(t,"onclosecdata"),t.cdata="",t.state=s.TEXT):o==="]"?t.cdata+="]":(t.cdata+="]]"+o,t.state=s.CDATA);continue;case s.PROC_INST:o==="?"?t.state=s.PROC_INST_ENDING:L(o)?t.state=s.PROC_INST_BODY:t.procInstName+=o;continue;case s.PROC_INST_BODY:if(!t.procInstBody&&L(o))continue;o==="?"?t.state=s.PROC_INST_ENDING:t.procInstBody+=o;continue;case s.PROC_INST_ENDING:o===">"?(N(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=s.TEXT):(t.procInstBody+="?"+o,t.state=s.PROC_INST_BODY);continue;case s.OPEN_TAG:R(X,o)?t.tagName+=o:(hr(t),o===">"?de(t):o==="/"?t.state=s.OPEN_TAG_SLASH:(L(o)||D(t,"Invalid character in tag name"),t.state=s.ATTRIB));continue;case s.OPEN_TAG_SLASH:o===">"?(de(t,!0),Xe(t)):(D(t,"Forward-slash in opening tag not followed by >"),t.state=s.ATTRIB);continue;case s.ATTRIB:if(L(o))continue;o===">"?de(t):o==="/"?t.state=s.OPEN_TAG_SLASH:R(q,o)?(t.attribName=o,t.attribValue="",t.state=s.ATTRIB_NAME):D(t,"Invalid attribute name");continue;case s.ATTRIB_NAME:o==="="?t.state=s.ATTRIB_VALUE:o===">"?(D(t,"Attribute without value"),t.attribValue=t.attribName,Ve(t),de(t)):L(o)?t.state=s.ATTRIB_NAME_SAW_WHITE:R(X,o)?t.attribName+=o:D(t,"Invalid attribute name");continue;case s.ATTRIB_NAME_SAW_WHITE:if(o==="=")t.state=s.ATTRIB_VALUE;else{if(L(o))continue;D(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",N(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",o===">"?de(t):R(q,o)?(t.attribName=o,t.state=s.ATTRIB_NAME):(D(t,"Invalid attribute name"),t.state=s.ATTRIB)}continue;case s.ATTRIB_VALUE:if(L(o))continue;F(o)?(t.q=o,t.state=s.ATTRIB_VALUE_QUOTED):(t.opt.unquotedAttributeValues||ge(t,"Unquoted attribute value"),t.state=s.ATTRIB_VALUE_UNQUOTED,t.attribValue=o);continue;case s.ATTRIB_VALUE_QUOTED:if(o!==t.q){o==="&"?t.state=s.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=o;continue}Ve(t),t.q="",t.state=s.ATTRIB_VALUE_CLOSED;continue;case s.ATTRIB_VALUE_CLOSED:L(o)?t.state=s.ATTRIB:o===">"?de(t):o==="/"?t.state=s.OPEN_TAG_SLASH:R(q,o)?(D(t,"No whitespace between attributes"),t.attribName=o,t.attribValue="",t.state=s.ATTRIB_NAME):D(t,"Invalid attribute name");continue;case s.ATTRIB_VALUE_UNQUOTED:if(!M(o)){o==="&"?t.state=s.ATTRIB_VALUE_ENTITY_U:t.attribValue+=o;continue}Ve(t),o===">"?de(t):t.state=s.ATTRIB;continue;case s.CLOSE_TAG:if(t.tagName)o===">"?Xe(t):R(X,o)?t.tagName+=o:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=s.SCRIPT):(L(o)||D(t,"Invalid tagname in closing tag"),t.state=s.CLOSE_TAG_SAW_WHITE);else{if(L(o))continue;ae(q,o)?t.script?(t.script+="</"+o,t.state=s.SCRIPT):D(t,"Invalid tagname in closing tag."):t.tagName=o}continue;case s.CLOSE_TAG_SAW_WHITE:if(L(o))continue;o===">"?Xe(t):D(t,"Invalid characters in closing tag");continue;case s.TEXT_ENTITY:case s.ATTRIB_VALUE_ENTITY_Q:case s.ATTRIB_VALUE_ENTITY_U:var z,Q;switch(t.state){case s.TEXT_ENTITY:z=s.TEXT,Q="textNode";break;case s.ATTRIB_VALUE_ENTITY_Q:z=s.ATTRIB_VALUE_QUOTED,Q="attribValue";break;case s.ATTRIB_VALUE_ENTITY_U:z=s.ATTRIB_VALUE_UNQUOTED,Q="attribValue";break}if(o===";"){var Z=fr(t);t.opt.unparsedEntities&&!Object.values(i.XML_ENTITIES).includes(Z)?(t.entity="",t.state=z,t.write(Z)):(t[Q]+=Z,t.entity="",t.state=z)}else R(t.entity.length?J:te,o)?t.entity+=o:(D(t,"Invalid character in entity name"),t[Q]+="&"+t.entity+o,t.entity="",t.state=z);continue;default:throw new Error(t,"Unknown state: "+t.state)}return t.position>=t.bufferCheckPosition&&c(t),t}String.fromCodePoint||(function(){var a=String.fromCharCode,t=Math.floor,h=function(){var o=16384,C=[],U,z,Q=-1,Z=arguments.length;if(!Z)return"";for(var he="";++Q<Z;){var j=Number(arguments[Q]);if(!isFinite(j)||j<0||j>1114111||t(j)!==j)throw RangeError("Invalid code point: "+j);j<=65535?C.push(j):(j-=65536,U=(j>>10)+55296,z=j%1024+56320,C.push(U,z)),(Q+1===Z||C.length>o)&&(he+=a.apply(null,C),C.length=0)}return he};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:h,configurable:!0,writable:!0}):String.fromCodePoint=h})()})(e)})(qt)),qt}ji();var Se=(e=>(e.ReservedName="reserved name",e.Character="character",e.Extension="extension",e))(Se||{});class Ee extends Error{constructor(i){super(`Invalid ${i.reason} '${i.segment}' in filename '${i.filename}'`,{cause:i})}get filename(){return this.cause.filename}get reason(){return this.cause.reason}get segment(){return this.cause.segment}}function Hi(e){const i=Mr().files,r=i.forbidden_filename_characters??window._oc_config?.forbidden_filenames_characters??["/","\\"];for(const u of r)if(e.includes(u))throw new Ee({segment:u,reason:"character",filename:e});if(e=e.toLocaleLowerCase(),(i.forbidden_filenames??[".htaccess"]).includes(e))throw new Ee({filename:e,segment:e,reason:"reserved name"});const n=e.indexOf(".",1),c=e.substring(0,n===-1?void 0:n);if((i.forbidden_filename_basenames??[]).includes(c))throw new Ee({filename:e,segment:c,reason:"reserved name"});const m=i.forbidden_filename_extensions??[".part",".filepart"];for(const u of m)if(e.length>u.length&&e.endsWith(u))throw new Ee({segment:u,reason:"extension",filename:e})}const at=["B","KB","MB","GB","TB","PB"],nt=["B","KiB","MiB","GiB","TiB","PiB"];function qi(e,i=!1,r=!1,n=!1){r=r&&!n,typeof e=="string"&&(e=Number(e));let c=e>0?Math.floor(Math.log(e)/Math.log(n?1e3:1024)):0;c=Math.min((r?nt.length:at.length)-1,c);const m=r?nt[c]:at[c];let u=(e/Math.pow(n?1e3:1024,c)).toFixed(1);return i===!0&&c===0?(u!=="0.0"?"< 1 ":"0 ")+(r?nt[1]:at[1]):(c<2?u=parseFloat(u).toFixed(0):u=parseFloat(u).toLocaleString(er()),u+" "+m)}function Yt(e){return e instanceof Date?e.toISOString():String(e)}function Wi(e,i,r){i=i??[m=>m],r=r??[];const n=i.map((m,u)=>(r[u]??"asc")==="asc"?1:-1),c=Intl.Collator([Xr(),er()],{numeric:!0,usage:"sort"});return[...e].sort((m,u)=>{for(const[f,d]of i.entries()){const p=c.compare(Yt(d(m)),Yt(d(u)));if(p!==0)return p*n[f]}return 0})}function Yi(e,i={}){const r={sortingMode:"basename",sortingOrder:"asc",...i};function n(u){const f=u.displayname||u.attributes?.displayname||u.basename||"";return u.type===le.Folder?f:f.lastIndexOf(".")>0?f.slice(0,f.lastIndexOf(".")):f}const c=[...r.sortFavoritesFirst?[u=>u.attributes?.favorite!==1]:[],...r.sortFoldersFirst?[u=>u.type!=="folder"]:[],...r.sortingMode!=="basename"?[u=>u[r.sortingMode]??u.attributes[r.sortingMode]]:[],u=>n(u),u=>u.basename],m=[...r.sortFavoritesFirst?["asc"]:[],...r.sortFoldersFirst?["asc"]:[],...r.sortingMode==="mtime"?[r.sortingOrder==="asc"?"desc":"asc"]:[],...r.sortingMode!=="mtime"&&r.sortingMode!=="basename"?[r.sortingOrder]:[],r.sortingOrder,r.sortingOrder];return Wi(e,c,m)}const Qi=new ei({concurrency:5});function Zi(e){const{resolve:i,promise:r}=Promise.withResolvers();return Qi.add(()=>{const n=new Image;return n.onerror=()=>i(!1),n.onload=()=>i(!0),n.src=e,r}),r}function Ki(e,i={}){i={size:32,cropPreview:!1,mimeFallback:!0,...i};try{const r=e.attributes?.previewUrl||dt("/core/preview?fileId={fileid}",{fileid:e.fileid});let n;try{n=new URL(r)}catch{n=new URL(r,window.location.origin)}return n.searchParams.set("x",`${i.size}`),n.searchParams.set("y",`${i.size}`),n.searchParams.set("mimeFallback",`${i.mimeFallback}`),n.searchParams.set("a",i.cropPreview===!0?"0":"1"),n.searchParams.set("c",`${e.attributes.etag}`),n}catch{return null}}function Ji(e,i){const r=P(null),n=P(!1);return Er(()=>{n.value=!1,r.value=Ki(_e(e),_e(i||{})),r.value&&_e(e).type===le.File&&Zi(r.value.href).then(c=>{n.value=c})}),{previewURL:r,previewLoaded:n}}const K=(e,i)=>{const r=e.__vccOpts||e;for(const[n,c]of i)r[n]=c;return r};var $e;(function(e){e[e.User=0]="User",e[e.Group=1]="Group",e[e.Link=3]="Link",e[e.Email=4]="Email",e[e.Remote=6]="Remote",e[e.Team=7]="Team",e[e.Guest=8]="Guest",e[e.RemoteGroup=9]="RemoteGroup",e[e.Room=10]="Room",e[e.Deck=12]="Deck",e[e.FederatedGroup=14]="FederatedGroup",e[e.ScienceMesh=15]="ScienceMesh"})($e||($e={}));const ea={name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ta=["aria-hidden","aria-label"],ra=["fill","width","height"],ia={d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"},aa={key:0};function na(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon file-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",ia,[r.title?(g(),b("title",aa,x(r.title),1)):G("",!0)])],8,ra))],16,ta)}const ct=K(ea,[["render",na]]),oa={name:"MenuDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},sa=["aria-hidden","aria-label"],la=["fill","width","height"],ca={d:"M7,10L12,15L17,10H7Z"},ua={key:0};function da(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon menu-down-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",ca,[r.title?(g(),b("title",ua,x(r.title),1)):G("",!0)])],8,la))],16,sa)}const ot=K(oa,[["render",da]]),pa={name:"MenuUpIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ma=["aria-hidden","aria-label"],ha=["fill","width","height"],fa={d:"M7,15L12,10L17,15H7Z"},ga={key:0};function va(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon menu-up-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",fa,[r.title?(g(),b("title",ga,x(r.title),1)):G("",!0)])],8,ha))],16,ma)}const st=K(pa,[["render",va]]),Ea={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ba=["aria-hidden","aria-label"],_a=["fill","width","height"],wa={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},ya={key:0};function Ta(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",wa,[r.title?(g(),b("title",ya,x(r.title),1)):G("",!0)])],8,_a))],16,ba)}const dr=K(Ea,[["render",Ta]]),pr={"file-picker__file-icon":"_file-picker__file-icon_3v9zx_9","file-picker__file-icon--primary":"_file-picker__file-icon--primary_3v9zx_21","file-picker__file-icon-overlay":"_file-picker__file-icon-overlay_3v9zx_25"},Ia=me({__name:"FilePreview",props:{node:{},cropImagePreviews:{type:Boolean}},setup(e){const i=e,r=P(pr),{previewURL:n,previewLoaded:c}=Ji(Kt(i,"node"),O(()=>({cropPreview:i.cropImagePreviews}))),m=O(()=>i.node.type===le.File),u=O(()=>{if(i.node.type!==le.Folder)return null;if(i.node.attributes?.["is-encrypted"]===1)return Yr;if(i.node.attributes?.["is-tag"])return Qr;const f=Object.values(i.node.attributes?.["share-types"]||{}).flat();if(f.some(d=>d===$e.Link||d===$e.Email))return Zr;if(f.length>0)return Ot;switch(i.node.attributes?.["mount-type"]){case"external":case"external-session":return Jr;case"group":return Kr;case"shared":return Ot}return null});return(f,d)=>(g(),b("div",{style:Ir(w(c)?{backgroundImage:`url(${w(n)})`}:void 0),class:fe(r.value["file-picker__file-icon"])},[w(c)?G("",!0):(g(),b(se,{key:0},[m.value?(g(),B(ct,{key:0,size:32})):(g(),b(se,{key:1},[u.value?(g(),B(w(tr),{key:0,class:fe(r.value["file-picker__file-icon-overlay"]),inline:"",path:u.value,size:16},null,8,["class","path"])):G("",!0),$(dr,{class:fe(r.value["file-picker__file-icon--primary"]),size:32},null,8,["class"])],64))],64))],6))}}),Na=["tabindex","aria-selected","data-filename"],Aa={class:"row-name"},La={class:"file-picker__name-container","data-testid":"row-name"},Ca=["title","textContent"],Ra=["textContent"],Da={class:"row-size"},Oa={class:"row-modified"},Sa=me({__name:"FileListRow",props:{allowPickDirectory:{type:Boolean},selected:{type:Boolean},showCheckbox:{type:Boolean},canPick:{type:Boolean},node:{},cropImagePreviews:{type:Boolean}},emits:["update:selected","enterDirectory"],setup(e,{emit:i}){const r=e,n=i,c=O(()=>r.node.mtime??0),m=O(()=>Jt(r.node.displayname)),u=O(()=>r.node.displayname.slice(0,m.value?-m.value.length:void 0)),f=O(()=>r.node.type===le.Folder),d=O(()=>r.canPick&&(r.allowPickDirectory||!f.value)),p=O(()=>(r.node.permissions&ee.READ)===ee.READ);function l(){d.value&&n("update:selected",!r.selected)}function v(){f.value?p.value&&n("enterDirectory",r.node):l()}function E(I){I.key==="Enter"&&v()}return(I,V)=>(g(),b("tr",re({tabindex:e.showCheckbox&&!f.value?void 0:0,"aria-selected":d.value?e.selected:void 0,class:["file-picker__row",[{"file-picker__row--selected":e.selected&&!e.showCheckbox,"file-picker__row--not-navigatable":f.value&&!p.value,"file-picker__row--not-pickable":!d.value}]],"data-filename":e.node.basename,"data-testid":"file-list-row"},Tr({click:v,...!e.showCheckbox||f.value?{keydown:E}:{}},!0)),[e.showCheckbox?(g(),b("td",{key:0,class:"row-checkbox",onClick:De(()=>{},["stop"])},[$(w(rr),{"aria-label":w(A)("Select the row for {nodename}",{nodename:u.value}),disabled:!d.value,"data-testid":"row-checkbox","model-value":e.selected,"onUpdate:modelValue":l},null,8,["aria-label","disabled","model-value"])])):G("",!0),T("td",Aa,[T("div",La,[$(Ia,{node:e.node,"crop-image-previews":e.cropImagePreviews},null,8,["node","crop-image-previews"]),T("div",{class:"file-picker__file-name",title:u.value,textContent:x(u.value)},null,8,Ca),T("div",{class:"file-picker__file-extension",textContent:x(m.value)},null,8,Ra)])]),T("td",Da,x(w(qi)(e.node.size||0)),1),T("td",Oa,[$(w(jr),{timestamp:c.value,"ignore-seconds":""},null,8,["timestamp"])])],16,Na))}}),ka=K(Sa,[["__scopeId","data-v-2af740c4"]]),Fa={"aria-hidden":"true",class:"file-picker__row loading-row"},$a={key:0,class:"row-checkbox"},Pa={class:"row-name"},Ba={class:"row-wrapper"},xa=me({__name:"LoadingTableRow",props:{showCheckbox:{type:Boolean}},setup(e){return(i,r)=>(g(),b("tr",Fa,[e.showCheckbox?(g(),b("td",$a,[...r[0]||(r[0]=[T("span",null,null,-1)])])):G("",!0),T("td",Pa,[T("div",Ba,[T("span",{class:fe(w(pr)["file-picker__file-icon"])},null,2),r[1]||(r[1]=T("span",null,null,-1))])]),r[2]||(r[2]=T("td",{class:"row-size"},[T("span")],-1)),r[3]||(r[3]=T("td",{class:"row-modified"},[T("span")],-1))]))}}),Ma=K(xa,[["__scopeId","data-v-1f96131b"]]);function mr(){const e=Be("files","config",null),i=P(e?.show_hidden??!0),r=P(e?.sort_favorites_first??!0),n=P(e?.crop_image_previews??!0);return Ie(async()=>{if(Ne())Te.debug("Skip loading files settings - currently on public share");else try{const{data:c}=await ir.get(dt("/apps/files/api/v1/configs"));i.value=c?.data?.show_hidden??!1,r.value=c?.data?.sort_favorites_first??!0,n.value=c?.data?.crop_image_previews??!0}catch(c){Te.error("Could not load files settings",{error:c}),pt(A("Could not load files settings"))}}),{showHiddenFiles:i,sortFavoritesFirst:r,cropImagePreviews:n}}function Ua(e){const i=p=>p==="asc"?"ascending":p==="desc"?"descending":"none",r=Be("files","viewConfigs",null),n=P({sortBy:r?.files?.sorting_mode??"basename",order:i(r?.files?.sorting_direction??"asc")}),c=P({sortBy:r?.recent?.sorting_mode??"basename",order:i(r?.recent?.sorting_direction??"asc")}),m=P({sortBy:r?.favorites?.sorting_mode??"basename",order:i(r?.favorites?.sorting_direction??"asc")});Ie(async()=>{if(Ne())Te.debug("Skip loading files views - currently on public share");else try{const{data:p}=await ir.get(dt("/apps/files/api/v1/views"));n.value={sortBy:p?.data?.files?.sorting_mode??"basename",order:i(p?.data?.files?.sorting_direction)},m.value={sortBy:p?.data?.favorites?.sorting_mode??"basename",order:i(p?.data?.favorites?.sorting_direction)},c.value={sortBy:p?.data?.recent?.sorting_mode??"basename",order:i(p?.data?.recent?.sorting_direction)}}catch(p){Te.error("Could not load files views",{error:p}),pt(A("Could not load files views"))}});const u=O(()=>_e(e||"files")==="files"?n.value:_e(e)==="recent"?c.value:m.value),f=O(()=>u.value.sortBy),d=O(()=>u.value.order);return{filesViewConfig:n,favoritesViewConfig:m,recentViewConfig:c,currentConfig:u,sortBy:f,order:d}}const za={key:0,class:"row-checkbox"},Ga={class:"hidden-visually"},Va=["aria-sort"],Xa={class:"header-wrapper"},ja={key:2,style:{width:"44px"}},Ha=["aria-sort"],qa={key:2,style:{width:"44px"}},Wa=["aria-sort"],Ya={key:2,style:{width:"44px"}},Qa=me({__name:"FileList",props:_r({currentView:{},multiselect:{type:Boolean},allowPickDirectory:{type:Boolean},loading:{type:Boolean},files:{},canPick:{type:Function}},{path:{required:!0},pathModifiers:{},selectedFiles:{required:!0},selectedFilesModifiers:{}}),emits:["update:path","update:selectedFiles"],setup(e){const i=Lt(e,"path"),r=Lt(e,"selectedFiles"),n=e,c=P(),{currentConfig:m}=Ua(n.currentView),u=O(()=>c.value??m.value),f=O(()=>u.value.sortBy==="basename"?u.value.order==="none"?void 0:u.value.order:void 0),d=O(()=>u.value.sortBy==="size"?u.value.order==="none"?void 0:u.value.order:void 0),p=O(()=>u.value.sortBy==="mtime"?u.value.order==="none"?void 0:u.value.order:void 0);function l(F){u.value.sortBy===F?u.value.order==="ascending"?c.value={sortBy:u.value.sortBy,order:"descending"}:c.value={sortBy:u.value.sortBy,order:"ascending"}:c.value={sortBy:F,order:"ascending"}}const{sortFavoritesFirst:v,cropImagePreviews:E}=mr(),I=O(()=>Yi(n.files,{sortFoldersFirst:!0,sortFavoritesFirst:v.value,sortingOrder:u.value.order==="descending"?"desc":"asc",sortingMode:u.value.sortBy})),V=O(()=>n.files.filter(F=>n.allowPickDirectory||F.type!==le.Folder)),_=O(()=>!n.loading&&r.value.length>0&&r.value.length>=V.value.length);function q(){r.value.length<V.value.length?r.value=[...V.value]:r.value=[]}function X(F){r.value.includes(F)?r.value=r.value.filter(M=>M.path!==F.path):n.multiselect?r.value=[...r.value,F]:r.value=[F]}function te(F){i.value=F.path}const J=P(4),L=P();{const F=()=>wr(()=>{const M=L.value?.parentElement?.children||[];let R=L.value?.parentElement?.clientHeight||450;for(let ae=0;ae<M.length;ae++)L.value?.isSameNode(M[ae])||(R-=M[ae].clientHeight);J.value=Math.max(1,Math.floor((R-50)/50))});Ie(()=>{window.addEventListener("resize",F),F()}),yr(()=>{window.removeEventListener("resize",F)})}return(F,M)=>(g(),b("div",{ref_key:"fileContainer",ref:L,class:"file-picker__files"},[T("table",null,[T("thead",null,[T("tr",null,[e.multiselect?(g(),b("th",za,[T("span",Ga,x(w(A)("Select entry")),1),e.multiselect?(g(),B(w(rr),{key:0,"aria-label":w(A)("Select all entries"),"data-testid":"select-all-checkbox","model-value":_.value,"onUpdate:modelValue":q},null,8,["aria-label","model-value"])):G("",!0)])):G("",!0),T("th",{"aria-sort":f.value,class:"row-name"},[T("div",Xa,[M[3]||(M[3]=T("span",{class:"file-picker__header-preview"},null,-1)),$(w(we),{"data-test":"file-picker_sort-name",variant:"tertiary",wide:"",onClick:M[0]||(M[0]=R=>l("basename"))},{icon:k(()=>[f.value==="ascending"?(g(),B(st,{key:0,size:20})):f.value==="descending"?(g(),B(ot,{key:1,size:20})):(g(),b("span",ja))]),default:k(()=>[be(" "+x(w(A)("Name")),1)]),_:1})])],8,Va),T("th",{"aria-sort":d.value,class:"row-size"},[$(w(we),{variant:"tertiary",wide:"",onClick:M[1]||(M[1]=R=>l("size"))},{icon:k(()=>[d.value==="ascending"?(g(),B(st,{key:0,size:20})):d.value==="descending"?(g(),B(ot,{key:1,size:20})):(g(),b("span",qa))]),default:k(()=>[be(" "+x(w(A)("Size")),1)]),_:1})],8,Ha),T("th",{"aria-sort":p.value,class:"row-modified"},[$(w(we),{variant:"tertiary",wide:"",onClick:M[2]||(M[2]=R=>l("mtime"))},{icon:k(()=>[p.value==="ascending"?(g(),B(st,{key:0,size:20})):p.value==="descending"?(g(),B(ot,{key:1,size:20})):(g(),b("span",Ya))]),default:k(()=>[be(" "+x(w(A)("Modified")),1)]),_:1})],8,Wa)])]),T("tbody",null,[e.loading?(g(!0),b(se,{key:0},ke(J.value,R=>(g(),B(Ma,{key:R,"show-checkbox":e.multiselect},null,8,["show-checkbox"]))),128)):(g(!0),b(se,{key:1},ke(I.value,R=>(g(),B(ka,{key:R.fileid||R.path,"allow-pick-directory":e.allowPickDirectory,"show-checkbox":e.multiselect,"can-pick":(e.multiselect||r.value.length===0||r.value.includes(R))&&(e.canPick===void 0||e.canPick(R)),selected:r.value.includes(R),node:R,"crop-image-previews":w(E),"onUpdate:selected":ae=>X(R),onEnterDirectory:te},null,8,["allow-pick-directory","show-checkbox","can-pick","selected","node","crop-image-previews","onUpdate:selected"]))),128))])])],512))}}),Za=K(Qa,[["__scopeId","data-v-68ec5c33"]]),Ka={name:"HomeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Ja=["aria-hidden","aria-label"],en=["fill","width","height"],tn={d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"},rn={key:0};function an(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon home-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",tn,[r.title?(g(),b("title",rn,x(r.title),1)):G("",!0)])],8,en))],16,Ja)}const nn=K(Ka,[["render",an]]),on={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},sn=["aria-hidden","aria-label"],ln=["fill","width","height"],cn={d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},un={key:0};function dn(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon plus-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",cn,[r.title?(g(),b("title",un,x(r.title),1)):G("",!0)])],8,ln))],16,sn)}const pn=K(on,[["render",dn]]),mn=me({__name:"FilePickerBreadcrumbs",props:{path:{},showMenu:{type:Boolean}},emits:["update:path","create-node"],setup(e,{emit:i}){const r=e,n=i,c=P(!1),m=P(""),u=br("nameInput");function f(){const l=m.value.trim(),v=u.value?.$el?.querySelector("input");let E="";try{Hi(l)}catch(I){if(!(I instanceof Ee))throw I;switch(I.reason){case Se.Character:E=A('"{char}" is not allowed inside a folder name.',{char:I.segment});break;case Se.ReservedName:E=A('"{segment}" is a reserved name and not allowed for folder names.',{segment:I.segment});break;case Se.Extension:E=A('Folder names must not end with "{extension}".',{extension:I.segment});break;default:E=A("Invalid folder name.")}}return v&&v.setCustomValidity(E),E===""}function d(){const l=m.value.trim();f()&&(c.value=!1,n("create-node",l),m.value="")}const p=O(()=>r.path.split("/").filter(l=>l!=="").map((l,v,E)=>({name:l,path:"/"+E.slice(0,v+1).join("/")})));return(l,v)=>(g(),B(w(wi),{class:"file-picker__breadcrumbs"},Qt({default:k(()=>[$(w(Fe),{name:w(A)("All files"),title:w(A)("Home"),onClick:v[0]||(v[0]=E=>n("update:path","/"))},{icon:k(()=>[$(nn,{size:20})]),_:1},8,["name","title"]),(g(!0),b(se,null,ke(p.value,E=>(g(),B(w(Fe),{key:E.path,name:E.name,title:E.path,onClick:I=>n("update:path",E.path)},null,8,["name","title","onClick"]))),128))]),_:2},[e.showMenu?{name:"actions",fn:k(()=>[$(w(ut),{open:c.value,"onUpdate:open":v[2]||(v[2]=E=>c.value=E),"aria-label":w(A)("Create directory"),"force-menu":!0,"force-name":!0,"menu-name":w(A)("New"),variant:"secondary",onClose:v[3]||(v[3]=E=>m.value="")},{icon:k(()=>[$(pn,{size:20})]),default:k(()=>[$(w(ti),{ref_key:"nameInput",ref:u,modelValue:m.value,"onUpdate:modelValue":[v[1]||(v[1]=E=>m.value=E),f],label:w(A)("New folder"),placeholder:w(A)("New folder name"),onSubmit:d},{icon:k(()=>[$(dr,{size:20})]),_:1},8,["modelValue","label","placeholder"])]),_:1},8,["open","aria-label","menu-name"])]),key:"0"}:void 0]),1024))}}),hn=K(mn,[["__scopeId","data-v-4ce40fd0"]]),fn={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},gn=["aria-hidden","aria-label"],vn=["fill","width","height"],En={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},bn={key:0};function _n(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon close-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",En,[r.title?(g(),b("title",bn,x(r.title),1)):G("",!0)])],8,vn))],16,gn)}const wn=K(fn,[["render",_n]]),yn={name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Tn=["aria-hidden","aria-label"],In=["fill","width","height"],Nn={d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},An={key:0};function Ln(e,i,r,n,c,m){return g(),b("span",re(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon magnify-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[T("path",Nn,[r.title?(g(),b("title",An,x(r.title),1)):G("",!0)])],8,In))],16,Tn)}const Cn=K(yn,[["render",Ln]]);function Rn(e){const i=[{id:"files",label:A("All files"),icon:Hr},{id:"recent",label:A("Recent"),icon:qr},{id:"favorites",label:A("Favorites"),icon:Wr}],r=e.value?i.filter(({id:n})=>n==="files"):i;return{allViews:i,availableViews:r}}const Dn={key:0,class:"file-picker__side"},On=me({__name:"FilePickerNavigation",props:{currentView:{},filterString:{},isCollapsed:{type:Boolean},disabledNavigation:{type:Boolean}},emits:["update:currentView","update:filterString"],setup(e,{emit:i}){const r=e,n=i,{availableViews:c}=Rn(P(Pe()===null)),m=O(()=>c.filter(f=>f.id===r.currentView)[0]??c[0]),u=f=>n("update:filterString",f.toString());return(f,d)=>(g(),b(se,null,[$(w(ii),{class:"file-picker__filter-input",label:w(A)("Filter file list"),"show-trailing-button":!!e.filterString,"model-value":e.filterString,"onUpdate:modelValue":u,onTrailingButtonClick:d[0]||(d[0]=p=>u(""))},{"trailing-button-icon":k(()=>[$(wn,{size:16})]),default:k(()=>[$(Cn,{size:16})]),_:1},8,["label","show-trailing-button","model-value"]),w(c).length>1&&!e.disabledNavigation?(g(),b(se,{key:0},[e.isCollapsed?(g(),B(w(ri),{key:1,"aria-label":w(A)("Current view selector"),clearable:!1,searchable:!1,options:w(c),"model-value":m.value,"onUpdate:modelValue":d[1]||(d[1]=p=>n("update:currentView",p.id))},null,8,["aria-label","options","model-value"])):(g(),b("ul",Dn,[(g(!0),b(se,null,ke(w(c),p=>(g(),b("li",{key:p.id},[$(w(we),{variant:e.currentView===p.id?"primary":"tertiary",wide:!0,onClick:l=>f.$emit("update:currentView",p.id)},{icon:k(()=>[$(w(tr),{path:p.icon,size:20},null,8,["path"])]),default:k(()=>[be(" "+x(p.label),1)]),_:2},1032,["variant","onClick"])]))),128))]))],64)):G("",!0)],64))}}),Sn=K(On,[["__scopeId","data-v-b91fd905"]]);function kn(e){const i=new AbortController,r=Math.round(Date.now()/1e3)-3600*24*14;return new ie(async(n,c,m)=>{m(()=>i.abort());try{const{data:u}=await e.search("/",{signal:i.signal,details:!0,data:Si(r)}),f=u.results.map(d=>ze(d));n(f)}catch(u){c(u)}})}function Fn(e,i){const r=new AbortController;return new ie(async(n,c,m)=>{m(()=>r.abort());try{const u=(await e.getDirectoryContents(ye(Ae,i),{signal:r.signal,details:!0,includeSelf:!0,data:or()})).data.map(f=>ze(f));n({contents:u.filter(({path:f})=>f!==i),folder:u.find(({path:f})=>f===i)})}catch(u){c(u)}})}async function $n(e,i){const{data:r}=await e.stat(ye(Ae,i),{details:!0,data:or()});return ze(r)}function Pn(e,i){const r=$i(),n=lt([]),c=lt(null),m=P(!0),u=P(null);async function f(p){const l=ye(i.value,p);await r.createDirectory(ye(Ae,l));const v=await $n(r,l);return n.value=[...n.value,v],v}async function d(){u.value&&u.value.cancel(),m.value=!0,e.value==="favorites"?u.value=Pi(r,i.value):e.value==="recent"?u.value=kn(r):u.value=Fn(r,i.value);const p=await u.value;if(p)"folder"in p?(c.value=p.folder,n.value=p.contents):(c.value=null,n.value=p);else return;u.value=null,m.value=!1}return Zt([e,i],()=>d()),Ie(()=>d()),{isLoading:m,files:n,folder:c,loadFiles:d,createDirectory:f}}function Bn(e){const i=O(()=>e.value.map(r=>r.split("/")));return{isSupportedMimeType:r=>{const n=r.split("/");return i.value.some(([c,m])=>(n[0]===c||c==="*")&&(n[1]===m||m==="*"))}}}const xn={class:"file-picker__main"},Mn={key:1,class:"file-picker__view"},Un=me({__name:"FilePicker",props:{buttons:{},name:{},allowPickDirectory:{type:Boolean,default:!1},noMenu:{type:Boolean,default:!1},disabledNavigation:{type:Boolean,default:!1},filterFn:{type:Function,default:void 0},canPickFn:{type:Function,default:void 0},mimetypeFilter:{default:()=>[]},multiselect:{type:Boolean,default:!1},path:{default:void 0}},emits:["close"],setup(e,{emit:i}){const r=e,n=i,c=P(!0),m=P("files"),u=P(window?.sessionStorage.getItem("NC.FilePicker.LastPath")||"/"),f=P(""),d=O({get:()=>m.value==="files"?f.value||r.path||u.value:"/",set:S=>{f.value=S}}),p=lt([]),{files:l,folder:v,isLoading:E,loadFiles:I,createDirectory:V}=Pn(m,d);Zt([f],()=>{r.path===void 0&&f.value&&window.sessionStorage.setItem("NC.FilePicker.LastPath",f.value),p.value=[]});let _=!1;const q=O(()=>{const S=p.value.length===0&&r.allowPickDirectory&&v.value?[v.value]:p.value;return(typeof r.buttons=="function"?r.buttons(S,d.value,m.value):r.buttons).map(y=>({...y,disabled:y.disabled||E.value,callback:()=>{_=!0,X(y.callback,S)}}))});async function X(S,y){await S(y),n("close",y),_=!1}const te=O(()=>m.value==="favorites"?A("Favorites"):m.value==="recent"?A("Recent"):""),J=P(""),{isSupportedMimeType:L}=Bn(Kt(r,"mimetypeFilter"));Ie(()=>I());const{showHiddenFiles:F}=mr(),M=O(()=>{let S=l.value;return F.value||(S=S.filter(y=>!y.basename.startsWith("."))),r.mimetypeFilter.length>0&&(S=S.filter(y=>y.type==="folder"||y.mime&&L(y.mime))),J.value&&(S=S.filter(y=>y.basename.toLowerCase().includes(J.value.toLowerCase()))),r.filterFn&&(S=S.filter(y=>r.filterFn(y))),S}),R=O(()=>m.value==="files"?A("Upload some content or sync with your devices!"):m.value==="recent"?A("Files and folders you recently modified will show up here."):A("Files and folders you mark as favorite will show up here."));async function ae(S){try{const y=await V(S);f.value=y.path,kr("files:node:created",l.value.filter(N=>N.basename===S)[0])}catch(y){Te.warn("Could not create new folder",{name:S,error:y}),pt(A("Could not create the new folder"))}}function s(S){!S&&!_&&n("close")}return(S,y)=>(g(),B(w($r),{open:c.value,"onUpdate:open":[y[6]||(y[6]=N=>c.value=N),s],buttons:q.value,name:e.name,size:"large","content-classes":"file-picker__content","dialog-classes":"file-picker","navigation-classes":"file-picker__navigation"},{navigation:k(({isCollapsed:N})=>[$(Sn,{"current-view":m.value,"onUpdate:currentView":y[0]||(y[0]=ne=>m.value=ne),"filter-string":J.value,"onUpdate:filterString":y[1]||(y[1]=ne=>J.value=ne),"is-collapsed":N,"disabled-navigation":e.disabledNavigation},null,8,["current-view","filter-string","is-collapsed","disabled-navigation"])]),default:k(()=>[T("div",xn,[m.value==="files"?(g(),B(hn,{key:0,path:d.value,"onUpdate:path":y[2]||(y[2]=N=>d.value=N),"show-menu":!e.noMenu,onCreateNode:ae},null,8,["path","show-menu"])):(g(),b("div",Mn,[T("h3",null,x(te.value),1)])),w(E)||M.value.length>0?(g(),B(Za,{key:2,path:d.value,"onUpdate:path":[y[3]||(y[3]=N=>d.value=N),y[5]||(y[5]=N=>m.value="files")],"selected-files":p.value,"onUpdate:selectedFiles":y[4]||(y[4]=N=>p.value=N),"allow-pick-directory":e.allowPickDirectory,"current-view":m.value,files:M.value,multiselect:e.multiselect,loading:w(E),name:te.value,"can-pick":e.canPickFn},null,8,["path","selected-files","allow-pick-directory","current-view","files","multiselect","loading","name","can-pick"])):J.value?(g(),B(w(Ct),{key:3,name:w(A)("No matching files"),description:w(A)("No files matching your filter were found.")},{icon:k(()=>[$(ct)]),_:1},8,["name","description"])):(g(),B(w(Ct),{key:4,name:w(A)("No files in here"),description:R.value},{icon:k(()=>[$(ct)]),_:1},8,["name","description"]))])]),_:1},8,["open","buttons","name"]))}}),co=K(Un,[["__scopeId","data-v-303416d3"]]);export{co as default};
//# sourceMappingURL=FilePicker-W-IYpVkn-I2miG68_.chunk.mjs.map
