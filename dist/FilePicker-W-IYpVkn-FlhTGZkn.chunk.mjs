import{r as He,E as b,o as g,c as B,F as G,b as $,v as qt,w as k,x as Xe,H as T,G as fe,e as be,f as M,z as ae,O as Re,M as oe,aL as It,aA as pe,ak as Ea,I as ba,g as _a,i as Ie,A as wa,B as $e,C as ya,a5 as Ta,aM as Ia,aN as Qt,a4 as Ce,av as ye,D as Na,ay as Aa,aI as Ca,n as La,a2 as Da,a3 as Zt,q as P,au as Ra,ao as _e,j as me,s as O,az as st,k as Kt,ag as Jt,ai as Ne,y as w,a6 as Oa,l as ea,p as Sa,N as ke,m as ka,u as Nt,R as Fa,aO as $a,aP as Pa,aQ as Ba,aR as Ma,at as xa,aS as Ua,aT as za,aU as Ga,aV as At,aW as Va,aX as Ha,X as Xa}from"./mdi-B9XVyi7B.chunk.mjs";import{j as lt,M as ja,O as A,N as Wa,P as Te,s as ct}from"./index-JpgrUA2Z-ClfXhQGo.chunk.mjs";import{N as Ct}from"./index-DrsucJpX.chunk.mjs";import{d as Ya,r as qa,B as je}from"./string_decoder-mL5xNZ9K.chunk.mjs";import{a as Pe,e as Qa,b as Za,d as ut}from"./_plugin-vue_export-helper-CDPKodk-.chunk.mjs";import{a as Ka,u as Ja,_ as ei}from"./index-DGc3S-5s.chunk.mjs";import{b as we,N as ta}from"./NcNoteCard-CVhtNL04-BSciYEDO.chunk.mjs";import{N as aa}from"./NcCheckboxRadioSwitch-BCSKF7Tk-bH1fDMyQ.chunk.mjs";import{S as Lt}from"./ShareType-suoNfd7y.chunk.mjs";import{P as ti,a as ai}from"./NcBreadcrumbs-DYfGaSjT-BuhDgaIS.chunk.mjs";import{c as ia}from"./index-BOuI_nzB.chunk.mjs";import{N as Dt,c as Rt,a as Ot}from"./NcActionRouter-oT-YU_jf-MmX7C-nb.chunk.mjs";import{N as ii}from"./NcSelect-Czzsi3P_-DAfF4XPJ.chunk.mjs";import{_ as ri}from"./TrashCanOutline-u_08oBcy.chunk.mjs";import"./PencilOutline-BWbwYeLs.chunk.mjs";import"./NcPasswordField-djttkA5Q-BxuGevvX.chunk.mjs";import"./NcInputField-Bwsh2aHY-kbXSi5f0.chunk.mjs";const ni={name:"ChevronRightIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},si=["aria-hidden","aria-label"],oi=["fill","width","height"],li={d:"M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"},ci={key:0};function ui(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon chevron-right-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",li,[a.title?(g(),b("title",ci,M(a.title),1)):G("",!0)])],8,oi))],16,si)}const di=Pe(ni,[["render",ui]]),pi={name:"NcBreadcrumb",components:{NcActions:lt,ChevronRight:di,NcButton:we},inheritAttrs:!1,props:{name:{type:String,required:!0},title:{type:String,default:null},to:{type:[String,Object],default:void 0},href:{type:String,default:void 0},icon:{type:String,default:""},forceIconText:{type:Boolean,default:!1},disableDrop:{type:Boolean,default:!1},forceMenu:{type:Boolean,default:!1},open:{type:Boolean,default:!1},class:{type:[String,Array,Object],default:""}},emits:["dragenter","dragleave","dropped","update:open"],setup(){const e=Qa();return{actionsContainer:`.vue-crumb[data-crumb-id="${e}"]`,crumbId:e}},data(){return{hovering:!1}},computed:{linkAttributes(){return this.to?{to:this.to,...this.$attrs}:this.href?{href:this.href,...this.$attrs}:this.$attrs}},methods:{onOpenChange(e){this.$emit("update:open",e)},dropped(e){return this.disableDrop||(this.$emit("dropped",e,this.to||this.href),this.$parent.$emit("dropped",e,this.to||this.href),this.hovering=!1),!1},dragEnter(e){this.$emit("dragenter",e),!this.disableDrop&&(this.hovering=!0)},dragLeave(e){this.$emit("dragleave",e),!this.disableDrop&&(e.target.contains(e.relatedTarget)||this.$refs.crumb.contains(e.relatedTarget)||(this.hovering=!1))}}},mi=["data-crumb-id"];function hi(e,i,a,n,c,m){const u=He("NcButton"),f=He("NcActions"),d=He("ChevronRight");return g(),b("li",{ref:"crumb",class:fe(["vue-crumb",[{"vue-crumb--hovered":c.hovering},e.$props.class]]),"data-crumb-id":n.crumbId,draggable:"false",onDragstart:Re(()=>{},["prevent"]),onDrop:i[0]||(i[0]=Re((...p)=>m.dropped&&m.dropped(...p),["prevent"])),onDragover:Re(()=>{},["prevent"]),onDragenter:i[1]||(i[1]=(...p)=>m.dragEnter&&m.dragEnter(...p)),onDragleave:i[2]||(i[2]=(...p)=>m.dragLeave&&m.dragLeave(...p))},[(a.name||a.icon||e.$slots.icon)&&!e.$slots.default?(g(),B(u,ae({key:0,"aria-label":a.icon?a.name:void 0,variant:"tertiary"},m.linkAttributes),qt({_:2},[e.$slots.icon||a.icon?{name:"icon",fn:k(()=>[Xe(e.$slots,"icon",{},()=>[T("span",{class:fe([a.icon,"icon"])},null,2)],!0)]),key:"0"}:void 0,!(e.$slots.icon||a.icon)||a.forceIconText?{name:"default",fn:k(()=>[be(M(a.name),1)]),key:"1"}:void 0]),1040,["aria-label"])):G("",!0),e.$slots.default?(g(),B(f,{key:1,ref:"actions",container:n.actionsContainer,"force-menu":a.forceMenu,"force-name":"","menu-name":a.name,open:a.open,title:a.title,variant:"tertiary","onUpdate:open":m.onOpenChange},{icon:k(()=>[Xe(e.$slots,"menu-icon",{},void 0,!0)]),default:k(()=>[Xe(e.$slots,"default",{},void 0,!0)]),_:3},8,["container","force-menu","menu-name","open","title","onUpdate:open"])):G("",!0),$(d,{class:"vue-crumb__separator",size:20})],42,mi)}const Fe=Pe(pi,[["render",hi],["__scopeId","data-v-28ef52a4"]]),fi={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},gi=["aria-hidden","aria-label"],vi=["fill","width","height"],Ei={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},bi={key:0};function _i(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",Ei,[a.title?(g(),b("title",bi,M(a.title),1)):G("",!0)])],8,vi))],16,gi)}const St=Pe(fi,[["render",_i]]),Y="vue-crumb",wi={name:"NcBreadcrumbs",components:{NcActions:lt,NcActionButton:Ot,NcActionRouter:Rt,NcActionLink:Dt,NcBreadcrumb:Fe,IconFolder:St},props:{rootIcon:{type:String,default:"icon-home"},ariaLabel:{type:String,default:null}},emits:["dropped"],data(){return{hiddenIndices:[],menuBreadcrumbProps:{name:"",forceMenu:!0,disableDrop:!0,open:!1},breadcrumbsRefs:[]}},created(){window.addEventListener("resize",Ya(()=>{this.handleWindowResize()},100)),ba("navigation-toggled",this.delayedResize)},mounted(){this.handleWindowResize()},updated(){this.delayedResize(),this.$nextTick(()=>{this.hideCrumbs()})},beforeUnmount(){window.removeEventListener("resize",this.handleWindowResize),Ea("navigation-toggled",this.delayedResize)},methods:{closeActions(e){this.$refs.actionsBreadcrumb.$el.contains(e.relatedTarget)||(this.menuBreadcrumbProps.open=!1)},async delayedResize(){await this.$nextTick(),this.handleWindowResize()},handleWindowResize(){if(!this.$refs.container)return;const e=this.breadcrumbsRefs.length,i=[],a=this.$refs.container.offsetWidth;let n=this.getTotalWidth();this.$refs.breadcrumb__actions&&(n+=this.$refs.breadcrumb__actions.offsetWidth);let c=n-a;c+=c>0?64:0;let m=0;const u=Math.floor(e/2);for(;c>0&&m<e-2;){const f=u+(m%2?m+1:m)/2*Math.pow(-1,m+e%2);c-=this.getWidth(this.breadcrumbsRefs[f]?.$el,f===this.breadcrumbsRefs.length-1),i.push(f),m++}this.arraysEqual(this.hiddenIndices,i.sort((f,d)=>f-d))||(this.hiddenIndices=i)},arraysEqual(e,i){if(e.length!==i.length)return!1;if(e===i)return!0;if(e===null||i===null)return!1;for(let a=0;a<e.length;++a)if(e[a]!==i[a])return!1;return!0},getTotalWidth(){return this.breadcrumbsRefs.reduce((e,i,a)=>e+this.getWidth(i.$el,a===this.breadcrumbsRefs.length-1),0)},getWidth(e,i){if(!e?.classList)return 0;const a=e.classList.contains(`${Y}--hidden`);e.style.minWidth="auto",i&&(e.style.maxWidth="210px"),e.classList.remove(`${Y}--hidden`);const n=e.offsetWidth;return a&&e.classList.add(`${Y}--hidden`),e.style.minWidth="",e.style.maxWidth="",n},preventDefault(e){return e.preventDefault&&e.preventDefault(),!1},dragStart(e){return this.preventDefault(e)},dropped(e,i,a){a||this.$emit("dropped",e,i),this.menuBreadcrumbProps.open=!1;const n=document.querySelectorAll(`.${Y}`);for(const c of n)c.classList.remove(`${Y}--hovered`);return this.preventDefault(e)},dragOver(e){return this.preventDefault(e)},dragEnter(e,i){if(!i&&e.target.closest){const a=e.target.closest(`.${Y}`);if(a.classList&&a.classList.contains(Y)){const n=document.querySelectorAll(`.${Y}`);for(const c of n)c.classList.remove(`${Y}--hovered`);a.classList.add(`${Y}--hovered`)}}},dragLeave(e,i){if(!i&&!e.target.contains(e.relatedTarget)&&e.target.closest){const a=e.target.closest(`.${Y}`);if(a.contains(e.relatedTarget))return;a.classList&&a.classList.contains(Y)&&a.classList.remove(`${Y}--hovered`)}},hideCrumbs(){this.breadcrumbsRefs.forEach((e,i)=>{e?.$el?.classList&&(this.hiddenIndices.includes(i)?e.$el.classList.add(`${Y}--hidden`):e.$el.classList.remove(`${Y}--hidden`))})},isBreadcrumb(e){return e?.type?.name==="NcBreadcrumb"}},render(){let e=[];if(this.$slots.default?.().forEach(c=>{if(this.isBreadcrumb(c)){e.push(c);return}c?.type===oe&&c?.children?.forEach?.(m=>{this.isBreadcrumb(m)&&e.push(m)})}),e.length===0)return;e[0]=It(e[0],{icon:this.rootIcon,ref:"breadcrumbs"});const i=[];e=e.map((c,m)=>It(c,{ref:u=>{i[m]=u}}));const a=[...e];this.hiddenIndices.length&&a.splice(Math.round(e.length/2),0,pe(Fe,{class:"dropdown",...this.menuBreadcrumbProps,"aria-hidden":!0,ref:"actionsBreadcrumb",key:"actions-breadcrumb-1",onDragenter:()=>{this.menuBreadcrumbProps.open=!0},onDragleave:this.closeActions,"onUpdate:open":c=>{this.menuBreadcrumbProps.open=c}},{default:()=>this.hiddenIndices.filter(c=>c<=e.length-1).map(c=>{const m=e[c],{to:u,href:f,disableDrop:d,name:p,...l}=m.props;delete l.ref;let v=Ot,E="";f&&(v=Dt,E=f),u&&(v=Rt,E=u);const I=pe(St,{size:20});return pe(v,{...l,class:Y,href:f||null,to:u||null,draggable:!1,onDragstart:this.dragStart,onDrop:V=>this.dropped(V,E,d),onDragover:this.dragOver,onDragenter:V=>this.dragEnter(V,d),onDragleave:V=>this.dragLeave(V,d)},{default:()=>p,icon:()=>I})})}));const n=[pe("nav",{"aria-label":this.ariaLabel},[pe("ul",{class:"breadcrumb__crumbs"},[a])])];return ja(this.$slots.actions?.())&&n.push(pe("div",{class:"breadcrumb__actions",ref:"breadcrumb__actions"},this.$slots.actions?.())),this.breadcrumbsRefs=i,pe("div",{class:["breadcrumb",{"breadcrumb--collapsed":this.hiddenIndices.length===e.length-2}],ref:"container"},n)}},yi=Pe(wi,[["__scopeId","data-v-af2b1226"]]);function ue(e,i,a){return i in e?Object.defineProperty(e,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[i]=a,e}function kt(e,i,a){Ti(e,i),i.set(e,a)}function Ti(e,i){if(i.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function j(e,i){var a=ra(e,i,"get");return Ii(e,a)}function Ii(e,i){return i.get?i.get.call(e):i.value}function Ft(e,i,a){var n=ra(e,i,"set");return Ni(e,n,a),a}function ra(e,i,a){if(!i.has(e))throw new TypeError("attempted to "+a+" private field on non-instance");return i.get(e)}function Ni(e,i,a){if(i.set)i.set.call(e,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}}var Ai=typeof Symbol<"u"?Symbol.toStringTag:"@@toStringTag",q=new WeakMap,ve=new WeakMap;class Be{constructor(i){var{executor:a=()=>{},internals:n=pt(),promise:c=new Promise((m,u)=>a(m,u,f=>{n.onCancelList.push(f)}))}=i;kt(this,q,{writable:!0,value:void 0}),kt(this,ve,{writable:!0,value:void 0}),ue(this,Ai,"CancelablePromise"),this.cancel=this.cancel.bind(this),Ft(this,q,n),Ft(this,ve,c||new Promise((m,u)=>a(m,u,f=>{n.onCancelList.push(f)})))}then(i,a){return Oe(j(this,ve).then(Le(i,j(this,q)),Le(a,j(this,q))),j(this,q))}catch(i){return Oe(j(this,ve).catch(Le(i,j(this,q))),j(this,q))}finally(i,a){return a&&j(this,q).onCancelList.push(i),Oe(j(this,ve).finally(Le(()=>{if(i)return a&&(j(this,q).onCancelList=j(this,q).onCancelList.filter(n=>n!==i)),i()},j(this,q))),j(this,q))}cancel(){j(this,q).isCanceled=!0;var i=j(this,q).onCancelList;j(this,q).onCancelList=[];for(var a of i)if(typeof a=="function")try{a()}catch(n){console.error(n)}}isCanceled(){return j(this,q).isCanceled===!0}}class ie extends Be{constructor(i){super({executor:i})}}ue(ie,"all",function(e){return De(e,Promise.all(e))}),ue(ie,"allSettled",function(e){return De(e,Promise.allSettled(e))}),ue(ie,"any",function(e){return De(e,Promise.any(e))}),ue(ie,"race",function(e){return De(e,Promise.race(e))}),ue(ie,"resolve",function(e){return $t(Promise.resolve(e))}),ue(ie,"reject",function(e){return $t(Promise.reject(e))}),ue(ie,"isCancelable",dt);function $t(e){return Oe(e,pt())}function dt(e){return e instanceof ie||e instanceof Be}function Le(e,i){if(e)return a=>{if(!i.isCanceled){var n=e(a);return dt(n)&&i.onCancelList.push(n.cancel),n}return a}}function Oe(e,i){return new Be({internals:i,promise:e})}function De(e,i){var a=pt();return a.onCancelList.push(()=>{for(var n of e)dt(n)&&n.cancel()}),new Be({internals:a,promise:i})}function pt(){return{isCanceled:!1,onCancelList:[]}}const Ci=_a().setApp("@nextcloud/files").detectUser().build();var le=(e=>(e.Folder="folder",e.File="file",e))(le||{}),ee=(e=>(e[e.NONE=0]="NONE",e[e.CREATE=4]="CREATE",e[e.READ=1]="READ",e[e.UPDATE=2]="UPDATE",e[e.DELETE=8]="DELETE",e[e.SHARE=16]="SHARE",e[e.ALL=31]="ALL",e))(ee||{});const na=function(e,i){return e.match(i)!==null},ce=(e,i)=>{if(e.id&&typeof e.id!="number")throw new Error("Invalid id type of value");if(!e.source)throw new Error("Missing mandatory source");try{new URL(e.source)}catch{throw new Error("Invalid source format, source must be a valid URL")}if(!e.source.startsWith("http"))throw new Error("Invalid source format, only http(s) is supported");if(e.displayname&&typeof e.displayname!="string")throw new Error("Invalid displayname type");if(e.mtime&&!(e.mtime instanceof Date))throw new Error("Invalid mtime type");if(e.crtime&&!(e.crtime instanceof Date))throw new Error("Invalid crtime type");if(!e.mime||typeof e.mime!="string"||!e.mime.match(/^[-\w.]+\/[-+\w.]+$/gi))throw new Error("Missing or invalid mandatory mime");if("size"in e&&typeof e.size!="number"&&e.size!==void 0)throw new Error("Invalid size type");if("permissions"in e&&e.permissions!==void 0&&!(typeof e.permissions=="number"&&e.permissions>=ee.NONE&&e.permissions<=ee.ALL))throw new Error("Invalid permissions");if(e.owner&&e.owner!==null&&typeof e.owner!="string")throw new Error("Invalid owner type");if(e.attributes&&typeof e.attributes!="object")throw new Error("Invalid attributes type");if(e.root&&typeof e.root!="string")throw new Error("Invalid root type");if(e.root&&!e.root.startsWith("/"))throw new Error("Root must start with a leading slash");if(e.root&&!e.source.includes(e.root))throw new Error("Root must be part of the source");if(e.root&&na(e.source,i)){const a=e.source.match(i)[0];if(!e.source.includes(ye(a,e.root)))throw new Error("The root must be relative to the service. e.g /files/emma")}if(e.status&&!Object.values(mt).includes(e.status))throw new Error("Status must be a valid NodeStatus")};var mt=(e=>(e.NEW="new",e.FAILED="failed",e.LOADING="loading",e.LOCKED="locked",e))(mt||{});class Me{_data;_attributes;_knownDavService=/(remote|public)\.php\/(web)?dav/i;readonlyAttributes=Object.entries(Object.getOwnPropertyDescriptors(Me.prototype)).filter(i=>typeof i[1].get=="function"&&i[0]!=="__proto__").map(i=>i[0]);handler={set:(i,a,n)=>this.readonlyAttributes.includes(a)?!1:Reflect.set(i,a,n),deleteProperty:(i,a)=>this.readonlyAttributes.includes(a)?!1:Reflect.deleteProperty(i,a),get:(i,a,n)=>this.readonlyAttributes.includes(a)?(Ci.warn(`Accessing "Node.attributes.${a}" is deprecated, access it directly on the Node instance.`),Reflect.get(this,a)):Reflect.get(i,a,n)};constructor(i,a){i.mime||(i.mime="application/octet-stream"),ce(i,a||this._knownDavService),this._data={displayname:i.attributes?.displayname,...i,attributes:{}},this._attributes=new Proxy(this._data.attributes,this.handler),this.update(i.attributes??{}),a&&(this._knownDavService=a)}get source(){return this._data.source.replace(/\/$/i,"")}get encodedSource(){const{origin:i}=new URL(this.source);return i+Ta(this.source.slice(i.length))}get basename(){return Ia(this.source)}get displayname(){return this._data.displayname||this.basename}set displayname(i){ce({...this._data,displayname:i},this._knownDavService),this._data.displayname=i}get extension(){return Qt(this.source)}get dirname(){if(this.root){let a=this.source;this.isDavResource&&(a=a.split(this._knownDavService).pop());const n=a.indexOf(this.root),c=this.root.replace(/\/$/,"");return Ce(a.slice(n+c.length)||"/")}const i=new URL(this.source);return Ce(i.pathname)}get mime(){return this._data.mime||"application/octet-stream"}set mime(i){i??="application/octet-stream",ce({...this._data,mime:i},this._knownDavService),this._data.mime=i}get mtime(){return this._data.mtime}set mtime(i){ce({...this._data,mtime:i},this._knownDavService),this._data.mtime=i}get crtime(){return this._data.crtime}get size(){return this._data.size}set size(i){ce({...this._data,size:i},this._knownDavService),this.updateMtime(),this._data.size=i}get attributes(){return this._attributes}get permissions(){return this.owner===null&&!this.isDavResource?ee.READ:this._data.permissions!==void 0?this._data.permissions:ee.NONE}set permissions(i){ce({...this._data,permissions:i},this._knownDavService),this.updateMtime(),this._data.permissions=i}get owner(){return this.isDavResource?this._data.owner:null}get isDavResource(){return na(this.source,this._knownDavService)}get isDavRessource(){return this.isDavResource}get root(){return this._data.root?this._data.root.replace(/^(.+)\/$/,"$1"):this.isDavResource&&Ce(this.source).split(this._knownDavService).pop()||null}get path(){if(this.root){let i=this.source;this.isDavResource&&(i=i.split(this._knownDavService).pop());const a=i.indexOf(this.root),n=this.root.replace(/\/$/,"");return i.slice(a+n.length)||"/"}return(this.dirname+"/"+this.basename).replace(/\/\//g,"/")}get fileid(){return this._data?.id}get status(){return this._data?.status}set status(i){ce({...this._data,status:i},this._knownDavService),this._data.status=i}get data(){return structuredClone(this._data)}move(i){ce({...this._data,source:i},this._knownDavService);const a=this.basename;this._data.source=i,this.displayname===a&&this.basename!==a&&(this.displayname=this.basename)}rename(i){if(i.includes("/"))throw new Error("Invalid basename");this.move(Ce(this.source)+"/"+i)}updateMtime(){this._data.mtime&&(this._data.mtime=new Date)}update(i){for(const[a,n]of Object.entries(i))try{n===void 0?delete this.attributes[a]:this.attributes[a]=n}catch(c){if(c instanceof TypeError)continue;throw c}}}class ht extends Me{get type(){return le.File}clone(){return new ht(this.data)}}class ft extends Me{constructor(i){super({...i,mime:"httpd/unix-directory"})}get type(){return le.Folder}get extension(){return null}get mime(){return"httpd/unix-directory"}clone(){return new ft(this.data)}}const Li=function(e=""){let i=ee.NONE;return e&&((e.includes("C")||e.includes("K"))&&(i|=ee.CREATE),e.includes("G")&&(i|=ee.READ),(e.includes("W")||e.includes("N")||e.includes("V"))&&(i|=ee.UPDATE),e.includes("D")&&(i|=ee.DELETE),e.includes("R")&&(i|=ee.SHARE)),i},Di=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],Ri={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"},gt=function(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[...Di]),window._nc_dav_properties.map(e=>`<${e} />`).join(" ")},vt=function(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...Ri}),Object.keys(window._nc_dav_namespaces).map(e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`).join(" ")},sa=function(){return`<?xml version="1.0"?>
		<d:propfind ${vt()}>
			<d:prop>
				${gt()}
			</d:prop>
		</d:propfind>`},Oi=function(){return`<?xml version="1.0"?>
		<oc:filter-files ${vt()}>
			<d:prop>
				${gt()}
			</d:prop>
			<oc:filter-rules>
				<oc:favorite>1</oc:favorite>
			</oc:filter-rules>
		</oc:filter-files>`},Si=function(e){return`<?xml version="1.0" encoding="UTF-8"?>
<d:searchrequest ${vt()}
	xmlns:ns="https://github.com/icewind1991/SearchDAV/ns">
	<d:basicsearch>
		<d:select>
			<d:prop>
				${gt()}
			</d:prop>
		</d:select>
		<d:from>
			<d:scope>
				<d:href>/files/${$e()?.uid}/</d:href>
				<d:depth>infinity</d:depth>
			</d:scope>
		</d:from>
		<d:where>
			<d:and>
				<d:or>
					<d:not>
						<d:eq>
							<d:prop>
								<d:getcontenttype/>
							</d:prop>
							<d:literal>httpd/unix-directory</d:literal>
						</d:eq>
					</d:not>
					<d:eq>
						<d:prop>
							<oc:size/>
						</d:prop>
						<d:literal>0</d:literal>
					</d:eq>
				</d:or>
				<d:gt>
					<d:prop>
						<d:getlastmodified/>
					</d:prop>
					<d:literal>${e}</d:literal>
				</d:gt>
			</d:and>
		</d:where>
		<d:orderby>
			<d:order>
				<d:prop>
					<d:getlastmodified/>
				</d:prop>
				<d:descending/>
			</d:order>
		</d:orderby>
		<d:limit>
			<d:nresults>100</d:nresults>
			<ns:firstresult>0</ns:firstresult>
		</d:limit>
	</d:basicsearch>
</d:searchrequest>`};function ki(){return Ie()?`/files/${wa()}`:`/files/${$e()?.uid}`}const Ae=ki();function Fi(){const e=Za("dav");return Ie()?e.replace("remote.php","public.php"):e}const oa=Fi(),$i=function(e=oa,i={}){const a=Ka(e,{headers:i});function n(c){a.setHeaders({...i,"X-Requested-With":"XMLHttpRequest",requesttoken:c??""})}return Na(n),n(ya()),Ja().patch("fetch",(c,m)=>{const u=m.headers;return u?.method&&(m.method=u.method,delete u.method),fetch(c,m)}),a},Pi=(e,i="/",a=Ae)=>{const n=new AbortController;return new ie(async(c,m,u)=>{u(()=>n.abort());try{const f=(await e.getDirectoryContents(`${a}${i}`,{signal:n.signal,details:!0,data:Oi(),headers:{method:"REPORT"},includeSelf:!0})).data.filter(d=>d.filename!==i).map(d=>xe(d,a));c(f)}catch(f){m(f)}})},xe=function(e,i=Ae,a=oa){let n=$e()?.uid;if(Ie())n=n??"anonymous";else if(!n)throw new Error("No user id found");const c=e.props,m=Li(c?.permissions),u=String(c?.["owner-id"]||n),f=c.fileid||0,d=new Date(Date.parse(e.lastmod)),p=new Date(Date.parse(c.creationdate)),l={id:f,source:`${a}${e.filename}`,mtime:!isNaN(d.getTime())&&d.getTime()!==0?d:void 0,crtime:!isNaN(p.getTime())&&p.getTime()!==0?p:void 0,mime:e.mime||"application/octet-stream",displayname:c.displayname!==void 0?String(c.displayname):void 0,size:c?.size||Number.parseInt(c.getcontentlength||"0"),status:f<0?mt.FAILED:void 0,permissions:m,owner:u,root:i,attributes:{...e,...c,hasPreview:c?.["has-preview"]}};return delete l.attributes?.props,e.type==="file"?new ht(l):new ft(l)};var Bi=qa();const Mi=Aa(Bi);var We={},Pt,Bt;function la(){return Bt||(Bt=1,Pt=typeof Ca=="object"&&We&&We.NODE_DEBUG&&/\bsemver\b/i.test(We.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{}),Pt}var Ye,Mt;function ca(){if(Mt)return Ye;Mt=1;const e="2.0.0",i=256,a=Number.MAX_SAFE_INTEGER||9007199254740991,n=16,c=i-6;return Ye={MAX_LENGTH:i,MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:c,MAX_SAFE_INTEGER:a,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:e,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},Ye}var qe={exports:{}},xt;function xi(){return xt||(xt=1,(function(e,i){const{MAX_SAFE_COMPONENT_LENGTH:a,MAX_SAFE_BUILD_LENGTH:n,MAX_LENGTH:c}=ca(),m=la();i=e.exports={};const u=i.re=[],f=i.safeRe=[],d=i.src=[],p=i.safeSrc=[],l=i.t={};let v=0;const E="[a-zA-Z0-9-]",I=[["\\s",1],["\\d",c],[E,n]],V=W=>{for(const[H,te]of I)W=W.split(`${H}*`).join(`${H}{0,${te}}`).split(`${H}+`).join(`${H}{1,${te}}`);return W},_=(W,H,te)=>{const J=V(H),C=v++;m(W,C,H),l[W]=C,d[C]=H,p[C]=J,u[C]=new RegExp(H,te?"g":void 0),f[C]=new RegExp(J,te?"g":void 0)};_("NUMERICIDENTIFIER","0|[1-9]\\d*"),_("NUMERICIDENTIFIERLOOSE","\\d+"),_("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${E}*`),_("MAINVERSION",`(${d[l.NUMERICIDENTIFIER]})\\.(${d[l.NUMERICIDENTIFIER]})\\.(${d[l.NUMERICIDENTIFIER]})`),_("MAINVERSIONLOOSE",`(${d[l.NUMERICIDENTIFIERLOOSE]})\\.(${d[l.NUMERICIDENTIFIERLOOSE]})\\.(${d[l.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASEIDENTIFIER",`(?:${d[l.NONNUMERICIDENTIFIER]}|${d[l.NUMERICIDENTIFIER]})`),_("PRERELEASEIDENTIFIERLOOSE",`(?:${d[l.NONNUMERICIDENTIFIER]}|${d[l.NUMERICIDENTIFIERLOOSE]})`),_("PRERELEASE",`(?:-(${d[l.PRERELEASEIDENTIFIER]}(?:\\.${d[l.PRERELEASEIDENTIFIER]})*))`),_("PRERELEASELOOSE",`(?:-?(${d[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${d[l.PRERELEASEIDENTIFIERLOOSE]})*))`),_("BUILDIDENTIFIER",`${E}+`),_("BUILD",`(?:\\+(${d[l.BUILDIDENTIFIER]}(?:\\.${d[l.BUILDIDENTIFIER]})*))`),_("FULLPLAIN",`v?${d[l.MAINVERSION]}${d[l.PRERELEASE]}?${d[l.BUILD]}?`),_("FULL",`^${d[l.FULLPLAIN]}$`),_("LOOSEPLAIN",`[v=\\s]*${d[l.MAINVERSIONLOOSE]}${d[l.PRERELEASELOOSE]}?${d[l.BUILD]}?`),_("LOOSE",`^${d[l.LOOSEPLAIN]}$`),_("GTLT","((?:<|>)?=?)"),_("XRANGEIDENTIFIERLOOSE",`${d[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),_("XRANGEIDENTIFIER",`${d[l.NUMERICIDENTIFIER]}|x|X|\\*`),_("XRANGEPLAIN",`[v=\\s]*(${d[l.XRANGEIDENTIFIER]})(?:\\.(${d[l.XRANGEIDENTIFIER]})(?:\\.(${d[l.XRANGEIDENTIFIER]})(?:${d[l.PRERELEASE]})?${d[l.BUILD]}?)?)?`),_("XRANGEPLAINLOOSE",`[v=\\s]*(${d[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[l.XRANGEIDENTIFIERLOOSE]})(?:${d[l.PRERELEASELOOSE]})?${d[l.BUILD]}?)?)?`),_("XRANGE",`^${d[l.GTLT]}\\s*${d[l.XRANGEPLAIN]}$`),_("XRANGELOOSE",`^${d[l.GTLT]}\\s*${d[l.XRANGEPLAINLOOSE]}$`),_("COERCEPLAIN",`(^|[^\\d])(\\d{1,${a}})(?:\\.(\\d{1,${a}}))?(?:\\.(\\d{1,${a}}))?`),_("COERCE",`${d[l.COERCEPLAIN]}(?:$|[^\\d])`),_("COERCEFULL",d[l.COERCEPLAIN]+`(?:${d[l.PRERELEASE]})?(?:${d[l.BUILD]})?(?:$|[^\\d])`),_("COERCERTL",d[l.COERCE],!0),_("COERCERTLFULL",d[l.COERCEFULL],!0),_("LONETILDE","(?:~>?)"),_("TILDETRIM",`(\\s*)${d[l.LONETILDE]}\\s+`,!0),i.tildeTrimReplace="$1~",_("TILDE",`^${d[l.LONETILDE]}${d[l.XRANGEPLAIN]}$`),_("TILDELOOSE",`^${d[l.LONETILDE]}${d[l.XRANGEPLAINLOOSE]}$`),_("LONECARET","(?:\\^)"),_("CARETTRIM",`(\\s*)${d[l.LONECARET]}\\s+`,!0),i.caretTrimReplace="$1^",_("CARET",`^${d[l.LONECARET]}${d[l.XRANGEPLAIN]}$`),_("CARETLOOSE",`^${d[l.LONECARET]}${d[l.XRANGEPLAINLOOSE]}$`),_("COMPARATORLOOSE",`^${d[l.GTLT]}\\s*(${d[l.LOOSEPLAIN]})$|^$`),_("COMPARATOR",`^${d[l.GTLT]}\\s*(${d[l.FULLPLAIN]})$|^$`),_("COMPARATORTRIM",`(\\s*)${d[l.GTLT]}\\s*(${d[l.LOOSEPLAIN]}|${d[l.XRANGEPLAIN]})`,!0),i.comparatorTrimReplace="$1$2$3",_("HYPHENRANGE",`^\\s*(${d[l.XRANGEPLAIN]})\\s+-\\s+(${d[l.XRANGEPLAIN]})\\s*$`),_("HYPHENRANGELOOSE",`^\\s*(${d[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${d[l.XRANGEPLAINLOOSE]})\\s*$`),_("STAR","(<|>)?=?\\s*\\*"),_("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),_("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(qe,qe.exports)),qe.exports}var Qe,Ut;function Ui(){if(Ut)return Qe;Ut=1;const e=Object.freeze({loose:!0}),i=Object.freeze({});return Qe=a=>a?typeof a!="object"?e:a:i,Qe}var Ze,zt;function zi(){if(zt)return Ze;zt=1;const e=/^[0-9]+$/,i=(a,n)=>{if(typeof a=="number"&&typeof n=="number")return a===n?0:a<n?-1:1;const c=e.test(a),m=e.test(n);return c&&m&&(a=+a,n=+n),a===n?0:c&&!m?-1:m&&!c?1:a<n?-1:1};return Ze={compareIdentifiers:i,rcompareIdentifiers:(a,n)=>i(n,a)},Ze}var Ke,Gt;function ua(){if(Gt)return Ke;Gt=1;const e=la(),{MAX_LENGTH:i,MAX_SAFE_INTEGER:a}=ca(),{safeRe:n,t:c}=xi(),m=Ui(),{compareIdentifiers:u}=zi();class f{constructor(p,l){if(l=m(l),p instanceof f){if(p.loose===!!l.loose&&p.includePrerelease===!!l.includePrerelease)return p;p=p.version}else if(typeof p!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof p}".`);if(p.length>i)throw new TypeError(`version is longer than ${i} characters`);e("SemVer",p,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const v=p.trim().match(l.loose?n[c.LOOSE]:n[c.FULL]);if(!v)throw new TypeError(`Invalid Version: ${p}`);if(this.raw=p,this.major=+v[1],this.minor=+v[2],this.patch=+v[3],this.major>a||this.major<0)throw new TypeError("Invalid major version");if(this.minor>a||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>a||this.patch<0)throw new TypeError("Invalid patch version");v[4]?this.prerelease=v[4].split(".").map(E=>{if(/^[0-9]+$/.test(E)){const I=+E;if(I>=0&&I<a)return I}return E}):this.prerelease=[],this.build=v[5]?v[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(p){if(e("SemVer.compare",this.version,this.options,p),!(p instanceof f)){if(typeof p=="string"&&p===this.version)return 0;p=new f(p,this.options)}return p.version===this.version?0:this.compareMain(p)||this.comparePre(p)}compareMain(p){return p instanceof f||(p=new f(p,this.options)),this.major<p.major?-1:this.major>p.major?1:this.minor<p.minor?-1:this.minor>p.minor?1:this.patch<p.patch?-1:this.patch>p.patch?1:0}comparePre(p){if(p instanceof f||(p=new f(p,this.options)),this.prerelease.length&&!p.prerelease.length)return-1;if(!this.prerelease.length&&p.prerelease.length)return 1;if(!this.prerelease.length&&!p.prerelease.length)return 0;let l=0;do{const v=this.prerelease[l],E=p.prerelease[l];if(e("prerelease compare",l,v,E),v===void 0&&E===void 0)return 0;if(E===void 0)return 1;if(v===void 0)return-1;if(v!==E)return u(v,E)}while(++l)}compareBuild(p){p instanceof f||(p=new f(p,this.options));let l=0;do{const v=this.build[l],E=p.build[l];if(e("build compare",l,v,E),v===void 0&&E===void 0)return 0;if(E===void 0)return 1;if(v===void 0)return-1;if(v!==E)return u(v,E)}while(++l)}inc(p,l,v){if(p.startsWith("pre")){if(!l&&v===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const E=`-${l}`.match(this.options.loose?n[c.PRERELEASELOOSE]:n[c.PRERELEASE]);if(!E||E[1]!==l)throw new Error(`invalid identifier: ${l}`)}}switch(p){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,v);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,v);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,v),this.inc("pre",l,v);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,v),this.inc("pre",l,v);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const E=Number(v)?1:0;if(this.prerelease.length===0)this.prerelease=[E];else{let I=this.prerelease.length;for(;--I>=0;)typeof this.prerelease[I]=="number"&&(this.prerelease[I]++,I=-2);if(I===-1){if(l===this.prerelease.join(".")&&v===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(E)}}if(l){let I=[l,E];v===!1&&(I=[l]),u(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=I):this.prerelease=I}break}default:throw new Error(`invalid increment argument: ${p}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return Ke=f,Ke}var Je,Vt;function Gi(){if(Vt)return Je;Vt=1;const e=ua();return Je=(i,a)=>new e(i,a).major,Je}Gi();var et,Ht;function Vi(){if(Ht)return et;Ht=1;const e=ua();return et=(i,a,n=!1)=>{if(i instanceof e)return i;try{return new e(i,a)}catch(c){if(!n)return null;throw c}},et}var tt,Xt;function Hi(){if(Xt)return tt;Xt=1;const e=Vi();return tt=(i,a)=>{const n=e(i,a);return n?n.version:null},tt}Hi();var jt={},Wt;function Xi(){return Wt||(Wt=1,(function(e){(function(i){i.parser=function(r,t){return new n(r,t)},i.SAXParser=n,i.SAXStream=l,i.createStream=p,i.MAX_BUFFER_LENGTH=64*1024;var a=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];i.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function n(r,t){if(!(this instanceof n))return new n(r,t);var h=this;m(h),h.q=h.c="",h.bufferCheckPosition=i.MAX_BUFFER_LENGTH,h.opt=t||{},h.opt.lowercase=h.opt.lowercase||h.opt.lowercasetags,h.looseCase=h.opt.lowercase?"toLowerCase":"toUpperCase",h.tags=[],h.closed=h.closedRoot=h.sawRoot=!1,h.tag=h.error=null,h.strict=!!r,h.noscript=!!(r||h.opt.noscript),h.state=o.BEGIN,h.strictEntities=h.opt.strictEntities,h.ENTITIES=h.strictEntities?Object.create(i.XML_ENTITIES):Object.create(i.ENTITIES),h.attribList=[],h.opt.xmlns&&(h.ns=Object.create(_)),h.opt.unquotedAttributeValues===void 0&&(h.opt.unquotedAttributeValues=!r),h.trackPosition=h.opt.position!==!1,h.trackPosition&&(h.position=h.line=h.column=0),y(h,"onready")}Object.create||(Object.create=function(r){function t(){}t.prototype=r;var h=new t;return h}),Object.keys||(Object.keys=function(r){var t=[];for(var h in r)r.hasOwnProperty(h)&&t.push(h);return t});function c(r){for(var t=Math.max(i.MAX_BUFFER_LENGTH,10),h=0,s=0,L=a.length;s<L;s++){var U=r[a[s]].length;if(U>t)switch(a[s]){case"textNode":ne(r);break;case"cdata":N(r,"oncdata",r.cdata),r.cdata="";break;case"script":N(r,"onscript",r.script),r.script="";break;default:ge(r,"Max buffer length exceeded: "+a[s])}h=Math.max(h,U)}var z=i.MAX_BUFFER_LENGTH-h;r.bufferCheckPosition=z+r.position}function m(r){for(var t=0,h=a.length;t<h;t++)r[a[t]]=""}function u(r){ne(r),r.cdata!==""&&(N(r,"oncdata",r.cdata),r.cdata=""),r.script!==""&&(N(r,"onscript",r.script),r.script="")}n.prototype={end:function(){bt(this)},write:ga,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){u(this)}};var f;try{f=require("stream").Stream}catch{f=function(){}}f||(f=function(){});var d=i.EVENTS.filter(function(r){return r!=="error"&&r!=="end"});function p(r,t){return new l(r,t)}function l(r,t){if(!(this instanceof l))return new l(r,t);f.apply(this),this._parser=new n(r,t),this.writable=!0,this.readable=!0;var h=this;this._parser.onend=function(){h.emit("end")},this._parser.onerror=function(s){h.emit("error",s),h._parser.error=null},this._decoder=null,d.forEach(function(s){Object.defineProperty(h,"on"+s,{get:function(){return h._parser["on"+s]},set:function(L){if(!L)return h.removeAllListeners(s),h._parser["on"+s]=L,L;h.on(s,L)},enumerable:!0,configurable:!1})})}l.prototype=Object.create(f.prototype,{constructor:{value:l}}),l.prototype.write=function(r){if(typeof je=="function"&&typeof je.isBuffer=="function"&&je.isBuffer(r)){if(!this._decoder){var t=Mi.StringDecoder;this._decoder=new t("utf8")}r=this._decoder.write(r)}return this._parser.write(r.toString()),this.emit("data",r),!0},l.prototype.end=function(r){return r&&r.length&&this.write(r),this._parser.end(),!0},l.prototype.on=function(r,t){var h=this;return!h._parser["on"+r]&&d.indexOf(r)!==-1&&(h._parser["on"+r]=function(){var s=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);s.splice(0,0,r),h.emit.apply(h,s)}),f.prototype.on.call(h,r,t)};var v="[CDATA[",E="DOCTYPE",I="http://www.w3.org/XML/1998/namespace",V="http://www.w3.org/2000/xmlns/",_={xml:I,xmlns:V},W=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,H=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,te=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,J=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function C(r){return r===" "||r===`
`||r==="\r"||r==="	"}function F(r){return r==='"'||r==="'"}function x(r){return r===">"||C(r)}function D(r,t){return r.test(t)}function re(r,t){return!D(r,t)}var o=0;i.STATE={BEGIN:o++,BEGIN_WHITESPACE:o++,TEXT:o++,TEXT_ENTITY:o++,OPEN_WAKA:o++,SGML_DECL:o++,SGML_DECL_QUOTED:o++,DOCTYPE:o++,DOCTYPE_QUOTED:o++,DOCTYPE_DTD:o++,DOCTYPE_DTD_QUOTED:o++,COMMENT_STARTING:o++,COMMENT:o++,COMMENT_ENDING:o++,COMMENT_ENDED:o++,CDATA:o++,CDATA_ENDING:o++,CDATA_ENDING_2:o++,PROC_INST:o++,PROC_INST_BODY:o++,PROC_INST_ENDING:o++,OPEN_TAG:o++,OPEN_TAG_SLASH:o++,ATTRIB:o++,ATTRIB_NAME:o++,ATTRIB_NAME_SAW_WHITE:o++,ATTRIB_VALUE:o++,ATTRIB_VALUE_QUOTED:o++,ATTRIB_VALUE_CLOSED:o++,ATTRIB_VALUE_UNQUOTED:o++,ATTRIB_VALUE_ENTITY_Q:o++,ATTRIB_VALUE_ENTITY_U:o++,CLOSE_TAG:o++,CLOSE_TAG_SAW_WHITE:o++,SCRIPT:o++,SCRIPT_ENDING:o++},i.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},i.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(i.ENTITIES).forEach(function(r){var t=i.ENTITIES[r],h=typeof t=="number"?String.fromCharCode(t):t;i.ENTITIES[r]=h});for(var S in i.STATE)i.STATE[i.STATE[S]]=S;o=i.STATE;function y(r,t,h){r[t]&&r[t](h)}function N(r,t,h){r.textNode&&ne(r),y(r,t,h)}function ne(r){r.textNode=Et(r.opt,r.textNode),r.textNode&&y(r,"ontext",r.textNode),r.textNode=""}function Et(r,t){return r.trim&&(t=t.trim()),r.normalize&&(t=t.replace(/\s+/g," ")),t}function ge(r,t){return ne(r),r.trackPosition&&(t+=`
Line: `+r.line+`
Column: `+r.column+`
Char: `+r.c),t=new Error(t),r.error=t,y(r,"onerror",t),r}function bt(r){return r.sawRoot&&!r.closedRoot&&R(r,"Unclosed root tag"),r.state!==o.BEGIN&&r.state!==o.BEGIN_WHITESPACE&&r.state!==o.TEXT&&ge(r,"Unexpected end"),ne(r),r.c="",r.closed=!0,y(r,"onend"),n.call(r,r.strict,r.opt),r}function R(r,t){if(typeof r!="object"||!(r instanceof n))throw new Error("bad call to strictFail");r.strict&&ge(r,t)}function ha(r){r.strict||(r.tagName=r.tagName[r.looseCase]());var t=r.tags[r.tags.length-1]||r,h=r.tag={name:r.tagName,attributes:{}};r.opt.xmlns&&(h.ns=t.ns),r.attribList.length=0,N(r,"onopentagstart",h)}function Ue(r,t){var h=r.indexOf(":"),s=h<0?["",r]:r.split(":"),L=s[0],U=s[1];return t&&r==="xmlns"&&(L="xmlns",U=""),{prefix:L,local:U}}function ze(r){if(r.strict||(r.attribName=r.attribName[r.looseCase]()),r.attribList.indexOf(r.attribName)!==-1||r.tag.attributes.hasOwnProperty(r.attribName)){r.attribName=r.attribValue="";return}if(r.opt.xmlns){var t=Ue(r.attribName,!0),h=t.prefix,s=t.local;if(h==="xmlns")if(s==="xml"&&r.attribValue!==I)R(r,"xml: prefix must be bound to "+I+`
Actual: `+r.attribValue);else if(s==="xmlns"&&r.attribValue!==V)R(r,"xmlns: prefix must be bound to "+V+`
Actual: `+r.attribValue);else{var L=r.tag,U=r.tags[r.tags.length-1]||r;L.ns===U.ns&&(L.ns=Object.create(U.ns)),L.ns[s]=r.attribValue}r.attribList.push([r.attribName,r.attribValue])}else r.tag.attributes[r.attribName]=r.attribValue,N(r,"onattribute",{name:r.attribName,value:r.attribValue});r.attribName=r.attribValue=""}function de(r,t){if(r.opt.xmlns){var h=r.tag,s=Ue(r.tagName);h.prefix=s.prefix,h.local=s.local,h.uri=h.ns[s.prefix]||"",h.prefix&&!h.uri&&(R(r,"Unbound namespace prefix: "+JSON.stringify(r.tagName)),h.uri=s.prefix);var L=r.tags[r.tags.length-1]||r;h.ns&&L.ns!==h.ns&&Object.keys(h.ns).forEach(function(Tt){N(r,"onopennamespace",{prefix:Tt,uri:h.ns[Tt]})});for(var U=0,z=r.attribList.length;U<z;U++){var Q=r.attribList[U],Z=Q[0],he=Q[1],X=Ue(Z,!0),se=X.prefix,va=X.local,yt=se===""?"":h.ns[se]||"",Ve={name:Z,value:he,prefix:se,local:va,uri:yt};se&&se!=="xmlns"&&!yt&&(R(r,"Unbound namespace prefix: "+JSON.stringify(se)),Ve.uri=se),r.tag.attributes[Z]=Ve,N(r,"onattribute",Ve)}r.attribList.length=0}r.tag.isSelfClosing=!!t,r.sawRoot=!0,r.tags.push(r.tag),N(r,"onopentag",r.tag),t||(!r.noscript&&r.tagName.toLowerCase()==="script"?r.state=o.SCRIPT:r.state=o.TEXT,r.tag=null,r.tagName=""),r.attribName=r.attribValue="",r.attribList.length=0}function Ge(r){if(!r.tagName){R(r,"Weird empty close tag."),r.textNode+="</>",r.state=o.TEXT;return}if(r.script){if(r.tagName!=="script"){r.script+="</"+r.tagName+">",r.tagName="",r.state=o.SCRIPT;return}N(r,"onscript",r.script),r.script=""}var t=r.tags.length,h=r.tagName;r.strict||(h=h[r.looseCase]());for(var s=h;t--;){var L=r.tags[t];if(L.name!==s)R(r,"Unexpected close tag");else break}if(t<0){R(r,"Unmatched closing tag: "+r.tagName),r.textNode+="</"+r.tagName+">",r.state=o.TEXT;return}r.tagName=h;for(var U=r.tags.length;U-- >t;){var z=r.tag=r.tags.pop();r.tagName=r.tag.name,N(r,"onclosetag",r.tagName);var Q={};for(var Z in z.ns)Q[Z]=z.ns[Z];var he=r.tags[r.tags.length-1]||r;r.opt.xmlns&&z.ns!==he.ns&&Object.keys(z.ns).forEach(function(X){var se=z.ns[X];N(r,"onclosenamespace",{prefix:X,uri:se})})}t===0&&(r.closedRoot=!0),r.tagName=r.attribValue=r.attribName="",r.attribList.length=0,r.state=o.TEXT}function fa(r){var t=r.entity,h=t.toLowerCase(),s,L="";return r.ENTITIES[t]?r.ENTITIES[t]:r.ENTITIES[h]?r.ENTITIES[h]:(t=h,t.charAt(0)==="#"&&(t.charAt(1)==="x"?(t=t.slice(2),s=parseInt(t,16),L=s.toString(16)):(t=t.slice(1),s=parseInt(t,10),L=s.toString(10))),t=t.replace(/^0+/,""),isNaN(s)||L.toLowerCase()!==t?(R(r,"Invalid character entity"),"&"+r.entity+";"):String.fromCodePoint(s))}function _t(r,t){t==="<"?(r.state=o.OPEN_WAKA,r.startTagPosition=r.position):C(t)||(R(r,"Non-whitespace before first tag."),r.textNode=t,r.state=o.TEXT)}function wt(r,t){var h="";return t<r.length&&(h=r.charAt(t)),h}function ga(r){var t=this;if(this.error)throw this.error;if(t.closed)return ge(t,"Cannot write after close. Assign an onready handler.");if(r===null)return bt(t);typeof r=="object"&&(r=r.toString());for(var h=0,s="";s=wt(r,h++),t.c=s,!!s;)switch(t.trackPosition&&(t.position++,s===`
`?(t.line++,t.column=0):t.column++),t.state){case o.BEGIN:if(t.state=o.BEGIN_WHITESPACE,s==="\uFEFF")continue;_t(t,s);continue;case o.BEGIN_WHITESPACE:_t(t,s);continue;case o.TEXT:if(t.sawRoot&&!t.closedRoot){for(var L=h-1;s&&s!=="<"&&s!=="&";)s=wt(r,h++),s&&t.trackPosition&&(t.position++,s===`
`?(t.line++,t.column=0):t.column++);t.textNode+=r.substring(L,h-1)}s==="<"&&!(t.sawRoot&&t.closedRoot&&!t.strict)?(t.state=o.OPEN_WAKA,t.startTagPosition=t.position):(!C(s)&&(!t.sawRoot||t.closedRoot)&&R(t,"Text data outside of root node."),s==="&"?t.state=o.TEXT_ENTITY:t.textNode+=s);continue;case o.SCRIPT:s==="<"?t.state=o.SCRIPT_ENDING:t.script+=s;continue;case o.SCRIPT_ENDING:s==="/"?t.state=o.CLOSE_TAG:(t.script+="<"+s,t.state=o.SCRIPT);continue;case o.OPEN_WAKA:if(s==="!")t.state=o.SGML_DECL,t.sgmlDecl="";else if(!C(s))if(D(W,s))t.state=o.OPEN_TAG,t.tagName=s;else if(s==="/")t.state=o.CLOSE_TAG,t.tagName="";else if(s==="?")t.state=o.PROC_INST,t.procInstName=t.procInstBody="";else{if(R(t,"Unencoded <"),t.startTagPosition+1<t.position){var U=t.position-t.startTagPosition;s=new Array(U).join(" ")+s}t.textNode+="<"+s,t.state=o.TEXT}continue;case o.SGML_DECL:if(t.sgmlDecl+s==="--"){t.state=o.COMMENT,t.comment="",t.sgmlDecl="";continue}t.doctype&&t.doctype!==!0&&t.sgmlDecl?(t.state=o.DOCTYPE_DTD,t.doctype+="<!"+t.sgmlDecl+s,t.sgmlDecl=""):(t.sgmlDecl+s).toUpperCase()===v?(N(t,"onopencdata"),t.state=o.CDATA,t.sgmlDecl="",t.cdata=""):(t.sgmlDecl+s).toUpperCase()===E?(t.state=o.DOCTYPE,(t.doctype||t.sawRoot)&&R(t,"Inappropriately located doctype declaration"),t.doctype="",t.sgmlDecl=""):s===">"?(N(t,"onsgmldeclaration",t.sgmlDecl),t.sgmlDecl="",t.state=o.TEXT):(F(s)&&(t.state=o.SGML_DECL_QUOTED),t.sgmlDecl+=s);continue;case o.SGML_DECL_QUOTED:s===t.q&&(t.state=o.SGML_DECL,t.q=""),t.sgmlDecl+=s;continue;case o.DOCTYPE:s===">"?(t.state=o.TEXT,N(t,"ondoctype",t.doctype),t.doctype=!0):(t.doctype+=s,s==="["?t.state=o.DOCTYPE_DTD:F(s)&&(t.state=o.DOCTYPE_QUOTED,t.q=s));continue;case o.DOCTYPE_QUOTED:t.doctype+=s,s===t.q&&(t.q="",t.state=o.DOCTYPE);continue;case o.DOCTYPE_DTD:s==="]"?(t.doctype+=s,t.state=o.DOCTYPE):s==="<"?(t.state=o.OPEN_WAKA,t.startTagPosition=t.position):F(s)?(t.doctype+=s,t.state=o.DOCTYPE_DTD_QUOTED,t.q=s):t.doctype+=s;continue;case o.DOCTYPE_DTD_QUOTED:t.doctype+=s,s===t.q&&(t.state=o.DOCTYPE_DTD,t.q="");continue;case o.COMMENT:s==="-"?t.state=o.COMMENT_ENDING:t.comment+=s;continue;case o.COMMENT_ENDING:s==="-"?(t.state=o.COMMENT_ENDED,t.comment=Et(t.opt,t.comment),t.comment&&N(t,"oncomment",t.comment),t.comment=""):(t.comment+="-"+s,t.state=o.COMMENT);continue;case o.COMMENT_ENDED:s!==">"?(R(t,"Malformed comment"),t.comment+="--"+s,t.state=o.COMMENT):t.doctype&&t.doctype!==!0?t.state=o.DOCTYPE_DTD:t.state=o.TEXT;continue;case o.CDATA:s==="]"?t.state=o.CDATA_ENDING:t.cdata+=s;continue;case o.CDATA_ENDING:s==="]"?t.state=o.CDATA_ENDING_2:(t.cdata+="]"+s,t.state=o.CDATA);continue;case o.CDATA_ENDING_2:s===">"?(t.cdata&&N(t,"oncdata",t.cdata),N(t,"onclosecdata"),t.cdata="",t.state=o.TEXT):s==="]"?t.cdata+="]":(t.cdata+="]]"+s,t.state=o.CDATA);continue;case o.PROC_INST:s==="?"?t.state=o.PROC_INST_ENDING:C(s)?t.state=o.PROC_INST_BODY:t.procInstName+=s;continue;case o.PROC_INST_BODY:if(!t.procInstBody&&C(s))continue;s==="?"?t.state=o.PROC_INST_ENDING:t.procInstBody+=s;continue;case o.PROC_INST_ENDING:s===">"?(N(t,"onprocessinginstruction",{name:t.procInstName,body:t.procInstBody}),t.procInstName=t.procInstBody="",t.state=o.TEXT):(t.procInstBody+="?"+s,t.state=o.PROC_INST_BODY);continue;case o.OPEN_TAG:D(H,s)?t.tagName+=s:(ha(t),s===">"?de(t):s==="/"?t.state=o.OPEN_TAG_SLASH:(C(s)||R(t,"Invalid character in tag name"),t.state=o.ATTRIB));continue;case o.OPEN_TAG_SLASH:s===">"?(de(t,!0),Ge(t)):(R(t,"Forward-slash in opening tag not followed by >"),t.state=o.ATTRIB);continue;case o.ATTRIB:if(C(s))continue;s===">"?de(t):s==="/"?t.state=o.OPEN_TAG_SLASH:D(W,s)?(t.attribName=s,t.attribValue="",t.state=o.ATTRIB_NAME):R(t,"Invalid attribute name");continue;case o.ATTRIB_NAME:s==="="?t.state=o.ATTRIB_VALUE:s===">"?(R(t,"Attribute without value"),t.attribValue=t.attribName,ze(t),de(t)):C(s)?t.state=o.ATTRIB_NAME_SAW_WHITE:D(H,s)?t.attribName+=s:R(t,"Invalid attribute name");continue;case o.ATTRIB_NAME_SAW_WHITE:if(s==="=")t.state=o.ATTRIB_VALUE;else{if(C(s))continue;R(t,"Attribute without value"),t.tag.attributes[t.attribName]="",t.attribValue="",N(t,"onattribute",{name:t.attribName,value:""}),t.attribName="",s===">"?de(t):D(W,s)?(t.attribName=s,t.state=o.ATTRIB_NAME):(R(t,"Invalid attribute name"),t.state=o.ATTRIB)}continue;case o.ATTRIB_VALUE:if(C(s))continue;F(s)?(t.q=s,t.state=o.ATTRIB_VALUE_QUOTED):(t.opt.unquotedAttributeValues||ge(t,"Unquoted attribute value"),t.state=o.ATTRIB_VALUE_UNQUOTED,t.attribValue=s);continue;case o.ATTRIB_VALUE_QUOTED:if(s!==t.q){s==="&"?t.state=o.ATTRIB_VALUE_ENTITY_Q:t.attribValue+=s;continue}ze(t),t.q="",t.state=o.ATTRIB_VALUE_CLOSED;continue;case o.ATTRIB_VALUE_CLOSED:C(s)?t.state=o.ATTRIB:s===">"?de(t):s==="/"?t.state=o.OPEN_TAG_SLASH:D(W,s)?(R(t,"No whitespace between attributes"),t.attribName=s,t.attribValue="",t.state=o.ATTRIB_NAME):R(t,"Invalid attribute name");continue;case o.ATTRIB_VALUE_UNQUOTED:if(!x(s)){s==="&"?t.state=o.ATTRIB_VALUE_ENTITY_U:t.attribValue+=s;continue}ze(t),s===">"?de(t):t.state=o.ATTRIB;continue;case o.CLOSE_TAG:if(t.tagName)s===">"?Ge(t):D(H,s)?t.tagName+=s:t.script?(t.script+="</"+t.tagName,t.tagName="",t.state=o.SCRIPT):(C(s)||R(t,"Invalid tagname in closing tag"),t.state=o.CLOSE_TAG_SAW_WHITE);else{if(C(s))continue;re(W,s)?t.script?(t.script+="</"+s,t.state=o.SCRIPT):R(t,"Invalid tagname in closing tag."):t.tagName=s}continue;case o.CLOSE_TAG_SAW_WHITE:if(C(s))continue;s===">"?Ge(t):R(t,"Invalid characters in closing tag");continue;case o.TEXT_ENTITY:case o.ATTRIB_VALUE_ENTITY_Q:case o.ATTRIB_VALUE_ENTITY_U:var z,Q;switch(t.state){case o.TEXT_ENTITY:z=o.TEXT,Q="textNode";break;case o.ATTRIB_VALUE_ENTITY_Q:z=o.ATTRIB_VALUE_QUOTED,Q="attribValue";break;case o.ATTRIB_VALUE_ENTITY_U:z=o.ATTRIB_VALUE_UNQUOTED,Q="attribValue";break}if(s===";"){var Z=fa(t);t.opt.unparsedEntities&&!Object.values(i.XML_ENTITIES).includes(Z)?(t.entity="",t.state=z,t.write(Z)):(t[Q]+=Z,t.entity="",t.state=z)}else D(t.entity.length?J:te,s)?t.entity+=s:(R(t,"Invalid character in entity name"),t[Q]+="&"+t.entity+s,t.entity="",t.state=z);continue;default:throw new Error(t,"Unknown state: "+t.state)}return t.position>=t.bufferCheckPosition&&c(t),t}String.fromCodePoint||(function(){var r=String.fromCharCode,t=Math.floor,h=function(){var s=16384,L=[],U,z,Q=-1,Z=arguments.length;if(!Z)return"";for(var he="";++Q<Z;){var X=Number(arguments[Q]);if(!isFinite(X)||X<0||X>1114111||t(X)!==X)throw RangeError("Invalid code point: "+X);X<=65535?L.push(X):(X-=65536,U=(X>>10)+55296,z=X%1024+56320,L.push(U,z)),(Q+1===Z||L.length>s)&&(he+=r.apply(null,L),L.length=0)}return he};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:h,configurable:!0,writable:!0}):String.fromCodePoint=h})()})(e)})(jt)),jt}Xi();var Se=(e=>(e.ReservedName="reserved name",e.Character="character",e.Extension="extension",e))(Se||{});class Ee extends Error{constructor(i){super(`Invalid ${i.reason} '${i.segment}' in filename '${i.filename}'`,{cause:i})}get filename(){return this.cause.filename}get reason(){return this.cause.reason}get segment(){return this.cause.segment}}function ji(e){const i=La().files,a=i.forbidden_filename_characters??window._oc_config?.forbidden_filenames_characters??["/","\\"];for(const u of a)if(e.includes(u))throw new Ee({segment:u,reason:"character",filename:e});if(e=e.toLocaleLowerCase(),(i.forbidden_filenames??[".htaccess"]).includes(e))throw new Ee({filename:e,segment:e,reason:"reserved name"});const n=e.indexOf(".",1),c=e.substring(0,n===-1?void 0:n);if((i.forbidden_filename_basenames??[]).includes(c))throw new Ee({filename:e,segment:c,reason:"reserved name"});const m=i.forbidden_filename_extensions??[".part",".filepart"];for(const u of m)if(e.length>u.length&&e.endsWith(u))throw new Ee({segment:u,reason:"extension",filename:e})}const at=["B","KB","MB","GB","TB","PB"],it=["B","KiB","MiB","GiB","TiB","PiB"];function Wi(e,i=!1,a=!1,n=!1){a=a&&!n,typeof e=="string"&&(e=Number(e));let c=e>0?Math.floor(Math.log(e)/Math.log(n?1e3:1024)):0;c=Math.min((a?it.length:at.length)-1,c);const m=a?it[c]:at[c];let u=(e/Math.pow(n?1e3:1024,c)).toFixed(1);return i===!0&&c===0?(u!=="0.0"?"< 1 ":"0 ")+(a?it[1]:at[1]):(c<2?u=parseFloat(u).toFixed(0):u=parseFloat(u).toLocaleString(Zt()),u+" "+m)}function Yt(e){return e instanceof Date?e.toISOString():String(e)}function Yi(e,i,a){i=i??[m=>m],a=a??[];const n=i.map((m,u)=>(a[u]??"asc")==="asc"?1:-1),c=Intl.Collator([Da(),Zt()],{numeric:!0,usage:"sort"});return[...e].sort((m,u)=>{for(const[f,d]of i.entries()){const p=c.compare(Yt(d(m)),Yt(d(u)));if(p!==0)return p*n[f]}return 0})}function qi(e,i={}){const a={sortingMode:"basename",sortingOrder:"asc",...i};function n(u){const f=u.displayname||u.attributes?.displayname||u.basename||"";return u.type===le.Folder?f:f.lastIndexOf(".")>0?f.slice(0,f.lastIndexOf(".")):f}const c=[...a.sortFavoritesFirst?[u=>u.attributes?.favorite!==1]:[],...a.sortFoldersFirst?[u=>u.type!=="folder"]:[],...a.sortingMode!=="basename"?[u=>u[a.sortingMode]??u.attributes[a.sortingMode]]:[],u=>n(u),u=>u.basename],m=[...a.sortFavoritesFirst?["asc"]:[],...a.sortFoldersFirst?["asc"]:[],...a.sortingMode==="mtime"?[a.sortingOrder==="asc"?"desc":"asc"]:[],...a.sortingMode!=="mtime"&&a.sortingMode!=="basename"?[a.sortingOrder]:[],a.sortingOrder,a.sortingOrder];return Yi(e,c,m)}const Qi=new ti({concurrency:5});function Zi(e){const{resolve:i,promise:a}=Promise.withResolvers();return Qi.add(()=>{const n=new Image;return n.onerror=()=>i(!1),n.onload=()=>i(!0),n.src=e,a}),a}function Ki(e,i={}){i={size:32,cropPreview:!1,mimeFallback:!0,...i};try{const a=e.attributes?.previewUrl||ut("/core/preview?fileId={fileid}",{fileid:e.fileid});let n;try{n=new URL(a)}catch{n=new URL(a,window.location.origin)}return n.searchParams.set("x",`${i.size}`),n.searchParams.set("y",`${i.size}`),n.searchParams.set("mimeFallback",`${i.mimeFallback}`),n.searchParams.set("a",i.cropPreview===!0?"0":"1"),n.searchParams.set("c",`${e.attributes.etag}`),n}catch{return null}}function Ji(e,i){const a=P(null),n=P(!1);return Ra(()=>{n.value=!1,a.value=Ki(_e(e),_e(i||{})),a.value&&_e(e).type===le.File&&Zi(a.value.href).then(c=>{n.value=c})}),{previewURL:a,previewLoaded:n}}const K=(e,i)=>{const a=e.__vccOpts||e;for(const[n,c]of i)a[n]=c;return a},er={name:"FileIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},tr=["aria-hidden","aria-label"],ar=["fill","width","height"],ir={d:"M13,9V3.5L18.5,9M6,2C4.89,2 4,2.89 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2H6Z"},rr={key:0};function nr(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon file-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",ir,[a.title?(g(),b("title",rr,M(a.title),1)):G("",!0)])],8,ar))],16,tr)}const ot=K(er,[["render",nr]]),sr={name:"MenuDownIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},or=["aria-hidden","aria-label"],lr=["fill","width","height"],cr={d:"M7,10L12,15L17,10H7Z"},ur={key:0};function dr(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon menu-down-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",cr,[a.title?(g(),b("title",ur,M(a.title),1)):G("",!0)])],8,lr))],16,or)}const rt=K(sr,[["render",dr]]),pr={name:"MenuUpIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},mr=["aria-hidden","aria-label"],hr=["fill","width","height"],fr={d:"M7,15L12,10L17,15H7Z"},gr={key:0};function vr(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon menu-up-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",fr,[a.title?(g(),b("title",gr,M(a.title),1)):G("",!0)])],8,hr))],16,mr)}const nt=K(pr,[["render",vr]]),Er={name:"FolderIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},br=["aria-hidden","aria-label"],_r=["fill","width","height"],wr={d:"M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"},yr={key:0};function Tr(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon folder-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",wr,[a.title?(g(),b("title",yr,M(a.title),1)):G("",!0)])],8,_r))],16,br)}const da=K(Er,[["render",Tr]]),pa={"file-picker__file-icon":"_file-picker__file-icon_3v9zx_9","file-picker__file-icon--primary":"_file-picker__file-icon--primary_3v9zx_21","file-picker__file-icon-overlay":"_file-picker__file-icon-overlay_3v9zx_25"},Ir=me({__name:"FilePreview",props:{node:{},cropImagePreviews:{type:Boolean}},setup(e){const i=e,a=P(pa),{previewURL:n,previewLoaded:c}=Ji(Jt(i,"node"),O(()=>({cropPreview:i.cropImagePreviews}))),m=O(()=>i.node.type===le.File),u=O(()=>{if(i.node.type!==le.Folder)return null;if(i.node.attributes?.["is-encrypted"]===1)return Ua;if(i.node.attributes?.["is-tag"])return za;const f=Object.values(i.node.attributes?.["share-types"]||{}).flat();if(f.some(d=>d===Lt.Link||d===Lt.Email))return Ga;if(f.length>0)return At;switch(i.node.attributes?.["mount-type"]){case"external":case"external-session":return Ha;case"group":return Va;case"shared":return At}return null});return(f,d)=>(g(),b("div",{style:Xa(w(c)?{backgroundImage:`url(${w(n)})`}:void 0),class:fe(a.value["file-picker__file-icon"])},[w(c)?G("",!0):(g(),b(oe,{key:0},[m.value?(g(),B(ot,{key:0,size:32})):(g(),b(oe,{key:1},[u.value?(g(),B(w(ta),{key:0,class:fe(a.value["file-picker__file-icon-overlay"]),inline:"",path:u.value,size:16},null,8,["class","path"])):G("",!0),$(da,{class:fe(a.value["file-picker__file-icon--primary"]),size:32},null,8,["class"])],64))],64))],6))}}),Nr=["tabindex","aria-selected","data-filename"],Ar={class:"row-name"},Cr={class:"file-picker__name-container","data-testid":"row-name"},Lr=["title","textContent"],Dr=["textContent"],Rr={class:"row-size"},Or={class:"row-modified"},Sr=me({__name:"FileListRow",props:{allowPickDirectory:{type:Boolean},selected:{type:Boolean},showCheckbox:{type:Boolean},canPick:{type:Boolean},node:{},cropImagePreviews:{type:Boolean}},emits:["update:selected","enterDirectory"],setup(e,{emit:i}){const a=e,n=i,c=O(()=>a.node.mtime??0),m=O(()=>Qt(a.node.displayname)),u=O(()=>a.node.displayname.slice(0,m.value?-m.value.length:void 0)),f=O(()=>a.node.type===le.Folder),d=O(()=>a.canPick&&(a.allowPickDirectory||!f.value)),p=O(()=>(a.node.permissions&ee.READ)===ee.READ);function l(){d.value&&n("update:selected",!a.selected)}function v(){f.value?p.value&&n("enterDirectory",a.node):l()}function E(I){I.key==="Enter"&&v()}return(I,V)=>(g(),b("tr",ae({tabindex:e.showCheckbox&&!f.value?void 0:0,"aria-selected":d.value?e.selected:void 0,class:["file-picker__row",[{"file-picker__row--selected":e.selected&&!e.showCheckbox,"file-picker__row--not-navigatable":f.value&&!p.value,"file-picker__row--not-pickable":!d.value}]],"data-filename":e.node.basename,"data-testid":"file-list-row"},xa({click:v,...!e.showCheckbox||f.value?{keydown:E}:{}},!0)),[e.showCheckbox?(g(),b("td",{key:0,class:"row-checkbox",onClick:Re(()=>{},["stop"])},[$(w(aa),{"aria-label":w(A)("Select the row for {nodename}",{nodename:u.value}),disabled:!d.value,"data-testid":"row-checkbox","model-value":e.selected,"onUpdate:modelValue":l},null,8,["aria-label","disabled","model-value"])])):G("",!0),T("td",Ar,[T("div",Cr,[$(Ir,{node:e.node,"crop-image-previews":e.cropImagePreviews},null,8,["node","crop-image-previews"]),T("div",{class:"file-picker__file-name",title:u.value,textContent:M(u.value)},null,8,Lr),T("div",{class:"file-picker__file-extension",textContent:M(m.value)},null,8,Dr)])]),T("td",Rr,M(w(Wi)(e.node.size||0)),1),T("td",Or,[$(w(ei),{timestamp:c.value,"ignore-seconds":""},null,8,["timestamp"])])],16,Nr))}}),kr=K(Sr,[["__scopeId","data-v-2af740c4"]]),Fr={"aria-hidden":"true",class:"file-picker__row loading-row"},$r={key:0,class:"row-checkbox"},Pr={class:"row-name"},Br={class:"row-wrapper"},Mr=me({__name:"LoadingTableRow",props:{showCheckbox:{type:Boolean}},setup(e){return(i,a)=>(g(),b("tr",Fr,[e.showCheckbox?(g(),b("td",$r,[...a[0]||(a[0]=[T("span",null,null,-1)])])):G("",!0),T("td",Pr,[T("div",Br,[T("span",{class:fe(w(pa)["file-picker__file-icon"])},null,2),a[1]||(a[1]=T("span",null,null,-1))])]),a[2]||(a[2]=T("td",{class:"row-size"},[T("span")],-1)),a[3]||(a[3]=T("td",{class:"row-modified"},[T("span")],-1))]))}}),xr=K(Mr,[["__scopeId","data-v-1f96131b"]]);function ma(){const e=ea("files","config",null),i=P(e?.show_hidden??!0),a=P(e?.sort_favorites_first??!0),n=P(e?.crop_image_previews??!0);return Ne(async()=>{if(Ie())Te.debug("Skip loading files settings - currently on public share");else try{const{data:c}=await ia.get(ut("/apps/files/api/v1/configs"));i.value=c?.data?.show_hidden??!1,a.value=c?.data?.sort_favorites_first??!0,n.value=c?.data?.crop_image_previews??!0}catch(c){Te.error("Could not load files settings",{error:c}),ct(A("Could not load files settings"))}}),{showHiddenFiles:i,sortFavoritesFirst:a,cropImagePreviews:n}}function Ur(e){const i=p=>p==="asc"?"ascending":p==="desc"?"descending":"none",a=ea("files","viewConfigs",null),n=P({sortBy:a?.files?.sorting_mode??"basename",order:i(a?.files?.sorting_direction??"asc")}),c=P({sortBy:a?.recent?.sorting_mode??"basename",order:i(a?.recent?.sorting_direction??"asc")}),m=P({sortBy:a?.favorites?.sorting_mode??"basename",order:i(a?.favorites?.sorting_direction??"asc")});Ne(async()=>{if(Ie())Te.debug("Skip loading files views - currently on public share");else try{const{data:p}=await ia.get(ut("/apps/files/api/v1/views"));n.value={sortBy:p?.data?.files?.sorting_mode??"basename",order:i(p?.data?.files?.sorting_direction)},m.value={sortBy:p?.data?.favorites?.sorting_mode??"basename",order:i(p?.data?.favorites?.sorting_direction)},c.value={sortBy:p?.data?.recent?.sorting_mode??"basename",order:i(p?.data?.recent?.sorting_direction)}}catch(p){Te.error("Could not load files views",{error:p}),ct(A("Could not load files views"))}});const u=O(()=>_e(e||"files")==="files"?n.value:_e(e)==="recent"?c.value:m.value),f=O(()=>u.value.sortBy),d=O(()=>u.value.order);return{filesViewConfig:n,favoritesViewConfig:m,recentViewConfig:c,currentConfig:u,sortBy:f,order:d}}const zr={key:0,class:"row-checkbox"},Gr={class:"hidden-visually"},Vr=["aria-sort"],Hr={class:"header-wrapper"},Xr={key:2,style:{width:"44px"}},jr=["aria-sort"],Wr={key:2,style:{width:"44px"}},Yr=["aria-sort"],qr={key:2,style:{width:"44px"}},Qr=me({__name:"FileList",props:ka({currentView:{},multiselect:{type:Boolean},allowPickDirectory:{type:Boolean},loading:{type:Boolean},files:{},canPick:{type:Function}},{path:{required:!0},pathModifiers:{},selectedFiles:{required:!0},selectedFilesModifiers:{}}),emits:["update:path","update:selectedFiles"],setup(e){const i=Nt(e,"path"),a=Nt(e,"selectedFiles"),n=e,c=P(),{currentConfig:m}=Ur(n.currentView),u=O(()=>c.value??m.value),f=O(()=>u.value.sortBy==="basename"?u.value.order==="none"?void 0:u.value.order:void 0),d=O(()=>u.value.sortBy==="size"?u.value.order==="none"?void 0:u.value.order:void 0),p=O(()=>u.value.sortBy==="mtime"?u.value.order==="none"?void 0:u.value.order:void 0);function l(F){u.value.sortBy===F?u.value.order==="ascending"?c.value={sortBy:u.value.sortBy,order:"descending"}:c.value={sortBy:u.value.sortBy,order:"ascending"}:c.value={sortBy:F,order:"ascending"}}const{sortFavoritesFirst:v,cropImagePreviews:E}=ma(),I=O(()=>qi(n.files,{sortFoldersFirst:!0,sortFavoritesFirst:v.value,sortingOrder:u.value.order==="descending"?"desc":"asc",sortingMode:u.value.sortBy})),V=O(()=>n.files.filter(F=>n.allowPickDirectory||F.type!==le.Folder)),_=O(()=>!n.loading&&a.value.length>0&&a.value.length>=V.value.length);function W(){a.value.length<V.value.length?a.value=[...V.value]:a.value=[]}function H(F){a.value.includes(F)?a.value=a.value.filter(x=>x.path!==F.path):n.multiselect?a.value=[...a.value,F]:a.value=[F]}function te(F){i.value=F.path}const J=P(4),C=P();{const F=()=>Fa(()=>{const x=C.value?.parentElement?.children||[];let D=C.value?.parentElement?.clientHeight||450;for(let re=0;re<x.length;re++)C.value?.isSameNode(x[re])||(D-=x[re].clientHeight);J.value=Math.max(1,Math.floor((D-50)/50))});Ne(()=>{window.addEventListener("resize",F),F()}),$a(()=>{window.removeEventListener("resize",F)})}return(F,x)=>(g(),b("div",{ref_key:"fileContainer",ref:C,class:"file-picker__files"},[T("table",null,[T("thead",null,[T("tr",null,[e.multiselect?(g(),b("th",zr,[T("span",Gr,M(w(A)("Select entry")),1),e.multiselect?(g(),B(w(aa),{key:0,"aria-label":w(A)("Select all entries"),"data-testid":"select-all-checkbox","model-value":_.value,"onUpdate:modelValue":W},null,8,["aria-label","model-value"])):G("",!0)])):G("",!0),T("th",{"aria-sort":f.value,class:"row-name"},[T("div",Hr,[x[3]||(x[3]=T("span",{class:"file-picker__header-preview"},null,-1)),$(w(we),{"data-test":"file-picker_sort-name",variant:"tertiary",wide:"",onClick:x[0]||(x[0]=D=>l("basename"))},{icon:k(()=>[f.value==="ascending"?(g(),B(nt,{key:0,size:20})):f.value==="descending"?(g(),B(rt,{key:1,size:20})):(g(),b("span",Xr))]),default:k(()=>[be(" "+M(w(A)("Name")),1)]),_:1})])],8,Vr),T("th",{"aria-sort":d.value,class:"row-size"},[$(w(we),{variant:"tertiary",wide:"",onClick:x[1]||(x[1]=D=>l("size"))},{icon:k(()=>[d.value==="ascending"?(g(),B(nt,{key:0,size:20})):d.value==="descending"?(g(),B(rt,{key:1,size:20})):(g(),b("span",Wr))]),default:k(()=>[be(" "+M(w(A)("Size")),1)]),_:1})],8,jr),T("th",{"aria-sort":p.value,class:"row-modified"},[$(w(we),{variant:"tertiary",wide:"",onClick:x[2]||(x[2]=D=>l("mtime"))},{icon:k(()=>[p.value==="ascending"?(g(),B(nt,{key:0,size:20})):p.value==="descending"?(g(),B(rt,{key:1,size:20})):(g(),b("span",qr))]),default:k(()=>[be(" "+M(w(A)("Modified")),1)]),_:1})],8,Yr)])]),T("tbody",null,[e.loading?(g(!0),b(oe,{key:0},ke(J.value,D=>(g(),B(xr,{key:D,"show-checkbox":e.multiselect},null,8,["show-checkbox"]))),128)):(g(!0),b(oe,{key:1},ke(I.value,D=>(g(),B(kr,{key:D.fileid||D.path,"allow-pick-directory":e.allowPickDirectory,"show-checkbox":e.multiselect,"can-pick":(e.multiselect||a.value.length===0||a.value.includes(D))&&(e.canPick===void 0||e.canPick(D)),selected:a.value.includes(D),node:D,"crop-image-previews":w(E),"onUpdate:selected":re=>H(D),onEnterDirectory:te},null,8,["allow-pick-directory","show-checkbox","can-pick","selected","node","crop-image-previews","onUpdate:selected"]))),128))])])],512))}}),Zr=K(Qr,[["__scopeId","data-v-68ec5c33"]]),Kr={name:"HomeIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Jr=["aria-hidden","aria-label"],en=["fill","width","height"],tn={d:"M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"},an={key:0};function rn(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon home-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",tn,[a.title?(g(),b("title",an,M(a.title),1)):G("",!0)])],8,en))],16,Jr)}const nn=K(Kr,[["render",rn]]),sn={name:"PlusIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},on=["aria-hidden","aria-label"],ln=["fill","width","height"],cn={d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"},un={key:0};function dn(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon plus-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",cn,[a.title?(g(),b("title",un,M(a.title),1)):G("",!0)])],8,ln))],16,on)}const pn=K(sn,[["render",dn]]),mn=me({__name:"FilePickerBreadcrumbs",props:{path:{},showMenu:{type:Boolean}},emits:["update:path","create-node"],setup(e,{emit:i}){const a=e,n=i,c=P(!1),m=P(""),u=Sa("nameInput");function f(){const l=m.value.trim(),v=u.value?.$el?.querySelector("input");let E="";try{ji(l)}catch(I){if(!(I instanceof Ee))throw I;switch(I.reason){case Se.Character:E=A('"{char}" is not allowed inside a folder name.',{char:I.segment});break;case Se.ReservedName:E=A('"{segment}" is a reserved name and not allowed for folder names.',{segment:I.segment});break;case Se.Extension:E=A('Folder names must not end with "{extension}".',{extension:I.segment});break;default:E=A("Invalid folder name.")}}return v&&v.setCustomValidity(E),E===""}function d(){const l=m.value.trim();f()&&(c.value=!1,n("create-node",l),m.value="")}const p=O(()=>a.path.split("/").filter(l=>l!=="").map((l,v,E)=>({name:l,path:"/"+E.slice(0,v+1).join("/")})));return(l,v)=>(g(),B(w(yi),{class:"file-picker__breadcrumbs"},qt({default:k(()=>[$(w(Fe),{name:w(A)("All files"),title:w(A)("Home"),onClick:v[0]||(v[0]=E=>n("update:path","/"))},{icon:k(()=>[$(nn,{size:20})]),_:1},8,["name","title"]),(g(!0),b(oe,null,ke(p.value,E=>(g(),B(w(Fe),{key:E.path,name:E.name,title:E.path,onClick:I=>n("update:path",E.path)},null,8,["name","title","onClick"]))),128))]),_:2},[e.showMenu?{name:"actions",fn:k(()=>[$(w(lt),{open:c.value,"onUpdate:open":v[2]||(v[2]=E=>c.value=E),"aria-label":w(A)("Create directory"),"force-menu":!0,"force-name":!0,"menu-name":w(A)("New"),variant:"secondary",onClose:v[3]||(v[3]=E=>m.value="")},{icon:k(()=>[$(pn,{size:20})]),default:k(()=>[$(w(ai),{ref_key:"nameInput",ref:u,modelValue:m.value,"onUpdate:modelValue":[v[1]||(v[1]=E=>m.value=E),f],label:w(A)("New folder"),placeholder:w(A)("New folder name"),onSubmit:d},{icon:k(()=>[$(da,{size:20})]),_:1},8,["modelValue","label","placeholder"])]),_:1},8,["open","aria-label","menu-name"])]),key:"0"}:void 0]),1024))}}),hn=K(mn,[["__scopeId","data-v-4ce40fd0"]]),fn={name:"CloseIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},gn=["aria-hidden","aria-label"],vn=["fill","width","height"],En={d:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"},bn={key:0};function _n(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon close-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",En,[a.title?(g(),b("title",bn,M(a.title),1)):G("",!0)])],8,vn))],16,gn)}const wn=K(fn,[["render",_n]]),yn={name:"MagnifyIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Tn=["aria-hidden","aria-label"],In=["fill","width","height"],Nn={d:"M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"},An={key:0};function Cn(e,i,a,n,c,m){return g(),b("span",ae(e.$attrs,{"aria-hidden":a.title?null:"true","aria-label":a.title,class:"material-design-icon magnify-icon",role:"img",onClick:i[0]||(i[0]=u=>e.$emit("click",u))}),[(g(),b("svg",{fill:a.fillColor,class:"material-design-icon__svg",width:a.size,height:a.size,viewBox:"0 0 24 24"},[T("path",Nn,[a.title?(g(),b("title",An,M(a.title),1)):G("",!0)])],8,In))],16,Tn)}const Ln=K(yn,[["render",Cn]]);function Dn(e){const i=[{id:"files",label:A("All files"),icon:Pa},{id:"recent",label:A("Recent"),icon:Ba},{id:"favorites",label:A("Favorites"),icon:Ma}],a=e.value?i.filter(({id:n})=>n==="files"):i;return{allViews:i,availableViews:a}}const Rn={key:0,class:"file-picker__side"},On=me({__name:"FilePickerNavigation",props:{currentView:{},filterString:{},isCollapsed:{type:Boolean},disabledNavigation:{type:Boolean}},emits:["update:currentView","update:filterString"],setup(e,{emit:i}){const a=e,n=i,{availableViews:c}=Dn(P($e()===null)),m=O(()=>c.filter(f=>f.id===a.currentView)[0]??c[0]),u=f=>n("update:filterString",f.toString());return(f,d)=>(g(),b(oe,null,[$(w(ri),{class:"file-picker__filter-input",label:w(A)("Filter file list"),"show-trailing-button":!!e.filterString,"model-value":e.filterString,"onUpdate:modelValue":u,onTrailingButtonClick:d[0]||(d[0]=p=>u(""))},{"trailing-button-icon":k(()=>[$(wn,{size:16})]),default:k(()=>[$(Ln,{size:16})]),_:1},8,["label","show-trailing-button","model-value"]),w(c).length>1&&!e.disabledNavigation?(g(),b(oe,{key:0},[e.isCollapsed?(g(),B(w(ii),{key:1,"aria-label":w(A)("Current view selector"),clearable:!1,searchable:!1,options:w(c),"model-value":m.value,"onUpdate:modelValue":d[1]||(d[1]=p=>n("update:currentView",p.id))},null,8,["aria-label","options","model-value"])):(g(),b("ul",Rn,[(g(!0),b(oe,null,ke(w(c),p=>(g(),b("li",{key:p.id},[$(w(we),{variant:e.currentView===p.id?"primary":"tertiary",wide:!0,onClick:l=>f.$emit("update:currentView",p.id)},{icon:k(()=>[$(w(ta),{path:p.icon,size:20},null,8,["path"])]),default:k(()=>[be(" "+M(p.label),1)]),_:2},1032,["variant","onClick"])]))),128))]))],64)):G("",!0)],64))}}),Sn=K(On,[["__scopeId","data-v-b91fd905"]]);function kn(e){const i=new AbortController,a=Math.round(Date.now()/1e3)-3600*24*14;return new ie(async(n,c,m)=>{m(()=>i.abort());try{const{data:u}=await e.search("/",{signal:i.signal,details:!0,data:Si(a)}),f=u.results.map(d=>xe(d));n(f)}catch(u){c(u)}})}function Fn(e,i){const a=new AbortController;return new ie(async(n,c,m)=>{m(()=>a.abort());try{const u=(await e.getDirectoryContents(ye(Ae,i),{signal:a.signal,details:!0,includeSelf:!0,data:sa()})).data.map(f=>xe(f));n({contents:u.filter(({path:f})=>f!==i),folder:u.find(({path:f})=>f===i)})}catch(u){c(u)}})}async function $n(e,i){const{data:a}=await e.stat(ye(Ae,i),{details:!0,data:sa()});return xe(a)}function Pn(e,i){const a=$i(),n=st([]),c=st(null),m=P(!0),u=P(null);async function f(p){const l=ye(i.value,p);await a.createDirectory(ye(Ae,l));const v=await $n(a,l);return n.value=[...n.value,v],v}async function d(){u.value&&u.value.cancel(),m.value=!0,e.value==="favorites"?u.value=Pi(a,i.value):e.value==="recent"?u.value=kn(a):u.value=Fn(a,i.value);const p=await u.value;if(p)"folder"in p?(c.value=p.folder,n.value=p.contents):(c.value=null,n.value=p);else return;u.value=null,m.value=!1}return Kt([e,i],()=>d()),Ne(()=>d()),{isLoading:m,files:n,folder:c,loadFiles:d,createDirectory:f}}function Bn(e){const i=O(()=>e.value.map(a=>a.split("/")));return{isSupportedMimeType:a=>{const n=a.split("/");return i.value.some(([c,m])=>(n[0]===c||c==="*")&&(n[1]===m||m==="*"))}}}const Mn={class:"file-picker__main"},xn={key:1,class:"file-picker__view"},Un=me({__name:"FilePicker",props:{buttons:{},name:{},allowPickDirectory:{type:Boolean,default:!1},noMenu:{type:Boolean,default:!1},disabledNavigation:{type:Boolean,default:!1},filterFn:{type:Function,default:void 0},canPickFn:{type:Function,default:void 0},mimetypeFilter:{default:()=>[]},multiselect:{type:Boolean,default:!1},path:{default:void 0}},emits:["close"],setup(e,{emit:i}){const a=e,n=i,c=P(!0),m=P("files"),u=P(window?.sessionStorage.getItem("NC.FilePicker.LastPath")||"/"),f=P(""),d=O({get:()=>m.value==="files"?f.value||a.path||u.value:"/",set:S=>{f.value=S}}),p=st([]),{files:l,folder:v,isLoading:E,loadFiles:I,createDirectory:V}=Pn(m,d);Kt([f],()=>{a.path===void 0&&f.value&&window.sessionStorage.setItem("NC.FilePicker.LastPath",f.value),p.value=[]});let _=!1;const W=O(()=>{const S=p.value.length===0&&a.allowPickDirectory&&v.value?[v.value]:p.value;return(typeof a.buttons=="function"?a.buttons(S,d.value,m.value):a.buttons).map(y=>({...y,disabled:y.disabled||E.value,callback:()=>{_=!0,H(y.callback,S)}}))});async function H(S,y){await S(y),n("close",y),_=!1}const te=O(()=>m.value==="favorites"?A("Favorites"):m.value==="recent"?A("Recent"):""),J=P(""),{isSupportedMimeType:C}=Bn(Jt(a,"mimetypeFilter"));Ne(()=>I());const{showHiddenFiles:F}=ma(),x=O(()=>{let S=l.value;return F.value||(S=S.filter(y=>!y.basename.startsWith("."))),a.mimetypeFilter.length>0&&(S=S.filter(y=>y.type==="folder"||y.mime&&C(y.mime))),J.value&&(S=S.filter(y=>y.basename.toLowerCase().includes(J.value.toLowerCase()))),a.filterFn&&(S=S.filter(y=>a.filterFn(y))),S}),D=O(()=>m.value==="files"?A("Upload some content or sync with your devices!"):m.value==="recent"?A("Files and folders you recently modified will show up here."):A("Files and folders you mark as favorite will show up here."));async function re(S){try{const y=await V(S);f.value=y.path,Oa("files:node:created",l.value.filter(N=>N.basename===S)[0])}catch(y){Te.warn("Could not create new folder",{name:S,error:y}),ct(A("Could not create the new folder"))}}function o(S){!S&&!_&&n("close")}return(S,y)=>(g(),B(w(Wa),{open:c.value,"onUpdate:open":[y[6]||(y[6]=N=>c.value=N),o],buttons:W.value,name:e.name,size:"large","content-classes":"file-picker__content","dialog-classes":"file-picker","navigation-classes":"file-picker__navigation"},{navigation:k(({isCollapsed:N})=>[$(Sn,{"current-view":m.value,"onUpdate:currentView":y[0]||(y[0]=ne=>m.value=ne),"filter-string":J.value,"onUpdate:filterString":y[1]||(y[1]=ne=>J.value=ne),"is-collapsed":N,"disabled-navigation":e.disabledNavigation},null,8,["current-view","filter-string","is-collapsed","disabled-navigation"])]),default:k(()=>[T("div",Mn,[m.value==="files"?(g(),B(hn,{key:0,path:d.value,"onUpdate:path":y[2]||(y[2]=N=>d.value=N),"show-menu":!e.noMenu,onCreateNode:re},null,8,["path","show-menu"])):(g(),b("div",xn,[T("h3",null,M(te.value),1)])),w(E)||x.value.length>0?(g(),B(Zr,{key:2,path:d.value,"onUpdate:path":[y[3]||(y[3]=N=>d.value=N),y[5]||(y[5]=N=>m.value="files")],"selected-files":p.value,"onUpdate:selectedFiles":y[4]||(y[4]=N=>p.value=N),"allow-pick-directory":e.allowPickDirectory,"current-view":m.value,files:x.value,multiselect:e.multiselect,loading:w(E),name:te.value,"can-pick":e.canPickFn},null,8,["path","selected-files","allow-pick-directory","current-view","files","multiselect","loading","name","can-pick"])):J.value?(g(),B(w(Ct),{key:3,name:w(A)("No matching files"),description:w(A)("No files matching your filter were found.")},{icon:k(()=>[$(ot)]),_:1},8,["name","description"])):(g(),B(w(Ct),{key:4,name:w(A)("No files in here"),description:D.value},{icon:k(()=>[$(ot)]),_:1},8,["name","description"]))])]),_:1},8,["open","buttons","name"]))}}),rs=K(Un,[["__scopeId","data-v-303416d3"]]);export{rs as default};
//# sourceMappingURL=FilePicker-W-IYpVkn-FlhTGZkn.chunk.mjs.map
