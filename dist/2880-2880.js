"use strict";(self.webpackChunknextcloud_ui_legacy=self.webpackChunknextcloud_ui_legacy||[]).push([[2880],{82880:(e,i,l)=>{l.r(i),l.d(i,{default:()=>x});var n=l(20641),t=l(50953),a=l(53751),c=l(90033),r=l(9165),s=l(79458),o=l(63668),u=l(91126),d=l(22722),p=l(35810),v=l(89673),k=l(43016),m=l(31890),f=l(50240);const y=["src"],g={key:1},_=["src"],E={key:1},R=(0,n.pM)({__name:"ConflictPickerEntry",props:(0,n.zz)({existing:{},incoming:{}},{existingSelected:{type:Boolean,required:!0},existingSelectedModifiers:{},incomingSelected:{type:Boolean,required:!0},incomingSelectedModifiers:{}}),emits:["update:existingSelected","update:incomingSelected"],setup(e,{expose:i}){const l=(0,n.fn)(e,"existingSelected"),a=(0,n.fn)(e,"incomingSelected"),s=e;i({validate:function(){f.value=a.value||l.value?"":(0,m.t)("You need to choose at least one conflict solution")}});const u=e=>"FileSystemEntry"in window&&e instanceof window.FileSystemEntry,f=(0,t.KR)(""),R=(0,t.KR)(),h=(0,t.KR)(),b=(0,t.KR)(),C=(0,t.KR)(),w=(0,t.KR)(),x=(0,t.KR)(),S=(0,n.EW)(()=>a.value||l.value),W=(0,n.EW)(()=>s.existing.type===p.pt.Folder),F=(0,n.EW)(()=>u(s.incoming)?s.incoming.isDirectory:!(s.incoming instanceof File)&&s.incoming.type===p.pt.Folder);function A(e){return e.size}function $(e){if(!(e instanceof File))return e.mtime;{const i=e.lastModified;if(i>0)return new Date(i)}}async function L(e){return e instanceof File?await async function(e){if(!e.type.startsWith("image/"))return;const{resolve:i,promise:l}=Promise.withResolvers(),n=new FileReader;return n.onload=async l=>{const n=l?.target?.result;if(n instanceof ArrayBuffer){const l=new Blob([n],{type:e.type}),t=URL.createObjectURL(l);return void i(t)}i(void 0)},n.readAsArrayBuffer(e),l}(e):(0,k.g)(e,{size:64})?.toString()}return(0,n.wB)(()=>s.existing,async()=>{C.value=$(s.existing),x.value=A(s.existing),h.value=await L(s.existing)}),(0,n.wB)(()=>s.incoming,async()=>{const e=await async function(e){return"FileSystemFileEntry"in window&&e instanceof window.FileSystemFileEntry?await new Promise((i,l)=>e.file(i,l)):u(e)?null:e}(s.incoming);null!==e&&(b.value=$(e),w.value=A(e),R.value=await L(e))}),(i,s)=>((0,n.uX)(),(0,n.CE)("fieldset",{class:(0,c.C4)(i.$style.pickerEntry)},[(0,n.Lk)("legend",null,(0,c.v_)(e.existing.basename),1),(0,n.bF)((0,t.R1)(o.A),{modelValue:a.value,"onUpdate:modelValue":s[0]||(s[0]=e=>a.value=e),error:!!f.value,"helper-text":f.value,required:!S.value},{default:(0,n.k6)(()=>[(0,n.Lk)("span",{class:(0,c.C4)(i.$style.pickerEntryItem)},[R.value?((0,n.uX)(),(0,n.CE)("img",{key:1,class:(0,c.C4)(i.$style.pickerEntryPreview),src:R.value,alt:"",loading:"lazy"},null,10,y)):((0,n.uX)(),(0,n.Wv)((0,t.R1)(d.A),{key:0,class:(0,c.C4)([i.$style.pickerEntryIcon,{[i.$style.pickerEntryIcon_folder]:W.value}]),path:F.value?(0,t.R1)(r.fEr):(0,t.R1)(r.DvY),size:48},null,8,["class","path"])),(0,n.Lk)("span",{class:(0,c.C4)(i.$style.pickerEntryDescription)},[(0,n.Lk)("span",null,(0,c.v_)((0,t.R1)(m.t)("New version")),1),b.value?((0,n.uX)(),(0,n.Wv)((0,t.R1)(v.A),{key:0,timestamp:b.value,"relative-time":!1,format:{timeStyle:"short",dateStyle:"medium"}},null,8,["timestamp"])):((0,n.uX)(),(0,n.CE)("span",g,(0,c.v_)((0,t.R1)(m.t)("Last modified date unknown")),1)),(0,n.Lk)("span",null,(0,c.v_)(w.value),1)],2)],2)]),_:1},8,["modelValue","error","helper-text","required"]),(0,n.bF)((0,t.R1)(o.A),{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=e=>l.value=e),error:!!f.value,"helper-text":f.value,required:!S.value},{default:(0,n.k6)(()=>[(0,n.Lk)("span",{class:(0,c.C4)(i.$style.pickerEntryItem)},[h.value?((0,n.uX)(),(0,n.CE)("img",{key:1,class:(0,c.C4)(i.$style.pickerEntryPreview),src:h.value,alt:"",loading:"lazy"},null,10,_)):((0,n.uX)(),(0,n.Wv)((0,t.R1)(d.A),{key:0,class:(0,c.C4)([i.$style.pickerEntryIcon,{[i.$style.pickerEntryIcon_folder]:W.value}]),path:W.value?(0,t.R1)(r.fEr):(0,t.R1)(r.DvY),size:48},null,8,["class","path"])),(0,n.Lk)("span",{class:(0,c.C4)(i.$style.pickerEntryDescription)},[(0,n.Lk)("span",null,(0,c.v_)((0,t.R1)(m.t)("Existing version")),1),C.value?((0,n.uX)(),(0,n.Wv)((0,t.R1)(v.A),{key:0,timestamp:C.value,"relative-time":!1,format:{timeStyle:"short",dateStyle:"medium"}},null,8,["timestamp"])):((0,n.uX)(),(0,n.CE)("span",E,(0,c.v_)((0,t.R1)(m.t)("Last modified date unknown")),1)),(0,n.Lk)("span",null,(0,c.v_)(x.value),1)],2)],2)]),_:1},8,["modelValue","error","helper-text","required"])],2))}}),h=(0,f._)(R,[["__cssModules",{$style:{pickerEntry:"_pickerEntry_xk2pl_1",pickerEntryItem:"_pickerEntryItem_xk2pl_5",pickerEntryIcon:"_pickerEntryIcon_xk2pl_11",pickerEntryPreview:"_pickerEntryPreview_xk2pl_12",pickerEntryIcon_folder:"_pickerEntryIcon_folder_xk2pl_24",pickerEntryDescription:"_pickerEntryDescription_xk2pl_34"}}]]),b={class:"hidden-visually"},C={key:0,class:"hidden-visually"},w=(0,n.pM)({__name:"ConflictPicker",props:{container:{},dirname:{},existing:{},incoming:{},recursiveUpload:{type:Boolean}},emits:["close"],setup(e,{emit:i}){const l=e,p=i,v=(0,m.t)("You need to select at least one version of each file to continue."),k=(0,n.rk)("form"),f=(0,n.rk)("conflictEntry"),y=(0,t.IJ)([]),g=(0,t.IJ)([]),_=(0,n.EW)(()=>0===y.value.length),E=(0,n.EW)(()=>y.value.length===l.incoming.length),R=(0,n.EW)(()=>!E.value&&!_.value),w=(0,n.EW)(()=>g.value.length===l.existing.length),x=(0,n.EW)(()=>!w.value&&!_.value),S=(0,n.EW)(()=>{for(const e of l.incoming)if(!g.value.includes(e)&&!y.value.includes(e))return!1;return!0}),W=(0,n.EW)(()=>""!==l.dirname?.trim()?(0,m.n)("%n file conflict in {dirname}","%n file conflicts in {dirname}",l.incoming.length,{dirname:l.dirname}):(0,m.n)("%n file conflict","%n files conflict",l.incoming.length));function F(){p("close",null)}function A(){m.l.debug("Conflict skipped. Ignoring all conflicting files"),p("close",{selected:[],renamed:[],skipped:[...l.incoming]})}function $(e){e?(m.l.debug("Selected all new files"),y.value=[...l.incoming]):(m.l.debug("Cleared new selection"),y.value=[])}function L(e){e?(m.l.debug("Selected all existing files"),g.value=[...l.incoming]):(m.l.debug("Cleared old selection"),g.value=[])}function I(){if(!S.value){for(const e of f.value)e.validate();return k.value.reportValidity(),void(0,m.s)(v)}const e=y.value.filter(e=>!g.value.includes(e)),i=y.value.filter(e=>g.value.includes(e)),l=g.value.filter(e=>!y.value.includes(e));p("close",{renamed:i,selected:e,skipped:l})}return(i,l)=>((0,n.uX)(),(0,n.Wv)((0,t.R1)(u.A),{container:e.container,class:(0,c.C4)(i.$style.picker),name:W.value,size:"large",onClosing:F},{actions:(0,n.k6)(()=>[(0,n.bF)((0,t.R1)(s.A),{title:(0,t.R1)(m.t)("Cancel the entire operation"),"data-cy-conflict-picker-cancel":"",variant:"tertiary",onClick:F},{icon:(0,n.k6)(()=>[(0,n.bF)((0,t.R1)(d.A),{path:(0,t.R1)(r.hyP)},null,8,["path"])]),default:(0,n.k6)(()=>[(0,n.eW)(" "+(0,c.v_)((0,t.R1)(m.t)("Cancel")),1)]),_:1},8,["title"]),(0,n.Lk)("span",{class:(0,c.C4)(i.$style.pickerActionSeparator)},null,2),(0,n.bF)((0,t.R1)(s.A),{onClick:A},{icon:(0,n.k6)(()=>[(0,n.bF)((0,t.R1)(d.A),{path:(0,t.R1)(r.hyP)},null,8,["path"])]),default:(0,n.k6)(()=>[(0,n.eW)(" "+(0,c.v_)(1===e.incoming.length?(0,t.R1)(m.t)("Skip this file"):(0,t.R1)(m.n)("Skip %n file","Skip %n files",e.incoming.length)),1)]),_:1}),(0,n.bF)((0,t.R1)(s.A),{"aria-disabled":!S.value,class:(0,c.C4)([i.$style.pickerActionSubmit,{[i.$style.pickerActionSubmit_disabled]:!S.value}]),title:S.value?"":(0,t.R1)(v),type:"submit",variant:"primary",onClick:(0,a.D$)(I,["stop","prevent"])},{icon:(0,n.k6)(()=>[(0,n.bF)((0,t.R1)(d.A),{directional:"",path:(0,t.R1)(r.K5o)},null,8,["path"])]),default:(0,n.k6)(()=>[(0,n.eW)(" "+(0,c.v_)((0,t.R1)(m.t)("Continue"))+" ",1),S.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("span",C,(0,c.v_)((0,t.R1)(v)),1))]),_:1},8,["aria-disabled","class","title"])]),default:(0,n.k6)(()=>[(0,n.Lk)("div",{class:(0,c.C4)(i.$style.pickerHeader)},[(0,n.Lk)("p",{id:"conflict-picker-description",class:(0,c.C4)(i.$style.pickerDescription)},[(0,n.eW)((0,c.v_)((0,t.R1)(m.t)("Which files do you want to keep?")),1),l[0]||(l[0]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)(" "+(0,c.v_)((0,t.R1)(m.t)("If you select both versions, the incoming file will have a number added to its name.")),1),l[1]||(l[1]=(0,n.Lk)("br",null,null,-1)),e.recursiveUpload?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[(0,n.eW)((0,c.v_)((0,t.R1)(m.t)("When an incoming folder is selected, the content is written into the existing folder and a recursive conflict resolution is performed.")),1)],64)):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.eW)((0,c.v_)((0,t.R1)(m.t)("When an incoming folder is selected, any conflicting files within it will also be overwritten.")),1)],64))],2)],2),(0,n.Lk)("form",{ref:"form","aria-labelledby":"conflict-picker-description",class:(0,c.C4)(i.$style.pickerForm),onSubmit:(0,a.D$)(I,["prevent","stop"])},[(0,n.Lk)("fieldset",{class:(0,c.C4)(i.$style.pickerSelectAll)},[(0,n.Lk)("legend",b,(0,c.v_)((0,t.R1)(m.t)("Select all checkboxes")),1),(0,n.bF)((0,t.R1)(o.A),{"model-value":E.value,indeterminate:R.value,"onUpdate:modelValue":$},{default:(0,n.k6)(()=>[(0,n.eW)((0,c.v_)((0,t.R1)(m.t)("Select all new files")),1)]),_:1},8,["model-value","indeterminate"]),(0,n.bF)((0,t.R1)(o.A),{"model-value":w.value,indeterminate:x.value,"onUpdate:modelValue":L},{default:(0,n.k6)(()=>[(0,n.eW)((0,c.v_)((0,t.R1)(m.t)("Select all existing files")),1)]),_:1},8,["model-value","indeterminate"])],2),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.existing,(i,l)=>((0,n.uX)(),(0,n.Wv)(h,{ref_for:!0,ref:"conflictEntry",key:i.fileid,incoming:e.incoming[l],existing:i,"incoming-selected":y.value.includes(e.incoming[l]),"existing-selected":g.value.includes(e.incoming[l]),"onUpdate:existingSelected":i=>{return n=e.incoming[l],void(g.value.includes(n)?g.value=g.value.filter(e=>e!==n):g.value=[...g.value,n]);var n},"onUpdate:incomingSelected":i=>{return n=e.incoming[l],void(y.value.includes(n)?y.value=y.value.filter(e=>e!==n):y.value=[...y.value,n]);var n}},null,8,["incoming","existing","incoming-selected","existing-selected","onUpdate:existingSelected","onUpdate:incomingSelected"]))),128))],34)]),_:1},8,["container","class","name"]))}}),x=(0,f._)(w,[["__cssModules",{$style:{picker:"_picker_6q4ek_1",pickerHeader:"_pickerHeader_6q4ek_6",pickerForm:"_pickerForm_6q4ek_15",pickerActionSubmit_disabled:"_pickerActionSubmit_disabled_6q4ek_22",pickerSelectAll:"_pickerSelectAll_6q4ek_27","conflict-picker__all":"_conflict-picker__all_6q4ek_40"}}]])}}]);
//# sourceMappingURL=2880-2880.js.map?v=e173b56d1e35791ae43e