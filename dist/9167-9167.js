"use strict";(self.webpackChunknextcloud=self.webpackChunknextcloud||[]).push([[9167],{77422:(t,e,s)=>{s.d(e,{A:()=>c});var a=s(71354),i=s.n(a),n=s(76314),o=s.n(n)()(i());o.push([t.id,".systemtags-picker__input[data-v-5176571c],.systemtags-picker__note[data-v-5176571c]{position:sticky;z-index:9;background-color:var(--color-main-background)}.systemtags-picker__input[data-v-5176571c]{display:flex;top:0;gap:8px;padding-block-end:8px;align-items:flex-end}.systemtags-picker__tags[data-v-5176571c]{padding-block:8px;gap:var(--default-grid-baseline);display:flex;flex-direction:column}.systemtags-picker__tags li[data-v-5176571c]{display:flex;align-items:center;justify-content:space-between;width:100%}.systemtags-picker__tags li[data-v-5176571c] .checkbox-radio-switch{width:100%}.systemtags-picker__tags li[data-v-5176571c] .checkbox-radio-switch .checkbox-content{max-width:none;box-sizing:border-box}.systemtags-picker__tags .systemtags-picker__tag-color button[data-v-5176571c]{margin-inline-start:calc(var(--default-grid-baseline)*2)}.systemtags-picker__tags .systemtags-picker__tag-color button .button-color-pencil[data-v-5176571c]{display:none;color:var(--color-main-text)}.systemtags-picker__tags .systemtags-picker__tag-color button:focus .button-color-pencil[data-v-5176571c],.systemtags-picker__tags .systemtags-picker__tag-color button:hover .button-color-pencil[data-v-5176571c],.systemtags-picker__tags .systemtags-picker__tag-color button[aria-expanded=true] .button-color-pencil[data-v-5176571c]{display:block}.systemtags-picker__tags .systemtags-picker__tag-color button:focus .button-color-circle[data-v-5176571c],.systemtags-picker__tags .systemtags-picker__tag-color button:focus .button-color-empty[data-v-5176571c],.systemtags-picker__tags .systemtags-picker__tag-color button:hover .button-color-circle[data-v-5176571c],.systemtags-picker__tags .systemtags-picker__tag-color button:hover .button-color-empty[data-v-5176571c],.systemtags-picker__tags .systemtags-picker__tag-color button[aria-expanded=true] .button-color-circle[data-v-5176571c],.systemtags-picker__tags .systemtags-picker__tag-color button[aria-expanded=true] .button-color-empty[data-v-5176571c]{display:none}.systemtags-picker__tags .systemtags-picker__tag-create[data-v-5176571c] span{text-align:start}.systemtags-picker__tags .systemtags-picker__tag-create-subline[data-v-5176571c]{font-weight:normal}.systemtags-picker__note[data-v-5176571c]{bottom:0;padding-block:8px}.systemtags-picker__note[data-v-5176571c] .notecard{min-height:2lh;align-items:center}.systemtags-picker__note>div[data-v-5176571c]{margin:0 !important}.systemtags-picker--done[data-v-5176571c] .empty-content__icon{opacity:1}.nc-chip[data-v-5176571c]{display:inline !important}","",{version:3,sources:["webpack://./apps/systemtags/src/components/SystemTagPicker.vue"],names:[],mappings:"AAEA,qFAEC,eAAA,CACA,SAAA,CACA,6CAAA,CAGD,2CACC,YAAA,CACA,KAAA,CACA,OAAA,CACA,qBAAA,CACA,oBAAA,CAGD,0CACC,iBAAA,CACA,gCAAA,CACA,YAAA,CACA,qBAAA,CAEA,6CACC,YAAA,CACA,kBAAA,CACA,6BAAA,CACA,UAAA,CAGA,oEACC,UAAA,CAEA,sFAEC,cAAA,CAEA,qBAAA,CAKH,+EACC,wDAAA,CAEA,oGACC,YAAA,CACA,4BAAA,CAMA,4UACC,aAAA,CAED,qpBAEC,YAAA,CAMF,8EACC,gBAAA,CAED,iFACC,kBAAA,CAKH,0CACC,QAAA,CACA,iBAAA,CAEA,oDAEC,cAAA,CACA,kBAAA,CAGD,8CACC,mBAAA,CAIF,+DACC,SAAA,CAID,0BACC,yBAAA",sourcesContent:["\n// Common sticky properties\n.systemtags-picker__input,\n.systemtags-picker__note {\n\tposition: sticky;\n\tz-index: 9;\n\tbackground-color: var(--color-main-background);\n}\n\n.systemtags-picker__input {\n\tdisplay: flex;\n\ttop: 0;\n\tgap: 8px;\n\tpadding-block-end: 8px;\n\talign-items: flex-end;\n}\n\n.systemtags-picker__tags {\n\tpadding-block: 8px;\n\tgap: var(--default-grid-baseline);\n\tdisplay: flex;\n\tflex-direction: column;\n\n\tli {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: space-between;\n\t\twidth: 100%;\n\n\t\t// Make switch full width\n\t\t:deep(.checkbox-radio-switch) {\n\t\t\twidth: 100%;\n\n\t\t\t.checkbox-content {\n\t\t\t\t// adjust width\n\t\t\t\tmax-width: none;\n\t\t\t\t// recalculate padding\n\t\t\t\tbox-sizing: border-box;\n\t\t\t}\n\t\t}\n\t}\n\n\t.systemtags-picker__tag-color button {\n\t\tmargin-inline-start: calc(var(--default-grid-baseline) * 2);\n\n\t\t.button-color-pencil {\n\t\t\tdisplay: none;\n\t\t\tcolor: var(--color-main-text);\n\t\t}\n\n\t\t&:focus,\n\t\t&:hover,\n\t\t&[aria-expanded='true'] {\n\t\t\t.button-color-pencil {\n\t\t\t\tdisplay: block;\n\t\t\t}\n\t\t\t.button-color-circle,\n\t\t\t.button-color-empty {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t}\n\t}\n\n\t.systemtags-picker__tag-create {\n\t\t:deep(span) {\n\t\t\ttext-align: start;\n\t\t}\n\t\t&-subline {\n\t\t\tfont-weight: normal;\n\t\t}\n\t}\n}\n\n.systemtags-picker__note {\n\tbottom: 0;\n\tpadding-block: 8px;\n\n\t:deep(.notecard) {\n\t\t// min 2 lines of text to avoid jumping\n\t\tmin-height: 2lh;\n\t\talign-items: center;\n\t}\n\n\t& > div {\n\t\tmargin: 0 !important;\n\t}\n}\n\n.systemtags-picker--done :deep(.empty-content__icon) {\n\topacity:  1;\n}\n\n// Rendered chip in note\n.nc-chip {\n\tdisplay: inline !important;\n}\n"],sourceRoot:""}]);const c=o},99167:(t,e,s)=>{s.r(e),s.d(e,{default:()=>st});var a=s(85471),i=s(61338),n=s(21777),o=s(53334),c=s(81222),r=s(85168),l=s(17334),d=s.n(l),g=s(99418),p=s(70580),m=s.n(p),u=s(93797),A=s(32073),h=s(42678),y=s(56798),C=s(94219),_=s(32190),f=s(2645),k=s(40083),b=s(82182);const v={name:"CheckCircleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var x=s(14486);const N=(0,x.A)(v,function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon check-circle-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M12 2C6.5 2 2 6.5 2 12S6.5 22 12 22 22 17.5 22 12 17.5 2 12 2M10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},[],!1,null,null,null).exports,w={name:"CircleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},T=(0,x.A)(w,function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon circle-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},[],!1,null,null,null).exports;var S=s(16039),E=s(16502),L=s(96078);const I={name:"TagOutlineIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},B=(0,x.A)(I,function(){var t=this,e=t._self._c;return e("span",t._b({staticClass:"material-design-icon tag-outline-icon",attrs:{"aria-hidden":t.title?null:"true","aria-label":t.title,role:"img"},on:{click:function(e){return t.$emit("click",e)}}},"span",t.$attrs,!1),[e("svg",{staticClass:"material-design-icon__svg",attrs:{fill:t.fillColor,width:t.size,height:t.size,viewBox:"0 0 24 24"}},[e("path",{attrs:{d:"M21.41 11.58L12.41 2.58A2 2 0 0 0 11 2H4A2 2 0 0 0 2 4V11A2 2 0 0 0 2.59 12.42L11.59 21.42A2 2 0 0 0 13 22A2 2 0 0 0 14.41 21.41L21.41 14.41A2 2 0 0 0 22 13A2 2 0 0 0 21.41 11.58M13 20L4 11V4H11L20 13M6.5 5A1.5 1.5 0 1 1 5 6.5A1.5 1.5 0 0 1 6.5 5Z"}},[t.title?e("title",[t._v(t._s(t.title))]):t._e()])])])},[],!1,null,null,null).exports;var R=s(82528),P=s(57599),$=s(12686),O=s(25631);const z=d()(R.Gw,500),D=getComputedStyle(document.body).getPropertyValue("--color-main-background").replace("#","")||((0,P.j2)()?"000000":"ffffff");var G;!function(t){t.BASE="base",t.LOADING="loading",t.CREATING_TAG="creating-tag",t.DONE="done"}(G||(G={}));const M=(0,c.C)("systemtags","restrictSystemTagsCreationToAdmin",!1),j=(0,a.pM)({name:"SystemTagPicker",components:{CheckIcon:N,CircleIcon:T,CircleOutlineIcon:S.A,NcButton:u.A,NcCheckboxRadioSwitch:A.A,NcChip:h.A,NcColorPicker:y.default,NcDialog:C.A,NcEmptyContent:_.A,NcLoadingIcon:f.A,NcNoteCard:k.A,NcTextField:b.A,PencilIcon:E.A,PlusIcon:L.A,TagIcon:B},props:{nodes:{type:Array,required:!0}},setup:()=>({emit:i.Ic,Status:G,t:o.t,canEditOrCreateTag:!M||(0,n.HW)()?.isAdmin}),data:()=>({status:G.BASE,opened:!0,openedPicker:!1,input:"",tags:[],tagList:{},toAdd:[],toRemove:[]}),computed:{sortedTags(){return[...this.tags].sort((t,e)=>t.displayName.localeCompare(e.displayName,(0,o.Z0)(),{ignorePunctuation:!0}))},filteredTags(){return""===this.input.trim()?this.sortedTags:this.sortedTags.filter(t=>t.displayName.normalize().toLowerCase().includes(this.input.normalize().toLowerCase()))},hasChanges(){return this.toAdd.length>0||this.toRemove.length>0},canCreateTag(){return""!==this.input.trim()&&!this.tags.some(t=>t.displayName.trim().toLocaleLowerCase()===this.input.trim().toLocaleLowerCase())},statusMessage(){if(0===this.toAdd.length&&0===this.toRemove.length)return"";if(1===this.toAdd.length&&1===this.toRemove.length)return(0,o.n)("systemtags","{tag1} will be set and {tag2} will be removed from 1 file.","{tag1} will be set and {tag2} will be removed from {count} files.",this.nodes.length,{tag1:this.formatTagChip(this.toAdd[0]),tag2:this.formatTagChip(this.toRemove[0]),count:this.nodes.length},{escape:!1});const t=this.toAdd.map(this.formatTagChip),e=t.pop(),s=this.toRemove.map(this.formatTagChip),a=s.pop(),i=(0,o.n)("systemtags","{tag} will be set to 1 file.","{tag} will be set to {count} files.",this.nodes.length,{tag:e,count:this.nodes.length},{escape:!1}),n=(0,o.n)("systemtags","{tag} will be removed from 1 file.","{tag} will be removed from {count} files.",this.nodes.length,{tag:a,count:this.nodes.length},{escape:!1}),c=(0,o.n)("systemtags","{tags} and {lastTag} will be set to 1 file.","{tags} and {lastTag} will be set to {count} files.",this.nodes.length,{tags:t.join(", "),lastTag:e,count:this.nodes.length},{escape:!1}),r=(0,o.n)("systemtags","{tags} and {lastTag} will be removed from 1 file.","{tags} and {lastTag} will be removed from {count} files.",this.nodes.length,{tags:s.join(", "),lastTag:a,count:this.nodes.length},{escape:!1});return 1===this.toAdd.length&&0===this.toRemove.length?i:0===this.toAdd.length&&1===this.toRemove.length?n:this.toAdd.length>1&&0===this.toRemove.length?c:0===this.toAdd.length&&this.toRemove.length>1?r:this.toAdd.length>1&&1===this.toRemove.length?`${c} ${n}`:1===this.toAdd.length&&this.toRemove.length>1?`${i} ${r}`:`${c} ${r}`}},beforeMount(){(0,R.un)().then(t=>{this.tags=t}),this.tagList=this.nodes.reduce((t,e)=>(((0,$.rA)(e)||[]).forEach(e=>{t[e]=(t[e]||0)+1}),t),{}),this.canEditOrCreateTag||O.A.debug("System tag creation is restricted to admins and the current user is not an admin")},methods:{formatTagChip(t){const e=this.$refs.chip.$el.cloneNode(!0);if(t.color){const s=this.tagListStyle(t);Object.entries(s).forEach(t=>{let[s,a]=t;e.style.setProperty(s,a)})}return e.outerHTML.replace("%s",m()(g.A.sanitize(t.displayName)))},formatTagName:t=>t.userVisible?t.userAssignable?t.displayName:(0,o.t)("systemtags","{displayName} (restricted)",{displayName:t.displayName}):(0,o.t)("systemtags","{displayName} (hidden)",{displayName:t.displayName}),onColorChange(t,e){t.color=e.replace("#",""),z(t)},isChecked(t){return t.displayName in this.tagList&&this.tagList[t.displayName]===this.nodes.length},isIndeterminate(t){return t.displayName in this.tagList&&0!==this.tagList[t.displayName]&&this.tagList[t.displayName]!==this.nodes.length},onCheckUpdate(t,e){e?(this.toAdd.push(t),this.toRemove=this.toRemove.filter(e=>e.id!==t.id),this.tagList[t.displayName]=this.nodes.length):(this.toRemove.push(t),this.toAdd=this.toAdd.filter(e=>e.id!==t.id),this.tagList[t.displayName]=0)},async onNewTag(){if(this.canEditOrCreateTag){this.status=G.CREATING_TAG;try{const t={displayName:this.input.trim(),userAssignable:!0,userVisible:!0,canAssign:!0},e=await(0,R.VZ)(t),s=await(0,R.xI)(e);this.tags.push(s),this.input="",this.onCheckUpdate(s,!0),await this.$nextTick();const a=this.$el.querySelector(`input[type="checkbox"][label="${s.displayName}"]`);a?.scrollIntoView({behavior:"instant",block:"center",inline:"center"})}catch(t){(0,r.Qg)(t?.message||(0,o.t)("systemtags","Failed to create tag"))}finally{this.status=G.BASE}}else(0,r.Qg)((0,o.t)("systemtags","Only admins can create new tags"))},async onSubmit(){this.status=G.LOADING,O.A.debug("Applying tags",{toAdd:this.toAdd,toRemove:this.toRemove});try{for(const t of this.toAdd){const{etag:e,objects:s}=await(0,R.b0)(t,"files"),a=[...new Set([...s.map(t=>t.id).filter(Boolean),...this.nodes.map(t=>t.fileid).filter(Boolean)])];await(0,R.T0)(t,"files",a.map(t=>({id:t,type:"files"})),e)}for(const t of this.toRemove){const{etag:e,objects:s}=await(0,R.b0)(t,"files"),a=new Set(this.nodes.map(t=>t.fileid)),i=s.map(t=>t.id).filter((t,e,s)=>!a.has(t)&&s.indexOf(t)===e);await(0,R.T0)(t,"files",i.map(t=>({id:t,type:"files"})),e)}}catch(t){return O.A.error("Failed to apply tags",{error:t}),(0,r.Qg)((0,o.t)("systemtags","Failed to apply tags changes")),void(this.status=G.BASE)}const t=[];this.toAdd.forEach(e=>{this.nodes.forEach(s=>{const a=[...(0,$.rA)(s)||[],e.displayName].sort((t,e)=>t.localeCompare(e,(0,o.Z0)(),{ignorePunctuation:!0}));(0,$.Pq)(s,a),t.push(s)})}),this.toRemove.forEach(e=>{this.nodes.forEach(s=>{const a=[...(0,$.rA)(s)||[]].filter(t=>t!==e.displayName).sort((t,e)=>t.localeCompare(e,(0,o.Z0)(),{ignorePunctuation:!0}));(0,$.Pq)(s,a),t.push(s)})}),t.forEach(t=>(0,i.Ic)("systemtags:node:updated",t)),this.status=G.DONE,setTimeout(()=>{this.opened=!1,this.$emit("close",!0)},2e3)},onCancel(){this.opened=!1,this.$emit("close",null)},tagListStyle(t){if(!t.color)return{"--color-circle-icon":"var(--color-text-maxcontrast)"};const e=(0,P.W7)(`#${t.color}`,`#${D}`),s=(0,P.Pj)(e)?"#000000":"#ffffff";return{"--color-circle-icon":"var(--color-primary-element)","--color-primary":e,"--color-primary-text":s,"--color-primary-element":e,"--color-primary-element-text":s}}}});var F=s(85072),q=s.n(F),H=s(97825),V=s.n(H),Z=s(77659),U=s.n(Z),Y=s(55056),Q=s.n(Y),K=s(10540),W=s.n(K),J=s(41113),X=s.n(J),tt=s(77422),et={};et.styleTagTransform=X(),et.setAttributes=Q(),et.insert=U().bind(null,"head"),et.domAPI=V(),et.insertStyleElement=W(),q()(tt.A,et),tt.A&&tt.A.locals&&tt.A.locals;const st=(0,x.A)(j,function(){var t=this,e=t._self._c;return t._self._setupProxy,e("NcDialog",{staticClass:"systemtags-picker",class:"systemtags-picker--"+t.status,attrs:{"data-cy-systemtags-picker":"","can-close":t.status!==t.Status.LOADING,name:t.t("systemtags","Manage tags"),open:t.opened,"close-on-click-outside":"","out-transition":""},on:{"update:open":t.onCancel},scopedSlots:t._u([{key:"actions",fn:function(){return[e("NcButton",{attrs:{disabled:t.status!==t.Status.BASE,type:"tertiary","data-cy-systemtags-picker-button-cancel":""},on:{click:t.onCancel}},[t._v("\n\t\t\t"+t._s(t.t("systemtags","Cancel"))+"\n\t\t")]),t._v(" "),e("NcButton",{attrs:{disabled:!t.hasChanges||t.status!==t.Status.BASE,"data-cy-systemtags-picker-button-submit":""},on:{click:t.onSubmit}},[t._v("\n\t\t\t"+t._s(t.t("systemtags","Apply"))+"\n\t\t")])]},proxy:!0}])},[t.status===t.Status.LOADING||t.status===t.Status.DONE?e("NcEmptyContent",{attrs:{name:t.t("systemtags","Applying tags changes…")},scopedSlots:t._u([{key:"icon",fn:function(){return[t.status===t.Status.LOADING?e("NcLoadingIcon"):e("CheckIcon",{attrs:{"fill-color":"var(--color-border-success)"}})]},proxy:!0}],null,!1,2775311655)}):[e("div",{staticClass:"systemtags-picker__input"},[e("NcTextField",{attrs:{value:t.input,label:t.canEditOrCreateTag?t.t("systemtags","Search or create tag"):t.t("systemtags","Search tag"),"data-cy-systemtags-picker-input":""},on:{"update:value":function(e){t.input=e}}},[e("TagIcon",{attrs:{size:20}})],1)],1),t._v(" "),e("ul",{staticClass:"systemtags-picker__tags",attrs:{"data-cy-systemtags-picker-tags":""}},[t._l(t.filteredTags,function(s){return e("li",{key:s.id,staticClass:"systemtags-picker__tag",style:t.tagListStyle(s),attrs:{"data-cy-systemtags-picker-tag":s.id}},[e("NcCheckboxRadioSwitch",{staticClass:"systemtags-picker__tag-checkbox",attrs:{checked:t.isChecked(s),disabled:!s.canAssign,indeterminate:t.isIndeterminate(s),label:s.displayName},on:{"update:checked":function(e){return t.onCheckUpdate(s,e)}}},[t._v("\n\t\t\t\t\t"+t._s(t.formatTagName(s))+"\n\t\t\t\t")]),t._v(" "),t.canEditOrCreateTag?e("NcColorPicker",{staticClass:"systemtags-picker__tag-color",attrs:{"data-cy-systemtags-picker-tag-color":s.id,value:`#${s.color||"000000"}`,shown:t.openedPicker===s.id},on:{"update:value":function(e){return t.onColorChange(s,e)},"update:shown":function(e){t.openedPicker=!!e&&s.id},submit:function(e){t.openedPicker=!1}}},[e("NcButton",{attrs:{"aria-label":t.t("systemtags","Change tag color"),type:"tertiary"},scopedSlots:t._u([{key:"icon",fn:function(){return[s.color?e("CircleIcon",{staticClass:"button-color-circle",attrs:{size:24,"fill-color":"var(--color-circle-icon)"}}):e("CircleOutlineIcon",{staticClass:"button-color-empty",attrs:{size:24,"fill-color":"var(--color-circle-icon)"}}),t._v(" "),e("PencilIcon",{staticClass:"button-color-pencil"})]},proxy:!0}],null,!0)})],1):t._e()],1)}),t._v(" "),e("li",[t.canEditOrCreateTag&&t.canCreateTag?e("NcButton",{staticClass:"systemtags-picker__tag-create",attrs:{disabled:t.status===t.Status.CREATING_TAG,alignment:"start","native-type":"submit",type:"tertiary","data-cy-systemtags-picker-button-create":""},on:{click:t.onNewTag},scopedSlots:t._u([{key:"icon",fn:function(){return[e("PlusIcon")]},proxy:!0}],null,!1,1789392498)},[t._v("\n\t\t\t\t\t"+t._s(t.input.trim())),e("br"),t._v(" "),e("span",{staticClass:"systemtags-picker__tag-create-subline"},[t._v(t._s(t.t("systemtags","Create new tag")))])]):t._e()],1)],2),t._v(" "),e("div",{staticClass:"systemtags-picker__note"},[t.hasChanges?e("NcNoteCard",{attrs:{type:"info"}},[e("span",{domProps:{innerHTML:t._s(t.statusMessage)}})]):e("NcNoteCard",{attrs:{type:"info"}},[t._v("\n\t\t\t\t"+t._s(t.t("systemtags","Choose tags for the selected files"))+"\n\t\t\t")])],1)],t._v(" "),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}]},[e("NcChip",{ref:"chip",attrs:{text:"%s",type:"primary","no-close":""}})],1)],2)},[],!1,null,"5176571c",null).exports}}]);
//# sourceMappingURL=9167-9167.js.map?v=c145ed8ecdee6d0dd07c