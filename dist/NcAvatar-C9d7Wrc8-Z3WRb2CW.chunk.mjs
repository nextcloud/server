import{c as dt,a as F,u as P,s as T}from"./index-Bndk0DrU.chunk.mjs";import{c as st}from"./index-Bs6rU6kV.chunk.mjs";import{_ as at,o as q,k as ft,g as nt,r as pt,p as gt,b as yt,a as B,N as mt}from"./createElementId-DhjFt1I9-BntyslFA.chunk.mjs";import{d as vt,e as bt,g as G,h as _t,i as St,o as V,a as xt,I as At}from"./index-B70jBK7m.chunk.mjs";import{l as $,N as kt}from"./logger-D3RVzcfQ-DDUIpzCh.chunk.mjs";import{j as x,o as p,k as O,m as rt,l as M,M as E,n as H,t as U,I as Ut,p as it,r as wt,v as R,a3 as Lt,a2 as Mt,b as It,a6 as Nt,f as w,a7 as Ct,E as Dt,c as L,w as N,y as J,e as K,F as Ot,C as Et,J as $t,z as zt,g as jt}from"./runtime-dom.esm-bundler-nUg13ekW.chunk.mjs";import{g as Pt}from"./colors-BHGKZFDI-Co6UphLj.chunk.mjs";import"./translation-DoG5ZELJ-Bni_xMHF.chunk.mjs";import{g as Tt}from"./index-Ma7sfat2.chunk.mjs";import{N as Bt,g as Wt}from"./NcUserStatusIcon-XiwrgeCm-DK69DUW7.chunk.mjs";import{A as Ft,N as Gt}from"./PencilOutline-CZb7h_lN.chunk.mjs";import{a as Ht,N as Zt}from"./NcDateTime.vue_vue_type_script_setup_true_lang-BhB8yA4U-0Qr4fsfm.chunk.mjs";import{N as qt}from"./mdi-B6zUPWea.chunk.mjs";const Vt={name:"NcActionText",mixins:[Ft],inject:{isInSemanticMenu:{from:vt,default:!1}}},Rt=["role"],Jt={key:0,class:"action-text__longtext-wrapper"},Kt={class:"action-text__name"},Qt=["textContent"],Xt=["textContent"],Yt={key:2,class:"action-text__text"};function te(i,r,a,s,t,e){return p(),x("li",{class:"action",role:e.isInSemanticMenu&&"presentation"},[O("span",{class:"action-text",onClick:r[0]||(r[0]=(...n)=>i.onClick&&i.onClick(...n))},[rt(i.$slots,"icon",{},()=>[i.icon!==""?(p(),x("span",{key:0,"aria-hidden":"true",class:H(["action-text__icon",[i.isIconUrl?"action-text__icon--url":i.icon]]),style:E({backgroundImage:i.isIconUrl?`url(${i.icon})`:null})},null,6)):M("",!0)],!0),i.name?(p(),x("span",Jt,[O("strong",Kt,U(i.name),1),O("span",{class:"action-text__longtext",textContent:U(i.text)},null,8,Qt)])):i.isLongText?(p(),x("span",{key:1,class:"action-text__longtext",textContent:U(i.text)},null,8,Xt)):(p(),x("span",Yt,U(i.text),1)),M("",!0)])],8,Rt)}const ee=at(Vt,[["render",te],["__scopeId","data-v-fa684b48"]]),se=Symbol.for("nc:theme:enforced");function ae(i){const r=it(()=>Mt(i)??document.body),a=wt(G(r.value)),s=St();function t(){a.value=G(r.value)}return _t(r,t,{attributes:!0}),R(r,t),R(s,t,{immediate:!0}),Lt(a)}const ne=bt(()=>ae());function re(){const i=ne(),r=Ut(se,void 0);return it(()=>r?.value?r.value==="dark":i.value)}const W=new WeakMap,ie={mounted(i,r){const a=!r.modifiers.bubble;let s;if(typeof r.value=="function")s=V(i,r.value,{capture:a});else{const[t,e]=r.value;s=V(i,t,Object.assign({capture:a},e))}W.set(i,s)},unmounted(i){const r=W.get(i);r&&typeof r=="function"?r():r?.stop(),W.delete(i)}};function D(i,r,a){const s={type:String(i)};return a==null&&(typeof r=="string"||Array.isArray(r))?a=r:Object.assign(s,r),Array.isArray(a)?s.children=a:a!=null&&(s.value=String(a)),s}const ot=(function(i){if(i==null)return le;if(typeof i=="function")return z(i);if(typeof i=="object")return Array.isArray(i)?oe(i):ue(i);if(typeof i=="string")return ce(i);throw new Error("Expected function, string, or object as test")});function oe(i){const r=[];let a=-1;for(;++a<i.length;)r[a]=ot(i[a]);return z(s);function s(...t){let e=-1;for(;++e<r.length;)if(r[e].apply(this,t))return!0;return!1}}function ue(i){const r=i;return z(a);function a(s){const t=s;let e;for(e in i)if(t[e]!==r[e])return!1;return!0}}function ce(i){return z(r);function r(a){return a&&a.type===i}}function z(i){return r;function r(a,s,t){return!!(he(a)&&i.call(this,a,typeof s=="number"?s:void 0,t||void 0))}}function le(){return!0}function he(i){return i!==null&&typeof i=="object"&&"type"in i}const ut=[],de=!0,Q=!1,ct="skip";function fe(i,r,a,s){let t;typeof r=="function"&&typeof a!="function"?(s=a,a=r):t=r;const e=ot(t),n=s?-1:1;l(i,void 0,[])();function l(u,m,d){const f=u&&typeof u=="object"?u:{};if(typeof f.type=="string"){const h=typeof f.tagName=="string"?f.tagName:typeof f.name=="string"?f.name:void 0;Object.defineProperty(A,"name",{value:"node ("+(u.type+(h?"<"+h+">":""))+")"})}return A;function A(){let h=ut,c,o,v;if((!r||e(u,m,d[d.length-1]||void 0))&&(h=pe(a(u,d)),h[0]===Q))return h;if("children"in u&&u.children){const _=u;if(_.children&&h[0]!==ct)for(o=(s?_.children.length:-1)+n,v=d.concat(_);o>-1&&o<_.children.length;){const S=_.children[o];if(c=l(S,o,v)(),c[0]===Q)return c;o=typeof c[1]=="number"?c[1]:o+n}}return h}}}function pe(i){return Array.isArray(i)?i:typeof i=="number"?[de,i]:i==null?ut:[i]}function ge(i,r,a,s){let t,e,n;typeof r=="function"&&typeof a!="function"?(e=void 0,n=r,t=a):(e=r,n=a,t=s),fe(i,e,l,t);function l(u,m){const d=m[m.length-1],f=d?d.children.indexOf(u):void 0;return n(u,f,d)}}const Ze=/(\s|^)(https?:\/\/)([-A-Z0-9+_.]+(?::[0-9]+)?(?:\/[-A-Z0-9+&@#%?=~_|!:,.;()]*)*)(\s|$)/ig,X=/(\s|\(|^)((https?:\/\/)([-A-Z0-9+_.]+[-A-Z0-9]+(?::[0-9]+)?(?:\/[-A-Z0-9+&@#%?=~_|!:,.;()]*)*))(?=\s|\)|$)/ig,ye=It({name:"NcLink",props:{href:{type:String,required:!0}},render(){return Nt("a",{href:this.href,rel:"noopener noreferrer",target:"_blank",class:"rich-text--external-link"},[this.href.trim()])}});function qe({autolink:i,useMarkdown:r,useExtendedMarkdown:a}){return function(s){a||!r||!i||ge(s,t=>t.type==="text",(t,e,n)=>{let l=me(t.value);return typeof l=="string"?l=[D("text",l)]:l=l.map(u=>typeof u=="string"?D("text",u):D("link",{url:u.props.href},[D("text",u.props.href)])).filter(u=>u).flat(),n.children.splice(e,1,...l),[ct,(e??0)+l.length]})}}function me(i){let r=X.exec(i);const a=[];let s=0;for(;r!==null;){let e=r[2],n,l=i.substring(s,r.index+r[1].length);e[0]===" "&&(l+=e[0],e=e.substring(1).trim());const u=e[e.length-1];(u==="."||u===","||u===";"||r[0][0]==="("&&u===")")&&(e=e.substring(0,e.length-1),n=u),a.push(l),a.push({component:ye,props:{href:e}}),n&&a.push(n),s=r.index+r[0].length,r=X.exec(i)}a.push(i.substring(s));const t=a.map(e=>typeof e=="string"?e:e.props.href).join("");return i===t?a:($.error("[NcRichText] Failed to reassemble the chunked text: "+i),i)}function ve(i,r){const a=(d,f)=>d.startsWith(f)?d.slice(f.length):d,s=(d,...f)=>f.reduce((A,h)=>a(A,h),d);if(!i)return null;const t=/^https?:\/\//.test(r),e=/^[a-z][a-z0-9+.-]*:.+/.test(r);if(!t&&e||t&&!r.startsWith(q())||!t&&!r.startsWith("/"))return null;const n=t?s(r,q(),"/index.php"):r,l=s(i.options.history.base,ft(),"/index.php"),u=s(n,l)||"/",m=i.resolve(u);return m.matched.length?m.fullPath:null}function be(i){return window._nc_contacts_menu_hooks?Object.values(window._nc_contacts_menu_hooks).filter(r=>r.enabled(i)):[]}const _e=new Int32Array(4);class y{static hashStr(r,a=!1){return this.onePassHasher.start().appendStr(r).end(a)}static hashAsciiStr(r,a=!1){return this.onePassHasher.start().appendAsciiStr(r).end(a)}static stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);static buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);static hexChars="0123456789abcdef";static hexOut=[];static onePassHasher=new y;static _hex(r){const a=y.hexChars,s=y.hexOut;let t,e,n,l;for(l=0;l<4;l+=1)for(e=l*8,t=r[l],n=0;n<8;n+=2)s[e+1+n]=a.charAt(t&15),t>>>=4,s[e+0+n]=a.charAt(t&15),t>>>=4;return s.join("")}static _md5cycle(r,a){let s=r[0],t=r[1],e=r[2],n=r[3];s+=(t&e|~t&n)+a[0]-680876936|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[1]-389564586|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[2]+606105819|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[3]-1044525330|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+a[4]-176418897|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[5]+1200080426|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[6]-1473231341|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[7]-45705983|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+a[8]+1770035416|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[9]-1958414417|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[10]-42063|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[11]-1990404162|0,t=(t<<22|t>>>10)+e|0,s+=(t&e|~t&n)+a[12]+1804603682|0,s=(s<<7|s>>>25)+t|0,n+=(s&t|~s&e)+a[13]-40341101|0,n=(n<<12|n>>>20)+s|0,e+=(n&s|~n&t)+a[14]-1502002290|0,e=(e<<17|e>>>15)+n|0,t+=(e&n|~e&s)+a[15]+1236535329|0,t=(t<<22|t>>>10)+e|0,s+=(t&n|e&~n)+a[1]-165796510|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[6]-1069501632|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[11]+643717713|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[0]-373897302|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+a[5]-701558691|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[10]+38016083|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[15]-660478335|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[4]-405537848|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+a[9]+568446438|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[14]-1019803690|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[3]-187363961|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[8]+1163531501|0,t=(t<<20|t>>>12)+e|0,s+=(t&n|e&~n)+a[13]-1444681467|0,s=(s<<5|s>>>27)+t|0,n+=(s&e|t&~e)+a[2]-51403784|0,n=(n<<9|n>>>23)+s|0,e+=(n&t|s&~t)+a[7]+1735328473|0,e=(e<<14|e>>>18)+n|0,t+=(e&s|n&~s)+a[12]-1926607734|0,t=(t<<20|t>>>12)+e|0,s+=(t^e^n)+a[5]-378558|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[8]-2022574463|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[11]+1839030562|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[14]-35309556|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+a[1]-1530992060|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[4]+1272893353|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[7]-155497632|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[10]-1094730640|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+a[13]+681279174|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[0]-358537222|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[3]-722521979|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[6]+76029189|0,t=(t<<23|t>>>9)+e|0,s+=(t^e^n)+a[9]-640364487|0,s=(s<<4|s>>>28)+t|0,n+=(s^t^e)+a[12]-421815835|0,n=(n<<11|n>>>21)+s|0,e+=(n^s^t)+a[15]+530742520|0,e=(e<<16|e>>>16)+n|0,t+=(e^n^s)+a[2]-995338651|0,t=(t<<23|t>>>9)+e|0,s+=(e^(t|~n))+a[0]-198630844|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[7]+1126891415|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[14]-1416354905|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[5]-57434055|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+a[12]+1700485571|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[3]-1894986606|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[10]-1051523|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[1]-2054922799|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+a[8]+1873313359|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[15]-30611744|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[6]-1560198380|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[13]+1309151649|0,t=(t<<21|t>>>11)+e|0,s+=(e^(t|~n))+a[4]-145523070|0,s=(s<<6|s>>>26)+t|0,n+=(t^(s|~e))+a[11]-1120210379|0,n=(n<<10|n>>>22)+s|0,e+=(s^(n|~t))+a[2]+718787259|0,e=(e<<15|e>>>17)+n|0,t+=(n^(e|~s))+a[9]-343485551|0,t=(t<<21|t>>>11)+e|0,r[0]=s+r[0]|0,r[1]=t+r[1]|0,r[2]=e+r[2]|0,r[3]=n+r[3]|0}_dataLength=0;_bufferLength=0;_state=new Int32Array(4);_buffer=new ArrayBuffer(68);_buffer8;_buffer32;constructor(){this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(y.stateIdentity),this}appendStr(r){const a=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n;for(n=0;n<r.length;n+=1){if(e=r.charCodeAt(n),e<128)a[t++]=e;else if(e<2048)a[t++]=(e>>>6)+192,a[t++]=e&63|128;else if(e<55296||e>56319)a[t++]=(e>>>12)+224,a[t++]=e>>>6&63|128,a[t++]=e&63|128;else{if(e=(e-55296)*1024+(r.charCodeAt(++n)-56320)+65536,e>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");a[t++]=(e>>>18)+240,a[t++]=e>>>12&63|128,a[t++]=e>>>6&63|128,a[t++]=e&63|128}t>=64&&(this._dataLength+=64,y._md5cycle(this._state,s),t-=64,s[0]=s[16])}return this._bufferLength=t,this}appendAsciiStr(r){const a=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n=0;for(;;){for(e=Math.min(r.length-n,64-t);e--;)a[t++]=r.charCodeAt(n++);if(t<64)break;this._dataLength+=64,y._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}appendByteArray(r){const a=this._buffer8,s=this._buffer32;let t=this._bufferLength,e,n=0;for(;;){for(e=Math.min(r.length-n,64-t);e--;)a[t++]=r[n++];if(t<64)break;this._dataLength+=64,y._md5cycle(this._state,s),t=0}return this._bufferLength=t,this}getState(){const r=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[r[0],r[1],r[2],r[3]]}}setState(r){const a=r.buffer,s=r.state,t=this._state;let e;for(this._dataLength=r.length,this._bufferLength=r.buflen,t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],e=0;e<a.length;e+=1)this._buffer8[e]=a.charCodeAt(e)}end(r=!1){const a=this._bufferLength,s=this._buffer8,t=this._buffer32,e=(a>>2)+1;this._dataLength+=a;const n=this._dataLength*8;if(s[a]=128,s[a+1]=s[a+2]=s[a+3]=0,t.set(y.buffer32Identity.subarray(e),e),a>55&&(y._md5cycle(this._state,t),t.set(y.buffer32Identity)),n<=4294967295)t[14]=n;else{const l=n.toString(16).match(/(.*?)(.{0,8})$/);if(l===null)return r?_e:"";const u=parseInt(l[2],16),m=parseInt(l[1],16)||0;t[14]=u,t[15]=m}return y._md5cycle(this._state,t),r?this._state:y._hex(this._state)}}if(y.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");function Se(i){let r=i;i.match(/^([0-9a-f]{4}-?){8}$/)===null&&(r=y.hashStr(i)),r=r.replace(/[^0-9a-f]/g,"");let a=0;for(let s=0;s<r.length;s++)a+=parseInt(r.charAt(s),16);return a}function Y(i){const r=Pt(6),a=Se(i.toLocaleLowerCase());return r[a%r.length]}var Z={exports:{}},xe=Z.exports,tt;function Ae(){return tt||(tt=1,(function(i){(function(r){if(typeof a!="function"){var a=function(c){return c};a.nonNative=!0}const s=a("plaintext"),t=a("html"),e=a("comment"),n=/<(\w*)>/g,l=/<\/?([^\s\/>]+)/;function u(c,o,v){c=c||"",o=o||[],v=v||"";let _=d(o,v);return f(c,_)}function m(c,o){c=c||[],o=o||"";let v=d(c,o);return function(_){return f(_||"",v)}}u.init_streaming_mode=m;function d(c,o){return c=A(c),{allowable_tags:c,tag_replacement:o,state:s,tag_buffer:"",depth:0,in_quote_char:""}}function f(c,o){if(typeof c!="string")throw new TypeError("'html' parameter must be a string");let v=o.allowable_tags,_=o.tag_replacement,S=o.state,g=o.tag_buffer,C=o.depth,k=o.in_quote_char,I="";for(let j=0,ht=c.length;j<ht;j++){let b=c[j];if(S===s)b==="<"?(S=t,g+=b):I+=b;else if(S===t)switch(b){case"<":if(k)break;C++;break;case">":if(k)break;if(C){C--;break}k="",S=s,g+=">",v.has(h(g))?I+=g:I+=_,g="";break;case'"':case"'":b===k?k="":k=k||b,g+=b;break;case"-":g==="<!-"&&(S=e),g+=b;break;case" ":case`
`:if(g==="<"){S=s,I+="< ",g="";break}g+=b;break;default:g+=b;break}else S===e&&(b===">"?(g.slice(-2)=="--"&&(S=s),g=""):g+=b)}return o.state=S,o.tag_buffer=g,o.depth=C,o.in_quote_char=k,I}function A(c){let o=new Set;if(typeof c=="string"){let v;for(;v=n.exec(c);)o.add(v[1])}else!a.nonNative&&typeof c[a.iterator]=="function"?o=new Set(c):typeof c.forEach=="function"&&c.forEach(o.add,o);return o}function h(c){let o=l.exec(c);return o?o[1].toLowerCase():null}i.exports?i.exports=u:r.striptags=u})(xe)})(Z)),Z.exports}Ae();function ke(i,r){const a=(r?.size||64)<=64?64:512,s=r?.isGuest?"/guest":"",t=r?.isDarkTheme??G(document.body)?"/dark":"";return nt(`/avatar${s}/{user}/{size}${t}`,{user:i,size:a})}pt(gt);const Ue={data(){return{hasStatus:!1,userStatus:{status:null,message:null,icon:null}}},methods:{async fetchUserStatus(i){if(!i)return;const r=Tt();if(!(!Object.hasOwn(r,"user_status")||!r.user_status.enabled)&&F())try{const{data:a}=await st.get(yt("apps/user_status/api/v1/statuses/{userId}",{userId:i}));this.setUserStatus(a.ocs.data)}catch(a){if(a.response.status===404&&a.response.data.ocs?.data?.length===0)return;$.error("Failed to fetch user status",{error:a})}},setUserStatus({status:i,message:r,icon:a}){this.userStatus.status=i||"",this.userStatus.message=r||"",this.userStatus.icon=a||"",this.hasStatus=!!i}}},lt=dt("nextcloud").persist().build();function we(i){const r=lt.getItem("user-has-avatar."+i);return typeof r=="string"?!!r:null}function et(i,r){i&&lt.setItem("user-has-avatar."+i,r)}const Le={name:"NcAvatar",directives:{ClickOutside:ie},components:{IconDotsHorizontal:At,NcActions:xt,NcButton:kt,NcIconSvgWrapper:mt,NcLoadingIcon:qt,NcUserStatusIcon:Bt},mixins:[Ue],props:{url:{type:String,default:void 0},iconClass:{type:String,default:void 0},user:{type:String,default:void 0},hideStatus:{type:Boolean,default:!1},verboseStatus:{type:Boolean,default:!1},preloadedUserStatus:{type:Object,default:void 0},isGuest:{type:Boolean,default:!1},displayName:{type:String,default:void 0},size:{type:Number,default:32},noPlaceholder:{type:Boolean,default:!1},disableTooltip:{type:Boolean,default:!1},disableMenu:{type:Boolean,default:!1},tooltipMessage:{type:String,default:null},isNoUser:{type:Boolean,default:!1},menuContainer:{type:[Boolean,String,Object,Element],default:"body"}},setup(){return{isDarkTheme:re()}},data(){return{avatarUrlLoaded:null,avatarSrcSetLoaded:null,userDoesNotExist:!1,isAvatarLoaded:!1,isMenuLoaded:!1,contactsMenuLoading:!1,contactsMenuData:{},contactsMenuActions:[],contactsMenuOpenState:!1}},computed:{avatarAriaLabel(){if(this.hasMenu)return this.canDisplayUserStatus||this.showUserStatusIconOnAvatar?B("Avatar of {displayName}, {status}",{displayName:this.displayName??this.user,status:Wt(this.userStatus.status)}):B("Avatar of {displayName}",{displayName:this.displayName??this.user})},canDisplayUserStatus(){return!this.hideStatus&&this.hasStatus&&["online","away","busy","dnd"].includes(this.userStatus.status)},showUserStatusIconOnAvatar(){return!this.hideStatus&&!this.verboseStatus&&this.hasStatus&&this.userStatus.status!=="dnd"&&this.userStatus.icon},userIdentifier(){return this.isDisplayNameDefined?this.displayName:this.isUserDefined?this.user:""},isUserDefined(){return typeof this.user<"u"},isDisplayNameDefined(){return typeof this.displayName<"u"},isUrlDefined(){return typeof this.url<"u"},hasMenu(){return this.disableMenu?!1:this.isMenuLoaded?this.menu.length>0:!(this.user===F()?.uid||this.userDoesNotExist||this.url)},showInitials(){return!this.noPlaceholder&&this.userDoesNotExist&&!(this.iconClass||this.$slots.icon)},avatarStyle(){return{"--avatar-size":this.size+"px",lineHeight:this.showInitials?this.size+"px":0,fontSize:Math.round(this.size*.45)+"px"}},initialsWrapperStyle(){const{r:i,g:r,b:a}=Y(this.userIdentifier);return{backgroundColor:`rgba(${i}, ${r}, ${a}, 0.1)`}},initialsStyle(){const{r:i,g:r,b:a}=Y(this.userIdentifier);return{color:`rgb(${i}, ${r}, ${a})`}},tooltip(){return this.disableTooltip?null:this.tooltipMessage?this.tooltipMessage:this.displayName},initials(){let i="?";if(this.showInitials){const r=this.userIdentifier.trim();if(r==="")return i;const a=r.match(/[\p{L}\p{N}\s]/gu);if(!a)return i;const s=a.join(""),t=s.lastIndexOf(" ");i=String.fromCodePoint(s.codePointAt(0)),t!==-1&&(i=i.concat(String.fromCodePoint(s.codePointAt(t+1))))}return i.toLocaleUpperCase()},menu(){const i=this.contactsMenuActions.map(a=>{const s=ve(this.$router,a.hyperlink);return{ncActionComponent:s?Ht:Zt,ncActionComponentProps:s?{to:s,icon:a.icon}:{href:a.hyperlink,icon:a.icon},text:a.title}});for(const a of be(this.contactsMenuData))try{i.push({ncActionComponent:Gt,ncActionComponentProps:{onClick:()=>a.callback(this.contactsMenuData)},text:a.displayName(this.contactsMenuData),iconSvg:a.iconSvg(this.contactsMenuData)})}catch(s){$.error(`Failed to render ContactsMenu action ${a.id}`,{error:s,action:a})}function r(a){const s=document.createTextNode(a),t=document.createElement("p");return t.appendChild(s),t.innerHTML}if(!this.hideStatus&&(this.userStatus.icon||this.userStatus.message)){const a=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
					<text x="50%" y="50%" text-anchor="middle" style="dominant-baseline: central; font-size: 85%">${r(this.userStatus.icon)}</text>
				</svg>`;return[{ncActionComponent:ee,ncActionComponentProps:{},iconSvg:this.userStatus.icon?a:void 0,text:`${this.userStatus.message}`}].concat(i)}return i}},watch:{url(){this.userDoesNotExist=!1,this.loadAvatarUrl()},user(){this.userDoesNotExist=!1,this.isMenuLoaded=!1,this.loadAvatarUrl()}},mounted(){this.loadAvatarUrl(),T("settings:avatar:updated",this.loadAvatarUrl),T("settings:display-name:updated",this.loadAvatarUrl),!this.hideStatus&&this.user&&!this.isNoUser?(this.preloadedUserStatus?this.setUserStatus(this.preloadedUserStatus):this.fetchUserStatus(this.user),T("user_status:status.updated",this.handleUserStatusUpdated)):!this.hideStatus&&this.preloadedUserStatus&&this.setUserStatus(this.preloadedUserStatus)},beforeUnmount(){P("settings:avatar:updated",this.loadAvatarUrl),P("settings:display-name:updated",this.loadAvatarUrl),P("user_status:status.updated",this.handleUserStatusUpdated)},methods:{t:B,handleUserStatusUpdated(i){this.user===i.userId&&(this.userStatus={status:i.status,icon:i.icon,message:i.message},this.hasStatus=i.status!==null)},async toggleMenu(i){i.type==="keydown"&&i.key!=="Enter"||(this.contactsMenuOpenState||await this.fetchContactsMenu(),this.contactsMenuOpenState=!this.contactsMenuOpenState)},closeMenu(){this.contactsMenuOpenState=!1},async fetchContactsMenu(){this.contactsMenuLoading=!0;try{const i=encodeURIComponent(this.user),{data:r}=await st.post(nt("contactsmenu/findOne"),`shareType=0&shareWith=${i}`);this.contactsMenuData=r,this.contactsMenuActions=r.topAction?[r.topAction].concat(r.actions):r.actions}catch{this.contactsMenuOpenState=!1}this.contactsMenuLoading=!1,this.isMenuLoaded=!0},loadAvatarUrl(){if(this.isAvatarLoaded=!1,!this.isUrlDefined&&(!this.isUserDefined||this.isNoUser||this.iconClass||this.$slots.icon)){this.isAvatarLoaded=!0,this.userDoesNotExist=!0;return}if(this.isUrlDefined){this.updateImageIfValid(this.url);return}if(this.size<=64){const i=this.avatarUrlGenerator(this.user,64),r=[i+" 1x",this.avatarUrlGenerator(this.user,512)+" 8x"].join(", ");this.updateImageIfValid(i,r)}else{const i=this.avatarUrlGenerator(this.user,512);this.updateImageIfValid(i)}},avatarUrlGenerator(i,r){let a=ke(i,{size:r,isDarkTheme:this.isDarkTheme,isGuest:this.isGuest});return i===F()?.uid&&typeof oc_userconfig<"u"&&(a+="?v="+window.oc_userconfig.avatar.version),a},updateImageIfValid(i,r=null){const a=we(this.user);if(this.isUserDefined&&typeof a=="boolean"){this.isAvatarLoaded=!0,this.avatarUrlLoaded=i,r&&(this.avatarSrcSetLoaded=r),a===!1&&(this.userDoesNotExist=!0);return}const s=new Image;s.onload=()=>{this.avatarUrlLoaded=i,r&&(this.avatarSrcSetLoaded=r),this.isAvatarLoaded=!0,et(this.user,!0)},s.onerror=t=>{$.debug("[NcAvatar] Invalid avatar url",{error:t,url:i}),this.avatarUrlLoaded=null,this.avatarSrcSetLoaded=null,this.userDoesNotExist=!0,this.isAvatarLoaded=!1,et(this.user,!1)},r&&(s.srcset=r),s.src=i}}},Me=["title"],Ie=["src","srcset"],Ne={key:2,class:"avatardiv__user-status avatardiv__user-status--icon"};function Ce(i,r,a,s,t,e){const n=w("NcLoadingIcon"),l=w("IconDotsHorizontal"),u=w("NcButton"),m=w("NcIconSvgWrapper"),d=w("NcActions"),f=w("NcUserStatusIcon"),A=Ct("click-outside");return Dt((p(),x("span",{class:H(["avatardiv popovermenu-wrapper",{"avatardiv--unknown":t.userDoesNotExist,"avatardiv--with-menu":e.hasMenu,"avatardiv--with-menu-loading":t.contactsMenuLoading}]),style:E(e.avatarStyle),title:e.tooltip},[rt(i.$slots,"icon",{},()=>[a.iconClass?(p(),x("span",{key:0,class:H([a.iconClass,"avatar-class-icon"])},null,2)):t.isAvatarLoaded&&!t.userDoesNotExist?(p(),x("img",{key:1,src:t.avatarUrlLoaded,srcset:t.avatarSrcSetLoaded,alt:""},null,8,Ie)):M("",!0)],!0),e.hasMenu&&e.menu.length===0?(p(),L(u,{key:0,"aria-label":e.avatarAriaLabel,class:"action-item action-item__menutoggle",variant:"tertiary-no-background",onClick:e.toggleMenu},{icon:N(()=>[t.contactsMenuLoading?(p(),L(n,{key:0})):(p(),L(l,{key:1,size:20}))]),_:1},8,["aria-label","onClick"])):e.hasMenu?(p(),L(d,{key:1,open:t.contactsMenuOpenState,"onUpdate:open":r[0]||(r[0]=h=>t.contactsMenuOpenState=h),"aria-label":e.avatarAriaLabel,container:a.menuContainer,forceMenu:"",manualOpen:"",variant:"tertiary-no-background",onClick:e.toggleMenu},J({default:N(()=>[(p(!0),x(Ot,null,Et(e.menu,(h,c)=>(p(),L($t(h.ncActionComponent),zt({key:c},{ref_for:!0},h.ncActionComponentProps),J({default:N(()=>[jt(" "+U(h.text),1)]),_:2},[h.iconSvg?{name:"icon",fn:N(()=>[K(m,{svg:h.iconSvg},null,8,["svg"])]),key:"0"}:void 0]),1040))),128))]),_:2},[t.contactsMenuLoading?{name:"icon",fn:N(()=>[K(n)]),key:"0"}:void 0]),1032,["open","aria-label","container","onClick"])):M("",!0),e.showUserStatusIconOnAvatar?(p(),x("span",Ne,U(i.userStatus.icon),1)):e.canDisplayUserStatus?(p(),L(f,{key:3,class:"avatardiv__user-status",status:i.userStatus.status,"aria-hidden":String(e.hasMenu)},null,8,["status","aria-hidden"])):M("",!0),e.showInitials?(p(),x("span",{key:4,style:E(e.initialsWrapperStyle),class:"avatardiv__initials-wrapper"},[O("span",{style:E(e.initialsStyle),class:"avatardiv__initials"},U(e.initials),5)],4)):M("",!0)],14,Me)),[[A,e.closeMenu]])}const Ve=at(Le,[["render",Ce],["__scopeId","data-v-72a1eed6"]]);export{Q as E,Ve as N,ct as S,Ze as U,fe as a,Ue as b,ot as c,ve as g,me as p,qe as r,D as u,ge as v};
//# sourceMappingURL=NcAvatar-C9d7Wrc8-Z3WRb2CW.chunk.mjs.map
