import{a as w,b as h,o as g}from"./index-6_gsQFyp.chunk.mjs";import{d as y}from"./createElementId-DhjFt1I9-Bjk2333q.chunk.mjs";import{i as u,b}from"./index-xFugdZPW.chunk.mjs";import{a as E,u as D}from"./index-BlJ76-SL.chunk.mjs";import{l as m,N,a as $,b as T,P as i}from"./folder-CeyZUHai-CVGj8rKf.chunk.mjs";function R(e=""){let t=i.NONE;return e&&(e.includes("G")&&(t|=i.READ),e.includes("W")&&(t|=i.WRITE),e.includes("CK")&&(t|=i.CREATE),e.includes("NV")&&(t|=i.UPDATE),e.includes("D")&&(t|=i.DELETE),e.includes("R")&&(t|=i.SHARE)),t}const _=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],f={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"};function S(e,t={nc:"http://nextcloud.org/ns"}){typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[..._],window._nc_dav_namespaces={...f});const s={...window._nc_dav_namespaces,...t};if(window._nc_dav_properties.find(n=>n===e))return m.warn(`${e} already registered`,{prop:e}),!1;if(e.startsWith("<")||e.split(":").length!==2)return m.error(`${e} is not valid. See example: 'oc:fileid'`,{prop:e}),!1;const o=e.split(":")[0];return s[o]?(window._nc_dav_properties.push(e),window._nc_dav_namespaces=s,!0):(m.error(`${e} namespace unknown`,{prop:e,namespaces:s}),!1)}function W(){return typeof window._nc_dav_properties>"u"&&(window._nc_dav_properties=[..._]),window._nc_dav_properties.map(e=>`<${e} />`).join(" ")}function j(){return typeof window._nc_dav_namespaces>"u"&&(window._nc_dav_namespaces={...f}),Object.keys(window._nc_dav_namespaces).map(e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`).join(" ")}function x(){return u()?`/files/${b()}`:`/files/${w()?.uid}`}const A=x();function q(){const e=y("dav");return u()?e.replace("remote.php","public.php"):e}const v=q();function z(e=v,t={}){const s=E(e,{headers:t});function o(n){s.setHeaders({...t,"X-Requested-With":"XMLHttpRequest",requesttoken:n??""})}return g(o),o(h()),D().patch("fetch",(n,a)=>{const r=a.headers;return r?.method&&(a.method=r.method,delete r.method),fetch(n,a)}),s}function C(e,t=A,s=v){let o=w()?.uid;if(u())o=o??"anonymous";else if(!o)throw new Error("No user id found");const n=e.props,a=R(n?.permissions),r=String(n?.["owner-id"]||o),l=n.fileid||0,d=new Date(Date.parse(e.lastmod)),c=new Date(Date.parse(n.creationdate)),p={id:l,source:`${s}${e.filename}`,mtime:!isNaN(d.getTime())&&d.getTime()!==0?d:void 0,crtime:!isNaN(c.getTime())&&c.getTime()!==0?c:void 0,mime:e.mime||"application/octet-stream",displayname:n.displayname!==void 0?String(n.displayname):void 0,size:n?.size||Number.parseInt(n.getcontentlength||"0"),status:l<0?N.FAILED:void 0,permissions:a,owner:r,root:t,attributes:{...e,...n,hasPreview:n?.["has-preview"]}};return delete p.attributes?.props,e.type==="file"?new $(p):new T(p)}export{j as a,W as b,S as c,v as d,q as e,x as f,z as g,C as r};
//# sourceMappingURL=dav-B62B0Btx.chunk.mjs.map
