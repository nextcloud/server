(()=>{var e,t={17445(e,t,i){"use strict";var r,n,o,s,a=i(10810),d=i(61338),l=i(36520),c=i(380),u=i(20005),E=(i(53334),i(65606));function h(){if(n)return r;n=1;const e="object"==typeof E&&E.env&&E.env.NODE_DEBUG&&/\bsemver\b/i.test(E.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};return r=e}function p(){if(s)return o;s=1;const e=Number.MAX_SAFE_INTEGER||9007199254740991;return o={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:e,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}}Object.freeze({DEFAULT:"default",HIDDEN:"hidden"});var f,v,w,N,m,I,R,g,O,L,A,b,$,T={exports:{}};function _(){if(R)return I;R=1;const e=h(),{MAX_LENGTH:t,MAX_SAFE_INTEGER:i}=p(),{safeRe:r,t:n}=(f||(f=1,function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:n}=p(),o=h(),s=(t=e.exports={}).re=[],a=t.safeRe=[],d=t.src=[],l=t.safeSrc=[],c=t.t={};let u=0;const E="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",n],[E,r]],v=(e,t,i)=>{const r=(e=>{for(const[t,i]of f)e=e.split(`${t}*`).join(`${t}{0,${i}}`).split(`${t}+`).join(`${t}{1,${i}}`);return e})(t),n=u++;o(e,n,t),c[e]=n,d[n]=t,l[n]=r,s[n]=new RegExp(t,i?"g":void 0),a[n]=new RegExp(r,i?"g":void 0)};v("NUMERICIDENTIFIER","0|[1-9]\\d*"),v("NUMERICIDENTIFIERLOOSE","\\d+"),v("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${E}*`),v("MAINVERSION",`(${d[c.NUMERICIDENTIFIER]})\\.(${d[c.NUMERICIDENTIFIER]})\\.(${d[c.NUMERICIDENTIFIER]})`),v("MAINVERSIONLOOSE",`(${d[c.NUMERICIDENTIFIERLOOSE]})\\.(${d[c.NUMERICIDENTIFIERLOOSE]})\\.(${d[c.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASEIDENTIFIER",`(?:${d[c.NONNUMERICIDENTIFIER]}|${d[c.NUMERICIDENTIFIER]})`),v("PRERELEASEIDENTIFIERLOOSE",`(?:${d[c.NONNUMERICIDENTIFIER]}|${d[c.NUMERICIDENTIFIERLOOSE]})`),v("PRERELEASE",`(?:-(${d[c.PRERELEASEIDENTIFIER]}(?:\\.${d[c.PRERELEASEIDENTIFIER]})*))`),v("PRERELEASELOOSE",`(?:-?(${d[c.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${d[c.PRERELEASEIDENTIFIERLOOSE]})*))`),v("BUILDIDENTIFIER",`${E}+`),v("BUILD",`(?:\\+(${d[c.BUILDIDENTIFIER]}(?:\\.${d[c.BUILDIDENTIFIER]})*))`),v("FULLPLAIN",`v?${d[c.MAINVERSION]}${d[c.PRERELEASE]}?${d[c.BUILD]}?`),v("FULL",`^${d[c.FULLPLAIN]}$`),v("LOOSEPLAIN",`[v=\\s]*${d[c.MAINVERSIONLOOSE]}${d[c.PRERELEASELOOSE]}?${d[c.BUILD]}?`),v("LOOSE",`^${d[c.LOOSEPLAIN]}$`),v("GTLT","((?:<|>)?=?)"),v("XRANGEIDENTIFIERLOOSE",`${d[c.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),v("XRANGEIDENTIFIER",`${d[c.NUMERICIDENTIFIER]}|x|X|\\*`),v("XRANGEPLAIN",`[v=\\s]*(${d[c.XRANGEIDENTIFIER]})(?:\\.(${d[c.XRANGEIDENTIFIER]})(?:\\.(${d[c.XRANGEIDENTIFIER]})(?:${d[c.PRERELEASE]})?${d[c.BUILD]}?)?)?`),v("XRANGEPLAINLOOSE",`[v=\\s]*(${d[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[c.XRANGEIDENTIFIERLOOSE]})(?:\\.(${d[c.XRANGEIDENTIFIERLOOSE]})(?:${d[c.PRERELEASELOOSE]})?${d[c.BUILD]}?)?)?`),v("XRANGE",`^${d[c.GTLT]}\\s*${d[c.XRANGEPLAIN]}$`),v("XRANGELOOSE",`^${d[c.GTLT]}\\s*${d[c.XRANGEPLAINLOOSE]}$`),v("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),v("COERCE",`${d[c.COERCEPLAIN]}(?:$|[^\\d])`),v("COERCEFULL",d[c.COERCEPLAIN]+`(?:${d[c.PRERELEASE]})?(?:${d[c.BUILD]})?(?:$|[^\\d])`),v("COERCERTL",d[c.COERCE],!0),v("COERCERTLFULL",d[c.COERCEFULL],!0),v("LONETILDE","(?:~>?)"),v("TILDETRIM",`(\\s*)${d[c.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",v("TILDE",`^${d[c.LONETILDE]}${d[c.XRANGEPLAIN]}$`),v("TILDELOOSE",`^${d[c.LONETILDE]}${d[c.XRANGEPLAINLOOSE]}$`),v("LONECARET","(?:\\^)"),v("CARETTRIM",`(\\s*)${d[c.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",v("CARET",`^${d[c.LONECARET]}${d[c.XRANGEPLAIN]}$`),v("CARETLOOSE",`^${d[c.LONECARET]}${d[c.XRANGEPLAINLOOSE]}$`),v("COMPARATORLOOSE",`^${d[c.GTLT]}\\s*(${d[c.LOOSEPLAIN]})$|^$`),v("COMPARATOR",`^${d[c.GTLT]}\\s*(${d[c.FULLPLAIN]})$|^$`),v("COMPARATORTRIM",`(\\s*)${d[c.GTLT]}\\s*(${d[c.LOOSEPLAIN]}|${d[c.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",v("HYPHENRANGE",`^\\s*(${d[c.XRANGEPLAIN]})\\s+-\\s+(${d[c.XRANGEPLAIN]})\\s*$`),v("HYPHENRANGELOOSE",`^\\s*(${d[c.XRANGEPLAINLOOSE]})\\s+-\\s+(${d[c.XRANGEPLAINLOOSE]})\\s*$`),v("STAR","(<|>)?=?\\s*\\*"),v("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),v("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(T,T.exports)),T.exports),o=function(){if(w)return v;w=1;const e=Object.freeze({loose:!0}),t=Object.freeze({});return v=i=>i?"object"!=typeof i?e:i:t}(),{compareIdentifiers:s}=function(){if(m)return N;m=1;const e=/^[0-9]+$/,t=(t,i)=>{if("number"==typeof t&&"number"==typeof i)return t===i?0:t<i?-1:1;const r=e.test(t),n=e.test(i);return r&&n&&(t=+t,i=+i),t===i?0:r&&!n?-1:n&&!r?1:t<i?-1:1};return N={compareIdentifiers:t,rcompareIdentifiers:(e,i)=>t(i,e)}}();class a{constructor(s,d){if(d=o(d),s instanceof a){if(s.loose===!!d.loose&&s.includePrerelease===!!d.includePrerelease)return s;s=s.version}else if("string"!=typeof s)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof s}".`);if(s.length>t)throw new TypeError(`version is longer than ${t} characters`);e("SemVer",s,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const l=s.trim().match(d.loose?r[n.LOOSE]:r[n.FULL]);if(!l)throw new TypeError(`Invalid Version: ${s}`);if(this.raw=s,this.major=+l[1],this.minor=+l[2],this.patch=+l[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");l[4]?this.prerelease=l[4].split(".").map(e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<i)return t}return e}):this.prerelease=[],this.build=l[5]?l[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(e("SemVer.compare",this.version,this.options,t),!(t instanceof a)){if("string"==typeof t&&t===this.version)return 0;t=new a(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(e){return e instanceof a||(e=new a(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(t){if(t instanceof a||(t=new a(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let i=0;do{const r=this.prerelease[i],n=t.prerelease[i];if(e("prerelease compare",i,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return s(r,n)}while(++i)}compareBuild(t){t instanceof a||(t=new a(t,this.options));let i=0;do{const r=this.build[i],n=t.build[i];if(e("build compare",i,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return s(r,n)}while(++i)}inc(e,t,i){if(e.startsWith("pre")){if(!t&&!1===i)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?r[n.PRERELEASELOOSE]:r[n.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,i),this.inc("pre",t,i);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,i),this.inc("pre",t,i);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(i)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===i)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===i&&(r=[t]),0===s(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return I=a}function y(e,t,i){if(void 0!==e[t])if("array"===i){if(!Array.isArray(e[t]))throw new Error(`View ${t} must be an array`)}else{if(typeof e[t]!==i)throw new Error(`View ${t} must be a ${i}`);if("object"===i&&(null===e[t]||Array.isArray(e[t])))throw new Error(`View ${t} must be an object`)}}function P(e){if("object"!=typeof e||null===e)throw new Error("View column must be an object");if(!e.id||"string"!=typeof e.id)throw new Error("A column id is required");if(!e.title||"string"!=typeof e.title)throw new Error("A column title is required");if(!e.render||"function"!=typeof e.render)throw new Error("A render function is required");y(e,"sort","function"),y(e,"summary","function")}!function(){if(O)return g;O=1;const e=_();g=(t,i)=>new e(t,i).major}(),function(){if($)return b;$=1;const e=function(){if(A)return L;A=1;const e=_();return L=(t,i,r=!1)=>{if(t instanceof e)return t;try{return new e(t,i)}catch(e){if(!r)return null;throw e}}}();b=(t,i)=>{const r=e(t,i);return r?r.version:null}}(),c.m;class S extends c.m{_views=[];_currentView=null;register(e){if(this._views.find(t=>t.id===e.id))throw new Error(`IView id ${e.id} is already registered`);(function(e){if(!e.icon||"string"!=typeof e.icon||!(0,u.A)(e.icon))throw new Error("View icon is required and must be a valid svg string");if(!e.id||"string"!=typeof e.id)throw new Error("View id is required and must be a string");if(!e.getContents||"function"!=typeof e.getContents)throw new Error("View getContents is required and must be a function");if(!e.name||"string"!=typeof e.name)throw new Error("View name is required and must be a string");if(y(e,"caption","string"),y(e,"columns","array"),y(e,"defaultSortKey","string"),y(e,"emptyCaption","string"),y(e,"emptyTitle","string"),y(e,"emptyView","function"),y(e,"expanded","boolean"),y(e,"hidden","boolean"),y(e,"loadChildViews","function"),y(e,"order","number"),y(e,"params","object"),y(e,"parent","string"),y(e,"sticky","boolean"),e.columns&&(e.columns.forEach(P),e.columns.reduce((e,t)=>e.add(t.id),new Set).size!==e.columns.length))throw new Error("View columns must have unique ids")})(e),this._views.push(e),this.dispatchTypedEvent("update",new CustomEvent("update"))}remove(e){const t=this._views.findIndex(t=>t.id===e);-1!==t&&(this._views.splice(t,1),this.dispatchTypedEvent("update",new CustomEvent("update")))}setActive(e){if(null===e)this._currentView=null;else{const t=this._views.find(({id:t})=>t===e);if(!t)throw new Error(`No view with ${e} registered`);this._currentView=t}const t=new CustomEvent("updateActive",{detail:this._currentView});this.dispatchTypedEvent("updateActive",t)}get active(){return this._currentView}get views(){return this._views}}function C(){return void 0===window._nc_navigation&&(window._nc_navigation=new S,l.l.debug("Navigation service initialized")),window._nc_navigation}Object.freeze({UploadFromDevice:0,CreateNew:1,Other:2}),Object.freeze({ReservedName:"reserved name",Character:"character",Extension:"extension"}),Error,Object.freeze({Name:"basename",Modified:"mtime",Size:"size"});var F=i(85471);const D=(0,i(35947).YK)().setApp("files").detectUser().build(),G=(0,a.nY)("active",()=>{const e=(0,F.KR)(),t=(0,F.KR)(),i=(0,F.KR)(),r=(0,F.KR)();function n(e){i.value&&i.value.source===e.source&&(i.value=void 0)}function o(e=null){D.debug("Setting active view",{view:e}),r.value=e??void 0,i.value=void 0}return(0,F.wB)(i,()=>{"number"==typeof i.value?.fileid&&i.value.fileid!==t.value?.fileid&&(D.debug("Updating active fileid in URL query",{fileid:i.value.fileid}),window.OCP.Files.Router.goToRoute(null,{...window.OCP.Files.Router.params,fileid:String(i.value.fileid)},{...window.OCP.Files.Router.query},!0))}),function(){const e=C();o(e.active),(0,d.B1)("files:node:deleted",n),e.addEventListener("updateActive",e=>{o(e.detail)})}(),{activeAction:e,activeFolder:t,activeNode:i,activeView:r}});var M=i(21777),U=i(63814),j=i(32505),B=i(44719);const V=["d:getcontentlength","d:getcontenttype","d:getetag","d:getlastmodified","d:creationdate","d:displayname","d:quota-available-bytes","d:resourcetype","nc:has-preview","nc:is-encrypted","nc:mount-type","oc:comments-unread","oc:favorite","oc:fileid","oc:owner-display-name","oc:owner-id","oc:permissions","oc:size"],X={d:"DAV:",nc:"http://nextcloud.org/ns",oc:"http://owncloud.org/ns",ocs:"http://open-collaboration-services.org/ns"};function x(){return(0,j.f)()?`/files/${(0,j.G)()}`:`/files/${(0,M.HW)()?.uid}`}const q=x(),z=function(){const e=(0,U.dC)("dav");return(0,j.f)()?e.replace("remote.php","public.php"):e}();const k=function(e=z,t={}){const i=(0,B.UU)(e,{headers:t});function r(e){i.setHeaders({...t,"X-Requested-With":"XMLHttpRequest",requesttoken:e??""})}return(0,M.zo)(r),r((0,M.do)()),(0,B.Gu)().patch("fetch",(e,t)=>{const i=t.headers;return i?.method&&(t.method=i.method,delete i.method),fetch(e,t)}),i}();async function H(e){const t=`<?xml version="1.0"?>\n\t\t<d:propfind ${void 0===window._nc_dav_namespaces&&(window._nc_dav_namespaces={...X}),Object.keys(window._nc_dav_namespaces).map(e=>`xmlns:${e}="${window._nc_dav_namespaces?.[e]}"`).join(" ")}>\n\t\t\t<d:prop>\n\t\t\t\t${void 0===window._nc_dav_properties&&(window._nc_dav_properties=[...V]),window._nc_dav_properties.map(e=>`<${e} />`).join(" ")}\n\t\t\t</d:prop>\n\t\t</d:propfind>`;return function(e,t=q,i=z){let r=(0,M.HW)()?.uid;if((0,j.f)())r=r??"anonymous";else if(!r)throw new Error("No user id found");const n=e.props,o=function(e=""){let t=l.P.NONE;return e?(e.includes("G")&&(t|=l.P.READ),e.includes("W")&&(t|=l.P.WRITE),e.includes("CK")&&(t|=l.P.CREATE),e.includes("NV")&&(t|=l.P.UPDATE),e.includes("D")&&(t|=l.P.DELETE),e.includes("R")&&(t|=l.P.SHARE),t):t}(n?.permissions),s=String(n?.["owner-id"]||r),a=n.fileid||0,d=new Date(Date.parse(e.lastmod)),c=new Date(Date.parse(n.creationdate)),u={id:a,source:`${i}${e.filename}`,mtime:isNaN(d.getTime())||0===d.getTime()?void 0:d,crtime:isNaN(c.getTime())||0===c.getTime()?void 0:c,mime:e.mime||"application/octet-stream",displayname:void 0!==n.displayname?String(n.displayname):void 0,size:n?.size||Number.parseInt(n.getcontentlength||"0"),status:a<0?l.c.FAILED:void 0,permissions:o,owner:s,root:t,attributes:{...e,...n,hasPreview:n?.["has-preview"]}};return delete u.attributes?.props,"file"===e.type?new l.a(u):new l.b(u)}((await k.stat(`${x()}${e}`,{details:!0,data:t})).data)}var W=i(71225);function K(...e){const t=(0,a.nY)("files",{state:()=>({files:{},roots:{}}),getters:{getNode:e=>t=>e.files[t],getNodes:e=>t=>t.map(t=>e.files[t]).filter(Boolean),getNodesById:e=>t=>Object.values(e.files).filter(e=>e.fileid===t),getRoot:e=>t=>e.roots[t]},actions:{getDirectoryByPath(e,t){const i=function(...e){const t=K(...e),i=(0,a.nY)("paths",{state:()=>({paths:{}}),getters:{getPath:e=>(t,i)=>{if(e.paths[t])return e.paths[t][i]}},actions:{addPath(e){this.paths[e.service]||F.Ay.set(this.paths,e.service,{}),F.Ay.set(this.paths[e.service],e.path,e.source)},deletePath(e,t){this.paths[e]&&F.Ay.delete(this.paths[e],t)},onCreatedNode(e){const t=C()?.active?.id||"files";e.fileid?(e.type===l.F.Folder&&this.addPath({service:t,path:e.path,source:e.source}),this.addNodeToParentChildren(e)):D.error("Node has no fileid",{node:e})},onDeletedNode(e){const t=C()?.active?.id||"files";e.type===l.F.Folder&&this.deletePath(t,e.path),this.deleteNodeFromParentChildren(e)},onMovedNode({node:e,oldSource:t}){const i=C()?.active?.id||"files";if(e.type===l.F.Folder){const r=Object.entries(this.paths[i]).find(([,e])=>e===t);r?.[0]&&this.deletePath(i,r[0]),this.addPath({service:i,path:e.path,source:e.source})}const r=new l.a({source:t,owner:e.owner,mime:e.mime,root:e.root});this.deleteNodeFromParentChildren(r),this.addNodeToParentChildren(e)},deleteNodeFromParentChildren(e){const i=C()?.active?.id||"files",r=(0,W.pD)(e.source),n="/"===e.dirname?t.getRoot(i):t.getNode(r);if(n){const t=new Set(n._children??[]);return t.delete(e.source),F.Ay.set(n,"_children",[...t.values()]),void D.debug("Children updated",{parent:n,node:e,children:n._children})}D.debug("Parent path does not exists, skipping children update",{node:e})},addNodeToParentChildren(e){const i=C()?.active?.id||"files",r=(0,W.pD)(e.source),n="/"===e.dirname?t.getRoot(i):t.getNode(r);if(n){const t=new Set(n._children??[]);return t.add(e.source),F.Ay.set(n,"_children",[...t.values()]),void D.debug("Children updated",{parent:n,node:e,children:n._children})}D.debug("Parent path does not exists, skipping children update",{node:e})}}})(...e);return i._initialized||((0,d.B1)("files:node:created",i.onCreatedNode),(0,d.B1)("files:node:deleted",i.onDeletedNode),(0,d.B1)("files:node:moved",i.onMovedNode),i._initialized=!0),i}();let r;if(t&&"/"!==t){const n=i.getPath(e,t);n&&(r=this.getNode(n))}else r=this.getRoot(e);return r},getNodesByPath(e,t){const i=this.getDirectoryByPath(e,t);return(i?._children??[]).map(e=>this.getNode(e)).filter(Boolean)},updateNodes(e){const t=e.reduce((e,t)=>t.fileid?(e[t.source]=t,e):(D.error("Trying to update/set a node without fileid",{node:t}),e),{});F.Ay.set(this,"files",{...this.files,...t})},deleteNodes(e){e.forEach(e=>{e.source&&F.Ay.delete(this.files,e.source)})},setRoot({service:e,root:t}){F.Ay.set(this.roots,e,t)},onDeletedNode(e){this.deleteNodes([e])},onCreatedNode(e){this.updateNodes([e])},onMovedNode({node:e,oldSource:t}){e.fileid?(F.Ay.delete(this.files,t),this.updateNodes([e])):D.error("Trying to update/set a node without fileid",{node:e})},async onUpdatedNode(e){if(!e.fileid)return void D.error("Trying to update/set a node without fileid",{node:e});const t=this.getNodesById(e.fileid);if(t.length>1)return await Promise.all(t.map(e=>H(e.path))).then(this.updateNodes),void D.debug(t.length+" nodes updated in store",{fileid:e.fileid});1!==t.length||e.source!==t[0].source?H(e.path).then(e=>this.updateNodes([e])):this.updateNodes([e])},onAddFavorite(e){const t=this.getNode(e.source);t&&F.Ay.set(t.attributes,"favorite",1)},onRemoveFavorite(e){const t=this.getNode(e.source);t&&F.Ay.set(t.attributes,"favorite",0)}}}),i=t(...e);return i._initialized||((0,d.B1)("files:node:created",i.onCreatedNode),(0,d.B1)("files:node:deleted",i.onDeletedNode),(0,d.B1)("files:node:updated",i.onUpdatedNode),(0,d.B1)("files:node:moved",i.onMovedNode),(0,d.B1)("files:favorites:added",i.onAddFavorite),(0,d.B1)("files:favorites:removed",i.onRemoveFavorite),i._initialized=!0),i}const Y=(0,a.nY)("sidebar",()=>{const e=(0,F.KR)(),t=(0,F.KR)(!1),i=G(),r=(0,F.EW)(()=>t.value?i.activeNode:void 0),n=(0,F.EW)(()=>!!(r.value&&i.activeFolder&&i.activeView)),o=(0,F.EW)(()=>{if(n.value)return{node:r.value,folder:i.activeFolder,view:i.activeView}}),s=(0,F.EW)(()=>o.value?E(o.value):[]),a=(0,F.EW)(()=>o.value?u(o.value):[]);function l(n,o){if(!(n&&i.activeFolder&&i.activeView))throw D.debug("sidebar: cannot open sidebar because the active folder or view is not set.",{node:n,activeFolder:i.activeFolder,activeView:i.activeView}),new Error("Cannot open sidebar because the active folder or view is not set.");if(t.value&&r.value?.source===n.source)return D.debug("sidebar: already open for current node"),void(o&&(D.debug("sidebar: already open for current node - switching tab",{tabId:o}),h(o)));const s=u({node:n,folder:i.activeFolder,view:i.activeView});o&&!s.find(({id:e})=>e===o)?(D.warn(`sidebar: cannot open tab '${o}' because it is not available for the current context.`),e.value=s[0]?.id):e.value=o??s[0]?.id,D.debug(`sidebar: opening for ${n.displayname}`,{node:n}),i.activeNode=n,t.value=!0}function c(){t.value=!1}function u(e){let t=window._nc_files_sidebar_tabs?[...window._nc_files_sidebar_tabs.values()]:[];return e&&(t=t.filter(t=>void 0===t.enabled||t.enabled(e))),t.sort((e,t)=>e.order-t.order)}function E(e){let t=window._nc_files_sidebar_actions?[...window._nc_files_sidebar_actions.values()]:[];return e&&(t=t.filter(t=>void 0===t.enabled||t.enabled(e))),t.sort((e,t)=>e.order-t.order)}function h(t){if(!a.value.find(({id:e})=>e===t))throw new Error(`Cannot set sidebar tab '${t}' because it is not available for the current context.`);e.value=t}(0,d.B1)("files:node:updated",e=>{e.source===r.value?.source&&(i.activeNode=e)}),(0,d.B1)("files:node:deleted",e=>{e.fileid===r.value?.fileid&&c()}),(0,d.B1)("viewer:sidebar:open",({source:e})=>{const t=K().getNode(e);t?(D.debug("sidebar: opening for node from Viewer.",{node:t}),l(t)):D.error(`sidebar: cannot open for node '${e}' because it was not found in the current view.`)});let p=!1;return(0,d.B1)("files:list:updated",()=>{p||(p=!0,window.OCP.Files.Router._router.afterEach((e,t)=>{t.query&&"opendetails"in t.query&&e.query&&!("opendetails"in e.query)&&(D.debug('sidebar: closing because "opendetails" query parameter was removed from URL.'),c())}))}),(0,F.wB)(t,e=>{const t={...window.OCP?.Files?.Router?.params??{}},r={...window.OCP?.Files?.Router?.query??{}};D.debug("sidebar: current node changed: "+(e?"open":"closed"),{query:r,params:t,node:i.activeNode}),!e&&"opendetails"in r&&(delete r.opendetails,window.OCP.Files.Router.goToRoute(null,t,r,!0)),e&&!("opendetails"in r)&&window.OCP.Files.Router.goToRoute(null,t,{...r,opendetails:"true"},!0)}),{activeTab:e,currentActions:s,currentContext:o,currentNode:r,currentTabs:a,hasContext:n,isOpen:(0,F.tB)(t),open:l,close:c,getActions:E,getTabs:u,setActiveTab:h}});window.OCA.Files??={},window.OCA.Files._sidebar=()=>Y((window._nc_files_pinia||(window._nc_files_pinia=(0,a.Ey)()),window._nc_files_pinia))},63779(){},77199(){}},i={};function r(e){var n=i[e];if(void 0!==n)return n.exports;var o=i[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}r.m=t,e=[],r.O=(t,i,n,o)=>{if(!i){var s=1/0;for(c=0;c<e.length;c++){for(var[i,n,o]=e[c],a=!0,d=0;d<i.length;d++)(!1&o||s>=o)&&Object.keys(r.O).every(e=>r.O[e](i[d]))?i.splice(d--,1):(a=!1,o<s&&(s=o));if(a){e.splice(c--,1);var l=n();void 0!==l&&(t=l)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[i,n,o]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.e=()=>Promise.resolve(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r.j=4763,(()=>{r.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={4763:0};r.O.j=t=>0===e[t];var t=(t,i)=>{var n,o,[s,a,d]=i,l=0;if(s.some(t=>0!==e[t])){for(n in a)r.o(a,n)&&(r.m[n]=a[n]);if(d)var c=d(r)}for(t&&t(i);l<s.length;l++)o=s[l],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return r.O(c)},i=globalThis.webpackChunknextcloud_ui_legacy=globalThis.webpackChunknextcloud_ui_legacy||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),r.nc=void 0;var n=r.O(void 0,[4208],()=>r(17445));n=r.O(n)})();
//# sourceMappingURL=files-sidebar.js.map?v=83ef26e59294d3c57faa