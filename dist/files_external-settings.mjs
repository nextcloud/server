import{d as he,c as xe}from"./pinia-4X7ao4YL.chunk.mjs";import{I as we,n as C,a3 as K,a6 as z,b as $,i as B,r as M,c as k,o as u,u as e,m as L,j as Q,v as h,x as T,y as x,B as y,t as v,F as S,N as ke,C as q,E as Z,G as W,a1 as ne,e as b,w,g as V,U as I,H as Ve,h as Se}from"./index-B3fM9XzM.chunk.mjs";import{t as n,l as A,w as Ce,x as Me,y as Ae,z as Ue,n as $e,A as Te,B as qe,k as Ee}from"./mdi-C6koAnlx.chunk.mjs";import{c as P,a as F,N as oe}from"./NcNoteCard-CVhtNL04-NCMYExJH.chunk.mjs";import"./index-BdHmWgGI.chunk.mjs";import{N as ue}from"./ContentCopy-DrdgsUBE.chunk.mjs";import{k as Oe,N as Pe,a as Ne,c as X,s as ee}from"./index-JpgrUA2Z-Bk1urlYU.chunk.mjs";import{N as ae}from"./NcSelect-Czzsi3P_-j-TCAwKy.chunk.mjs";import{_ as de}from"./TrashCanOutline-Dk8zzxc0.chunk.mjs";import{c as U}from"./index-Bis6vWHp.chunk.mjs";import{c as R}from"./createElementId-DhjFt1I9-DYB7_VOD.chunk.mjs";import{N as Re,a as Fe}from"./index-crm_MODs.chunk.mjs";import"./NcDateTime.vue_vue_type_script_setup_true_lang-BhB8yA4U-DJmI9Yye.chunk.mjs";import"./NcBreadcrumbs-DYfGaSjT-CltSOjzZ.chunk.mjs";import"./NcAvatar-DmUGApWA-CmSa2UB1.chunk.mjs";import"./NcRichText-CBMtJzE_-B1C-Mutf.chunk.mjs";import{N as ce}from"./PencilOutline-BIuFAr5N.chunk.mjs";import{_ as E}from"./string_decoder-CW7-7cc6.chunk.mjs";import{N}from"./NcCheckboxRadioSwitch-BCSKF7Tk-DXNr2PG3.chunk.mjs";import"./NcColorPicker-Kc0JqRtp-B_h-me5d.chunk.mjs";import"./TrayArrowDown-COzRkOJV.chunk.mjs";import"./NcEmojiPicker-pM4Pg2yq-B8mYNXCM.chunk.mjs";/* empty css                                       */import"./NcInputField-Bwsh2aHY-kFLkLvp0.chunk.mjs";import{N as Be}from"./NcPasswordField-djttkA5Q-e7dmiHhR.chunk.mjs";import{N as je}from"./NcUserBubble-DPAmU2_J-BAB1Topn.chunk.mjs";import"./NcUserStatusIcon-CGEf7fej-rG0Zbhsv.chunk.mjs";import"./colors-Go3zmZRD-DopeMbFY.chunk.mjs";import{_ as _e}from"./AuthMechanismRsa-DD54DKdW.chunk.mjs";import{C as H,a as me,M as j,S as D,b as De,c as He}from"./types-BHxjmIdN.chunk.mjs";import{a as pe,P as G}from"./index-DMhzLSXM.chunk.mjs";import{l as fe}from"./logger-or2fwppf.chunk.mjs";import"./index-BMztHQmx.chunk.mjs";const Ge='<svg xmlns="http://www.w3.org/2000/svg" id="mdi-account-group-outline" viewBox="0 0 24 24"><path d="M12,5A3.5,3.5 0 0,0 8.5,8.5A3.5,3.5 0 0,0 12,12A3.5,3.5 0 0,0 15.5,8.5A3.5,3.5 0 0,0 12,5M12,7A1.5,1.5 0 0,1 13.5,8.5A1.5,1.5 0 0,1 12,10A1.5,1.5 0 0,1 10.5,8.5A1.5,1.5 0 0,1 12,7M5.5,8A2.5,2.5 0 0,0 3,10.5C3,11.44 3.53,12.25 4.29,12.68C4.65,12.88 5.06,13 5.5,13C5.94,13 6.35,12.88 6.71,12.68C7.08,12.47 7.39,12.17 7.62,11.81C6.89,10.86 6.5,9.7 6.5,8.5C6.5,8.41 6.5,8.31 6.5,8.22C6.2,8.08 5.86,8 5.5,8M18.5,8C18.14,8 17.8,8.08 17.5,8.22C17.5,8.31 17.5,8.41 17.5,8.5C17.5,9.7 17.11,10.86 16.38,11.81C16.5,12 16.63,12.15 16.78,12.3C16.94,12.45 17.1,12.58 17.29,12.68C17.65,12.88 18.06,13 18.5,13C18.94,13 19.35,12.88 19.71,12.68C20.47,12.25 21,11.44 21,10.5A2.5,2.5 0 0,0 18.5,8M12,14C9.66,14 5,15.17 5,17.5V19H19V17.5C19,15.17 14.34,14 12,14M4.71,14.55C2.78,14.78 0,15.76 0,17.5V19H3V17.07C3,16.06 3.69,15.22 4.71,14.55M19.29,14.55C20.31,15.22 21,16.06 21,17.07V19H24V17.5C24,15.76 21.22,14.78 19.29,14.55M12,16C13.53,16 15.24,16.5 16.23,17H7.77C8.76,16.5 10.47,16 12,16Z" /></svg>',Y=we(new Map);function ge(s){const a=C(()=>K(s).map(l=>({id:`user:${l}`,user:l,displayName:Y.get(l)||l})));return z(async()=>{const l=K(s).filter(r=>!Y.has(r));if(l.length>0){const{data:r}=await U.post(R("/displaynames"),{users:l});for(const[c,_]of Object.entries(r.users))Y.set(c,_)}}),a}function Ie(s){return C(()=>K(s).map(ve))}function ve(s){return{id:s,isNoUser:!0,displayName:s,iconSvg:Ge}}const Qe=$({__name:"ApplicableEntities",props:{groups:{default:()=>[]},groupsModifiers:{},users:{default:()=>[]},usersModifiers:{}},emits:["update:groups","update:users"],setup(s){const a=B(s,"groups"),l=B(s,"users"),r=M([]),c=ge(l),_=Ie(a),o=C({get(){return[..._.value,...c.value]},set(p){l.value=p.filter(d=>d.user).map(d=>d.user),a.value=p.filter(d=>d.isNoUser).map(d=>d.id)}}),i=Oe(t,500);async function t(p){const{data:d}=await U.get(R("apps/files_external/ajax/applicable"),{params:{pattern:p,limit:20}}),m=[...r.value.map(f=>[f.id,f]),...Object.entries(d.groups).map(([f,g])=>[f,{...ve(f),displayName:g}]),...Object.entries(d.users).map(([f,g])=>[`user:${f}`,{id:`user:${f}`,user:f,displayName:g}])];r.value=[...new Map(m).values()]}return(p,d)=>(u(),k(e(Re),{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=m=>o.value=m),"keep-open":"",multiple:"",options:r.value,"input-label":e(n)("files_external","Restrict to"),onSearch:e(i)},null,8,["modelValue","options","input-label","onSearch"]))}}),Le=$({__name:"AuthMechanismConfiguration",props:L({authMechanism:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const a=B(s,"modelValue"),l=s,r=C(()=>{if(!l.authMechanism.configuration)return;const t=Object.entries(l.authMechanism.configuration).filter(([,p])=>!(p.flags&H.UserProvided));return Object.fromEntries(t)}),c=C(()=>window.OCA.FilesExternal.AuthMechanism.getHandler(l.authMechanism)),_=C(()=>{if(!r.value)return!1;for(const t of Object.values(r.value))if(!(t.flags&H.Hidden||t.flags&H.UserProvided))return!0;return!1}),o=M(!1);z(async()=>{c.value&&(o.value=!0,await window.customElements.whenDefined(c.value.tagName),o.value=!1)}),Q(r,()=>{for(const t in r.value)t in a.value||(a.value[t]=r.value[t]?.type===me.Boolean?!1:"")});function i(t){const p=[t.detail].flat()[0];a.value={...a.value,...p}}return(t,p)=>_.value?(u(),h("fieldset",{key:0,class:x(t.$style.authMechanismConfiguration)},[y("legend",null,v(e(n)("files_external","Authentication")),1),c.value?(u(),h(S,{key:0},[o.value?(u(),k(e(ce),{key:0})):(u(),k(ke(c.value.tagName),{key:1,".modelValue":a.value,".authMechanism":s.authMechanism,"onUpdate:modelValue":i},null,40,[".modelValue",".authMechanism"]))],64)):(u(!0),h(S,{key:1},q(r.value,(d,m)=>Z((u(),k(_e,{key:d.value,modelValue:a.value[m],"onUpdate:modelValue":f=>a.value[m]=f,"config-key":m,"config-option":d},null,8,["modelValue","onUpdate:modelValue","config-key","config-option"])),[[W,!(d.flags&e(H).Hidden)]])),128))],2)):T("",!0)}}),ze="_authMechanismConfiguration_kpcpy_2",Ze={authMechanismConfiguration:ze},We={$style:Ze},Ye=E(Le,[["__cssModules",We]]),Je=$({__name:"BackendConfiguration",props:L({configuration:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const a=B(s,"modelValue"),l=s;return Q(()=>l.configuration,()=>{for(const r in l.configuration)r in a.value||(a.value[r]=l.configuration[r]?.type===me.Boolean?!1:"")}),(r,c)=>(u(),h("fieldset",{class:x(r.$style.backendConfiguration)},[y("legend",null,v(e(n)("files_external","Storage configuration")),1),(u(!0),h(S,null,q(s.configuration,(_,o)=>Z((u(),k(_e,{key:_.value,modelValue:a.value[o],"onUpdate:modelValue":i=>a.value[o]=i,"config-key":o,"config-option":_},null,8,["modelValue","onUpdate:modelValue","config-key","config-option"])),[[W,!(_.flags&e(H).Hidden)]])),128))],2))}}),Ke="_backendConfiguration_1sf6y_2",Xe={backendConfiguration:Ke},ea={$style:Xe},aa=E(Je,[["__cssModules",ea]]),la=["id","aria-labelledby"],ta=$({__name:"MountOptions",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(s){const a=B(s,"modelValue");z(()=>{Object.keys(a.value).length===0&&(a.value.encrypt=!0,a.value.previews=!0,a.value.enable_sharing=!1,a.value.filesystem_check_changes=j.OncePerRequest,a.value.encoding_compatibility=!1,a.value.readonly=!1)});const{hasEncryption:l}=A("files_external","settings"),r=ne(),c=ne(),_=M(!1),o=[{label:n("files_external","Never"),value:j.Never},{label:n("files_external","Once every direct access"),value:j.OncePerRequest},{label:n("files_external","Always"),value:j.Always}],i=C({get(){return o.find(t=>t.value===a.value.filesystem_check_changes)},set(t){a.value.filesystem_check_changes=t?.value??j.OncePerRequest}});return(t,p)=>(u(),h("div",{class:x(t.$style.mountOptions)},[b(e(P),{id:e(r),"aria-controls":e(c),"aria-expanded":_.value,variant:"tertiary-no-background",onClick:p[0]||(p[0]=d=>_.value=!_.value)},{icon:w(()=>[b(e(F),{directional:"",path:_.value?e(Ce):e(Me)},null,8,["path"])]),default:w(()=>[V(" "+v(e(n)("files_external","Mount options")),1)]),_:1},8,["id","aria-controls","aria-expanded"]),Z(y("fieldset",{id:e(c),class:x(t.$style.mountOptions__fieldset),"aria-labelledby":e(r)},[b(e(ae),{modelValue:i.value,"onUpdate:modelValue":p[1]||(p[1]=d=>i.value=d),"input-label":e(n)("files_external","Check filesystem changes"),options:o},null,8,["modelValue","input-label"]),b(e(N),{modelValue:s.modelValue.readonly,"onUpdate:modelValue":p[2]||(p[2]=d=>s.modelValue.readonly=d),type:"switch"},{default:w(()=>[V(v(e(n)("files_external","Read only")),1)]),_:1},8,["modelValue"]),b(e(N),{modelValue:s.modelValue.previews,"onUpdate:modelValue":p[3]||(p[3]=d=>s.modelValue.previews=d),type:"switch"},{default:w(()=>[V(v(e(n)("files_external","Enable previews")),1)]),_:1},8,["modelValue"]),b(e(N),{modelValue:s.modelValue.enable_sharing,"onUpdate:modelValue":p[4]||(p[4]=d=>s.modelValue.enable_sharing=d),type:"switch"},{default:w(()=>[V(v(e(n)("files_external","Enable sharing")),1)]),_:1},8,["modelValue"]),e(l)?(u(),k(e(N),{key:0,modelValue:s.modelValue.encrypt,"onUpdate:modelValue":p[5]||(p[5]=d=>s.modelValue.encrypt=d),type:"switch"},{default:w(()=>[V(v(e(n)("files_external","Enable encryption")),1)]),_:1},8,["modelValue"])):T("",!0),b(e(N),{modelValue:s.modelValue.encoding_compatibility,"onUpdate:modelValue":p[6]||(p[6]=d=>s.modelValue.encoding_compatibility=d),type:"switch"},{default:w(()=>[V(v(e(n)("files_external","Compatibility with Mac NFD encoding (slow)")),1)]),_:1},8,["modelValue"])],10,la),[[W,_.value]])],2))}}),sa="_mountOptions_1fqyb_2",na="_mountOptions__fieldset_1fqyb_12",oa={mountOptions:sa,mountOptions__fieldset:na},ia={$style:oa},ra=E(ta,[["__cssModules",ia]]),{isAdmin:ie}=A("files_external","settings"),ua=A("files_external","allowedBackends"),re=A("files_external","backends").filter(s=>ua.includes(s.identifier)),da=A("files_external","authMechanisms"),ca=$({__name:"AddExternalStorageDialog",props:L({storage:{default:()=>({backendOptions:{},mountOptions:{},type:ie?"system":"personal"})}},{open:{type:Boolean,default:!0},openModifiers:{}}),emits:L(["close"],["update:open"]),setup(s){const a=B(s,"open"),l=M(structuredClone(I(s.storage)));z(()=>{a.value&&(l.value=structuredClone(I(s.storage)))});const r=C({get(){return re.find(o=>o.identifier===l.value.backend)},set(o){l.value.backend=o?.identifier}}),c=C(()=>da.filter(({scheme:o})=>r.value?.authSchemes[o])),_=C({get(){return c.value.find(o=>o.identifier===l.value.authMechanism)},set(o){l.value.authMechanism=o?.identifier}});return Q(c,()=>{c.value.length===1&&(l.value.authMechanism=c.value[0].identifier)}),(o,i)=>(u(),k(e(Pe),{open:a.value,"onUpdate:open":[i[9]||(i[9]=t=>a.value=t),i[11]||(i[11]=t=>t||o.$emit("close"))],"is-form":"","content-classes":o.$style.externalStorageDialog,name:l.value.id?e(n)("files_external","Edit storage"):e(n)("files_external","Add storage"),onSubmit:i[10]||(i[10]=t=>o.$emit("close",l.value))},{actions:w(()=>[s.storage.id?(u(),k(e(P),{key:0,onClick:i[8]||(i[8]=t=>o.$emit("close"))},{default:w(()=>[V(v(e(n)("files_external","Cancel")),1)]),_:1})):T("",!0),b(e(P),{variant:"primary",type:"submit"},{default:w(()=>[V(v(s.storage.id?e(n)("files_external","Edit"):e(n)("files_external","Create")),1)]),_:1})]),default:w(()=>[b(e(de),{modelValue:l.value.mountPoint,"onUpdate:modelValue":i[0]||(i[0]=t=>l.value.mountPoint=t),label:e(n)("files_external","Folder name"),required:""},null,8,["modelValue","label"]),b(ra,{modelValue:l.value.mountOptions,"onUpdate:modelValue":i[1]||(i[1]=t=>l.value.mountOptions=t)},null,8,["modelValue"]),e(ie)?(u(),k(Qe,{key:0,groups:l.value.applicableGroups,"onUpdate:groups":i[2]||(i[2]=t=>l.value.applicableGroups=t),users:l.value.applicableUsers,"onUpdate:users":i[3]||(i[3]=t=>l.value.applicableUsers=t)},null,8,["groups","users"])):T("",!0),b(e(ae),{modelValue:r.value,"onUpdate:modelValue":i[4]||(i[4]=t=>r.value=t),options:e(re),disabled:!!(l.value.id&&l.value.backend),"input-label":e(n)("files_external","External storage"),label:"name",required:""},null,8,["modelValue","options","disabled","input-label"]),b(e(ae),{modelValue:_.value,"onUpdate:modelValue":i[5]||(i[5]=t=>_.value=t),options:c.value,disabled:!l.value.backend||c.value.length<=1||!!(l.value.id&&l.value.authMechanism),"input-label":e(n)("files_external","Authentication"),label:"name",required:""},null,8,["modelValue","options","disabled","input-label"]),r.value?(u(),k(aa,{key:1,modelValue:l.value.backendOptions,"onUpdate:modelValue":i[6]||(i[6]=t=>l.value.backendOptions=t),class:x(o.$style.externalStorageDialog__configuration),configuration:r.value.configuration},null,8,["modelValue","class","configuration"])):T("",!0),_.value?(u(),k(Ye,{key:2,modelValue:l.value.backendOptions,"onUpdate:modelValue":i[7]||(i[7]=t=>l.value.backendOptions=t),class:x(o.$style.externalStorageDialog__configuration),"auth-mechanism":_.value},null,8,["modelValue","class","auth-mechanism"])):T("",!0)]),_:1},8,["open","content-classes","name"]))}}),_a="_externalStorageDialog_9wew8_2",ma="_externalStorageDialog__configuration_9wew8_9",pa={externalStorageDialog:_a,externalStorageDialog__configuration:ma},fa={$style:pa},be=E(ca,[["__cssModules",fa]]),{isAdmin:ga}=A("files_external","settings"),le=he("files_external--storages",()=>{const s=M([]),a=M([]);async function l(m){const f=R("apps/files_external/globalstorages"),{data:g}=await U.post(f,I(m),{confirmPassword:G.Strict});s.value.push(g)}async function r(m){const f=R("apps/files_external/userstorages"),{data:g}=await U.post(f,I(m),{confirmPassword:G.Strict});a.value.push(g)}async function c(m){await U.delete(p(m),{confirmPassword:G.Strict}),m.type==="personal"?a.value=a.value.filter(f=>f.id!==m.id):s.value=s.value.filter(f=>f.id!==m.id)}async function _(m){const{data:f}=await U.put(p(m),I(m),{confirmPassword:G.Strict});d(f)}async function o(m){const{data:f}=await U.get(p(m));d(f)}return t(),{globalStorages:s,userStorages:a,createGlobalStorage:l,createUserStorage:r,deleteStorage:c,reloadStorage:o,updateStorage:_};async function i(m){const f=`apps/files_external/${m}`,{data:g}=await U.get(R(f));return Object.values(g)}async function t(){pe(U),ga?s.value=await i("globalstorages"):(a.value=await i("userstorages"),s.value=await i("userglobalstorages"))}function p(m){const f=m.type==="personal"?"userstorages":"globalstorages";return R(`apps/files_external/${f}/${m.id}`)}function d(m){if(m.type==="personal"){const f=a.value.findIndex(g=>g.id===m.id);a.value.splice(f,1,m)}else{const f=s.value.findIndex(g=>g.id===m.id);s.value.splice(f,1,m)}}}),va={class:"hidden-visually"},ba={key:0},ya=$({__name:"ExternalStorageTableRow",props:{storage:{},isAdmin:{type:Boolean}},setup(s){const a=s,l=le(),r=A("files_external","backends"),c=C(()=>r.find(g=>g.identifier===a.storage.backend).name),_=A("files_external","authMechanisms"),o=C(()=>_.find(g=>g.identifier===a.storage.authMechanism).name),i=M(!1),t=C(()=>{if(i.value)return{icon:"loading",label:n("files_external","Checking …")};const g=a.storage.status??D.Indeterminate,te=a.storage.statusMessage||De[g],O=He[g],se=g===D.NetworkError||g===D.Timeout,ye=!se&&g!==D.Success&&g!==D.Indeterminate;return{icon:O,label:te,isWarning:se,isError:ye}}),p=ge(()=>a.storage.applicableUsers||[]);async function d(){await l.deleteStorage(a.storage)}async function m(){const g=await Ne(be,{storage:a.storage});g&&await l.updateStorage(g)}async function f(){i.value=!0;try{await l.reloadStorage(a.storage)}finally{i.value=!1}}return(g,te)=>(u(),h("tr",{class:x(g.$style.storageTableRow)},[y("td",null,[y("span",va,v(t.value.label),1),b(e(P),{"aria-label":e(n)("files_external","Recheck status"),title:t.value.label,variant:"tertiary-no-background",onClick:f},{icon:w(()=>[t.value.icon==="loading"?(u(),k(e(ce),{key:0})):(u(),k(e(F),{key:1,class:x({[g.$style.storageTableRow__status_error]:t.value.isError,[g.$style.storageTableRow__status_warning]:t.value.isWarning}),path:t.value.icon},null,8,["class","path"]))]),_:1},8,["aria-label","title"])]),y("td",null,v(s.storage.mountPoint),1),y("td",null,v(c.value),1),y("td",null,v(o.value),1),s.isAdmin?(u(),h("td",ba,[y("div",{class:x(g.$style.storageTableRow__cellApplicable)},[(u(!0),h(S,null,q(s.storage.applicableGroups,O=>(u(),k(e(Fe),{key:O,"icon-path":e(Ae),"no-close":"",text:O},null,8,["icon-path","text"]))),128)),(u(!0),h(S,null,q(e(p),O=>(u(),k(e(je),{key:O.user,"display-name":O.displayName,size:24,user:O.user},null,8,["display-name","user"]))),128))],2)])):T("",!0),y("td",null,[s.isAdmin||s.storage.type==="personal"?(u(),h("div",{key:0,class:x(g.$style.storageTableRow__cellActions)},[b(e(P),{"aria-label":e(n)("files_external","Edit"),title:e(n)("files_external","Edit"),onClick:m},{icon:w(()=>[b(e(F),{path:e(Ue)},null,8,["path"])]),_:1},8,["aria-label","title"]),b(e(P),{"aria-label":e(n)("files_external","Delete"),title:e(n)("files_external","Delete"),variant:"error",onClick:d},{icon:w(()=>[b(e(F),{path:e($e)},null,8,["path"])]),_:1},8,["aria-label","title"])],2)):(u(),k(e(F),{key:1,inline:"",path:e(Te),name:e(n)("files_external","System provided storage"),title:e(n)("files_external","System provided storage")},null,8,["path","name","title"]))])],2))}}),ha="_storageTableRow__cellActions_1k62p_2",xa="_storageTableRow__cellApplicable_1k62p_7",wa="_storageTableRow__status_warning_1k62p_17",ka="_storageTableRow__status_error_1k62p_21",Va={storageTableRow__cellActions:ha,storageTableRow__cellApplicable:xa,storageTableRow__status_warning:wa,storageTableRow__status_error:ka},Sa={$style:Va},Ca=E(ya,[["__cssModules",Sa]]),Ma=["aria-label"],Aa={class:"hidden-visually"},Ua={key:0},$a={class:"hidden-visually"},Ta=$({__name:"ExternalStorageTable",setup(s){const a=le(),{isAdmin:l}=A("files_external","settings"),r=C(()=>l?a.globalStorages:[...a.userStorages,...a.globalStorages]);return(c,_)=>(u(),h("table",{class:x(c.$style.storageTable),"aria-label":e(n)("files_external","External storages")},[y("thead",{class:x(c.$style.storageTable__header)},[y("tr",null,[y("th",{class:x(c.$style.storageTable__headerStatus)},[y("span",Aa,v(e(n)("files_external","Status")),1)],2),y("th",{class:x(c.$style.storageTable__headerFolder)},v(e(n)("files_external","Folder name")),3),y("th",{class:x(c.$style.storageTable__headerBackend)},v(e(n)("files_external","External storage")),3),y("th",{class:x(c.$style.storageTable__headerAuthentication)},v(e(n)("files_external","Authentication")),3),e(l)?(u(),h("th",Ua,v(e(n)("files_external","Restricted to")),1)):T("",!0),y("th",{class:x(c.$style.storageTable__headerActions)},[y("span",$a,v(e(n)("files_external","Actions")),1)],2)])],2),y("tbody",null,[(u(!0),h(S,null,q(r.value,o=>(u(),k(Ca,{key:o.id,"is-admin":e(l),storage:o},null,8,["is-admin","storage"]))),128))])],10,Ma))}}),qa="_storageTable_1dqte_2",Ea="_storageTable__header_1dqte_11",Oa="_storageTable__headerStatus_1dqte_16",Pa="_storageTable__headerFolder_1dqte_20",Na="_storageTable__headerBackend_1dqte_24",Ra="_storageTable__headerFAuthentication_1dqte_28",Fa="_storageTable__headerActions_1dqte_32",Ba={storageTable:qa,storageTable__header:Ea,storageTable__headerStatus:Oa,storageTable__headerFolder:Pa,storageTable__headerBackend:Na,storageTable__headerFAuthentication:Ra,storageTable__headerActions:Fa},ja={$style:Ba},Da=E(Ta,[["__cssModules",ja]]),Ha=$({__name:"UserMountSettings",setup(s){const a=A("files_external","user-mounting"),l=A("files_external","backends"),r=M(a.allowUserMounting),c=M(a.allowedBackends);return Q(r,()=>{const _=!r.value;window.OCP.AppConfig.setValue("files_external","allow_user_mounting",r.value?"yes":"no",{success:()=>X(n("files_external","Saved")),error:()=>{r.value=_,ee(n("files_external","Error while saving"))}})}),Q(c,(_,o)=>{window.OCP.AppConfig.setValue("files_external","user_mounting_backends",_.join(","),{success:()=>X(n("files_external","Saved allowed backends")),error:()=>{ee(n("files_external","Failed to save allowed backends")),c.value=o}})}),(_,o)=>(u(),h("form",null,[y("h3",{class:x(_.$style.userMountSettings__heading)},v(e(n)("files_external","Advanced options for external storage mounts")),3),b(e(N),{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=i=>r.value=i),type:"switch"},{default:w(()=>[V(v(e(n)("files_external","Allow people to mount external storage")),1)]),_:1},8,["modelValue"]),Z(y("fieldset",{class:x(_.$style.userMountSettings__backends)},[y("legend",null,v(e(n)("files_external","External storage backends people are allowed to mount")),1),(u(!0),h(S,null,q(e(l),i=>(u(),k(e(N),{key:i.identifier,modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=t=>c.value=t),value:i.identifier,name:"allowUserMountingBackends[]"},{default:w(()=>[V(v(i.name),1)]),_:2},1032,["modelValue","value"]))),128))],2),[[W,r.value]])]))}}),Ga="_userMountSettings__heading_59moz_2",Ia="_userMountSettings__backends_59moz_9",Qa={userMountSettings__heading:Ga,userMountSettings__backends:Ia},La={$style:Qa},za=E(Ha,[["__cssModules",La]]);const Za=["aria-label"],Wa=$({__name:"ExternalStoragesSection",setup(s){const a=A("files_external","settings",{docUrl:"",dependencyIssues:{messages:null,modules:null},isAdmin:!1}),l=le(),r=a.dependencyIssues?.messages??[],c=a.dependencyIssues?.modules??{},_=M(!1),o=M();async function i(t){if(_.value=!1,!!t)try{a.isAdmin?await l.createGlobalStorage(t):await l.createUserStorage(t),o.value=void 0}catch(p){fe.error("Failed to add external storage",{error:p}),_.value=!0}}return(t,p)=>(u(),k(e(ue),{"doc-url":e(a).docUrl,name:e(n)("files_external","External storage"),description:e(n)("files_external","External storage enables you to mount external storage services and devices as secondary Nextcloud storage devices.")+(e(a).isAdmin?" "+e(n)("files_external","You may also allow people to mount their own external storage services."):"")},{default:w(()=>[(u(!0),h(S,null,q(e(r),(d,m)=>(u(),k(e(oe),{key:m,type:"error"},{default:w(()=>[V(v(d),1)]),_:2},1024))),128)),(u(!0),h(S,null,q(e(c),(d,m)=>(u(),k(e(oe),{key:m,type:"warning"},{default:w(()=>[y("p",null,[m==="curl"?(u(),h(S,{key:0},[V(v(e(n)("files_external","The cURL support in PHP is not enabled or installed.")),1)],64)):m==="ftp"?(u(),h(S,{key:1},[V(v(e(n)("files_external","The FTP support in PHP is not enabled or installed.")),1)],64)):(u(),h(S,{key:2},[V(v(e(n)("files_external","{module} is not installed.",{module:m})),1)],64)),V(" "+v(e(qe)("files_external","Please ask your system administrator to install it as otherwise mounting the following backend is not possible:","Please ask your system administrator to install it as otherwise mounting the following backends is not possible:",d.length)),1)]),y("ul",{class:x(t.$style.externalStoragesSection__dependantList),"aria-label":e(n)("files_external","Dependant backends")},[(u(!0),h(S,null,q(d,f=>(u(),h("li",{key:f},v(f),1))),128))],10,Za)]),_:2},1024))),128)),T("",!0),b(Da),b(e(P),{class:x(t.$style.externalStoragesSection__newStorageButton),variant:"primary",onClick:p[0]||(p[0]=d=>_.value=!_.value)},{icon:w(()=>[b(e(F),{path:e(Ee)},null,8,["path"])]),default:w(()=>[V(" "+v(e(n)("files_external","Add external storage")),1)]),_:1},8,["class"]),b(be,{modelValue:o.value,"onUpdate:modelValue":p[1]||(p[1]=d=>o.value=d),open:_.value,"onUpdate:open":p[2]||(p[2]=d=>_.value=d),onClose:i},null,8,["modelValue","open"]),e(a).isAdmin?(u(),k(za,{key:1})):T("",!0)]),_:1},8,["doc-url","name","description"]))}}),Ya="_externalStoragesSection__dependantList_atsmn_2",Ja="_externalStoragesSection__newStorageButton_atsmn_7",Ka={externalStoragesSection__dependantList:Ya,externalStoragesSection__newStorageButton:Ja},Xa={$style:Ka},el=E(Wa,[["__cssModules",Xa]]),al=$({__name:"GlobalCredentialsSection",setup(s){const a=A("files_external","global-credentials"),l=M(!1),r=M(a.user),c=M(a.password);pe(U);async function _(){try{l.value=!0;const{data:o}=await U.post(R("apps/files_external/globalcredentials"),{uid:a.uid,user:r.value,password:c.value},{confirmPassword:G.Strict});if(o){X(n("files_external","Global credentials saved"));return}}catch(o){fe.error(o)}finally{l.value=!1}ee(n("files_external","Could not save global credentials")),r.value=a.user,c.value=a.password}return(o,i)=>(u(),k(e(ue),{name:e(n)("files_external","Global credentials"),description:e(n)("files_external","Global credentials can be used to authenticate with multiple external storages that have the same credentials.")},{default:w(()=>[y("form",{id:"global_credentials",class:x(o.$style.globalCredentialsSectionForm),autocomplete:"false",onSubmit:Ve(_,["prevent"])},[b(e(de),{modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=t=>r.value=t),name:"username",autocomplete:"false",label:e(n)("files_external","Login")},null,8,["modelValue","label"]),b(e(Be),{modelValue:c.value,"onUpdate:modelValue":i[1]||(i[1]=t=>c.value=t),name:"password",autocomplete:"false",label:e(n)("files_external","Password")},null,8,["modelValue","label"]),b(e(P),{class:x(o.$style.globalCredentialsSectionForm__submit),disabled:l.value,variant:"primary",type:"submit"},{default:w(()=>[V(v(l.value?e(n)("files_external","Saving …"):e(n)("files_external","Save")),1)]),_:1},8,["class","disabled"])],34)]),_:1},8,["name","description"]))}}),ll="_globalCredentialsSectionForm_bgjv2_2",tl="_globalCredentialsSectionForm__submit_bgjv2_10",sl={globalCredentialsSectionForm:ll,globalCredentialsSectionForm__submit:tl},nl={$style:sl},ol=E(al,[["__cssModules",nl]]),il=$({__name:"FilesExternalSettings",setup(s){return(a,l)=>(u(),h(S,null,[b(el),b(ol)],64))}}),rl=xe(),J=Se(il);J.config.idPrefix="files-external",J.use(rl),J.mount("#files-external");
//# sourceMappingURL=files_external-settings.mjs.map
