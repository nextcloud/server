const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=[window.OC.filePath('', '', 'dist/SetStatusModal-CLZK-PFi.chunk.mjs'),window.OC.filePath('', '', 'dist/index-JpgrUA2Z-hoZOv0I-.chunk.mjs'),window.OC.filePath('', '', 'dist/_plugin-vue_export-helper-sUpjG1-Y.chunk.mjs'),window.OC.filePath('', '', 'dist/string_decoder-CKkZVVJW.chunk.mjs'),window.OC.filePath('', '', 'dist/string_decoder-DopLwvn9.chunk.css'),window.OC.filePath('', '', 'dist/mdi-BrEv6Slh.chunk.mjs'),window.OC.filePath('', '', 'dist/mdi-BYHcrfvW.chunk.css'),window.OC.filePath('', '', 'dist/index-JpgrUA2Z-PxDoi4mB.chunk.css'),window.OC.filePath('', '', 'dist/NcSelect-Czzsi3P_-BfHbk_qw.chunk.mjs'),window.OC.filePath('', '', 'dist/NcSelect-Czzsi3P_-DxGOLvnt.chunk.css'),window.OC.filePath('', '', 'dist/NcEmojiPicker-pM4Pg2yq-Djq7ah7y.chunk.mjs'),window.OC.filePath('', '', 'dist/NcColorPicker-Kc0JqRtp-44mUS6uA.chunk.mjs'),window.OC.filePath('', '', 'dist/colors-Go3zmZRD-B3dC1KT2.chunk.mjs'),window.OC.filePath('', '', 'dist/NcColorPicker-Kc0JqRtp-BOLDG5h-.chunk.css'),window.OC.filePath('', '', 'dist/TrashCanOutline-DMH4BocM.chunk.mjs'),window.OC.filePath('', '', 'dist/NcInputField-Bwsh2aHY-fSb6LlM4.chunk.mjs'),window.OC.filePath('', '', 'dist/NcInputField-Bwsh2aHY-_gyGHRGx.chunk.css'),window.OC.filePath('', '', 'dist/NcEmojiPicker-pM4Pg2yq-BHtXoCfG.chunk.css'),window.OC.filePath('', '', 'dist/NcUserStatusIcon-CGEf7fej-CSAsMs-R.chunk.mjs'),window.OC.filePath('', '', 'dist/index-Cvjfo1ma.chunk.mjs'),window.OC.filePath('', '', 'dist/NcUserStatusIcon-CGEf7fej-Bq_6hmXG.chunk.css'),window.OC.filePath('', '', 'dist/index-I0e37rkN.chunk.mjs'),window.OC.filePath('', '', 'dist/TrayArrowDown-ItfJEWXj.chunk.mjs'),window.OC.filePath('', '', 'dist/TrayArrowDown-CMlC-wJV.chunk.css'),window.OC.filePath('', '', 'dist/user_status-SetStatusModal-HX2qTI0C.chunk.css')])))=>i.map(i=>d[i]);
import{V as ft,S as mt,n as z,s as ht,d as h,g,_ as gt,av as _t,r as O,F as N,o as A,c as G,G as yt,w as E,a as j,H as T,R as $,b as vt,t as bt,P as St,A as v,au as wt,J as X,a7 as I,l as It,e as K}from"./_plugin-vue_export-helper-sUpjG1-Y.chunk.mjs";import{s as Mt,_ as Ot}from"./index-JpgrUA2Z-hoZOv0I-.chunk.mjs";import{c as _,d as At}from"./index-Cvjfo1ma.chunk.mjs";import{g as kt,e as Ct}from"./string_decoder-CKkZVVJW.chunk.mjs";import{N as Et,m as M}from"./index-I0e37rkN.chunk.mjs";import{N as jt}from"./NcUserStatusIcon-CGEf7fej-CSAsMs-R.chunk.mjs";import"./mdi-BrEv6Slh.chunk.mjs";import"./TrayArrowDown-ItfJEWXj.chunk.mjs";function Tt(){return q().__VUE_DEVTOOLS_GLOBAL_HOOK__}function q(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const Pt=typeof Proxy=="function",xt="devtools-plugin:setup",Lt="plugin:settings:set";let w,L;function Ut(){var t;return w!==void 0||(typeof window<"u"&&window.performance?(w=!0,L=window.performance):typeof globalThis<"u"&&!((t=globalThis.perf_hooks)===null||t===void 0)&&t.performance?(w=!0,L=globalThis.perf_hooks.performance):w=!1),w}function Dt(){return Ut()?L.now():Date.now()}class Ft{constructor(e,s){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=s;const a={};if(e.settings)for(const o in e.settings){const i=e.settings[o];a[o]=i.defaultValue}const n=`__vue-devtools-plugin-settings__${e.id}`;let r=Object.assign({},a);try{const o=localStorage.getItem(n),i=JSON.parse(o);Object.assign(r,i)}catch{}this.fallbacks={getSettings(){return r},setSettings(o){try{localStorage.setItem(n,JSON.stringify(o))}catch{}r=o},now(){return Dt()}},s&&s.on(Lt,(o,i)=>{o===this.plugin.id&&this.fallbacks.setSettings(i)}),this.proxiedOn=new Proxy({},{get:(o,i)=>this.target?this.target.on[i]:(...u)=>{this.onQueue.push({method:i,args:u})}}),this.proxiedTarget=new Proxy({},{get:(o,i)=>this.target?this.target[i]:i==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(i)?(...u)=>(this.targetQueue.push({method:i,args:u,resolve:()=>{}}),this.fallbacks[i](...u)):(...u)=>new Promise(c=>{this.targetQueue.push({method:i,args:u,resolve:c})})})}async setRealTarget(e){this.target=e;for(const s of this.onQueue)this.target.on[s.method](...s.args);for(const s of this.targetQueue)s.resolve(await this.target[s.method](...s.args))}}function Nt(t,e){const s=t,a=q(),n=Tt(),r=Pt&&s.enableEarlyProxy;if(n&&(a.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!r))n.emit(xt,t,e);else{const o=r?new Ft(s,n):null;(a.__VUE_DEVTOOLS_PLUGINS__=a.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:s,setupFn:e,proxy:o}),o&&e(o.proxiedTarget)}}const Y=kt().detectLogLevel().setApp("user_status").build();var Gt="store";function S(t,e){Object.keys(t).forEach(function(s){return e(t[s],s)})}function Z(t){return t!==null&&typeof t=="object"}function $t(t){return t&&typeof t.then=="function"}function Bt(t,e){return function(){return t(e)}}function B(t,e,s){return e.indexOf(t)<0&&(s&&s.prepend?e.unshift(t):e.push(t)),function(){var a=e.indexOf(t);a>-1&&e.splice(a,1)}}function V(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var s=t.state;C(t,s,[],t._modules.root,!0),D(t,s,e)}function D(t,e,s){var a=t._state,n=t._scope;t.getters={},t._makeLocalGettersCache=Object.create(null);var r=t._wrappedGetters,o={},i={},u=ft(!0);u.run(function(){S(r,function(c,l){o[l]=Bt(c,t),i[l]=ht(function(){return o[l]()}),Object.defineProperty(t.getters,l,{get:function(){return i[l].value},enumerable:!0})})}),t._state=mt({data:e}),t._scope=u,t.strict&&Jt(t),a&&s&&t._withCommit(function(){a.data=null}),n&&n.stop()}function C(t,e,s,a,n){var r=!s.length,o=t._modules.getNamespace(s);if(a.namespaced&&(t._modulesNamespaceMap[o],t._modulesNamespaceMap[o]=a),!r&&!n){var i=F(e,s.slice(0,-1)),u=s[s.length-1];t._withCommit(function(){i[u]=a.state})}var c=a.context=Vt(t,o,s);a.forEachMutation(function(l,d){var p=o+d;Ht(t,p,l,c)}),a.forEachAction(function(l,d){var p=l.root?d:o+d,pt=l.handler||l;Qt(t,p,pt,c)}),a.forEachGetter(function(l,d){var p=o+d;Rt(t,p,l,c)}),a.forEachChild(function(l,d){C(t,e,s.concat(d),l,n)})}function Vt(t,e,s){var a=e==="",n={dispatch:a?t.dispatch:function(r,o,i){var u=k(r,o,i),c=u.payload,l=u.options,d=u.type;return(!l||!l.root)&&(d=e+d),t.dispatch(d,c)},commit:a?t.commit:function(r,o,i){var u=k(r,o,i),c=u.payload,l=u.options,d=u.type;(!l||!l.root)&&(d=e+d),t.commit(d,c,l)}};return Object.defineProperties(n,{getters:{get:a?function(){return t.getters}:function(){return tt(t,e)}},state:{get:function(){return F(t.state,s)}}}),n}function tt(t,e){if(!t._makeLocalGettersCache[e]){var s={},a=e.length;Object.keys(t.getters).forEach(function(n){if(n.slice(0,a)===e){var r=n.slice(a);Object.defineProperty(s,r,{get:function(){return t.getters[n]},enumerable:!0})}}),t._makeLocalGettersCache[e]=s}return t._makeLocalGettersCache[e]}function Ht(t,e,s,a){var n=t._mutations[e]||(t._mutations[e]=[]);n.push(function(r){s.call(t,a.state,r)})}function Qt(t,e,s,a){var n=t._actions[e]||(t._actions[e]=[]);n.push(function(r){var o=s.call(t,{dispatch:a.dispatch,commit:a.commit,getters:a.getters,state:a.state,rootGetters:t.getters,rootState:t.state},r);return $t(o)||(o=Promise.resolve(o)),t._devtoolHook?o.catch(function(i){throw t._devtoolHook.emit("vuex:error",i),i}):o})}function Rt(t,e,s,a){t._wrappedGetters[e]||(t._wrappedGetters[e]=function(n){return s(a.state,a.getters,n.state,n.getters)})}function Jt(t){z(function(){return t._state.data},function(){},{deep:!0,flush:"sync"})}function F(t,e){return e.reduce(function(s,a){return s[a]},t)}function k(t,e,s){return Z(t)&&t.type&&(s=e,e=t,t=t.type),{type:t,payload:e,options:s}}var Wt="vuex bindings",H="vuex:mutations",P="vuex:actions",b="vuex",zt=0;function Xt(t,e){Nt({id:"org.vuejs.vuex",app:t,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[Wt]},function(s){s.addTimelineLayer({id:H,label:"Vuex Mutations",color:Q}),s.addTimelineLayer({id:P,label:"Vuex Actions",color:Q}),s.addInspector({id:b,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),s.on.getInspectorTree(function(a){if(a.app===t&&a.inspectorId===b)if(a.filter){var n=[];nt(n,e._modules.root,a.filter,""),a.rootNodes=n}else a.rootNodes=[at(e._modules.root,"")]}),s.on.getInspectorState(function(a){if(a.app===t&&a.inspectorId===b){var n=a.nodeId;tt(e,n),a.state=Yt(te(e._modules,n),n==="root"?e.getters:e._makeLocalGettersCache,n)}}),s.on.editInspectorState(function(a){if(a.app===t&&a.inspectorId===b){var n=a.nodeId,r=a.path;n!=="root"&&(r=n.split("/").filter(Boolean).concat(r)),e._withCommit(function(){a.set(e._state.data,r,a.state.value)})}}),e.subscribe(function(a,n){var r={};a.payload&&(r.payload=a.payload),r.state=n,s.notifyComponentUpdate(),s.sendInspectorTree(b),s.sendInspectorState(b),s.addTimelineEvent({layerId:H,event:{time:Date.now(),title:a.type,data:r}})}),e.subscribeAction({before:function(a,n){var r={};a.payload&&(r.payload=a.payload),a._id=zt++,a._time=Date.now(),r.state=n,s.addTimelineEvent({layerId:P,event:{time:a._time,title:a.type,groupId:a._id,subtitle:"start",data:r}})},after:function(a,n){var r={},o=Date.now()-a._time;r.duration={_custom:{type:"duration",display:o+"ms",tooltip:"Action duration",value:o}},a.payload&&(r.payload=a.payload),r.state=n,s.addTimelineEvent({layerId:P,event:{time:Date.now(),title:a.type,groupId:a._id,subtitle:"end",data:r}})}})})}var Q=8702998,Kt=6710886,qt=16777215,et={label:"namespaced",textColor:qt,backgroundColor:Kt};function st(t){return t&&t!=="root"?t.split("/").slice(-2,-1)[0]:"Root"}function at(t,e){return{id:e||"root",label:st(e),tags:t.namespaced?[et]:[],children:Object.keys(t._children).map(function(s){return at(t._children[s],e+s+"/")})}}function nt(t,e,s,a){a.includes(s)&&t.push({id:a||"root",label:a.endsWith("/")?a.slice(0,a.length-1):a||"Root",tags:e.namespaced?[et]:[]}),Object.keys(e._children).forEach(function(n){nt(t,e._children[n],s,a+n+"/")})}function Yt(t,e,s){e=s==="root"?e:e[s];var a=Object.keys(e),n={state:Object.keys(t.state).map(function(o){return{key:o,editable:!0,value:t.state[o]}})};if(a.length){var r=Zt(e);n.getters=Object.keys(r).map(function(o){return{key:o.endsWith("/")?st(o):o,editable:!1,value:U(function(){return r[o]})}})}return n}function Zt(t){var e={};return Object.keys(t).forEach(function(s){var a=s.split("/");if(a.length>1){var n=e,r=a.pop();a.forEach(function(o){n[o]||(n[o]={_custom:{value:{},display:o,tooltip:"Module",abstract:!0}}),n=n[o]._custom.value}),n[r]=U(function(){return t[s]})}else e[s]=U(function(){return t[s]})}),e}function te(t,e){var s=e.split("/").filter(function(a){return a});return s.reduce(function(a,n,r){var o=a[n];if(!o)throw new Error('Missing module "'+n+'" for path "'+e+'".');return r===s.length-1?o:o._children},e==="root"?t:t.root._children)}function U(t){try{return t()}catch(e){return e}}var m=function(t,e){this.runtime=e,this._children=Object.create(null),this._rawModule=t;var s=t.state;this.state=(typeof s=="function"?s():s)||{}},R={namespaced:{configurable:!0}};R.namespaced.get=function(){return!!this._rawModule.namespaced},m.prototype.addChild=function(t,e){this._children[t]=e},m.prototype.removeChild=function(t){delete this._children[t]},m.prototype.getChild=function(t){return this._children[t]},m.prototype.hasChild=function(t){return t in this._children},m.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)},m.prototype.forEachChild=function(t){S(this._children,t)},m.prototype.forEachGetter=function(t){this._rawModule.getters&&S(this._rawModule.getters,t)},m.prototype.forEachAction=function(t){this._rawModule.actions&&S(this._rawModule.actions,t)},m.prototype.forEachMutation=function(t){this._rawModule.mutations&&S(this._rawModule.mutations,t)},Object.defineProperties(m.prototype,R);var y=function(t){this.register([],t,!1)};y.prototype.get=function(t){return t.reduce(function(e,s){return e.getChild(s)},this.root)},y.prototype.getNamespace=function(t){var e=this.root;return t.reduce(function(s,a){return e=e.getChild(a),s+(e.namespaced?a+"/":"")},"")},y.prototype.update=function(t){ot([],this.root,t)},y.prototype.register=function(t,e,s){var a=this;s===void 0&&(s=!0);var n=new m(e,s);if(t.length===0)this.root=n;else{var r=this.get(t.slice(0,-1));r.addChild(t[t.length-1],n)}e.modules&&S(e.modules,function(o,i){a.register(t.concat(i),o,s)})},y.prototype.unregister=function(t){var e=this.get(t.slice(0,-1)),s=t[t.length-1],a=e.getChild(s);a&&a.runtime&&e.removeChild(s)},y.prototype.isRegistered=function(t){var e=this.get(t.slice(0,-1)),s=t[t.length-1];return e?e.hasChild(s):!1};function ot(t,e,s){if(e.update(s),s.modules)for(var a in s.modules){if(!e.getChild(a))return;ot(t.concat(a),e.getChild(a),s.modules[a])}}function ee(t){return new f(t)}var f=function(t){var e=this;t===void 0&&(t={});var s=t.plugins;s===void 0&&(s=[]);var a=t.strict;a===void 0&&(a=!1);var n=t.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new y(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=n;var r=this,o=this,i=o.dispatch,u=o.commit;this.dispatch=function(l,d){return i.call(r,l,d)},this.commit=function(l,d,p){return u.call(r,l,d,p)},this.strict=a;var c=this._modules.root.state;C(this,c,[],this._modules.root),D(this,c),s.forEach(function(l){return l(e)})},x={state:{configurable:!0}};f.prototype.install=function(t,e){t.provide(e||Gt,this),t.config.globalProperties.$store=this;var s=this._devtools!==void 0?this._devtools:!1;s&&Xt(t,this)},x.state.get=function(){return this._state.data},x.state.set=function(t){},f.prototype.commit=function(t,e,s){var a=this,n=k(t,e,s),r=n.type,o=n.payload,i={type:r,payload:o},u=this._mutations[r];u&&(this._withCommit(function(){u.forEach(function(c){c(o)})}),this._subscribers.slice().forEach(function(c){return c(i,a.state)}))},f.prototype.dispatch=function(t,e){var s=this,a=k(t,e),n=a.type,r=a.payload,o={type:n,payload:r},i=this._actions[n];if(i){try{this._actionSubscribers.slice().filter(function(c){return c.before}).forEach(function(c){return c.before(o,s.state)})}catch{}var u=i.length>1?Promise.all(i.map(function(c){return c(r)})):i[0](r);return new Promise(function(c,l){u.then(function(d){try{s._actionSubscribers.filter(function(p){return p.after}).forEach(function(p){return p.after(o,s.state)})}catch{}c(d)},function(d){try{s._actionSubscribers.filter(function(p){return p.error}).forEach(function(p){return p.error(o,s.state,d)})}catch{}l(d)})})}},f.prototype.subscribe=function(t,e){return B(t,this._subscribers,e)},f.prototype.subscribeAction=function(t,e){var s=typeof t=="function"?{before:t}:t;return B(s,this._actionSubscribers,e)},f.prototype.watch=function(t,e,s){var a=this;return z(function(){return t(a.state,a.getters)},e,Object.assign({},s))},f.prototype.replaceState=function(t){var e=this;this._withCommit(function(){e._state.data=t})},f.prototype.registerModule=function(t,e,s){s===void 0&&(s={}),typeof t=="string"&&(t=[t]),this._modules.register(t,e),C(this,this.state,t,this._modules.get(t),s.preserveState),D(this,this.state)},f.prototype.unregisterModule=function(t){var e=this;typeof t=="string"&&(t=[t]),this._modules.unregister(t),this._withCommit(function(){var s=F(e.state,t.slice(0,-1));delete s[t[t.length-1]]}),V(this)},f.prototype.hasModule=function(t){return typeof t=="string"&&(t=[t]),this._modules.isRegistered(t)},f.prototype.hotUpdate=function(t){this._modules.update(t),V(this,!0)},f.prototype._withCommit=function(t){var e=this._committing;this._committing=!0,t(),this._committing=e},Object.defineProperties(f.prototype,x);var se=it(function(t,e){var s={};return rt(e).forEach(function(a){var n=a.key,r=a.val;s[n]=function(){var o=this.$store.state,i=this.$store.getters;if(t){var u=ut(this.$store,"mapState",t);if(!u)return;o=u.context.state,i=u.context.getters}return typeof r=="function"?r.call(this,o,i):o[r]},s[n].vuex=!0}),s}),Re=it(function(t,e){var s={};return rt(e).forEach(function(a){var n=a.key,r=a.val;r=t+r,s[n]=function(){if(!(t&&!ut(this.$store,"mapGetters",t)))return this.$store.getters[r]},s[n].vuex=!0}),s});function rt(t){return ae(t)?Array.isArray(t)?t.map(function(e){return{key:e,val:e}}):Object.keys(t).map(function(e){return{key:e,val:t[e]}}):[]}function ae(t){return Array.isArray(t)||Z(t)}function it(t){return function(e,s){return typeof e!="string"?(s=e,e=""):e.charAt(e.length-1)!=="/"&&(e+="/"),t(e,s)}}function ut(t,e,s){var a=t._modulesNamespaceMap[s];return a}const ne={computed:{...se({statusType:t=>t.userStatus.status,statusIsUserDefined:t=>t.userStatus.statusIsUserDefined,customIcon:t=>t.userStatus.icon,customMessage:t=>t.userStatus.message}),visibleMessage(){if(this.customIcon&&this.customMessage)return`${this.customIcon} ${this.customMessage}`;if(this.customMessage)return this.customMessage;if(this.statusIsUserDefined)switch(this.statusType){case"online":return h("user_status","Online");case"away":return h("user_status","Away");case"busy":return h("user_status","Busy");case"dnd":return h("user_status","Do not disturb");case"invisible":return h("user_status","Invisible");case"offline":return h("user_status","Offline")}return h("user_status","Set status")}},methods:{async changeStatus(t){try{await this.$store.dispatch("setStatus",{statusType:t})}catch(e){Mt(h("user_status","There was an error saving the new status")),Y.debug(e)}}}};async function oe(t){const e=g("apps/user_status/api/v1/heartbeat?format=json");return(await _.put(e,{status:t?"away":"online"})).data.ocs.data}const re="_userStatusMenuItem_1rva6_1",ie="_userStatusIcon_1rva6_6",ue={userStatusMenuItem:re,userStatusIcon:ie},ce={name:"UserStatus",components:{NcButton:Ct,NcListItem:Et,NcUserStatusIcon:jt,SetStatusModal:_t(()=>Ot(()=>import("./SetStatusModal-CLZK-PFi.chunk.mjs"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]),import.meta.url))},mixins:[ne],props:{inline:{type:Boolean,default:!1}},data(){return{heartbeatInterval:null,isAway:!1,isModalOpen:!1,mouseMoveListener:null,setAwayTimeout:null}},mounted(){this.$store.dispatch("loadStatusFromInitialState"),OC.config.session_keepalive&&(this.heartbeatInterval=setInterval(this._backgroundHeartbeat.bind(this),1e3*60*5),this.setAwayTimeout=()=>{this.isAway=!0},this.mouseMoveListener=At(()=>{const t=this.isAway;this.isAway=!1,clearTimeout(this.setAwayTimeout),setTimeout(this.setAwayTimeout,1e3*60*2),t&&this._backgroundHeartbeat()},1e3*2,{immediate:!0}),window.addEventListener("mousemove",this.mouseMoveListener,{capture:!0,passive:!0}),this._backgroundHeartbeat()),X("user_status:status.updated",this.handleUserStatusUpdated)},beforeUnmount(){window.removeEventListener("mouseMove",this.mouseMoveListener),clearInterval(this.heartbeatInterval),wt("user_status:status.updated",this.handleUserStatusUpdated)},methods:{openModal(){this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},async _backgroundHeartbeat(){try{const t=await oe(this.isAway);t?.userId?this.$store.dispatch("setStatusFromHeartbeat",t):await this.$store.dispatch("reFetchStatusFromServer")}catch(t){Y.debug("Failed sending heartbeat, got: "+t.response?.status)}},handleUserStatusUpdated(t){v()?.uid===t.userId&&this.$store.dispatch("setStatusFromObject",{status:t.status,icon:t.icon,message:t.message})}}},le={key:1};function de(t,e,s,a,n,r){const o=O("NcUserStatusIcon"),i=O("NcListItem"),u=O("NcButton"),c=O("SetStatusModal");return A(),N(St,null,[s.inline?(A(),N("div",le,[j(u,{onClick:$(r.openModal,["stop"])},{icon:E(()=>[j(o,{class:T(t.$style.userStatusIcon),status:t.statusType,"aria-hidden":"true"},null,8,["class","status"])]),default:E(()=>[vt(" "+bt(t.visibleMessage),1)]),_:1},8,["onClick"])])):(A(),G(i,{key:0,class:T(t.$style.userStatusMenuItem),compact:"",name:t.visibleMessage,onClick:$(r.openModal,["stop"])},{icon:E(()=>[j(o,{class:T(t.$style.userStatusIcon),status:t.statusType,"aria-hidden":"true"},null,8,["class","status"])]),_:1},8,["class","name","onClick"])),n.isModalOpen?(A(),G(c,{key:2,inline:s.inline,onClose:r.closeModal},null,8,["inline","onClose"])):yt("",!0)],64)}const pe={$style:ue},ct=gt(ce,[["render",de],["__cssModules",pe]]);async function fe(){const t=g("apps/user_status/api/v1/predefined_statuses?format=json");return(await _.get(t)).data.ocs.data}const me=()=>({predefinedStatuses:[]}),he={addPredefinedStatus(t,e){t.predefinedStatuses=[...t.predefinedStatuses,e]}},ge={statusesHaveLoaded(t){return t.predefinedStatuses.length>0}},_e={async loadAllPredefinedStatuses({state:t,commit:e}){if(t.predefinedStatuses.length>0)return;const s=await fe();for(const a of s)e("addPredefinedStatus",a)}},ye={state:me,mutations:he,getters:ge,actions:_e};async function ve(){const t=g("apps/user_status/api/v1/user_status");return(await _.get(t)).data.ocs.data}async function be(t){const e=g("apps/user_status/api/v1/statuses/{userId}",{userId:"_"+t});return(await _.get(e)).data.ocs.data}async function Se(t){const e=g("apps/user_status/api/v1/user_status/status");await _.put(e,{statusType:t})}async function we(t,e=null){const s=g("apps/user_status/api/v1/user_status/message/predefined?format=json");await _.put(s,{messageId:t,clearAt:e})}async function Ie(t,e=null,s=null){const a=g("apps/user_status/api/v1/user_status/message/custom?format=json");await _.put(a,{message:t,statusIcon:e,clearAt:s})}async function Me(){const t=g("apps/user_status/api/v1/user_status/message?format=json");await _.delete(t)}async function Oe(t){const e=g("apps/user_status/api/v1/user_status/revert/{messageId}",{messageId:t});return(await _.delete(e)).data.ocs.data}const Ae=()=>({status:null,statusIsUserDefined:null,message:null,icon:null,clearAt:null,messageIsPredefined:null,messageId:null}),ke={loadBackupStatusFromServer(t,{status:e,statusIsUserDefined:s,message:a,icon:n,clearAt:r,messageIsPredefined:o,messageId:i}){t.status=e,t.message=a,t.icon=n,typeof s<"u"&&(t.statusIsUserDefined=s),typeof r<"u"&&(t.clearAt=r),typeof o<"u"&&(t.messageIsPredefined=o),typeof i<"u"&&(t.messageId=i)}},Ce={},Ee={async fetchBackupFromServer({commit:t}){try{const e=await be(v()?.uid);t("loadBackupStatusFromServer",e)}catch{}},async revertBackupFromServer({commit:t},{messageId:e}){const s=await Oe(e);s&&(t("loadBackupStatusFromServer",{}),t("loadStatusFromServer",s),I("user_status:status.updated",{status:s.status,message:s.message,icon:s.icon,clearAt:s.clearAt,userId:v()?.uid}))}},je={state:Ae,mutations:ke,getters:Ce,actions:Ee};function lt(){return new Date}function J(t){if(t===null)return null;const e=lt();if(t.type==="period")return e.setSeconds(e.getSeconds()+t.time),Math.floor(e.getTime()/1e3);if(t.type==="end-of")switch(t.time){case"day":case"week":return Number(M(e).endOf(t.time).format("X"))}return t.type==="_time"?t.time:null}function Je(t){if(t===null)return h("user_status","Don't clear");if(t.type==="end-of")switch(t.time){case"day":return h("user_status","Today");case"week":return h("user_status","This week");default:return null}if(t.type==="period")return M.duration(t.time*1e3).humanize();if(t.type==="_time"){const e=M(lt()),s=M(t.time,"X");return M.duration(e.diff(s)).humanize()}return null}const Te=()=>({status:null,statusIsUserDefined:null,message:null,icon:null,clearAt:null,messageIsPredefined:null,messageId:null}),Pe={setStatus(t,{statusType:e}){t.status=e,t.statusIsUserDefined=!0},setPredefinedMessage(t,{messageId:e,clearAt:s,message:a,icon:n}){t.messageId=e,t.messageIsPredefined=!0,t.message=a,t.icon=n,t.clearAt=s},setCustomMessage(t,{message:e,icon:s,clearAt:a}){t.messageId=null,t.messageIsPredefined=!1,t.message=e,t.icon=s,t.clearAt=a},clearMessage(t){t.messageId=null,t.messageIsPredefined=!1,t.message=null,t.icon=null,t.clearAt=null},loadStatusFromServer(t,{status:e,statusIsUserDefined:s,message:a,icon:n,clearAt:r,messageIsPredefined:o,messageId:i}){t.status=e,t.message=a,t.icon=n,typeof s<"u"&&(t.statusIsUserDefined=s),typeof r<"u"&&(t.clearAt=r),typeof o<"u"&&(t.messageIsPredefined=o),typeof i<"u"&&(t.messageId=i)}},xe={},Le={async setStatus({commit:t,state:e},{statusType:s}){await Se(s),t("setStatus",{statusType:s}),I("user_status:status.updated",{status:e.status,message:e.message,icon:e.icon,clearAt:e.clearAt,userId:v()?.uid})},async setStatusFromObject({commit:t},e){t("loadStatusFromServer",e)},async setPredefinedMessage({commit:t,rootState:e,state:s},{messageId:a,clearAt:n}){const r=J(n);await we(a,r);const o=e.predefinedStatuses.predefinedStatuses.find(c=>c.id===a),{message:i,icon:u}=o;t("setPredefinedMessage",{messageId:a,clearAt:r,message:i,icon:u}),I("user_status:status.updated",{status:s.status,message:s.message,icon:s.icon,clearAt:s.clearAt,userId:v()?.uid})},async setCustomMessage({commit:t,state:e},{message:s,icon:a,clearAt:n}){const r=J(n);await Ie(s,a,r),t("setCustomMessage",{message:s,icon:a,clearAt:r}),I("user_status:status.updated",{status:e.status,message:e.message,icon:e.icon,clearAt:e.clearAt,userId:v()?.uid})},async clearMessage({commit:t,state:e}){await Me(),t("clearMessage"),I("user_status:status.updated",{status:e.status,message:e.message,icon:e.icon,clearAt:e.clearAt,userId:v()?.uid})},async reFetchStatusFromServer({commit:t}){const e=await ve();t("loadStatusFromServer",e)},async setStatusFromHeartbeat({commit:t},e){t("loadStatusFromServer",e)},loadStatusFromInitialState({commit:t}){const e=It("user_status","status");t("loadStatusFromServer",e)}},Ue={state:Te,mutations:Pe,getters:xe,actions:Le},dt=ee({modules:{predefinedStatuses:ye,userStatus:Ue,userBackupStatus:je},strict:!0}),De=document.getElementById("user_status-menu-entry");function W(){const t=document.getElementById("user_status-menu-entry"),e=document.createElement("div");e.style.display="contents",t.replaceWith(e),K(ct).use(dt).mount(e)}De?W():X("core:user-menu:mounted",W),document.addEventListener("DOMContentLoaded",function(){OCA.Dashboard&&OCA.Dashboard.registerStatus("status",t=>{K(ct,{inline:!0}).use(dt).mount(t)})});export{ne as O,se as a,Je as c,Y as l,Re as m};
//# sourceMappingURL=user_status-menu.mjs.map
