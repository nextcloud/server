(()=>{var t,e,s,a={6919:(t,e,s)=>{"use strict";s.d(e,{A:()=>o});var a=s(71354),r=s.n(a),n=s(76314),i=s.n(n)()(r());i.push([t.id,".system-tag-form[data-v-2e1d5eac]{display:flex;flex-direction:column;max-width:400px;gap:8px 0}.system-tag-form__group[data-v-2e1d5eac]{display:flex;flex-direction:column}.system-tag-form__row[data-v-2e1d5eac]{margin-top:8px;display:flex;gap:0 4px}","",{version:3,sources:["webpack://./apps/systemtags/src/components/SystemTagForm.vue"],names:[],mappings:"AACA,kCACC,YAAA,CACA,qBAAA,CACA,eAAA,CACA,SAAA,CAEA,yCACC,YAAA,CACA,qBAAA,CAGD,uCACC,cAAA,CACA,YAAA,CACA,SAAA",sourcesContent:["\n.system-tag-form {\n\tdisplay: flex;\n\tflex-direction: column;\n\tmax-width: 400px;\n\tgap: 8px 0;\n\n\t&__group {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t&__row {\n\t\tmargin-top: 8px;\n\t\tdisplay: flex;\n\t\tgap: 0 4px;\n\t}\n}\n"],sourceRoot:""}]);const o=i},42634:()=>{},59169:()=>{},63779:()=>{},77199:()=>{},86833:()=>{},95869:(t,e,s)=>{"use strict";var a=s(21777),r=s(85471),n=s(2645),i=s(88837),o=s(53334),l=s(85168),c=s(21376),d=s(67607),g=s(5212),u=s(82182),m=s(71654);function p(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function y(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?p(Object(s),!0).forEach(function(e){h(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):p(Object(s)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}function h(t,e,s){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const v={userVisible:!0,userAssignable:!0,canAssign:!0};var f=s(19051),b=s(63814),A=s(45505);const T=(0,b.dC)("dav"),w=(0,A.UU)(T),C=t=>{w.setHeaders({"X-Requested-With":"XMLHttpRequest",requesttoken:null!=t?t:""})};(0,a.zo)(C),C((0,a.do)());const _=(0,s(35947).YK)().setApp("systemtags").detectUser().build();var x=s(61338),O=s(56760);function S(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),s.push.apply(s,a)}return s}function P(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?S(Object(s),!0).forEach(function(e){N(t,e,s[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):S(Object(s)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))})}return t}function N(t,e,s){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var j;!function(t){t.Public="Public",t.Restricted="Restricted",t.Invisible="Invisible"}(j||(j={}));const R=[{id:j.Public,label:(0,o.Tl)("systemtags","Public")},{id:j.Restricted,label:(0,o.Tl)("systemtags","Restricted")},{id:j.Invisible,label:(0,o.Tl)("systemtags","Invisible")}],k=(t,e)=>({[[!0,!0].join(",")]:j.Public,[[!0,!1].join(",")]:j.Restricted,[[!1,!1].join(",")]:j.Invisible}[[t,e].join(",")]),D=r.Ay.extend({name:"SystemTagForm",components:{NcButton:c.A,NcLoadingIcon:n.A,NcSelect:d.default,NcSelectTags:g.A,NcTextField:u.A},props:{tags:{type:Array,required:!0}},data:()=>({loading:!1,tagLevelOptions:R,selectedTag:null,errorMessage:"",tagName:"",tagLevel:j.Public}),watch:{selectedTag(t){this.tagName=t?t.displayName:"",this.tagLevel=t?k(t.userVisible,t.userAssignable):j.Public}},computed:{isCreating(){return null===this.selectedTag},isCreateDisabled(){return""===this.tagName},isUpdateDisabled(){var t,e,s;return""===this.tagName||(null===(t=this.selectedTag)||void 0===t?void 0:t.displayName)===this.tagName&&k(null===(e=this.selectedTag)||void 0===e?void 0:e.userVisible,null===(s=this.selectedTag)||void 0===s?void 0:s.userAssignable)===this.tagLevel},isResetDisabled(){return this.isCreating?""===this.tagName&&this.tagLevel===j.Public:null===this.selectedTag},userVisible(){return{[j.Public]:!0,[j.Restricted]:!0,[j.Invisible]:!1}[this.tagLevel]},userAssignable(){return{[j.Public]:!0,[j.Restricted]:!1,[j.Invisible]:!1}[this.tagLevel]},tagProperties(){return{displayName:this.tagName,userVisible:this.userVisible,userAssignable:this.userAssignable}}},methods:{t:o.Tl,async handleSubmit(){this.isCreating?await this.create():await this.update()},async create(){const t=P(P({},v),this.tagProperties);this.loading=!0;try{const e=await(async t=>{const e=(t=>{if("name"in t&&!("displayName"in t))return y({},t);const e=y({},t);return e.name=e.displayName,delete e.displayName,e})(t);try{const{headers:s}=await w.customRequest("/systemtags",{method:"POST",data:e}),a=s.get("content-location");if(a)return(0,x.Ic)("systemtags:tag:created",t),(t=>{const e=t.indexOf("?");e>0&&(t=t.substring(0,e));const s=t.split("/");let a;do{a=s[s.length-1],s.pop()}while(!a&&s.length>0);return Number(a)})(a);throw _.error((0,o.t)("systemtags",'Missing "Content-Location" header')),new Error((0,o.t)("systemtags",'Missing "Content-Location" header'))}catch(t){var s;if(409===(null==t||null===(s=t.response)||void 0===s?void 0:s.status))throw _.error((0,o.t)("systemtags","A tag with the same name already exists"),{error:t}),new Error((0,o.t)("systemtags","A tag with the same name already exists"));throw _.error((0,o.t)("systemtags","Failed to create tag"),{error:t}),new Error((0,o.t)("systemtags","Failed to create tag"))}})(t),s=P(P({},t),{},{id:e});this.$emit("tag:created",s),(0,l.Te)((0,o.Tl)("systemtags","Created tag")),this.reset()}catch(t){this.errorMessage=(0,o.Tl)("systemtags","Failed to create tag")}this.loading=!1},async update(){if(null===this.selectedTag)return;const t=P(P({},this.selectedTag),this.tagProperties);this.loading=!0;try{var e;await(async t=>{const e="/systemtags/"+t.id,s='<?xml version="1.0"?>\n\t<d:propertyupdate xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns" xmlns:nc="http://nextcloud.org/ns">\n\t\t<d:set>\n\t\t\t<d:prop>\n\t\t\t\t<oc:display-name>'.concat(t.displayName,"</oc:display-name>\n\t\t\t\t<oc:user-visible>").concat(t.userVisible,"</oc:user-visible>\n\t\t\t\t<oc:user-assignable>").concat(t.userAssignable,"</oc:user-assignable>\n\t\t\t\t<nc:color>").concat((null==t?void 0:t.color)||null,"</nc:color>\n\t\t\t</d:prop>\n\t\t</d:set>\n\t</d:propertyupdate>");try{await w.customRequest(e,{method:"PROPPATCH",data:s}),(0,x.Ic)("systemtags:tag:updated",t)}catch(t){throw _.error((0,o.t)("systemtags","Failed to update tag"),{error:t}),new Error((0,o.t)("systemtags","Failed to update tag"))}})(t),this.selectedTag=t,this.$emit("tag:updated",t),(0,l.Te)((0,o.Tl)("systemtags","Updated tag")),null===(e=this.$refs.tagNameInput)||void 0===e||e.focus()}catch(t){this.errorMessage=(0,o.Tl)("systemtags","Failed to update tag")}this.loading=!1},async handleDelete(){if(null!==this.selectedTag){this.loading=!0;try{await(async t=>{const e="/systemtags/"+t.id;try{await w.deleteFile(e),(0,x.Ic)("systemtags:tag:deleted",t)}catch(t){throw _.error((0,o.t)("systemtags","Failed to delete tag"),{error:t}),new Error((0,o.t)("systemtags","Failed to delete tag"))}})(this.selectedTag),this.$emit("tag:deleted",this.selectedTag),(0,l.Te)((0,o.Tl)("systemtags","Deleted tag")),this.reset()}catch(t){this.errorMessage=(0,o.Tl)("systemtags","Failed to delete tag")}this.loading=!1}},reset(){var t;this.selectedTag=null,this.errorMessage="",this.tagName="",this.tagLevel=j.Public,null===(t=this.$refs.tagNameInput)||void 0===t||t.focus()}}});var I=s(85072),E=s.n(I),L=s(97825),F=s.n(L),M=s(77659),U=s.n(M),B=s(55056),V=s.n(B),q=s(10540),$=s.n(q),Y=s(41113),z=s.n(Y),H=s(6919),K={};K.styleTagTransform=z(),K.setAttributes=V(),K.insert=U().bind(null,"head"),K.domAPI=F(),K.insertStyleElement=$(),E()(H.A,K),H.A&&H.A.locals&&H.A.locals;var Q=s(14486);const X=(0,Q.A)(D,function(){var t=this,e=t._self._c;return t._self._setupProxy,e("form",{staticClass:"system-tag-form",attrs:{disabled:t.loading,"aria-labelledby":"system-tag-form-heading"},on:{submit:function(e){return e.preventDefault(),t.handleSubmit.apply(null,arguments)},reset:t.reset}},[e("h4",{attrs:{id:"system-tag-form-heading"}},[t._v("\n\t\t"+t._s(t.t("systemtags","Create or edit tags"))+"\n\t")]),t._v(" "),e("div",{staticClass:"system-tag-form__group"},[e("label",{attrs:{for:"system-tags-input"}},[t._v(t._s(t.t("systemtags","Search for a tag to edit")))]),t._v(" "),e("NcSelectTags",{attrs:{"input-id":"system-tags-input",placeholder:t.t("systemtags","Collaborative tags …"),"fetch-tags":!1,options:t.tags,multiple:!1,passthru:""},scopedSlots:t._u([{key:"no-options",fn:function(){return[t._v("\n\t\t\t\t"+t._s(t.t("systemtags","No tags to select"))+"\n\t\t\t")]},proxy:!0}]),model:{value:t.selectedTag,callback:function(e){t.selectedTag=e},expression:"selectedTag"}})],1),t._v(" "),e("div",{staticClass:"system-tag-form__group"},[e("label",{attrs:{for:"system-tag-name"}},[t._v(t._s(t.t("systemtags","Tag name")))]),t._v(" "),e("NcTextField",{ref:"tagNameInput",attrs:{id:"system-tag-name",value:t.tagName,error:Boolean(t.errorMessage),"helper-text":t.errorMessage,"label-outside":""},on:{"update:value":function(e){t.tagName=e}}})],1),t._v(" "),e("div",{staticClass:"system-tag-form__group"},[e("label",{attrs:{for:"system-tag-level"}},[t._v(t._s(t.t("systemtags","Tag level")))]),t._v(" "),e("NcSelect",{attrs:{"input-id":"system-tag-level",options:t.tagLevelOptions,reduce:t=>t.id,clearable:!1,disabled:t.loading},model:{value:t.tagLevel,callback:function(e){t.tagLevel=e},expression:"tagLevel"}})],1),t._v(" "),e("div",{staticClass:"system-tag-form__row"},[t.isCreating?e("NcButton",{attrs:{"native-type":"submit",disabled:t.isCreateDisabled||t.loading}},[t._v("\n\t\t\t"+t._s(t.t("systemtags","Create"))+"\n\t\t")]):[e("NcButton",{attrs:{"native-type":"submit",disabled:t.isUpdateDisabled||t.loading}},[t._v("\n\t\t\t\t"+t._s(t.t("systemtags","Update"))+"\n\t\t\t")]),t._v(" "),e("NcButton",{attrs:{disabled:t.loading},on:{click:t.handleDelete}},[t._v("\n\t\t\t\t"+t._s(t.t("systemtags","Delete"))+"\n\t\t\t")])],t._v(" "),e("NcButton",{attrs:{"native-type":"reset",disabled:t.isResetDisabled||t.loading}},[t._v("\n\t\t\t"+t._s(t.t("systemtags","Reset"))+"\n\t\t")]),t._v(" "),t.loading?e("NcLoadingIcon",{attrs:{name:t.t("systemtags","Loading …"),size:32}}):t._e()],2)])},[],!1,null,"2e1d5eac",null).exports;var G=s(81222);const W={name:"SystemTagsCreationControl",components:{NcCheckboxRadioSwitch:s(32073).A},setup:()=>({t:o.t}),data:()=>({systemTagsCreationRestrictedToAdmin:(0,G.C)("systemtags","restrictSystemTagsCreationToAdmin",!1)}),methods:{async updateSystemTagsDefault(t){try{var e;const s=await(async t=>{const e=t?"1":"0",s=(0,b.KT)("/apps/provisioning_api/api/v1/config/apps/{appId}/{key}",{appId:"systemtags",key:"restrict_creation_to_admin"});return await(0,O.C5)(),(await f.Ay.post(s,{value:e})).data})(t);console.debug("updateSystemTagsDefault",s),this.handleResponse({isRestricted:t,status:null===(e=s.ocs)||void 0===e||null===(e=e.meta)||void 0===e?void 0:e.status})}catch(t){this.handleResponse({errorMessage:(0,o.t)("systemtags","Unable to update setting"),error:t})}},handleResponse(t){let{isRestricted:e,status:s,errorMessage:a,error:r}=t;if("ok"===s)return this.systemTagsCreationRestrictedToAdmin=e,void(0,l.Te)(e?(0,o.t)("systemtags","System tag creation is now restricted to administrators"):(0,o.t)("systemtags","System tag creation is now allowed for everybody"));a&&((0,l.Qg)(a),_.error(a,r))}}},J=(0,Q.A)(W,function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"system-tags-creation-control"}},[e("h4",{staticClass:"inlineblock"},[t._v("\n\t\t"+t._s(t.t("systemtags","System tag management"))+"\n\t")]),t._v(" "),e("p",{staticClass:"settings-hint"},[t._v("\n\t\t"+t._s(t.t("systemtags","If enabled, only administrators can create and edit tags. Accounts can still assign and remove them from files."))+"\n\t")]),t._v(" "),e("NcCheckboxRadioSwitch",{attrs:{type:"switch",checked:t.systemTagsCreationRestrictedToAdmin},on:{"update:checked":[function(e){t.systemTagsCreationRestrictedToAdmin=e},t.updateSystemTagsDefault]}},[t._v("\n\t\t"+t._s(t.t("systemtags","Restrict tag creation and editing to administrators"))+"\n\t")])],1)},[],!1,null,null,null).exports,Z=r.Ay.extend({name:"SystemTagsSection",components:{NcLoadingIcon:n.A,NcSettingsSection:i.A,SystemTagForm:X,SystemTagsCreationControl:J},data:()=>({loadingTags:!1,tags:[]}),async created(){this.loadingTags=!0;try{this.tags=await(async()=>{try{const{data:t}=await w.getDirectoryContents("/systemtags",{data:'<?xml version="1.0"?>\n<d:propfind xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns" xmlns:nc="http://nextcloud.org/ns">\n\t<d:prop>\n\t\t<oc:id />\n\t\t<oc:display-name />\n\t\t<oc:user-visible />\n\t\t<oc:user-assignable />\n\t\t<oc:can-assign />\n\t\t<d:getetag />\n\t\t<nc:color />\n\t</d:prop>\n</d:propfind>',details:!0,glob:"/systemtags/*"});return(t=>t.map(t=>{let{props:e}=t;return Object.fromEntries(Object.entries(e).map(t=>{let[e,s]=t;return[(0,m.A)(e),"displayName"===(0,m.A)(e)?String(s):s]}))}))(t)}catch(t){throw _.error((0,o.t)("systemtags","Failed to load tags"),{error:t}),new Error((0,o.t)("systemtags","Failed to load tags"))}})()}catch(t){(0,l.Qg)((0,o.Tl)("systemtags","Failed to load tags"))}this.loadingTags=!1},methods:{t:o.Tl,handleCreate(t){this.tags.unshift(t)},handleUpdate(t){const e=this.tags.findIndex(e=>e.id===t.id);this.tags.splice(e,1),this.tags.unshift(t)},handleDelete(t){const e=this.tags.findIndex(e=>e.id===t.id);this.tags.splice(e,1)}}}),tt=(0,Q.A)(Z,function(){var t=this,e=t._self._c;return t._self._setupProxy,e("NcSettingsSection",{attrs:{name:t.t("systemtags","Collaborative tags"),description:t.t("systemtags","Collaborative tags are available for all users. Restricted tags are visible to users but cannot be assigned by them. Invisible tags are for internal use, since users cannot see or assign them.")}},[e("SystemTagsCreationControl"),t._v(" "),t.loadingTags?e("NcLoadingIcon",{attrs:{name:t.t("systemtags","Loading collaborative tags …"),size:32}}):e("SystemTagForm",{attrs:{tags:t.tags},on:{"tag:created":t.handleCreate,"tag:updated":t.handleUpdate,"tag:deleted":t.handleDelete}})],1)},[],!1,null,null,null).exports;s.nc=(0,a.aV)(),(new(r.Ay.extend(tt))).$mount("#vue-admin-systemtags")}},r={};function n(t){var e=r[t];if(void 0!==e)return e.exports;var s=r[t]={id:t,loaded:!1,exports:{}};return a[t].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.m=a,t=[],n.O=(e,s,a,r)=>{if(!s){var i=1/0;for(d=0;d<t.length;d++){for(var[s,a,r]=t[d],o=!0,l=0;l<s.length;l++)(!1&r||i>=r)&&Object.keys(n.O).every(t=>n.O[t](s[l]))?s.splice(l--,1):(o=!1,r<i&&(i=r));if(o){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[s,a,r]},n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.f={},n.e=t=>Promise.all(Object.keys(n.f).reduce((e,s)=>(n.f[s](t,e),e),[])),n.u=t=>t+"-"+t+".js?v="+{640:"d4c5c018803ee8751b2a",780:"ff118c4ea27eb0b2dbdd",3564:"54a926778d2107076102",5810:"b550a24d46f75f92c2d5",7471:"6423b9b898ffefeb7d1d"}[t],n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),e={},s="nextcloud:",n.l=(t,a,r,i)=>{if(e[t])e[t].push(a);else{var o,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var g=c[d];if(g.getAttribute("src")==t||g.getAttribute("data-webpack")==s+r){o=g;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",n.nc&&o.setAttribute("nonce",n.nc),o.setAttribute("data-webpack",s+r),o.src=t),e[t]=[a];var u=(s,a)=>{o.onerror=o.onload=null,clearTimeout(m);var r=e[t];if(delete e[t],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach(t=>t(a)),s)return s(a)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),n.j=6349,(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var s=e.getElementsByTagName("script");if(s.length)for(var a=s.length-1;a>-1&&(!t||!/^http(s?):/.test(t));)t=s[a--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),(()=>{n.b="undefined"!=typeof document&&document.baseURI||self.location.href;var t={6349:0};n.f.j=(e,s)=>{var a=n.o(t,e)?t[e]:void 0;if(0!==a)if(a)s.push(a[2]);else{var r=new Promise((s,r)=>a=t[e]=[s,r]);s.push(a[2]=r);var i=n.p+n.u(e),o=new Error;n.l(i,s=>{if(n.o(t,e)&&(0!==(a=t[e])&&(t[e]=void 0),a)){var r=s&&("load"===s.type?"missing":s.type),i=s&&s.target&&s.target.src;o.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",o.name="ChunkLoadError",o.type=r,o.request=i,a[1](o)}},"chunk-"+e,e)}},n.O.j=e=>0===t[e];var e=(e,s)=>{var a,r,[i,o,l]=s,c=0;if(i.some(e=>0!==t[e])){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(l)var d=l(n)}for(e&&e(s);c<i.length;c++)r=i[c],n.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return n.O(d)},s=self.webpackChunknextcloud=self.webpackChunknextcloud||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))})(),n.nc=void 0;var i=n.O(void 0,[4208],()=>n(95869));i=n.O(i)})();
//# sourceMappingURL=systemtags-admin.js.map?v=f722883ea0729974ce81