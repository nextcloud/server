{"version":3,"file":"files_sharing-personal-settings.mjs","sources":["../apps/files_sharing/src/components/SelectShareFolderDialogue.vue","../apps/files_sharing/src/components/PersonalSettings.vue","../apps/files_sharing/src/personal-settings.js"],"sourcesContent":["<!--\n  - SPDX-FileCopyrightText: 2021 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div class=\"share-folder\">\n\t\t<!-- Folder picking form -->\n\t\t<form class=\"share-folder__form\" @reset.prevent.stop=\"resetFolder\">\n\t\t\t<NcTextField class=\"share-folder__picker\"\n\t\t\t\ttype=\"text\"\n\t\t\t\t:label=\"t('files_sharing', 'Set default folder for accepted shares')\"\n\t\t\t\t:value=\"readableDirectory\"\n\t\t\t\t@click.prevent=\"pickFolder\" />\n\n\t\t\t<!-- Show reset button if folder is different -->\n\t\t\t<input v-if=\"readableDirectory !== defaultDirectory\"\n\t\t\t\tclass=\"share-folder__reset\"\n\t\t\t\ttype=\"reset\"\n\t\t\t\t:value=\"t('files_sharing', 'Reset')\"\n\t\t\t\t:aria-label=\"t('files_sharing', 'Reset folder to system default')\">\n\t\t</form>\n\t</div>\n</template>\n\n<script>\nimport axios from '@nextcloud/axios'\nimport path from 'path'\nimport { generateUrl } from '@nextcloud/router'\nimport { getFilePickerBuilder, showError } from '@nextcloud/dialogs'\nimport { loadState } from '@nextcloud/initial-state'\nimport NcTextField from '@nextcloud/vue/dist/Components/NcTextField.js'\n\nconst defaultDirectory = loadState('files_sharing', 'default_share_folder', '/')\nconst directory = loadState('files_sharing', 'share_folder', defaultDirectory)\n\nexport default {\n\tname: 'SelectShareFolderDialogue',\n\tcomponents: {\n\t\tNcTextField,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tdirectory,\n\t\t\tdefaultDirectory,\n\t\t}\n\t},\n\tcomputed: {\n\t\treadableDirectory() {\n\t\t\tif (!this.directory) {\n\t\t\t\treturn '/'\n\t\t\t}\n\t\t\treturn this.directory\n\t\t},\n\t},\n\tmethods: {\n\t\tasync pickFolder() {\n\n\t\t\t// Setup file picker\n\t\t\tconst picker = getFilePickerBuilder(t('files', 'Choose a default folder for accepted shares'))\n\t\t\t\t.startAt(this.readableDirectory)\n\t\t\t\t.setMultiSelect(false)\n\t\t\t\t.setType(1)\n\t\t\t\t.setMimeTypeFilter(['httpd/unix-directory'])\n\t\t\t\t.allowDirectories()\n\t\t\t\t.build()\n\n\t\t\ttry {\n\t\t\t\t// Init user folder picking\n\t\t\t\tconst dir = await picker.pick() || '/'\n\t\t\t\tif (!dir.startsWith('/')) {\n\t\t\t\t\tthrow new Error(t('files', 'Invalid path selected'))\n\t\t\t\t}\n\n\t\t\t\t// Fix potential path issues and save results\n\t\t\t\tthis.directory = path.normalize(dir)\n\t\t\t\tawait axios.put(generateUrl('/apps/files_sharing/settings/shareFolder'), {\n\t\t\t\t\tshareFolder: this.directory,\n\t\t\t\t})\n\t\t\t} catch (error) {\n\t\t\t\tshowError(error.message || t('files', 'Unknown error'))\n\t\t\t}\n\t\t},\n\n\t\tresetFolder() {\n\t\t\tthis.directory = this.defaultDirectory\n\t\t\taxios.delete(generateUrl('/apps/files_sharing/settings/shareFolder'))\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\n.share-folder {\n\t&__form {\n\t\tdisplay: flex;\n\t}\n\n\t&__picker {\n\t\tcursor: pointer;\n\t\tmax-width: 300px;\n\t}\n\n\t// Make the reset button looks like text\n\t&__reset {\n\t\tbackground-color: transparent;\n\t\tborder: none;\n\t\tfont-weight: normal;\n\t\ttext-decoration: underline;\n\t\tfont-size: inherit;\n\t}\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<div v-if=\"!enforceAcceptShares || allowCustomDirectory\" id=\"files-sharing-personal-settings\" class=\"section\">\n\t\t<h2>{{ t('files_sharing', 'Sharing') }}</h2>\n\t\t<p v-if=\"!enforceAcceptShares\">\n\t\t\t<input id=\"files-sharing-personal-settings-accept\"\n\t\t\t\tv-model=\"accepting\"\n\t\t\t\tclass=\"checkbox\"\n\t\t\t\ttype=\"checkbox\"\n\t\t\t\t@change=\"toggleEnabled\">\n\t\t\t<label for=\"files-sharing-personal-settings-accept\">{{ t('files_sharing', 'Accept shares from other accounts and groups by default') }}</label>\n\t\t</p>\n\t\t<p v-if=\"allowCustomDirectory\">\n\t\t\t<SelectShareFolderDialogue />\n\t\t</p>\n\t</div>\n</template>\n\n<script>\nimport { generateUrl } from '@nextcloud/router'\nimport { loadState } from '@nextcloud/initial-state'\nimport { showError } from '@nextcloud/dialogs'\nimport axios from '@nextcloud/axios'\n\nimport SelectShareFolderDialogue from './SelectShareFolderDialogue.vue'\n\nexport default {\n\tname: 'PersonalSettings',\n\tcomponents: {\n\t\tSelectShareFolderDialogue,\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\t// Share acceptance config\n\t\t\taccepting: loadState('files_sharing', 'accept_default'),\n\t\t\tenforceAcceptShares: loadState('files_sharing', 'enforce_accept'),\n\n\t\t\t// Receiving share folder config\n\t\t\tallowCustomDirectory: loadState('files_sharing', 'allow_custom_share_folder'),\n\t\t}\n\t},\n\n\tmethods: {\n\t\tasync toggleEnabled() {\n\t\t\ttry {\n\t\t\t\tawait axios.put(generateUrl('/apps/files_sharing/settings/defaultAccept'), {\n\t\t\t\t\taccept: this.accepting,\n\t\t\t\t})\n\t\t\t} catch (error) {\n\t\t\t\tshowError(t('files_sharing', 'Error while toggling options'))\n\t\t\t\tconsole.error(error)\n\t\t\t}\n\t\t},\n\t},\n}\n</script>\n\n<style scoped lang=\"scss\">\np {\n\tmargin-top: 12px;\n\tmargin-bottom: 12px;\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2019 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport Vue from 'vue'\nimport PersonalSettings from './components/PersonalSettings.vue'\n\nVue.prototype.t = t\n\nconst View = Vue.extend(PersonalSettings)\nnew View().$mount('#files-sharing-personal-settings')\n"],"names":["defaultDirectory","loadState","directory","_sfc_main","NcTextField","picker","getFilePickerBuilder","dir","path","axios","generateUrl","error","showError","SelectShareFolderDialogue","Vue","View","PersonalSettings"],"mappings":";+UAiCA,MAAAA,EAAAC,EAAA,gBAAA,uBAAA,GAAA,EACAC,EAAAD,EAAA,gBAAA,eAAAD,CAAA,EAEAG,EAAA,CACA,KAAA,4BACA,WAAA,CACA,YAAAC,CACA,EACA,MAAA,CACA,MAAA,CACA,UAAAF,EACA,iBAAAF,CACA,CACA,EACA,SAAA,CACA,mBAAA,CACA,OAAA,KAAA,UAGA,KAAA,UAFA,GAGA,CACA,EACA,QAAA,CACA,MAAA,YAAA,CAGA,MAAAK,EAAAC,EAAA,EAAA,QAAA,6CAAA,CAAA,EACA,QAAA,KAAA,iBAAA,EACA,eAAA,EAAA,EACA,QAAA,CAAA,EACA,kBAAA,CAAA,sBAAA,CAAA,EACA,iBAAA,EACA,MAAA,EAEA,GAAA,CAEA,MAAAC,EAAA,MAAAF,EAAA,KAAA,GAAA,IACA,GAAA,CAAAE,EAAA,WAAA,GAAA,EACA,MAAA,IAAA,MAAA,EAAA,QAAA,uBAAA,CAAA,EAIA,KAAA,UAAAC,EAAA,UAAAD,CAAA,EACA,MAAAE,EAAA,IAAAC,EAAA,0CAAA,EAAA,CACA,YAAA,KAAA,SACA,CAAA,CACA,OAAAC,EAAA,CACAC,EAAAD,EAAA,SAAA,EAAA,QAAA,eAAA,CAAA,CACA,CACA,EAEA,aAAA,CACA,KAAA,UAAA,KAAA,iBACAF,EAAA,OAAAC,EAAA,0CAAA,CAAA,CACA,CACA,CACA,6wBC3DAP,EAAA,CACA,KAAA,mBACA,WAAA,CACA,0BAAAU,CACA,EAEA,MAAA,CACA,MAAA,CAEA,UAAAZ,EAAA,gBAAA,gBAAA,EACA,oBAAAA,EAAA,gBAAA,gBAAA,EAGA,qBAAAA,EAAA,gBAAA,2BAAA,CACA,CACA,EAEA,QAAA,CACA,MAAA,eAAA,CACA,GAAA,CACA,MAAAQ,EAAA,IAAAC,EAAA,4CAAA,EAAA,CACA,OAAA,KAAA,SACA,CAAA,CACA,OAAAC,EAAA,CACAC,EAAA,EAAA,gBAAA,8BAAA,CAAA,EACA,QAAA,MAAAD,CAAA,CACA,CACA,CACA,CACA,wjCCnDAG,EAAI,UAAU,EAAI,EAElB,MAAMC,EAAOD,EAAI,OAAOE,CAAgB,EACxC,IAAID,EAAI,EAAG,OAAO,kCAAkC"}