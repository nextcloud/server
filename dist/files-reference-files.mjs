/*! third party licenses: dist/vendor.LICENSE.txt */
import{a_ as p,c1 as h,bW as m,bZ as c,bS as a,aV as o,aI as w,aH as u,L as v}from"./core-common.mjs";import{R as b}from"./chunks/index-D0hy_tCT.mjs";import"./chunks/index-DG15V7L3.mjs";import{a8 as _,a9 as g,n as f}from"./chunks/icons-TElqpmA8.mjs";import{a as O}from"./chunks/index-PaKKd09k.mjs";import{FilePickerVue as y}from"./chunks/index-CqRCpcyw-BsQDTmMm.mjs";import"./chunks/preload-helper-BG02UnR2.mjs";import"./chunks/_plugin-vue2_normalizer-VrK6B12S-BQkexw0P.mjs";import"./chunks/index-CiG5J8j_.mjs";import"./chunks/index-CPb3EwrS.mjs";import"./chunks/index-tn-fAC9x.mjs";const j=p({name:"ReferenceFileWidget",components:{FolderIcon:_,FileIcon:g},props:{richObject:{type:Object,required:!0},accessible:{type:Boolean,default:!0},interactive:{type:Boolean,default:!0}},data(){return{previewUrl:null,failedViewer:!1}},computed:{availableViewerHandlers(){var e,i;return((i=(e=window==null?void 0:window.OCA)==null?void 0:e.Viewer)==null?void 0:i.availableHandlers)||[]},viewerHandler(){return this.availableViewerHandlers.find(e=>e.mimes.includes(this.richObject.mimetype))},viewerFile(){var e;const i=h("dav/files/".concat((e=m())==null?void 0:e.uid,"/").concat(this.richObject.path)).replace(/\/\/$/,"/");return{filename:this.richObject.path,basename:this.richObject.name,lastmod:new Date(this.richObject.mtime*1e3),size:this.richObject.size,type:"file",mime:this.richObject.mimetype,fileid:this.richObject.id,failed:!1,loaded:!0,davPath:i,source:i}},fileSize(){return window.OC.Util.humanFileSize(this.richObject.size)},fileMtime(){return window.OC.Util.relativeModifiedDate(this.richObject.mtime*1e3)},filePath(){return O.dirname(this.richObject.path)},filePreviewStyle(){return this.previewUrl?{backgroundImage:"url("+this.previewUrl+")"}:{}},filePreviewClass(){return this.previewUrl?"widget-file__image--preview":"widget-file__image--icon"},isFolder(){return this.richObject.mimetype==="httpd/unix-directory"}},mounted(){if(this.richObject["preview-available"]){const e=c("/core/preview?fileId={fileId}&x=250&y=250",{fileId:this.richObject.id}),i=new Image;i.onload=()=>{this.previewUrl=e},i.onerror=l=>{console.error("could not load recommendation preview",l)},i.src=e}},methods:{navigate(e){var i,l,s,r,n,d;this.isFolder?(e.stopPropagation(),e.preventDefault(),this.openFilePicker()):((l=(i=window==null?void 0:window.OCA)==null?void 0:i.Viewer)==null?void 0:l.mimetypes.indexOf(this.richObject.mimetype))!==-1&&!((r=(s=window==null?void 0:window.OCA)==null?void 0:s.Viewer)!=null&&r.file)&&(e.stopPropagation(),e.preventDefault(),(d=(n=window==null?void 0:window.OCA)==null?void 0:n.Viewer)==null||d.open({path:this.richObject.path}))},openFilePicker(){b(t("settings","Your files")).allowDirectories(!0).setMultiSelect(!1).addButton({id:"open",label:this.t("settings","Open in files"),callback(e){e[0]&&window.open(c("/f/{fileid}",{fileid:e[0].fileid}))},type:"primary"}).disableNavigation().startAt(this.richObject.path).build().pick()}}});var C=function(){var e=this,i=e._self._c;return e._self._setupProxy,e.accessible?e.interactive&&e.viewerHandler&&!e.failedViewer?i(e.viewerHandler.component,e._b({tag:"component",staticClass:"widget-file widget-file--interactive",attrs:{active:!1,"can-swipe":!1,"can-zoom":!1,"is-embedded":!0,"file-list":[e.viewerFile],"is-full-screen":!1,"is-sidebar-shown":!1},on:{error:function(l){e.failedViewer=!0}}},"component",e.viewerFile,!1)):i("a",{staticClass:"widget-file widget-file--link",attrs:{href:e.richObject.link,target:"_blank"},on:{click:e.navigate}},[i("span",{staticClass:"widget-file__image",class:e.filePreviewClass,style:e.filePreviewStyle},[e.previewUrl?e._e():[e.isFolder?i("FolderIcon",{attrs:{size:88,"fill-color":"var(--color-primary-element)"}}):i("FileIcon",{attrs:{size:88}})]],2),i("span",{staticClass:"widget-file__details"},[i("p",{staticClass:"widget-file__title"},[e._v(e._s(e.richObject.name))]),i("p",{staticClass:"widget-file__description"},[e._v(e._s(e.fileSize)),i("br"),e._v(e._s(e.fileMtime))]),i("p",{staticClass:"widget-file__link"},[e._v(e._s(e.filePath))])])]):i("div",{staticClass:"widget-file widget-file--no-access"},[i("span",{staticClass:"widget-file__image widget-file__image--icon"},[e.isFolder?i("FolderIcon",{attrs:{size:88}}):i("FileIcon",{attrs:{size:88}})],1),i("span",{staticClass:"widget-file__details"},[i("p",{staticClass:"widget-file__title"},[e._v(" "+e._s(e.t("files","File cannot be accessed"))+" ")]),i("p",{staticClass:"widget-file__description"},[e._v(" "+e._s(e.t("files","The file could not be found or you do not have permissions to view it. Ask the sender to share it."))+" ")])])])},F=[],k=f(j,C,F,!1,null,"af9044ca");const I=k.exports,P=p({name:"FileReferencePickerElement",components:{FilePicker:y},props:{providerId:{type:String,required:!0},accessible:{type:Boolean,default:!1}},computed:{containerId(){return"filepicker-".concat(Math.random().toString(36).slice(7))},filepickerOptions(){return{allowPickDirectory:!1,buttons:this.buttonFactory,container:"#".concat(this.containerId),multiselect:!1,name:a("files","Select file or folder to link to")}}},methods:{t:a,buttonFactory(e){const i=[];return e.length===0?i.push({label:a("files","Choose file"),type:"tertiary",callback:this.onClose}):i.push({label:a("files","Choose {file}",{file:e[0].basename}),type:"primary",callback:this.onClose}),i},onClose(e){e===void 0||e.length===0?this.$emit("cancel"):this.onSubmit(e[0])},onSubmit(e){const i=new URL(window.location.href);i.pathname=c("/f/{fileId}",{fileId:e.fileid}),i.search="",this.$emit("submit",i.href)}}});var S=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("div",{attrs:{id:e.containerId}},[i("FilePicker",e._b({on:{close:e.onClose}},"FilePicker",e.filepickerOptions,!1))],1)},V=[],x=f(P,S,V,!1,null,null);const z=x.exports;o.mixin({methods:{t:a}}),w("file",(e,{richObjectType:i,richObject:l,accessible:s,interactive:r})=>{const n=o.extend(I);new n({propsData:{richObjectType:i,richObject:l,accessible:s,interactive:r}}).$mount(e)},()=>{},{hasInteractiveView:!0}),u("files",(e,{providerId:i,accessible:l})=>{const s=o.extend(z),r=new s({propsData:{providerId:i,accessible:l}}).$mount(e);return new v(r.$el,r)},(e,i)=>{i.object.$destroy()});
