import{c as lt,a as H,u as z,s as j}from"./index-Bndk0DrU.chunk.mjs";import{c as at}from"./index-C-LJcJnH.chunk.mjs";import{_ as nt,g as rt,r as ht,q as dt,b as ft,a as B,N as pt}from"./createElementId-DhjFt1I9-BQ18DTJF.chunk.mjs";import{j as b,o as m,k as $,m as it,l as N,K as P,n as q,t as U,R as mt,z as Q,r as gt,s as V,a3 as yt,a2 as w,u as vt,f as I,aa as bt,E as St,c as M,w as D,x as X,e as Y,F as _t,C as At,I as xt,y as kt,g as wt}from"./runtime-dom.esm-bundler-BprhcrOE.chunk.mjs";import{d as Lt,e as Ut,g as R,h as It,j as Mt,a as Nt,I as Ct}from"./NcModal-DHryP_87-06sOiSPg.chunk.mjs";import{l as K,N as Dt,g as Et}from"./AccountOutline-DmK_gbmB.chunk.mjs";import{g as Ot}from"./colors-BHGKZFDI-LpnWtamI.chunk.mjs";import"./translation-DoG5ZELJ-Bni_xMHF.chunk.mjs";import{g as $t}from"./index-Ma7sfat2.chunk.mjs";import{N as Pt,g as Tt}from"./NcUserStatusIcon-XiwrgeCm-BlmNOek6.chunk.mjs";import{A as zt,N as jt}from"./PencilOutline-Co91mt8h.chunk.mjs";import{a as Bt,N as Gt}from"./NcDateTime.vue_vue_type_script_setup_true_lang-BhB8yA4U-BBzIHw3y.chunk.mjs";import{N as Ft}from"./Web-sfKoe9bN.chunk.mjs";const Wt={name:"NcActionText",mixins:[zt],inject:{isInSemanticMenu:{from:Lt,default:!1}}},Ht=["role"],qt={key:0,class:"action-text__longtext-wrapper"},Vt={class:"action-text__name"},Rt=["textContent"],Kt=["textContent"],Jt={key:2,class:"action-text__text"};function Qt(i,r,n,e,t,s){return m(),b("li",{class:"action",role:s.isInSemanticMenu&&"presentation"},[$("span",{class:"action-text",onClick:r[0]||(r[0]=(...a)=>i.onClick&&i.onClick(...a))},[it(i.$slots,"icon",{},()=>[i.icon!==""?(m(),b("span",{key:0,"aria-hidden":"true",class:q(["action-text__icon",[i.isIconUrl?"action-text__icon--url":i.icon]]),style:P({backgroundImage:i.isIconUrl?`url(${i.icon})`:null})},null,6)):N("",!0)],!0),i.name?(m(),b("span",qt,[$("strong",Vt,U(i.name),1),$("span",{class:"action-text__longtext",textContent:U(i.text)},null,8,Rt)])):i.isLongText?(m(),b("span",{key:1,class:"action-text__longtext",textContent:U(i.text)},null,8,Kt)):(m(),b("span",Jt,U(i.text),1)),N("",!0)])],8,Ht)}const Xt=nt(Wt,[["render",Qt],["__scopeId","data-v-fa684b48"]]),Yt=Symbol.for("nc:theme:enforced");function Zt(i){const r=Q(()=>w(i)??document.body),n=gt(R(r.value)),e=Mt();function t(){n.value=R(r.value)}return It(r,t,{attributes:!0}),V(r,t),V(e,t,{immediate:!0}),yt(n)}const te=Ut(()=>Zt());function ee(){const i=te(),r=mt(Yt,void 0);return Q(()=>r?.value?r.value==="dark":i.value)}const se=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const ae=Object.prototype.toString,ne=i=>ae.call(i)==="[object Object]",O=()=>{};function G(i){return Array.isArray(i)?i:[i]}function re(i,r,n){return V(i,r,{...n,immediate:!0})}const ot=se?window:void 0;function E(i){var r;const n=w(i);return(r=n?.$el)!==null&&r!==void 0?r:n}function F(...i){const r=(e,t,s,a)=>(e.addEventListener(t,s,a),()=>e.removeEventListener(t,s,a)),n=Q(()=>{const e=G(w(i[0])).filter(t=>t!=null);return e.every(t=>typeof t!="string")?e:void 0});return re(()=>{var e,t;return[(e=(t=n.value)===null||t===void 0?void 0:t.map(s=>E(s)))!==null&&e!==void 0?e:[ot].filter(s=>s!=null),G(w(n.value?i[1]:i[0])),G(vt(n.value?i[2]:i[1])),w(n.value?i[3]:i[2])]},([e,t,s,a],f,p)=>{if(!e?.length||!t?.length||!s?.length)return;const S=ne(a)?{...a}:a,A=e.flatMap(_=>t.flatMap(x=>s.map(g=>r(_,x,g,S))));p(()=>{A.forEach(_=>_())})},{flush:"post"})}function Z(i,r,n={}){const{window:e=ot,ignore:t=[],capture:s=!0,detectIframe:a=!1,controls:f=!1}=n;if(!e)return f?{stop:O,cancel:O,trigger:O}:O;let p=!0;const S=o=>w(t).some(l=>{if(typeof l=="string")return Array.from(e.document.querySelectorAll(l)).some(h=>h===o.target||o.composedPath().includes(h));{const h=E(l);return h&&(o.target===h||o.composedPath().includes(h))}});function A(o){const l=w(o);return l&&l.$.subTree.shapeFlag===16}function _(o,l){const h=w(o),d=h.$.subTree&&h.$.subTree.children;return d==null||!Array.isArray(d)?!1:d.some(L=>L.el===l.target||l.composedPath().includes(L.el))}const x=o=>{const l=E(i);if(o.target!=null&&!(!(l instanceof Element)&&A(i)&&_(i,o))&&!(!l||l===o.target||o.composedPath().includes(l))){if("detail"in o&&o.detail===0&&(p=!S(o)),!p){p=!0;return}r(o)}};let g=!1;const c=[F(e,"click",o=>{g||(g=!0,setTimeout(()=>{g=!1},0),x(o))},{passive:!0,capture:s}),F(e,"pointerdown",o=>{const l=E(i);p=!S(o)&&!!(l&&!o.composedPath().includes(l))},{passive:!0}),a&&F(e,"blur",o=>{setTimeout(()=>{var l;const h=E(i);((l=e.document.activeElement)===null||l===void 0?void 0:l.tagName)==="IFRAME"&&!h?.contains(e.document.activeElement)&&r(o)},0)},{passive:!0})].filter(Boolean),u=()=>c.forEach(o=>o());return f?{stop:u,cancel:()=>{p=!1},trigger:o=>{p=!0,x(o),p=!1}}:u}const W=new WeakMap,ie={mounted(i,r){const n=!r.modifiers.bubble;let e;if(typeof r.value=="function")e=Z(i,r.value,{capture:n});else{const[t,s]=r.value;e=Z(i,t,Object.assign({capture:n},s))}W.set(i,e)},unmounted(i){const r=W.get(i);r&&typeof r=="function"?r():r?.stop(),W.delete(i)}};function oe(i){return window._nc_contacts_menu_hooks?Object.values(window._nc_contacts_menu_hooks).filter(r=>r.enabled(i)):[]}const ue=new Int32Array(4);class y{static hashStr(r,n=!1){return this.onePassHasher.start().appendStr(r).end(n)}static hashAsciiStr(r,n=!1){return this.onePassHasher.start().appendAsciiStr(r).end(n)}static stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]);static buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);static hexChars="0123456789abcdef";static hexOut=[];static onePassHasher=new y;static _hex(r){const n=y.hexChars,e=y.hexOut;let t,s,a,f;for(f=0;f<4;f+=1)for(s=f*8,t=r[f],a=0;a<8;a+=2)e[s+1+a]=n.charAt(t&15),t>>>=4,e[s+0+a]=n.charAt(t&15),t>>>=4;return e.join("")}static _md5cycle(r,n){let e=r[0],t=r[1],s=r[2],a=r[3];e+=(t&s|~t&a)+n[0]-680876936|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[1]-389564586|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[2]+606105819|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[3]-1044525330|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&a)+n[4]-176418897|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[5]+1200080426|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[6]-1473231341|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[7]-45705983|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&a)+n[8]+1770035416|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[9]-1958414417|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[10]-42063|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[11]-1990404162|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&a)+n[12]+1804603682|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[13]-40341101|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[14]-1502002290|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[15]+1236535329|0,t=(t<<22|t>>>10)+s|0,e+=(t&a|s&~a)+n[1]-165796510|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[6]-1069501632|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[11]+643717713|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[0]-373897302|0,t=(t<<20|t>>>12)+s|0,e+=(t&a|s&~a)+n[5]-701558691|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[10]+38016083|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[15]-660478335|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[4]-405537848|0,t=(t<<20|t>>>12)+s|0,e+=(t&a|s&~a)+n[9]+568446438|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[14]-1019803690|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[3]-187363961|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[8]+1163531501|0,t=(t<<20|t>>>12)+s|0,e+=(t&a|s&~a)+n[13]-1444681467|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[2]-51403784|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[7]+1735328473|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[12]-1926607734|0,t=(t<<20|t>>>12)+s|0,e+=(t^s^a)+n[5]-378558|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[8]-2022574463|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[11]+1839030562|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[14]-35309556|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^a)+n[1]-1530992060|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[4]+1272893353|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[7]-155497632|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[10]-1094730640|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^a)+n[13]+681279174|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[0]-358537222|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[3]-722521979|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[6]+76029189|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^a)+n[9]-640364487|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[12]-421815835|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[15]+530742520|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[2]-995338651|0,t=(t<<23|t>>>9)+s|0,e+=(s^(t|~a))+n[0]-198630844|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[7]+1126891415|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[14]-1416354905|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[5]-57434055|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~a))+n[12]+1700485571|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[3]-1894986606|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[10]-1051523|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[1]-2054922799|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~a))+n[8]+1873313359|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[15]-30611744|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[6]-1560198380|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[13]+1309151649|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~a))+n[4]-145523070|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[11]-1120210379|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[2]+718787259|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[9]-343485551|0,t=(t<<21|t>>>11)+s|0,r[0]=e+r[0]|0,r[1]=t+r[1]|0,r[2]=s+r[2]|0,r[3]=a+r[3]|0}_dataLength=0;_bufferLength=0;_state=new Int32Array(4);_buffer=new ArrayBuffer(68);_buffer8;_buffer32;constructor(){this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(y.stateIdentity),this}appendStr(r){const n=this._buffer8,e=this._buffer32;let t=this._bufferLength,s,a;for(a=0;a<r.length;a+=1){if(s=r.charCodeAt(a),s<128)n[t++]=s;else if(s<2048)n[t++]=(s>>>6)+192,n[t++]=s&63|128;else if(s<55296||s>56319)n[t++]=(s>>>12)+224,n[t++]=s>>>6&63|128,n[t++]=s&63|128;else{if(s=(s-55296)*1024+(r.charCodeAt(++a)-56320)+65536,s>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");n[t++]=(s>>>18)+240,n[t++]=s>>>12&63|128,n[t++]=s>>>6&63|128,n[t++]=s&63|128}t>=64&&(this._dataLength+=64,y._md5cycle(this._state,e),t-=64,e[0]=e[16])}return this._bufferLength=t,this}appendAsciiStr(r){const n=this._buffer8,e=this._buffer32;let t=this._bufferLength,s,a=0;for(;;){for(s=Math.min(r.length-a,64-t);s--;)n[t++]=r.charCodeAt(a++);if(t<64)break;this._dataLength+=64,y._md5cycle(this._state,e),t=0}return this._bufferLength=t,this}appendByteArray(r){const n=this._buffer8,e=this._buffer32;let t=this._bufferLength,s,a=0;for(;;){for(s=Math.min(r.length-a,64-t);s--;)n[t++]=r[a++];if(t<64)break;this._dataLength+=64,y._md5cycle(this._state,e),t=0}return this._bufferLength=t,this}getState(){const r=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[r[0],r[1],r[2],r[3]]}}setState(r){const n=r.buffer,e=r.state,t=this._state;let s;for(this._dataLength=r.length,this._bufferLength=r.buflen,t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],s=0;s<n.length;s+=1)this._buffer8[s]=n.charCodeAt(s)}end(r=!1){const n=this._bufferLength,e=this._buffer8,t=this._buffer32,s=(n>>2)+1;this._dataLength+=n;const a=this._dataLength*8;if(e[n]=128,e[n+1]=e[n+2]=e[n+3]=0,t.set(y.buffer32Identity.subarray(s),s),n>55&&(y._md5cycle(this._state,t),t.set(y.buffer32Identity)),a<=4294967295)t[14]=a;else{const f=a.toString(16).match(/(.*?)(.{0,8})$/);if(f===null)return r?ue:"";const p=parseInt(f[2],16),S=parseInt(f[1],16)||0;t[14]=p,t[15]=S}return y._md5cycle(this._state,t),r?this._state:y._hex(this._state)}}if(y.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");function ce(i){let r=i;i.match(/^([0-9a-f]{4}-?){8}$/)===null&&(r=y.hashStr(i)),r=r.replace(/[^0-9a-f]/g,"");let n=0;for(let e=0;e<r.length;e++)n+=parseInt(r.charAt(e),16);return n}function tt(i){const r=Ot(6),n=ce(i.toLocaleLowerCase());return r[n%r.length]}var J={exports:{}},le=J.exports,et;function he(){return et||(et=1,(function(i){(function(r){if(typeof n!="function"){var n=function(c){return c};n.nonNative=!0}const e=n("plaintext"),t=n("html"),s=n("comment"),a=/<(\w*)>/g,f=/<\/?([^\s\/>]+)/;function p(c,u,o){c=c||"",u=u||[],o=o||"";let l=A(u,o);return _(c,l)}function S(c,u){c=c||[],u=u||"";let o=A(c,u);return function(l){return _(l||"",o)}}p.init_streaming_mode=S;function A(c,u){return c=x(c),{allowable_tags:c,tag_replacement:u,state:e,tag_buffer:"",depth:0,in_quote_char:""}}function _(c,u){if(typeof c!="string")throw new TypeError("'html' parameter must be a string");let o=u.allowable_tags,l=u.tag_replacement,h=u.state,d=u.tag_buffer,L=u.depth,k=u.in_quote_char,C="";for(let T=0,ct=c.length;T<ct;T++){let v=c[T];if(h===e)v==="<"?(h=t,d+=v):C+=v;else if(h===t)switch(v){case"<":if(k)break;L++;break;case">":if(k)break;if(L){L--;break}k="",h=e,d+=">",o.has(g(d))?C+=d:C+=l,d="";break;case'"':case"'":v===k?k="":k=k||v,d+=v;break;case"-":d==="<!-"&&(h=s),d+=v;break;case" ":case`
`:if(d==="<"){h=e,C+="< ",d="";break}d+=v;break;default:d+=v;break}else h===s&&(v===">"?(d.slice(-2)=="--"&&(h=e),d=""):d+=v)}return u.state=h,u.tag_buffer=d,u.depth=L,u.in_quote_char=k,C}function x(c){let u=new Set;if(typeof c=="string"){let o;for(;o=a.exec(c);)u.add(o[1])}else!n.nonNative&&typeof c[n.iterator]=="function"?u=new Set(c):typeof c.forEach=="function"&&c.forEach(u.add,u);return u}function g(c){let u=f.exec(c);return u?u[1].toLowerCase():null}i.exports?i.exports=p:r.striptags=p})(le)})(J)),J.exports}he();function de(i,r){const n=(r?.size||64)<=64?64:512,e=r?.isGuest?"/guest":"",t=r?.isDarkTheme??R(document.body)?"/dark":"";return rt(`/avatar${e}/{user}/{size}${t}`,{user:i,size:n})}ht(dt);const fe={data(){return{hasStatus:!1,userStatus:{status:null,message:null,icon:null}}},methods:{async fetchUserStatus(i){if(!i)return;const r=$t();if(!(!Object.hasOwn(r,"user_status")||!r.user_status.enabled)&&H())try{const{data:n}=await at.get(ft("apps/user_status/api/v1/statuses/{userId}",{userId:i}));this.setUserStatus(n.ocs.data)}catch(n){if(n.response.status===404&&n.response.data.ocs?.data?.length===0)return;K.error("Failed to fetch user status",{error:n})}},setUserStatus({status:i,message:r,icon:n}){this.userStatus.status=i||"",this.userStatus.message=r||"",this.userStatus.icon=n||"",this.hasStatus=!!i}}},ut=lt("nextcloud").persist().build();function pe(i){const r=ut.getItem("user-has-avatar."+i);return typeof r=="string"?!!r:null}function st(i,r){i&&ut.setItem("user-has-avatar."+i,r)}const me={name:"NcAvatar",directives:{ClickOutside:ie},components:{IconDotsHorizontal:Ct,NcActions:Nt,NcButton:Dt,NcIconSvgWrapper:pt,NcLoadingIcon:Ft,NcUserStatusIcon:Pt},mixins:[fe],props:{url:{type:String,default:void 0},iconClass:{type:String,default:void 0},user:{type:String,default:void 0},hideStatus:{type:Boolean,default:!1},verboseStatus:{type:Boolean,default:!1},preloadedUserStatus:{type:Object,default:void 0},isGuest:{type:Boolean,default:!1},displayName:{type:String,default:void 0},size:{type:Number,default:32},noPlaceholder:{type:Boolean,default:!1},disableTooltip:{type:Boolean,default:!1},disableMenu:{type:Boolean,default:!1},tooltipMessage:{type:String,default:null},isNoUser:{type:Boolean,default:!1},menuContainer:{type:[Boolean,String,Object,Element],default:"body"}},setup(){return{isDarkTheme:ee()}},data(){return{avatarUrlLoaded:null,avatarSrcSetLoaded:null,userDoesNotExist:!1,isAvatarLoaded:!1,isMenuLoaded:!1,contactsMenuLoading:!1,contactsMenuData:{},contactsMenuActions:[],contactsMenuOpenState:!1}},computed:{avatarAriaLabel(){if(this.hasMenu)return this.canDisplayUserStatus||this.showUserStatusIconOnAvatar?B("Avatar of {displayName}, {status}",{displayName:this.displayName??this.user,status:Tt(this.userStatus.status)}):B("Avatar of {displayName}",{displayName:this.displayName??this.user})},canDisplayUserStatus(){return!this.hideStatus&&this.hasStatus&&["online","away","busy","dnd"].includes(this.userStatus.status)},showUserStatusIconOnAvatar(){return!this.hideStatus&&!this.verboseStatus&&this.hasStatus&&this.userStatus.status!=="dnd"&&this.userStatus.icon},userIdentifier(){return this.isDisplayNameDefined?this.displayName:this.isUserDefined?this.user:""},isUserDefined(){return typeof this.user<"u"},isDisplayNameDefined(){return typeof this.displayName<"u"},isUrlDefined(){return typeof this.url<"u"},hasMenu(){return this.disableMenu?!1:this.isMenuLoaded?this.menu.length>0:!(this.user===H()?.uid||this.userDoesNotExist||this.url)},showInitials(){return!this.noPlaceholder&&this.userDoesNotExist&&!(this.iconClass||this.$slots.icon)},avatarStyle(){return{"--avatar-size":this.size+"px",lineHeight:this.showInitials?this.size+"px":0,fontSize:Math.round(this.size*.45)+"px"}},initialsWrapperStyle(){const{r:i,g:r,b:n}=tt(this.userIdentifier);return{backgroundColor:`rgba(${i}, ${r}, ${n}, 0.1)`}},initialsStyle(){const{r:i,g:r,b:n}=tt(this.userIdentifier);return{color:`rgb(${i}, ${r}, ${n})`}},tooltip(){return this.disableTooltip?null:this.tooltipMessage?this.tooltipMessage:this.displayName},initials(){let i="?";if(this.showInitials){const r=this.userIdentifier.trim();if(r==="")return i;const n=r.match(/[\p{L}\p{N}\s]/gu);if(!n)return i;const e=n.join(""),t=e.lastIndexOf(" ");i=String.fromCodePoint(e.codePointAt(0)),t!==-1&&(i=i.concat(String.fromCodePoint(e.codePointAt(t+1))))}return i.toLocaleUpperCase()},menu(){const i=this.contactsMenuActions.map(n=>{const e=Et(this.$router,n.hyperlink);return{ncActionComponent:e?Bt:Gt,ncActionComponentProps:e?{to:e,icon:n.icon}:{href:n.hyperlink,icon:n.icon},text:n.title}});for(const n of oe(this.contactsMenuData))try{i.push({ncActionComponent:jt,ncActionComponentProps:{onClick:()=>n.callback(this.contactsMenuData)},text:n.displayName(this.contactsMenuData),iconSvg:n.iconSvg(this.contactsMenuData)})}catch(e){K.error(`Failed to render ContactsMenu action ${n.id}`,{error:e,action:n})}function r(n){const e=document.createTextNode(n),t=document.createElement("p");return t.appendChild(e),t.innerHTML}if(!this.hideStatus&&(this.userStatus.icon||this.userStatus.message)){const n=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
					<text x="50%" y="50%" text-anchor="middle" style="dominant-baseline: central; font-size: 85%">${r(this.userStatus.icon)}</text>
				</svg>`;return[{ncActionComponent:Xt,ncActionComponentProps:{},iconSvg:this.userStatus.icon?n:void 0,text:`${this.userStatus.message}`}].concat(i)}return i}},watch:{url(){this.userDoesNotExist=!1,this.loadAvatarUrl()},user(){this.userDoesNotExist=!1,this.isMenuLoaded=!1,this.loadAvatarUrl()}},mounted(){this.loadAvatarUrl(),j("settings:avatar:updated",this.loadAvatarUrl),j("settings:display-name:updated",this.loadAvatarUrl),!this.hideStatus&&this.user&&!this.isNoUser?(this.preloadedUserStatus?this.setUserStatus(this.preloadedUserStatus):this.fetchUserStatus(this.user),j("user_status:status.updated",this.handleUserStatusUpdated)):!this.hideStatus&&this.preloadedUserStatus&&this.setUserStatus(this.preloadedUserStatus)},beforeUnmount(){z("settings:avatar:updated",this.loadAvatarUrl),z("settings:display-name:updated",this.loadAvatarUrl),z("user_status:status.updated",this.handleUserStatusUpdated)},methods:{t:B,handleUserStatusUpdated(i){this.user===i.userId&&(this.userStatus={status:i.status,icon:i.icon,message:i.message},this.hasStatus=i.status!==null)},async toggleMenu(i){i.type==="keydown"&&i.key!=="Enter"||(this.contactsMenuOpenState||await this.fetchContactsMenu(),this.contactsMenuOpenState=!this.contactsMenuOpenState)},closeMenu(){this.contactsMenuOpenState=!1},async fetchContactsMenu(){this.contactsMenuLoading=!0;try{const i=encodeURIComponent(this.user),{data:r}=await at.post(rt("contactsmenu/findOne"),`shareType=0&shareWith=${i}`);this.contactsMenuData=r,this.contactsMenuActions=r.topAction?[r.topAction].concat(r.actions):r.actions}catch{this.contactsMenuOpenState=!1}this.contactsMenuLoading=!1,this.isMenuLoaded=!0},loadAvatarUrl(){if(this.isAvatarLoaded=!1,!this.isUrlDefined&&(!this.isUserDefined||this.isNoUser||this.iconClass||this.$slots.icon)){this.isAvatarLoaded=!0,this.userDoesNotExist=!0;return}if(this.isUrlDefined){this.updateImageIfValid(this.url);return}if(this.size<=64){const i=this.avatarUrlGenerator(this.user,64),r=[i+" 1x",this.avatarUrlGenerator(this.user,512)+" 8x"].join(", ");this.updateImageIfValid(i,r)}else{const i=this.avatarUrlGenerator(this.user,512);this.updateImageIfValid(i)}},avatarUrlGenerator(i,r){let n=de(i,{size:r,isDarkTheme:this.isDarkTheme,isGuest:this.isGuest});return i===H()?.uid&&typeof oc_userconfig<"u"&&(n+="?v="+window.oc_userconfig.avatar.version),n},updateImageIfValid(i,r=null){const n=pe(this.user);if(this.isUserDefined&&typeof n=="boolean"){this.isAvatarLoaded=!0,this.avatarUrlLoaded=i,r&&(this.avatarSrcSetLoaded=r),n===!1&&(this.userDoesNotExist=!0);return}const e=new Image;e.onload=()=>{this.avatarUrlLoaded=i,r&&(this.avatarSrcSetLoaded=r),this.isAvatarLoaded=!0,st(this.user,!0)},e.onerror=t=>{K.debug("[NcAvatar] Invalid avatar url",{error:t,url:i}),this.avatarUrlLoaded=null,this.avatarSrcSetLoaded=null,this.userDoesNotExist=!0,this.isAvatarLoaded=!1,st(this.user,!1)},r&&(e.srcset=r),e.src=i}}},ge=["title"],ye=["src","srcset"],ve={key:2,class:"avatardiv__user-status avatardiv__user-status--icon"};function be(i,r,n,e,t,s){const a=I("NcLoadingIcon"),f=I("IconDotsHorizontal"),p=I("NcButton"),S=I("NcIconSvgWrapper"),A=I("NcActions"),_=I("NcUserStatusIcon"),x=bt("click-outside");return St((m(),b("span",{class:q(["avatardiv popovermenu-wrapper",{"avatardiv--unknown":t.userDoesNotExist,"avatardiv--with-menu":s.hasMenu,"avatardiv--with-menu-loading":t.contactsMenuLoading}]),style:P(s.avatarStyle),title:s.tooltip},[it(i.$slots,"icon",{},()=>[n.iconClass?(m(),b("span",{key:0,class:q([n.iconClass,"avatar-class-icon"])},null,2)):t.isAvatarLoaded&&!t.userDoesNotExist?(m(),b("img",{key:1,src:t.avatarUrlLoaded,srcset:t.avatarSrcSetLoaded,alt:""},null,8,ye)):N("",!0)],!0),s.hasMenu&&s.menu.length===0?(m(),M(p,{key:0,"aria-label":s.avatarAriaLabel,class:"action-item action-item__menutoggle",variant:"tertiary-no-background",onClick:s.toggleMenu},{icon:D(()=>[t.contactsMenuLoading?(m(),M(a,{key:0})):(m(),M(f,{key:1,size:20}))]),_:1},8,["aria-label","onClick"])):s.hasMenu?(m(),M(A,{key:1,open:t.contactsMenuOpenState,"onUpdate:open":r[0]||(r[0]=g=>t.contactsMenuOpenState=g),"aria-label":s.avatarAriaLabel,container:n.menuContainer,forceMenu:"",manualOpen:"",variant:"tertiary-no-background",onClick:s.toggleMenu},X({default:D(()=>[(m(!0),b(_t,null,At(s.menu,(g,c)=>(m(),M(xt(g.ncActionComponent),kt({key:c},{ref_for:!0},g.ncActionComponentProps),X({default:D(()=>[wt(" "+U(g.text),1)]),_:2},[g.iconSvg?{name:"icon",fn:D(()=>[Y(S,{svg:g.iconSvg},null,8,["svg"])]),key:"0"}:void 0]),1040))),128))]),_:2},[t.contactsMenuLoading?{name:"icon",fn:D(()=>[Y(a)]),key:"0"}:void 0]),1032,["open","aria-label","container","onClick"])):N("",!0),s.showUserStatusIconOnAvatar?(m(),b("span",ve,U(i.userStatus.icon),1)):s.canDisplayUserStatus?(m(),M(_,{key:3,class:"avatardiv__user-status",status:i.userStatus.status,"aria-hidden":String(s.hasMenu)},null,8,["status","aria-hidden"])):N("",!0),s.showInitials?(m(),b("span",{key:4,style:P(s.initialsWrapperStyle),class:"avatardiv__initials-wrapper"},[$("span",{style:P(s.initialsStyle),class:"avatardiv__initials"},U(s.initials),5)],4)):N("",!0)],14,ge)),[[x,s.closeMenu]])}const Ee=nt(me,[["render",be],["__scopeId","data-v-72a1eed6"]]);export{Ee as N,fe as u};
//# sourceMappingURL=NcAvatar-C9d7Wrc8-DdpNMIwi.chunk.mjs.map
