{"version":3,"file":"core-unified-search.mjs","sources":["../core/src/components/UnifiedSearch/CustomDateRangeModal.vue","../core/src/components/UnifiedSearch/SearchFilterChip.vue","../core/src/components/UnifiedSearch/SearchableList.vue","../core/src/components/UnifiedSearch/SearchResult.vue","../core/src/services/UnifiedSearchService.js","../core/src/store/unified-search-external-filters.js","../core/src/views/UnifiedSearchModal.vue","../core/src/views/UnifiedSearch.vue","../core/src/unified-search.ts"],"sourcesContent":["<!--\n - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcModal v-if=\"isModalOpen\"\n\t\tid=\"unified-search\"\n\t\t:name=\"t('core', 'Custom date range')\"\n\t\t:show.sync=\"isModalOpen\"\n\t\t:size=\"'small'\"\n\t\t:clear-view-delay=\"0\"\n\t\t:title=\"t('core', 'Custom date range')\"\n\t\t@close=\"closeModal\">\n\t\t<!-- Custom date range -->\n\t\t<div class=\"unified-search-custom-date-modal\">\n\t\t\t<h1>{{ t('core', 'Custom date range') }}</h1>\n\t\t\t<div class=\"unified-search-custom-date-modal__pickers\">\n\t\t\t\t<NcDateTimePicker :id=\"'unifiedsearch-custom-date-range-start'\"\n\t\t\t\t\tv-model=\"dateFilter.startFrom\"\n\t\t\t\t\t:label=\"t('core', 'Pick start date')\"\n\t\t\t\t\ttype=\"date\" />\n\t\t\t\t<NcDateTimePicker :id=\"'unifiedsearch-custom-date-range-end'\"\n\t\t\t\t\tv-model=\"dateFilter.endAt\"\n\t\t\t\t\t:label=\"t('core', 'Pick end date')\"\n\t\t\t\t\ttype=\"date\" />\n\t\t\t</div>\n\t\t\t<div class=\"unified-search-custom-date-modal__footer\">\n\t\t\t\t<NcButton @click=\"applyCustomRange\">\n\t\t\t\t\t{{ t('core', 'Search in date range') }}\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<CalendarRangeIcon :size=\"20\" />\n\t\t\t\t\t</template>\n\t\t\t\t</NcButton>\n\t\t\t</div>\n\t\t</div>\n\t</NcModal>\n</template>\n\n<script>\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcDateTimePicker from '@nextcloud/vue/dist/Components/NcDateTimePickerNative.js'\nimport NcModal from '@nextcloud/vue/dist/Components/NcModal.js'\nimport CalendarRangeIcon from 'vue-material-design-icons/CalendarRange.vue'\n\nexport default {\n\tname: 'CustomDateRangeModal',\n\tcomponents: {\n\t\tNcButton,\n\t\tNcModal,\n\t\tCalendarRangeIcon,\n\t\tNcDateTimePicker,\n\t},\n\tprops: {\n\t\tisOpen: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tdateFilter: { startFrom: null, endAt: null },\n\t\t}\n\t},\n\tcomputed: {\n\t\tisModalOpen: {\n\t\t\tget() {\n\t\t\t\treturn this.isOpen\n\t\t\t},\n\t\t\tset(value) {\n\t\t\t\tthis.$emit('update:is-open', value)\n\t\t\t},\n\t\t},\n\t},\n\tmethods: {\n\t\tcloseModal() {\n\t\t\tthis.isModalOpen = false\n\t\t},\n\t\tapplyCustomRange() {\n\t\t\tthis.$emit('set:custom-date-range', this.dateFilter)\n\t\t\tthis.closeModal()\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.unified-search-custom-date-modal {\n\tpadding: 10px 20px 10px 20px;\n\n\th1 {\n\t\tfont-size: 16px;\n\t\tfont-weight: bolder;\n\t\tline-height: 2em;\n\t}\n\n\t&__pickers {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\n\t&__footer {\n\t\tdisplay: flex;\n\t\tjustify-content: end;\n\t}\n\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div class=\"chip\">\n\t\t<span class=\"icon\">\n\t\t\t<slot name=\"icon\" />\n\t\t\t<span v-if=\"pretext.length\"> {{ pretext }} : </span>\n\t\t</span>\n\t\t<span class=\"text\">{{ text }}</span>\n\t\t<span class=\"close-icon\" @click=\"deleteChip\">\n\t\t\t<CloseIcon :size=\"18\" />\n\t\t</span>\n\t</div>\n</template>\n\n<script>\nimport CloseIcon from 'vue-material-design-icons/Close.vue'\n\nexport default {\n\tname: 'SearchFilterChip',\n\tcomponents: {\n\t\tCloseIcon,\n\t},\n\tprops: {\n\t\ttext: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tpretext: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tmethods: {\n\t\tdeleteChip() {\n\t\t\tthis.$emit('delete', this.filter)\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.chip {\n    display: flex;\n    align-items: center;\n    padding: 2px 4px;\n    border: 1px solid var(--color-primary-element-light);\n    border-radius: 20px;\n    background-color: var(--color-primary-element-light);\n    margin: 2px;\n\n    .icon {\n        display: flex;\n        align-items: center;\n        padding-right: 5px;\n\n        img {\n            width: 20px;\n            padding: 2px;\n            border-radius: 20px;\n            filter: var(--background-invert-if-bright);\n        }\n    }\n\n    .text {\n        margin: 0 2px;\n    }\n\n    .close-icon {\n        cursor: pointer ;\n\n        :hover {\n            filter: invert(20%);\n        }\n    }\n}\n</style>\n","<!--\n  - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n  - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n\n<template>\n\t<NcPopover :shown=\"opened\"\n\t\t@show=\"opened = true\"\n\t\t@hide=\"opened = false\">\n\t\t<template #trigger>\n\t\t\t<slot ref=\"popoverTrigger\" name=\"trigger\" />\n\t\t</template>\n\t\t<div class=\"searchable-list__wrapper\">\n\t\t\t<NcTextField :value.sync=\"searchTerm\"\n\t\t\t\t:label=\"labelText\"\n\t\t\t\ttrailing-button-icon=\"close\"\n\t\t\t\t:show-trailing-button=\"searchTerm !== ''\"\n\t\t\t\t@update:value=\"searchTermChanged\"\n\t\t\t\t@trailing-button-click=\"clearSearch\">\n\t\t\t\t<Magnify :size=\"20\" />\n\t\t\t</NcTextField>\n\t\t\t<ul v-if=\"filteredList.length > 0\" class=\"searchable-list__list\">\n\t\t\t\t<li v-for=\"element in filteredList\"\n\t\t\t\t\t:key=\"element.id\"\n\t\t\t\t\t:title=\"element.displayName\"\n\t\t\t\t\trole=\"button\">\n\t\t\t\t\t<NcButton alignment=\"start\"\n\t\t\t\t\t\ttype=\"tertiary\"\n\t\t\t\t\t\t:wide=\"true\"\n\t\t\t\t\t\t@click=\"itemSelected(element)\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<NcAvatar v-if=\"element.isUser\" :user=\"element.user\" :show-user-status=\"false\" />\n\t\t\t\t\t\t\t<NcAvatar v-else\n\t\t\t\t\t\t\t\t:is-no-user=\"true\"\n\t\t\t\t\t\t\t\t:display-name=\"element.displayName\"\n\t\t\t\t\t\t\t\t:show-user-status=\"false\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t{{ element.displayName }}\n\t\t\t\t\t</NcButton>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div v-else class=\"searchable-list__empty-content\">\n\t\t\t\t<NcEmptyContent :name=\"emptyContentText\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<AlertCircleOutline />\n\t\t\t\t\t</template>\n\t\t\t\t</NcEmptyContent>\n\t\t\t</div>\n\t\t</div>\n\t</NcPopover>\n</template>\n\n<script>\nimport { NcPopover, NcTextField, NcAvatar, NcEmptyContent, NcButton } from '@nextcloud/vue'\n\nimport AlertCircleOutline from 'vue-material-design-icons/AlertCircleOutline.vue'\nimport Magnify from 'vue-material-design-icons/Magnify.vue'\n\nexport default {\n\tname: 'SearchableList',\n\n\tcomponents: {\n\t\tNcPopover,\n\t\tNcTextField,\n\t\tMagnify,\n\t\tAlertCircleOutline,\n\t\tNcAvatar,\n\t\tNcEmptyContent,\n\t\tNcButton,\n\t},\n\n\tprops: {\n\t\tlabelText: {\n\t\t\ttype: String,\n\t\t\tdefault: 'this is a label',\n\t\t},\n\n\t\tsearchList: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\n\t\temptyContentText: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t},\n\n\tdata() {\n\t\treturn {\n\t\t\topened: false,\n\t\t\terror: false,\n\t\t\tsearchTerm: '',\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tfilteredList() {\n\t\t\treturn this.searchList.filter((element) => {\n\t\t\t\tif (!this.searchTerm.toLowerCase().length) {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t\treturn ['displayName'].some(prop => element[prop].toLowerCase().includes(this.searchTerm.toLowerCase()))\n\t\t\t})\n\t\t},\n\t},\n\n\tmethods: {\n\t\tclearSearch() {\n\t\t\tthis.searchTerm = ''\n\t\t},\n\t\titemSelected(element) {\n\t\t\tthis.$emit('item-selected', element)\n\t\t\tthis.clearSearch()\n\t\t\tthis.opened = false\n\t\t},\n\t\tsearchTermChanged(term) {\n\t\t\tthis.$emit('search-term-change', term)\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.searchable-list {\n\t&__wrapper {\n\t\tpadding: calc(var(--default-grid-baseline) * 3);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\twidth: 250px;\n\t}\n\n\t&__list {\n\t\twidth: 100%;\n\t\tmax-height: 284px;\n\t\toverflow-y: auto;\n\t\tmargin-top: var(--default-grid-baseline);\n\t\tpadding: var(--default-grid-baseline);\n\n\t\t:deep(.button-vue) {\n\t\t\tborder-radius: var(--border-radius-large) !important;\n\t\t\tspan {\n\t\t\t\tfont-weight: initial;\n\t\t\t}\n\t\t}\n\t}\n\n\t&__empty-content {\n\t\tmargin-top: calc(var(--default-grid-baseline) * 3);\n\t}\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcListItem class=\"result-items__item\"\n\t\t:name=\"title\"\n\t\t:bold=\"false\"\n\t\t:href=\"resourceUrl\"\n\t\ttarget=\"_self\">\n\t\t<template #icon>\n\t\t\t<div aria-hidden=\"true\"\n\t\t\t\tclass=\"result-items__item-icon\"\n\t\t\t\t:class=\"{\n\t\t\t\t\t'result-items__item-icon--rounded': rounded,\n\t\t\t\t\t'result-items__item-icon--no-preview': !isValidIconOrPreviewUrl(thumbnailUrl),\n\t\t\t\t\t'result-items__item-icon--with-thumbnail': isValidIconOrPreviewUrl(thumbnailUrl),\n\t\t\t\t\t[icon]: !isValidIconOrPreviewUrl(icon),\n\t\t\t\t}\"\n\t\t\t\t:style=\"{\n\t\t\t\t\tbackgroundImage: isValidIconOrPreviewUrl(icon) ? `url(${icon})` : '',\n\t\t\t\t}\">\n\t\t\t\t<img v-if=\"isValidIconOrPreviewUrl(thumbnailUrl) && !thumbnailHasError\"\n\t\t\t\t\t:src=\"thumbnailUrl\"\n\t\t\t\t\t@error=\"thumbnailErrorHandler\">\n\t\t\t</div>\n\t\t</template>\n\t\t<template #subname>\n\t\t\t{{ subline }}\n\t\t</template>\n\t</NcListItem>\n</template>\n\n<script>\nimport NcListItem from '@nextcloud/vue/dist/Components/NcListItem.js'\n\nexport default {\n\tname: 'SearchResult',\n\tcomponents: {\n\t\tNcListItem,\n\t},\n\tprops: {\n\t\tthumbnailUrl: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tsubline: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\tresourceUrl: {\n\t\t\ttype: String,\n\t\t\tdefault: null,\n\t\t},\n\t\ticon: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\trounded: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tquery: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\n\t\t/**\n\t\t * Only used for the first result as a visual feedback\n\t\t * so we can keep the search input focused but pressing\n\t\t * enter still opens the first result\n\t\t */\n\t\tfocused: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tthumbnailHasError: false,\n\t\t}\n\t},\n\twatch: {\n\t\tthumbnailUrl() {\n\t\t\tthis.thumbnailHasError = false\n\t\t},\n\t},\n\tmethods: {\n\t\tisValidIconOrPreviewUrl(url) {\n\t\t\treturn /^https?:\\/\\//.test(url) || url.startsWith('/')\n\t\t},\n\t\tthumbnailErrorHandler() {\n\t\t\tthis.thumbnailHasError = true\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@use \"sass:math\";\n$clickable-area: 44px;\n$margin: 10px;\n\n.result-items {\n    &__item {\n\n    ::v-deep a {\n            border-radius: 12px;\n            border: 2px solid transparent;\n            border-radius: var(--border-radius-large) !important;\n\n            &--focused {\n                background-color: var(--color-background-hover);\n            }\n\n            &:active,\n            &:hover,\n            &:focus {\n                background-color: var(--color-background-hover);\n                border: 2px solid var(--color-border-maxcontrast);\n            }\n\n            * {\n                cursor: pointer;\n            }\n\n        }\n\n        &-icon {\n            overflow: hidden;\n            width: $clickable-area;\n            height: $clickable-area;\n            border-radius: var(--border-radius);\n            background-repeat: no-repeat;\n            background-position: center center;\n            background-size: 32px;\n\n            &--rounded {\n                border-radius: math.div($clickable-area, 2);\n            }\n\n            &--no-preview {\n                background-size: 32px;\n            }\n\n            &--with-thumbnail {\n                background-size: cover;\n            }\n\n            &--with-thumbnail:not(&--rounded) {\n                // compensate for border\n                max-width: $clickable-area - 2px;\n                max-height: $clickable-area - 2px;\n                border: 1px solid var(--color-border);\n            }\n\n            img {\n                // Make sure to keep ratio\n                width: 100%;\n                height: 100%;\n\n                object-fit: cover;\n                object-position: center;\n            }\n        }\n\n    }\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { generateOcsUrl, generateUrl } from '@nextcloud/router'\nimport axios from '@nextcloud/axios'\nimport { getCurrentUser } from '@nextcloud/auth'\n\n/**\n * Create a cancel token\n *\n * @return {import('axios').CancelTokenSource}\n */\nconst createCancelToken = () => axios.CancelToken.source()\n\n/**\n * Get the list of available search providers\n *\n * @return {Promise<Array>}\n */\nexport async function getProviders() {\n\ttry {\n\t\tconst { data } = await axios.get(generateOcsUrl('search/providers'), {\n\t\t\tparams: {\n\t\t\t\t// Sending which location we're currently at\n\t\t\t\tfrom: window.location.pathname.replace('/index.php', '') + window.location.search,\n\t\t\t},\n\t\t})\n\t\tif ('ocs' in data && 'data' in data.ocs && Array.isArray(data.ocs.data) && data.ocs.data.length > 0) {\n\t\t\t// Providers are sorted by the api based on their order key\n\t\t\treturn data.ocs.data\n\t\t}\n\t} catch (error) {\n\t\tconsole.error(error)\n\t}\n\treturn []\n}\n\n/**\n * Get the list of available search providers\n *\n * @param {object} options destructuring object\n * @param {string} options.type the type to search\n * @param {string} options.query the search\n * @param {number|string|undefined} options.cursor the offset for paginated searches\n * @param {string} options.since the search\n * @param {string} options.until the search\n * @param {string} options.limit the search\n * @param {string} options.person the search\n * @param {object} options.extraQueries additional queries to filter search results\n * @return {object} {request: Promise, cancel: Promise}\n */\nexport function search({ type, query, cursor, since, until, limit, person, extraQueries = {} }) {\n\t/**\n\t * Generate an axios cancel token\n\t */\n\tconst cancelToken = createCancelToken()\n\n\tconst request = async () => axios.get(generateOcsUrl('search/providers/{type}/search', { type }), {\n\t\tcancelToken: cancelToken.token,\n\t\tparams: {\n\t\t\tterm: query,\n\t\t\tcursor,\n\t\t\tsince,\n\t\t\tuntil,\n\t\t\tlimit,\n\t\t\tperson,\n\t\t\t// Sending which location we're currently at\n\t\t\tfrom: window.location.pathname.replace('/index.php', '') + window.location.search,\n\t\t\t...extraQueries,\n\t\t},\n\t})\n\n\treturn {\n\t\trequest,\n\t\tcancel: cancelToken.cancel,\n\t}\n}\n\n/**\n * Get the list of active contacts\n *\n * @param {object} filter filter contacts by string\n * @param filter.searchTerm\n * @return {object} {request: Promise}\n */\nexport async function getContacts({ searchTerm }) {\n\tconst { data: { contacts } } = await axios.post(generateUrl('/contactsmenu/contacts'), {\n\t\tfilter: searchTerm,\n\t})\n\t/*\n\t * Add authenticated user to list of contacts for search filter\n\t * If authtenicated user is searching/filtering, do not add them to the list\n\t */\n\tif (!searchTerm) {\n\t\tlet authenticatedUser = getCurrentUser()\n\t\tauthenticatedUser = {\n\t\t\tid: authenticatedUser.uid,\n\t\t\tfullName: authenticatedUser.displayName,\n\t\t\temailAddresses: [],\n\t\t  }\n\t\tcontacts.unshift(authenticatedUser)\n\t\treturn contacts\n\t  }\n\n\treturn contacts\n}\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\nimport { defineStore } from 'pinia'\n\nexport const useSearchStore = defineStore({\n\tid: 'search',\n\n\tstate: () => ({\n\t\texternalFilters: [],\n\t}),\n\n\tactions: {\n\t\tregisterExternalFilter({ id, appId, label, callback, icon }) {\n\t\t\tthis.externalFilters.push({ id, appId, name: label, callback, icon, isPluginFilter: true })\n\t\t},\n\t},\n})\n","<!--\n - SPDX-FileCopyrightText: 2023 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<NcModal id=\"unified-search\"\n\t\tref=\"unifiedSearchModal\"\n\t\t:show.sync=\"internalIsVisible\"\n\t\t:clear-view-delay=\"0\"\n\t\t@close=\"closeModal\">\n\t\t<CustomDateRangeModal :is-open=\"showDateRangeModal\"\n\t\t\tclass=\"unified-search__date-range\"\n\t\t\t@set:custom-date-range=\"setCustomDateRange\"\n\t\t\t@update:is-open=\"showDateRangeModal = $event\" />\n\t\t<!-- Unified search form -->\n\t\t<div ref=\"unifiedSearch\" class=\"unified-search-modal\">\n\t\t\t<div class=\"unified-search-modal__header\">\n\t\t\t\t<h2>{{ t('core', 'Unified search') }}</h2>\n\t\t\t\t<NcInputField ref=\"searchInput\"\n\t\t\t\t\tdata-cy-unified-search-input\n\t\t\t\t\t:value.sync=\"searchQuery\"\n\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t:label=\"t('core', 'Search apps, files, tags, messages') + '...'\"\n\t\t\t\t\t@update:value=\"debouncedFind\" />\n\t\t\t\t<div class=\"unified-search-modal__filters\" data-cy-unified-search-filters>\n\t\t\t\t\t<NcActions :menu-name=\"t('core', 'Places')\" :open.sync=\"providerActionMenuIsOpen\" data-cy-unified-search-filter=\"places\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<ListBox :size=\"20\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<!-- Provider id's may be duplicated since, plugin filters could depend on a provider that is already in the defaults.\n\t\t\t\t\t\tprovider.id concatenated to provider.name is used to create the item id, if same then, there should be an issue. -->\n\t\t\t\t\t\t<NcActionButton v-for=\"provider in providers\"\n\t\t\t\t\t\t\t:key=\"`${provider.id}-${provider.name.replace(/\\s/g, '')}`\"\n\t\t\t\t\t\t\t@click=\"addProviderFilter(provider)\">\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<img :src=\"provider.icon\" class=\"filter-button__icon\" alt=\"\">\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t{{ provider.name }}\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t</NcActions>\n\t\t\t\t\t<NcActions :menu-name=\"t('core', 'Date')\" :open.sync=\"dateActionMenuIsOpen\" data-cy-unified-search-filter=\"date\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<CalendarRangeIcon :size=\"20\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t\t<NcActionButton :close-after-click=\"true\" @click=\"applyQuickDateRange('today')\">\n\t\t\t\t\t\t\t{{ t('core', 'Today') }}\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t<NcActionButton :close-after-click=\"true\" @click=\"applyQuickDateRange('7days')\">\n\t\t\t\t\t\t\t{{ t('core', 'Last 7 days') }}\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t<NcActionButton :close-after-click=\"true\" @click=\"applyQuickDateRange('30days')\">\n\t\t\t\t\t\t\t{{ t('core', 'Last 30 days') }}\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t<NcActionButton :close-after-click=\"true\" @click=\"applyQuickDateRange('thisyear')\">\n\t\t\t\t\t\t\t{{ t('core', 'This year') }}\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t<NcActionButton :close-after-click=\"true\" @click=\"applyQuickDateRange('lastyear')\">\n\t\t\t\t\t\t\t{{ t('core', 'Last year') }}\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t\t<NcActionButton :close-after-click=\"true\" @click=\"applyQuickDateRange('custom')\">\n\t\t\t\t\t\t\t{{ t('core', 'Custom date range') }}\n\t\t\t\t\t\t</NcActionButton>\n\t\t\t\t\t</NcActions>\n\t\t\t\t\t<SearchableList :label-text=\"t('core', 'Search people')\"\n\t\t\t\t\t\t:search-list=\"userContacts\"\n\t\t\t\t\t\t:empty-content-text=\"t('core', 'Not found')\"\n\t\t\t\t\t\tdata-cy-unified-search-filter=\"people\"\n\t\t\t\t\t\t@search-term-change=\"debouncedFilterContacts\"\n\t\t\t\t\t\t@item-selected=\"applyPersonFilter\">\n\t\t\t\t\t\t<template #trigger>\n\t\t\t\t\t\t\t<NcButton>\n\t\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t\t<AccountGroup :size=\"20\" />\n\t\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t\t\t{{ t('core', 'People') }}\n\t\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</SearchableList>\n\t\t\t\t\t<NcButton v-if=\"supportFiltering\" data-cy-unified-search-filter=\"current-view\" @click=\"closeModal\">\n\t\t\t\t\t\t{{ t('core', 'Filter in current view') }}\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<FilterIcon :size=\"20\" />\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</NcButton>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"unified-search-modal__filters-applied\">\n\t\t\t\t\t<FilterChip v-for=\"filter in filters\"\n\t\t\t\t\t\t:key=\"filter.id\"\n\t\t\t\t\t\t:text=\"filter.name ?? filter.text\"\n\t\t\t\t\t\t:pretext=\"''\"\n\t\t\t\t\t\t@delete=\"removeFilter(filter)\">\n\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t<NcAvatar v-if=\"filter.type === 'person'\"\n\t\t\t\t\t\t\t\t:user=\"filter.user\"\n\t\t\t\t\t\t\t\t:size=\"24\"\n\t\t\t\t\t\t\t\t:disable-menu=\"true\"\n\t\t\t\t\t\t\t\t:show-user-status=\"false\"\n\t\t\t\t\t\t\t\t:hide-favorite=\"false\" />\n\t\t\t\t\t\t\t<CalendarRangeIcon v-else-if=\"filter.type === 'date'\" />\n\t\t\t\t\t\t\t<img v-else :src=\"filter.icon\" alt=\"\">\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</FilterChip>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div v-if=\"noContentInfo.show\" class=\"unified-search-modal__no-content\">\n\t\t\t\t<NcEmptyContent :name=\"noContentInfo.text\">\n\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t<component :is=\"noContentInfo.icon\" />\n\t\t\t\t\t</template>\n\t\t\t\t</NcEmptyContent>\n\t\t\t</div>\n\t\t\t<div v-else class=\"unified-search-modal__results\">\n\t\t\t\t<div v-for=\"providerResult in results\" :key=\"providerResult.id\" class=\"result\">\n\t\t\t\t\t<div class=\"result-title\">\n\t\t\t\t\t\t<span>{{ providerResult.provider }}</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class=\"result-items\">\n\t\t\t\t\t\t<SearchResult v-for=\"(result, index) in providerResult.results\" :key=\"index\" v-bind=\"result\" />\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div class=\"result-footer\">\n\t\t\t\t\t\t<NcButton type=\"tertiary-no-background\" @click=\"loadMoreResultsForProvider(providerResult.id)\">\n\t\t\t\t\t\t\t{{ t('core', 'Load more results') }}\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<DotsHorizontalIcon :size=\"20\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t\t<NcButton v-if=\"providerResult.inAppSearch\" alignment=\"end-reverse\" type=\"tertiary-no-background\">\n\t\t\t\t\t\t\t{{ t('core', 'Search in') }} {{ providerResult.provider }}\n\t\t\t\t\t\t\t<template #icon>\n\t\t\t\t\t\t\t\t<ArrowRight :size=\"20\" />\n\t\t\t\t\t\t\t</template>\n\t\t\t\t\t\t</NcButton>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</NcModal>\n</template>\n\n<script>\nimport ArrowRight from 'vue-material-design-icons/ArrowRight.vue'\nimport AccountGroup from 'vue-material-design-icons/AccountGroup.vue'\nimport CalendarRangeIcon from 'vue-material-design-icons/CalendarRange.vue'\nimport CustomDateRangeModal from '../components/UnifiedSearch/CustomDateRangeModal.vue'\nimport DotsHorizontalIcon from 'vue-material-design-icons/DotsHorizontal.vue'\nimport FilterIcon from 'vue-material-design-icons/Filter.vue'\nimport FilterChip from '../components/UnifiedSearch/SearchFilterChip.vue'\nimport ListBox from 'vue-material-design-icons/ListBox.vue'\nimport NcActions from '@nextcloud/vue/dist/Components/NcActions.js'\nimport NcActionButton from '@nextcloud/vue/dist/Components/NcActionButton.js'\nimport NcAvatar from '@nextcloud/vue/dist/Components/NcAvatar.js'\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport NcEmptyContent from '@nextcloud/vue/dist/Components/NcEmptyContent.js'\nimport NcInputField from '@nextcloud/vue/dist/Components/NcInputField.js'\nimport NcModal from '@nextcloud/vue/dist/Components/NcModal.js'\nimport MagnifyIcon from 'vue-material-design-icons/Magnify.vue'\nimport SearchableList from '../components/UnifiedSearch/SearchableList.vue'\nimport SearchResult from '../components/UnifiedSearch/SearchResult.vue'\n\nimport debounce from 'debounce'\nimport { emit, subscribe } from '@nextcloud/event-bus'\nimport { translate as t } from '@nextcloud/l10n'\nimport { useBrowserLocation } from '@vueuse/core'\nimport { getProviders, search as unifiedSearch, getContacts } from '../services/UnifiedSearchService.js'\nimport { useSearchStore } from '../store/unified-search-external-filters.js'\n\nexport default {\n\tname: 'UnifiedSearchModal',\n\tcomponents: {\n\t\tArrowRight,\n\t\tAccountGroup,\n\t\tCalendarRangeIcon,\n\t\tCustomDateRangeModal,\n\t\tDotsHorizontalIcon,\n\t\tFilterIcon,\n\t\tFilterChip,\n\t\tListBox,\n\t\tNcActions,\n\t\tNcActionButton,\n\t\tNcAvatar,\n\t\tNcButton,\n\t\tNcEmptyContent,\n\t\tNcModal,\n\t\tNcInputField,\n\t\tMagnifyIcon,\n\t\tSearchableList,\n\t\tSearchResult,\n\t},\n\tprops: {\n\t\tisVisible: {\n\t\t\ttype: Boolean,\n\t\t\trequired: true,\n\t\t},\n\t},\n\tsetup() {\n\t\t/**\n\t\t * Reactive version of window.location\n\t\t */\n\t\tconst currentLocation = useBrowserLocation()\n\t\tconst searchStore = useSearchStore()\n\t\treturn {\n\t\t\tcurrentLocation,\n\t\t\texternalFilters: searchStore.externalFilters,\n\t\t}\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tproviders: [],\n\t\t\tproviderActionMenuIsOpen: false,\n\t\t\tdateActionMenuIsOpen: false,\n\t\t\tproviderResultLimit: 5,\n\t\t\tdateFilter: { id: 'date', type: 'date', text: '', startFrom: null, endAt: null },\n\t\t\tpersonFilter: { id: 'person', type: 'person', name: '' },\n\t\t\tdateFilterIsApplied: false,\n\t\t\tpersonFilterIsApplied: false,\n\t\t\tfilteredProviders: [],\n\t\t\tsearching: false,\n\t\t\tsearchQuery: '',\n\t\t\tplacessearchTerm: '',\n\t\t\tdateTimeFilter: null,\n\t\t\tfilters: [],\n\t\t\tresults: [],\n\t\t\tcontacts: [],\n\t\t\tdebouncedFind: debounce(this.find, 300),\n\t\t\tdebouncedFilterContacts: debounce(this.filterContacts, 300),\n\t\t\tshowDateRangeModal: false,\n\t\t\tinternalIsVisible: false,\n\t\t}\n\t},\n\n\tcomputed: {\n\t\tuserContacts() {\n\t\t\treturn this.contacts\n\t\t},\n\t\tnoContentInfo() {\n\t\t\tconst isEmptySearch = this.searchQuery.length === 0\n\t\t\tconst hasNoResults = this.searchQuery.length > 0 && this.results.length === 0\n\t\t\treturn {\n\t\t\t\tshow: isEmptySearch || hasNoResults,\n\t\t\t\ttext: this.searching && hasNoResults ? t('core', 'Searching â€¦') : (isEmptySearch ? t('core', 'Start typing to search') : t('core', 'No matching results')),\n\t\t\t\ticon: MagnifyIcon,\n\t\t\t}\n\t\t},\n\t\tsupportFiltering() {\n\t\t\t/* Hard coded apps for the moment this would be improved in coming updates. */\n\t\t\tconst providerPaths = ['/settings/users', '/apps/files', '/apps/deck']\n\t\t\treturn providerPaths.some((path) => this.currentLocation.pathname?.includes?.(path))\n\t\t},\n\t},\n\twatch: {\n\t\tisVisible(value) {\n\t\t\tif (value) {\n\t\t\t\t/*\n\t\t\t\t * Before setting the search UI to visible, reset previous search event emissions.\n\t\t\t\t * This allows apps to restore defaults after \"Filter in current view\" if the user opens the search interface once more.\n\t\t\t\t * Additionally, it's a new search, so it's better to reset all previous events emitted.\n\t\t\t\t */\n\t\t\t\temit('nextcloud:unified-search.reset', { query: '' })\n\t\t\t}\n\t\t\tthis.internalIsVisible = value\n\t\t},\n\t\tinternalIsVisible(value) {\n\t\t\tthis.$emit('update:isVisible', value)\n\t\t\tthis.$nextTick(() => {\n\t\t\t\tif (value) {\n\t\t\t\t\tthis.focusInput()\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\n\t},\n\tmounted() {\n\t\tsubscribe('nextcloud:unified-search:add-filter', this.handlePluginFilter)\n\t\tgetProviders().then((providers) => {\n\t\t\tthis.providers = providers\n\t\t\tthis.externalFilters.forEach(filter => {\n\t\t\t\tthis.providers.push(filter)\n\t\t\t})\n\t\t\tthis.providers = this.groupProvidersByApp(this.providers)\n\t\t\tconsole.debug('Search providers', this.providers)\n\t\t})\n\t\tgetContacts({ searchTerm: '' }).then((contacts) => {\n\t\t\tthis.contacts = this.mapContacts(contacts)\n\t\t\tconsole.debug('Contacts', this.contacts)\n\t\t})\n\t},\n\tmethods: {\n\t\tfind(query) {\n\t\t\tthis.searching = true\n\t\t\tif (query.length === 0) {\n\t\t\t\tthis.results = []\n\t\t\t\tthis.searching = false\n\t\t\t\temit('nextcloud:unified-search.reset', { query })\n\t\t\t\treturn\n\t\t\t}\n\t\t\temit('nextcloud:unified-search.search', { query })\n\t\t\tconst newResults = []\n\t\t\tconst providersToSearch = this.filteredProviders.length > 0 ? this.filteredProviders : this.providers\n\t\t\tconst searchProvider = (provider, filters) => {\n\t\t\t\tconst params = {\n\t\t\t\t\ttype: provider.id,\n\t\t\t\t\tquery,\n\t\t\t\t\tcursor: null,\n\t\t\t\t\textraQueries: provider.extraParams,\n\t\t\t\t}\n\n\t\t\t\tif (filters.dateFilterIsApplied) {\n\t\t\t\t\tif (provider.filters.since && provider.filters.until) {\n\t\t\t\t\t\tparams.since = this.dateFilter.startFrom\n\t\t\t\t\t\tparams.until = this.dateFilter.endAt\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Date filter is applied but provider does not support it, no need to search provider\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (filters.personFilterIsApplied) {\n\t\t\t\t\tif (provider.filters.person) {\n\t\t\t\t\t\tparams.person = this.personFilter.user\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Person filter is applied but provider does not support it, no need to search provider\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (this.providerResultLimit > 5) {\n\t\t\t\t\tparams.limit = this.providerResultLimit\n\t\t\t\t}\n\n\t\t\t\tconst request = unifiedSearch(params).request\n\n\t\t\t\trequest().then((response) => {\n\t\t\t\t\tnewResults.push({\n\t\t\t\t\t\tid: provider.id,\n\t\t\t\t\t\tprovider: provider.name,\n\t\t\t\t\t\tinAppSearch: provider.inAppSearch,\n\t\t\t\t\t\tresults: response.data.ocs.data.entries,\n\t\t\t\t\t})\n\n\t\t\t\t\tconsole.debug('New results', newResults)\n\t\t\t\t\tconsole.debug('Unified search results:', this.results)\n\n\t\t\t\t\tthis.updateResults(newResults)\n\t\t\t\t\tthis.searching = false\n\t\t\t\t})\n\t\t\t}\n\t\t\tprovidersToSearch.forEach(provider => {\n\t\t\t\tconst dateFilterIsApplied = this.dateFilterIsApplied\n\t\t\t\tconst personFilterIsApplied = this.personFilterIsApplied\n\t\t\t\tsearchProvider(provider, { dateFilterIsApplied, personFilterIsApplied })\n\t\t\t})\n\n\t\t},\n\t\tupdateResults(newResults) {\n\t\t\tlet updatedResults = [...this.results]\n\t\t\t// If filters are applied, remove any previous results for providers that are not in current filters\n\t\t\tif (this.filters.length > 0) {\n\t\t\t\tupdatedResults = updatedResults.filter(result => {\n\t\t\t\t\treturn this.filters.some(filter => filter.id === result.id)\n\t\t\t\t})\n\t\t\t}\n\t\t\t// Process the new results\n\t\t\tnewResults.forEach(newResult => {\n\t\t\t\tconst existingResultIndex = updatedResults.findIndex(result => result.id === newResult.id)\n\t\t\t\tif (existingResultIndex !== -1) {\n\t\t\t\t\tif (newResult.results.length === 0) {\n\t\t\t\t\t\t// If the new results data has no matches for and existing result, remove the existing result\n\t\t\t\t\t\tupdatedResults.splice(existingResultIndex, 1)\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// If input triggered a change in existing results, update existing result\n\t\t\t\t\t\tupdatedResults.splice(existingResultIndex, 1, newResult)\n\t\t\t\t\t}\n\t\t\t\t} else if (newResult.results.length > 0) {\n\t\t\t\t\t// Push the new result to the array only if its results array is not empty\n\t\t\t\t\tupdatedResults.push(newResult)\n\t\t\t\t}\n\t\t\t})\n\t\t\tconst sortedResults = updatedResults.slice(0)\n\t\t\t// Order results according to provider preference\n\t\t\tsortedResults.sort((a, b) => {\n\t\t\t\tconst aProvider = this.providers.find(provider => provider.id === a.id)\n\t\t\t\tconst bProvider = this.providers.find(provider => provider.id === b.id)\n\t\t\t\tconst aOrder = aProvider ? aProvider.order : 0\n\t\t\t\tconst bOrder = bProvider ? bProvider.order : 0\n\t\t\t\treturn aOrder - bOrder\n\t\t\t})\n\t\t\tthis.results = sortedResults\n\t\t},\n\t\tmapContacts(contacts) {\n\t\t\treturn contacts.map(contact => {\n\t\t\t\treturn {\n\t\t\t\t\t// id: contact.id,\n\t\t\t\t\t// name: '',\n\t\t\t\t\tdisplayName: contact.fullName,\n\t\t\t\t\tisNoUser: false,\n\t\t\t\t\tsubname: contact.emailAddresses[0] ? contact.emailAddresses[0] : '',\n\t\t\t\t\ticon: '',\n\t\t\t\t\tuser: contact.id,\n\t\t\t\t\tisUser: contact.isUser,\n\t\t\t\t}\n\t\t\t})\n\t\t},\n\t\tfilterContacts(query) {\n\t\t\tgetContacts({ searchTerm: query }).then((contacts) => {\n\t\t\t\tthis.contacts = this.mapContacts(contacts)\n\t\t\t\tconsole.debug(`Contacts filtered by ${query}`, this.contacts)\n\t\t\t})\n\t\t},\n\t\tapplyPersonFilter(person) {\n\t\t\tthis.personFilterIsApplied = true\n\t\t\tconst existingPersonFilter = this.filters.findIndex(filter => filter.id === person.id)\n\t\t\tif (existingPersonFilter === -1) {\n\t\t\t\tthis.personFilter.id = person.id\n\t\t\t\tthis.personFilter.user = person.user\n\t\t\t\tthis.personFilter.name = person.displayName\n\t\t\t\tthis.filters.push(this.personFilter)\n\t\t\t} else {\n\t\t\t\tthis.filters[existingPersonFilter].id = person.id\n\t\t\t\tthis.filters[existingPersonFilter].user = person.user\n\t\t\t\tthis.filters[existingPersonFilter].name = person.displayName\n\t\t\t}\n\n\t\t\tthis.debouncedFind(this.searchQuery)\n\t\t\tconsole.debug('Person filter applied', person)\n\t\t},\n\t\tloadMoreResultsForProvider(providerId) {\n\t\t\tthis.providerResultLimit += 5\n\t\t\tthis.filters = this.filters.filter(filter => filter.type !== 'provider')\n\t\t\tconst provider = this.providers.find(provider => provider.id === providerId)\n\t\t\tthis.addProviderFilter(provider, true)\n\t\t},\n\t\taddProviderFilter(providerFilter, loadMoreResultsForProvider = false) {\n\t\t\tif (!providerFilter.id) return\n\t\t\tif (providerFilter.isPluginFilter) {\n\t\t\t\tproviderFilter.callback()\n\t\t\t}\n\t\t\tthis.providerResultLimit = loadMoreResultsForProvider ? this.providerResultLimit : 5\n\t\t\tthis.providerActionMenuIsOpen = false\n\t\t\t// With the possibility for other apps to add new filters\n\t\t\t// Resulting in a possible id/provider collision\n\t\t\t// If a user tries to apply a filter that seems to already exist, we remove the current one and add the new one.\n\t\t\tconst existingFilterIndex = this.filteredProviders.findIndex(existing => existing.id === providerFilter.id)\n\t\t\tif (existingFilterIndex > -1) {\n\t\t\t\tthis.filteredProviders.splice(existingFilterIndex, 1)\n\t\t\t\tthis.filters = this.syncProviderFilters(this.filters, this.filteredProviders)\n\t\t\t}\n\t\t\tthis.filteredProviders.push({\n\t\t\t\tid: providerFilter.id,\n\t\t\t\tname: providerFilter.name,\n\t\t\t\ticon: providerFilter.icon,\n\t\t\t\ttype: providerFilter.type || 'provider',\n\t\t\t\tfilters: providerFilter.filters,\n\t\t\t\tisPluginFilter: providerFilter.isPluginFilter || false,\n\t\t\t})\n\t\t\tthis.filters = this.syncProviderFilters(this.filters, this.filteredProviders)\n\t\t\tconsole.debug('Search filters (newly added)', this.filters)\n\t\t\tthis.debouncedFind(this.searchQuery)\n\t\t},\n\t\tremoveFilter(filter) {\n\t\t\tif (filter.type === 'provider') {\n\t\t\t\tfor (let i = 0; i < this.filteredProviders.length; i++) {\n\t\t\t\t\tif (this.filteredProviders[i].id === filter.id) {\n\t\t\t\t\t\tthis.filteredProviders.splice(i, 1)\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.filters = this.syncProviderFilters(this.filters, this.filteredProviders)\n\t\t\t\tconsole.debug('Search filters (recently removed)', this.filters)\n\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < this.filters.length; i++) {\n\t\t\t\t\t// Remove date and person filter\n\t\t\t\t\tif (this.filters[i].id === 'date' || this.filters[i].id === filter.id) {\n\t\t\t\t\t\tthis.dateFilterIsApplied = false\n\t\t\t\t\t\tthis.filters.splice(i, 1)\n\t\t\t\t\t\tif (filter.type === 'person') {\n\t\t\t\t\t\t\tthis.personFilterIsApplied = false\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.debouncedFind(this.searchQuery)\n\t\t},\n\t\tsyncProviderFilters(firstArray, secondArray) {\n\t\t\t// Create a copy of the first array to avoid modifying it directly.\n\t\t\tconst synchronizedArray = firstArray.slice()\n\t\t\t// Remove items from the synchronizedArray that are not in the secondArray.\n\t\t\tsynchronizedArray.forEach((item, index) => {\n\t\t\t\tconst itemId = item.id\n\t\t\t\tif (item.type === 'provider') {\n\t\t\t\t\tif (!secondArray.some(secondItem => secondItem.id === itemId)) {\n\t\t\t\t\t\tsynchronizedArray.splice(index, 1)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t// Add items to the synchronizedArray that are in the secondArray but not in the firstArray.\n\t\t\tsecondArray.forEach(secondItem => {\n\t\t\t\tconst itemId = secondItem.id\n\t\t\t\tif (secondItem.type === 'provider') {\n\t\t\t\t\tif (!synchronizedArray.some(item => item.id === itemId)) {\n\t\t\t\t\t\tsynchronizedArray.push(secondItem)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\n\t\t\treturn synchronizedArray\n\t\t},\n\t\tupdateDateFilter() {\n\t\t\tconst currFilterIndex = this.filters.findIndex(filter => filter.id === 'date')\n\t\t\tif (currFilterIndex !== -1) {\n\t\t\t\tthis.filters[currFilterIndex] = this.dateFilter\n\t\t\t} else {\n\t\t\t\tthis.filters.push(this.dateFilter)\n\t\t\t}\n\t\t\tthis.dateFilterIsApplied = true\n\t\t\tthis.debouncedFind(this.searchQuery)\n\t\t},\n\t\tapplyQuickDateRange(range) {\n\t\t\tthis.dateActionMenuIsOpen = false\n\t\t\tconst today = new Date()\n\t\t\tlet startDate\n\t\t\tlet endDate\n\n\t\t\tswitch (range) {\n\t\t\tcase 'today':\n\t\t\t\t// For 'Today', both start and end are set to today\n\t\t\t\tstartDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 0, 0, 0, 0)\n\t\t\t\tendDate = new Date(today.getFullYear(), today.getMonth(), today.getDate(), 23, 59, 59, 999)\n\t\t\t\tthis.dateFilter.text = t('core', 'Today')\n\t\t\t\tbreak\n\t\t\tcase '7days':\n\t\t\t\t// For 'Last 7 days', start date is 7 days ago, end is today\n\t\t\t\tstartDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 6, 0, 0, 0, 0)\n\t\t\t\tthis.dateFilter.text = t('core', 'Last 7 days')\n\t\t\t\tbreak\n\t\t\tcase '30days':\n\t\t\t\t// For 'Last 30 days', start date is 30 days ago, end is today\n\t\t\t\tstartDate = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 29, 0, 0, 0, 0)\n\t\t\t\tthis.dateFilter.text = t('core', 'Last 30 days')\n\t\t\t\tbreak\n\t\t\tcase 'thisyear':\n\t\t\t\t// For 'This year', start date is the first day of the year, end is the last day of the year\n\t\t\t\tstartDate = new Date(today.getFullYear(), 0, 1, 0, 0, 0, 0)\n\t\t\t\tendDate = new Date(today.getFullYear(), 11, 31, 23, 59, 59, 999)\n\t\t\t\tthis.dateFilter.text = t('core', 'This year')\n\t\t\t\tbreak\n\t\t\tcase 'lastyear':\n\t\t\t\t// For 'Last year', start date is the first day of the previous year, end is the last day of the previous year\n\t\t\t\tstartDate = new Date(today.getFullYear() - 1, 0, 1, 0, 0, 0, 0)\n\t\t\t\tendDate = new Date(today.getFullYear() - 1, 11, 31, 23, 59, 59, 999)\n\t\t\t\tthis.dateFilter.text = t('core', 'Last year')\n\t\t\t\tbreak\n\t\t\tcase 'custom':\n\t\t\t\tthis.showDateRangeModal = true\n\t\t\t\treturn\n\t\t\tdefault:\n\t\t\t\treturn\n\t\t\t}\n\t\t\tthis.dateFilter.startFrom = startDate\n\t\t\tthis.dateFilter.endAt = endDate\n\t\t\tthis.updateDateFilter()\n\n\t\t},\n\t\tsetCustomDateRange(event) {\n\t\t\tconsole.debug('Custom date range', event)\n\t\t\tthis.dateFilter.startFrom = event.startFrom\n\t\t\tthis.dateFilter.endAt = event.endAt\n\t\t\tthis.dateFilter.text = t('core', `Between ${this.dateFilter.startFrom.toLocaleDateString()} and ${this.dateFilter.endAt.toLocaleDateString()}`)\n\t\t\tthis.updateDateFilter()\n\t\t},\n\t\thandlePluginFilter(addFilterEvent) {\n\t\t\tfor (let i = 0; i < this.filteredProviders.length; i++) {\n\t\t\t\tconst provider = this.filteredProviders[i]\n\t\t\t\tif (provider.id === addFilterEvent.id) {\n\t\t\t\t\tprovider.name = addFilterEvent.filterUpdateText\n\t\t\t\t\t// Filters attached may only make sense with certain providers,\n\t\t\t\t\t// So, find the provider attached, add apply the extra parameters to those providers only\n\t\t\t\t\tconst compatibleProviderIndex = this.providers.findIndex(provider => provider.id === addFilterEvent.id)\n\t\t\t\t\tif (compatibleProviderIndex > -1) {\n\t\t\t\t\t\tprovider.extraParams = addFilterEvent.filterParams\n\t\t\t\t\t\tthis.filteredProviders[i] = provider\n\t\t\t\t\t}\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.debouncedFind(this.searchQuery)\n\t\t},\n\t\tgroupProvidersByApp(filters) {\n\t\t\tconst groupedByProviderApp = {}\n\n\t\t\tfilters.forEach(filter => {\n\t\t\t\tconst provider = filter.appId ? filter.appId : 'general'\n\t\t\t\tif (!groupedByProviderApp[provider]) {\n\t\t\t\t\tgroupedByProviderApp[provider] = []\n\t\t\t\t}\n\t\t\t\tgroupedByProviderApp[provider].push(filter)\n\t\t\t})\n\n\t\t\tconst flattenedArray = []\n\t\t\tObject.values(groupedByProviderApp).forEach(group => {\n\t\t\t\tflattenedArray.push(...group)\n\t\t\t})\n\n\t\t\treturn flattenedArray\n\t\t},\n\t\tfocusInput() {\n\t\t\tthis.$refs.searchInput.$el.children[0].children[0].focus()\n\t\t},\n\t\tcloseModal() {\n\t\t\tthis.internalIsVisible = false\n\t\t\tthis.searchQuery = ''\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.unified-search-modal {\n\tbox-sizing: border-box;\n\theight: 100%;\n\tmin-height: 80vh;\n\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding-block: 10px 0;\n\n\t// inline padding on direct children to make sure the scrollbar is on the modal container\n\t>* {\n\t\tpadding-inline: 20px;\n\t}\n\n\t&__header {\n\t\tpadding-block-end: 8px;\n\t}\n\n\t&__heading {\n\t\tfont-size: 16px;\n\t\tfont-weight: bolder;\n\t\tline-height: 2em;\n\t\tmargin-bottom: 0;\n\t}\n\n\t&__filters {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\tgap: 4px;\n\t\tjustify-content: start;\n\t\tpadding-top: 4px;\n\t}\n\n\t&__filters-applied {\n\t\tpadding-top: 4px;\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t}\n\n\t&__no-content {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\theight: 100%;\n\t}\n\n\t&__results {\n\t\toverflow: hidden scroll;\n\t\tpadding-block: 0 10px;\n\n\t\t.result {\n\t\t\t&-title {\n\t\t\t\tspan {\n\t\t\t\t\tcolor: var(--color-primary-element);\n\t\t\t\t\tfont-weight: bolder;\n\t\t\t\t\tfont-size: 16px;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t&-footer {\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\tdisplay: flex;\n\t\t\t}\n\t\t}\n\n\t}\n}\n\n.filter-button__icon {\n\theight: 20px;\n\twidth: 20px;\n\tobject-fit: contain;\n\tfilter: var(--background-invert-if-bright);\n\tpadding: 11px; // align with text to fit at least 44px\n}\n\n// Ensure modal is accessible on small devices\n@media only screen and (max-height: 400px) {\n\t.unified-search-modal__results {\n\t\toverflow: unset;\n\t}\n}\n</style>\n","<!--\n - SPDX-FileCopyrightText: 2020 Nextcloud GmbH and Nextcloud contributors\n - SPDX-License-Identifier: AGPL-3.0-or-later\n-->\n<template>\n\t<div class=\"header-menu unified-search-menu\">\n\t\t<NcButton class=\"header-menu__trigger\"\n\t\t\t:aria-label=\"t('core', 'Unified search')\"\n\t\t\ttype=\"tertiary-no-background\"\n\t\t\t@click=\"toggleUnifiedSearch\">\n\t\t\t<template #icon>\n\t\t\t\t<Magnify class=\"header-menu__trigger-icon\" :size=\"20\" />\n\t\t\t</template>\n\t\t</NcButton>\n\t\t<UnifiedSearchModal :is-visible=\"showUnifiedSearch\" @update:isVisible=\"handleModalVisibilityChange\" />\n\t</div>\n</template>\n\n<script>\nimport NcButton from '@nextcloud/vue/dist/Components/NcButton.js'\nimport Magnify from 'vue-material-design-icons/Magnify.vue'\nimport UnifiedSearchModal from './UnifiedSearchModal.vue'\n\nexport default {\n\tname: 'UnifiedSearch',\n\tcomponents: {\n\t\tNcButton,\n\t\tMagnify,\n\t\tUnifiedSearchModal,\n\t},\n\tdata() {\n\t\treturn {\n\t\t\tshowUnifiedSearch: false,\n\t\t}\n\t},\n\tmounted() {\n\t\tconsole.debug('Unified search initialized!')\n\t},\n\tmethods: {\n\t\ttoggleUnifiedSearch() {\n\t\t\tthis.showUnifiedSearch = !this.showUnifiedSearch\n\t\t},\n\t\thandleModalVisibilityChange(newVisibilityVal) {\n\t\t\tthis.showUnifiedSearch = newVisibilityVal\n\t\t},\n\t},\n}\n</script>\n\n<style lang=\"scss\" scoped>\n// this is needed to allow us overriding component styles (focus-visible)\n#header {\n\t.header-menu {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\n\t\t&__trigger {\n\t\t\theight: var(--header-height);\n\t\t\twidth: var(--header-height) !important;\n\n\t\t\t&:focus-visible {\n\t\t\t\t// align with other header menu entries\n\t\t\t\toutline: none !important;\n\t\t\t\tbox-shadow: none !important;\n\t\t\t}\n\n\t\t\t&:not(:hover,:focus,:focus-visible) {\n\t\t\t\topacity: .85;\n\t\t\t}\n\n\t\t\t&-icon {\n\t\t\t\t// ensure the icon has the correct color\n\t\t\t\tcolor: var(--color-background-plain-text) !important;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>\n","/**\n * SPDX-FileCopyrightText: 2024 Nextcloud GmbH and Nextcloud contributors\n * SPDX-License-Identifier: AGPL-3.0-or-later\n */\n\nimport { getLoggerBuilder } from '@nextcloud/logger'\nimport { translate as t, translatePlural as n } from '@nextcloud/l10n'\nimport { createPinia, PiniaVuePlugin } from 'pinia'\nimport Vue from 'vue'\n\nimport UnifiedSearch from './views/UnifiedSearch.vue'\nimport { useSearchStore } from '../src/store/unified-search-external-filters.js'\n\nconst logger = getLoggerBuilder()\n\t.setApp('unified-search')\n\t.detectUser()\n\t.build()\n\nVue.mixin({\n\tdata() {\n\t\treturn {\n\t\t\tlogger,\n\t\t}\n\t},\n\tmethods: {\n\t\tt,\n\t\tn,\n\t},\n})\n\n// Define type structure for unified searc action\ninterface UnifiedSearchAction {\n\tid: string;\n\tappId: string;\n\tlabel: string;\n\ticon: string;\n\tcallback: () => void;\n}\n\n// Register the add/register filter action API globally\nwindow.OCA = window.OCA || {}\nwindow.OCA.UnifiedSearch = {\n\tregisterFilterAction: ({ id, appId, label, callback, icon }: UnifiedSearchAction) => {\n\t\tconst searchStore = useSearchStore()\n\t\tsearchStore.registerExternalFilter({ id, appId, label, callback, icon })\n\t},\n}\n\nVue.use(PiniaVuePlugin)\nconst pinia = createPinia()\n\nexport default new Vue({\n\tel: '#unified-search',\n\tpinia,\n\t// eslint-disable-next-line vue/match-component-file-name\n\tname: 'UnifiedSearchRoot',\n\trender: h => h(UnifiedSearch),\n})\n"],"names":["_sfc_main","NcButton","NcModal","CalendarRangeIcon","NcDateTimePicker","value","CloseIcon","NcPopover","NcTextField","Magnify","AlertCircleOutline","NcAvatar","NcEmptyContent","element","prop","term","NcListItem","url","createCancelToken","axios","getProviders","data","generateOcsUrl","error","search","type","query","cursor","since","until","limit","person","extraQueries","cancelToken","getContacts","searchTerm","contacts","generateUrl","authenticatedUser","getCurrentUser","useSearchStore","defineStore","id","appId","label","callback","icon","ArrowRight","AccountGroup","CustomDateRangeModal","DotsHorizontalIcon","FilterIcon","FilterChip","ListBox","NcActions","NcActionButton","NcInputField","MagnifyIcon","SearchableList","SearchResult","currentLocation","useBrowserLocation","searchStore","debounce","isEmptySearch","hasNoResults","t","path","_b","_a","emit","subscribe","providers","filter","newResults","providersToSearch","searchProvider","provider","filters","params","request","unifiedSearch","response","dateFilterIsApplied","personFilterIsApplied","updatedResults","result","newResult","existingResultIndex","sortedResults","a","b","aProvider","bProvider","aOrder","bOrder","contact","existingPersonFilter","providerId","providerFilter","loadMoreResultsForProvider","existingFilterIndex","existing","i","firstArray","secondArray","synchronizedArray","item","index","itemId","secondItem","currFilterIndex","range","today","startDate","endDate","event","addFilterEvent","groupedByProviderApp","flattenedArray","group","UnifiedSearchModal","newVisibilityVal","logger","getLoggerBuilder","Vue","n","PiniaVuePlugin","pinia","createPinia","h","UnifiedSearch"],"mappings":"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"}